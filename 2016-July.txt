From chris at projectclearwater.org  Fri Jul  1 04:33:23 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Fri, 1 Jul 2016 08:33:23 +0000
Subject: [Project Clearwater] homestead not running
In-Reply-To: <CAMKvRk_W4XWS8BM3P2f4QAN7s61UiDgWWyO_0FaEEq-VLHOXew@mail.gmail.com>
References: <CAMKvRk8ReMsCpP4t0QG4GsX=f=2PS6DGF+75m+=nm_oaZObYRQ@mail.gmail.com>
	<CY1PR02MB11815F82088D9D9C21CEA9D2E12E0@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CAMKvRk_W4XWS8BM3P2f4QAN7s61UiDgWWyO_0FaEEq-VLHOXew@mail.gmail.com>
Message-ID: <CY1PR02MB1181727EA656BE9DBF897BB3E1250@CY1PR02MB1181.namprd02.prod.outlook.com>

Thank you for the logs.

I looked in the Monit logs, and see the following lines:


[CST Jun 25 14:17:30] error    : 'cassandra_process' process is not running

[CST Jun 25 14:17:30] info     : 'cassandra_process' trying to restart

[CST Jun 25 14:17:30] info     : 'cassandra_process' restart: /bin/bash

[CST Jun 25 14:18:00] error    : 'cassandra_process' failed to start

[CST Jun 25 14:18:00] info     : 'cassandra_process' start: /bin/bash

[CST Jun 25 14:18:30] error    : 'cassandra_process' failed to start

This means that Cassandra has not started. Homestead is trying to connect to Cassandra on port 9160, so this would explain the error that you show below.

It also looks like etcd is failing to start. We need etcd to start up for Clearwater?s cluster manager to put Cassandra?s configuration in place, so the interesting question is why etcd is not running.

The first thing to check is that you have local config set up correctly. If you send over /etc/clearwater/local_config, I can take a look and check.

If that doesn?t show up any problems, I can take a look at the etcd logs and see if I can spot anything. You can find these at:

?         /var/log/clearwater-etcd

?         /var/log/clearwater-cluster-manager

Yours,

Chris

From: ??? [mailto:kate3018250 at gmail.com]
Sent: 27 June 2016 05:10
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Subject: Re: [Project Clearwater] homestead not running

Hi Chris,

I tried wait over twenty minutes , but it still not work.

I look those logs , However I don't know how to fix it.

Wish you can give me some tips. Thanks.

here is  monit.log

https://docs.google.com/document/d/1pPlrmEwWXz41m2wxnV5Gx0WkOZJEUbbum3RH1Kfheyo/edit?usp=sharing

these is cassandra system.log

https://docs.google.com/document/d/1EniWd3tALvgTpbm512kJqsV_HL8wdeYeJSJrdnUX69g/edit?usp=sharing

thanks for your help.

Yours,

Morris

2016-06-24 22:30 GMT+08:00 Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>:
Hi,

This log comes when Homestead cannot talk to Cassandra. Sometimes, Cassandra takes some time to start up, and homestead starts working after 10 minutes.

If this did not fix itself, can you please send over the Cassandra and Monit logs? You can find these in /var/log/cassandra and /var/log/monit.log.

Finally, did you run any other commands on your system?

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of ???
Sent: 20 June 2016 15:41
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] homestead not running

After I install homestead , it is not running .

However , when I command sudo service homestead restart , there is no error message.

It present OK , when I command sudo service homestead run ,

It comes "TSocket::open() connect() <Host: localhost Port: 9160>Connection refused"

(My ellis ralf homer bono sprout is running , and I install as "All in one")

the port 9160 is open .

how can I do to fix this problem.

thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160701/4fb2aa4c/attachment.html>

From Chris.Elford at metaswitch.com  Fri Jul  1 10:47:22 2016
From: Chris.Elford at metaswitch.com (Chris Elford)
Date: Fri, 1 Jul 2016 14:47:22 +0000
Subject: [Project Clearwater] Horsea Sprint Release Note
Message-ID: <CY1PR02MB11818B0E15CD5F7B19066C4DE1250@CY1PR02MB1181.namprd02.prod.outlook.com>

The release for Project Clearwater sprint "Horsea" has been cut. The code for this release is tagged as release-101 in github.

As part of our move towards supporting CentOS alongside Ubuntu, we ported over several of the core Project Clearwater packages. Monit, libnss-ato, clearwater-snmp-alarm-agent, and clearwater-radius-auth now build and run on CentOS 7.

This release includes the following bug fixes:

*         SNMP scalars are exposed under the wrong OID (https://github.com/Metaswitch/cpp-common/issues/523)

*         Crash when re-raising alarms (https://github.com/Metaswitch/cpp-common/issues/521)

*         Must run create_user as root (at least first time) (https://github.com/Metaswitch/crest/issues/271)

*         Misleading 'Cassandra is not installed yet, skipping schema addition for now' log (https://github.com/Metaswitch/clearwater-cassandra/issues/95)

*         clearwater-socket-factory is labelled architecture "all" - should be "any" (https://github.com/Metaswitch/clearwater-infrastructure/issues/329)

*         bracket_ipv6_address on Sprout uses a constant 60-100% CPU (https://github.com/Metaswitch/clearwater-infrastructure/issues/328)

*         Race condition between AlarmReqAgent::stop and AlarmReqAgent::alarm_request (https://github.com/Metaswitch/clearwater-snmp-handlers/issues/127)

*         clearwater-cluster-manager gives error on start (https://github.com/Metaswitch/clearwater-etcd/issues/294)

*         Can't spin up homestead node from private repo (https://github.com/Metaswitch/clearwater-heat/issues/30)

*         Homestead node takes 15 minutes to come up (https://github.com/Metaswitch/clearwater-heat/issues/28)

*         No build of snmpd package (https://github.com/Metaswitch/centos-clearwater-net-snmp/issues/3)



To upgrade to this release, follow the instructions at http://docs.projectclearwater.org/en/stable/Upgrading_a_Clearwater_deployment.html. If you are deploying an all-in-one node, the standard image (http://vm-images.cw-ngv.com/cw-aio.ova) has been updated for this release.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160701/64fa0945/attachment.html>

From chris at projectclearwater.org  Mon Jul  4 10:12:00 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Mon, 4 Jul 2016 14:12:00 +0000
Subject: [Project Clearwater] Homer in Clearwater architecture
In-Reply-To: <CAGEe17YRh=5M0f6wSv2Ttw9wFcb6FP5fXqi6o3Xqj=_S4p8mxA@mail.gmail.com>
References: <CAGEe17YRh=5M0f6wSv2Ttw9wFcb6FP5fXqi6o3Xqj=_S4p8mxA@mail.gmail.com>
Message-ID: <CY1PR02MB1181653298DB4D24335AB94DE1380@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Kosala,

Thank you for getting in touch.

We?ve written crest (and homer) as a thin wrapper around Cassandra. Crest makes a lot of assumptions about the type of database that it is writing into, so switching out the database is not going to be simple.

That said, if you can tell us a little more about what you are trying to achieve, we may be able to help you to get something working. What are you looking to get out of another database? Is there a feature missing from Project Clearwater that we could be adding? Which database are you looking at using and why?

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kosala
Sent: 30 June 2016 14:36
To: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] Homer in Clearwater architecture

What should I do, if I need a different databse in Homer instead of Cassandra?
I assume that I should re-implement Crest-homer ?
Any reply is appreciated.
Thanks
Ko

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160704/a7e9426f/attachment.html>

From rodrigo.moreira at ufu.br  Mon Jul  4 12:00:30 2016
From: rodrigo.moreira at ufu.br (Rodrigo Moreira)
Date: Mon, 4 Jul 2016 13:00:30 -0300
Subject: [Project Clearwater] [PCRF in the Clearwater]
Message-ID: <CAGRP3yP=v2PGymYxW1kSYi=5KhSwd1Q3OvGfGO+OWmSO+1CZhA@mail.gmail.com>

Dear,

Can I integrate the PCRF in the CW Cluster?

The Ralf entity has Rx interface?

Thank you!

Att.,
Rodrigo Moreira
Skype: rodrigo.moreir2007
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160704/7758fe20/attachment.html>

From chris at projectclearwater.org  Tue Jul  5 04:12:18 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 5 Jul 2016 08:12:18 +0000
Subject: [Project Clearwater] [PCRF in the Clearwater]
In-Reply-To: <CAGRP3yP=v2PGymYxW1kSYi=5KhSwd1Q3OvGfGO+OWmSO+1CZhA@mail.gmail.com>
References: <CAGRP3yP=v2PGymYxW1kSYi=5KhSwd1Q3OvGfGO+OWmSO+1CZhA@mail.gmail.com>
Message-ID: <CY1PR02MB1181F871A4C9D677B8F7FF16E1390@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Rodrigo,

We have tested Project Clearwater in an VoLTE network using a PCRF. It should be able to provide the I-CSCF and S-CSCF in your network too.

The part of the IMS core that talks to the PCRF (over Rx) is the P-CSCF. Project Clearwater does not include a P-CSCF - Ralf supports the Rf interface for billing, not the Rx interface. I?m not aware of any open source P-CSCF, but if you find one, I would love to hear about it.

I know that Clearwater has been tested with several different P-CSCFs. We use Metaswitch Networks<http://www.metaswitch.com/>? Perimeta for our lab testing, and we?ve found that it works well.

Can I also suggest that you sign up<http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org> to the Project Clearwater mailing list? That way, your messages will not need to be approved by a moderator, and you can see solutions to questions posted by other users.

I hope that helps.

Yours,

Chris

From: Rodrigo Moreira [mailto:rodrigo.moreira at ufu.br]
Sent: 04 July 2016 17:01
To: Chris Elford <Chris.Elford at metaswitch.com>; Eleanor Merry <Eleanor.Merry at metaswitch.com>; clearwater at lists.projectclearwater.org
Subject: [PCRF in the Clearwater]

Dear,

Can I integrate the PCRF in the CW Cluster?

The Ralf entity has Rx interface?
Thank you!

Att.,
Rodrigo Moreira
Skype: rodrigo.moreir2007
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/52945077/attachment.html>

From matt at projectclearwater.org  Tue Jul  5 04:41:19 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Tue, 5 Jul 2016 08:41:19 +0000
Subject: [Project Clearwater] How to let clearwater sends sip messages
 to its app server with its public ip address
References: <D38893C2.7FE%leotang@cisco.com>
	<CY1PR02MB118196B383B77C3EECF3CF3EE12A0@CY1PR02MB1181.namprd02.prod.outlook.com>
	<D38DC94B.812%leotang@cisco.com> <D38DE19B.824%leotang@cisco.com>
	<CY1PR02MB118173F06C68718F517862BFE12C0@CY1PR02MB1181.namprd02.prod.outlook.com>
	<D390758F.832%leotang@cisco.com>
	<CY1PR0201MB15632D4183B4AE61B429899A902E0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<D396B933.868%leotang@cisco.com>
	<CY1PR0201MB156389AADC306C7DB3E1725B90210@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<D3970DEB.880%leotang@cisco.com>
	<BLUPR0201MB1556C79E8C65A33DA80DAAA190210@BLUPR0201MB1556.namprd02.prod.outlook.com>
	<D39719E3.889%leotang@cisco.com> 
Message-ID: <CY1PR0201MB156316B60165F3A162BDEBF490390@CY1PR0201MB1563.namprd02.prod.outlook.com>

Leo,

Richard has implemented this enhancement and it's now in the latest build of Sprout.  You can either

*         pick this up right now by changing /etc/apt/sources.list.d/clearwater.list to point to "deb http://repo.cw-ngv.com/latest binary/<http://repo.cw-ngv.com/latest%20binary/>" and running "sudo apt-get update && sudo apt-get install sprout" or

*         wait until the next release (sometime next week), which will include it automatically.

Once you have the new code, you can set "scscf_node_uri=<domain name>" in your /etc/clearwater/local_config, restart sprout with "sudo service sprout stop" and the domain name you specified will be used by Sprout when it adds a Route pointing to itself during AS invocation.

I hope that helps - please let us know how you get on.

Thanks,

Matt

From: Matt Williams (projectclearwater.org)
Sent: 28 June 2016 10:34
To: 'Leo Tang (leotang)' <leotang at cisco.com>
Cc: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>; 'clearwater at lists.projectclearwater.org' <clearwater at lists.projectclearwater.org>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Leo,

OK, I've raised https://github.com/Metaswitch/sprout/issues/1462 to track this enhancement.  I'd hope that we'd be able to implement this in the next few weeks, although I can't commit to a date.

Matt


From: Leo Tang (leotang) [mailto:leotang at cisco.com]
Sent: 27 June 2016 11:03
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Cc: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Matt,

Thanks for your quick response.
And yes,  I am using tropo product.

I am sorry I am not quite familiar with coding, so I can not submitting the patch.
That would be great if clearwater side can do an enhancement for the feature.

Thanks.
Leo

From: "Matt Williams (projectclearwater.org)" <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Date: Monday, June 27, 2016 at 5:53 PM
To: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>
Cc: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Leo,

Thanks for your response.

Sorry, I mis-spoke earlier - Bono uses the public_hostname when record-routing itself, but you're right that Sprout always uses the local_ip.

I think that means that we can't currently work around having a NAT between the core and the AS.  I was going to ask if this was a common deployment topology as we hadn't seen it before, but I see that you're using Tropo, so I think that explains it.

This shouldn't be too hard to enhance - the base SIP URI is built at https://github.com/Metaswitch/sprout/blob/dev/src/scscfplugin.cpp#L108 and it would be possible to override it through configuration.  I'm not sure whether/when we'd be able to get this enhancement made - would you be interested in coding and submitting a patch?

Thanks,

Matt

From: Leo Tang (leotang) [mailto:leotang at cisco.com]
Sent: 27 June 2016 10:11
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Cc: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Matt.

my local_config

$ cat /etc/clearwater/local_config

# Local IP configuration

local_ip=10.0.0.193

public_ip=52.91.36.255

public_hostname=ec2-52-91-36-255.compute-1.amazonaws.com

etcd_cluster=10.0.0.193



# Only keep 50MB of logs

max_log_directory_size=52428800


The invite message from clearwater. The red message which is filled with 10.0.0.193 which is a private ip that blocked our sip messages.

Jun 27 08:51:10.034 DEBUG  PRISM ////1/[] [tcp/0.0.0.0/5060-t-4] #SIP#: (i)[INVITE sip:6505550995 at example.com SIP/2.0
Allow: SUBSCRIBE, NOTIFY, INVITE, ACK, CANCEL, BYE, REFER, INFO, MESSAGE, OPTIONS
Content-Length: 210
Session-Expires: 600
Via: SIP/2.0/TCP 10.0.0.193:56977;rport;branch=z9hG4bKPjTU5TvfoybTaQ4utxymiSbK9p3DW4PD0j
Via: SIP/2.0/TCP 10.0.0.193:52597;rport=52597;received=10.0.0.193;branch=z9hG4bKPjyqVBfQt5EmKbUMI.9U6ROhl7LnvzK4k.
Via: SIP/2.0/TCP 10.140.254.65:5062;rport=53134;received=64.104.125.237;branch=z9hG4bK-524287-1---0c22544c8cc97b08
Record-Route: <sip:scscf.ec2-52-91-36-255.compute-1.amazonaws.com:5054;transport=tcp;lr;service=scscf;billing-role=charge-orig>
Record-Route: <sip:10.0.0.193:5058;transport=TCP;lr>
Record-Route: <sip:A/Dvrql946 at ec2-52-91-36-255.compute-1.amazonaws.com:5060;transport=TCP;lr>
CSeq: 1 INVITE
Route: <sip:incall-gw1-staging.wdc.tropo.com;lr>
Route: <sip:odi_uo8FopUxqy at 10.0.0.193:5054;lr;orig;service=scscf>
P-Served-User: <sip:6505550755 at example.com>;sescase=orig;regstate=reg
Contact: <sip:6505550755 at 64.104.125.237:53134;transport=tcp;rinstance=53467a66e45c8aa0>
Call-ID: 79049OTM3NTRlMTBkMmFiOTg2ZGNjZjQ3OWI3MjI3ZjE2MzQ
Max-Forwards: 67
From: "6505550755" <sip:6505550755 at example.com>;tag=91bed763
Content-Type: application/sdp
To: <sip:6505550995 at example.com>
P-Asserted-Identity: <sip:6505550755 at example.com>
Supported: replaces
User-Agent: X-Lite release 4.9.2 stamp 79049

v=0
o=- 1467017469752494 1 IN IP4 10.140.254.65
s=X-Lite release 4.9.2 stamp 79049
c=IN IP4 10.140.254.65
t=0 0
m=audio 60526 RTP/AVP 8 101
a=rtpmap:101 telephone-event/8000
a=fmtp:101 0-15
a=sendrecv
] #[N/A][N/A][79049OTM3NTRlMTBkMmFiOTg2ZGNjZjQ3OWI3MjI3ZjE2MzQ][N/A][sip:6505550755 at example.com(52.91.36.255:56977)][sip:6505550995 at example.com(198.11.254.107:5060)]


From: "Matt Williams (projectclearwater.org)" <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Date: Monday, June 27, 2016 at 4:14 PM
To: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>
Cc: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Leo,

Thanks for your response.

Clearwater Sprout doesn't currently support using a different URI in the Route (or Record-Route) header when sending to an AS from the URI it uses when sending to other nodes in the network.

You mention the Route header containing an IP address.  This should normally be filled in from the public_hostname field in /etc/clearwater/local_config.  While it is permitted for this to be an IP address, we'd often configure it to be an actual FQDN.  If you do that, does that help - you could configure split-horizon DNS so that when nodes within your network resolve the hostname, they get the internal IP address and when your AS resolves the hostname, it gets the public IP address?

You asked about multiple network support.  Note that this allows you to have your management traffic (e.g. ssh) on a separate network from your signaling traffic (e.g. SIP), so I'm not sure this is useful here.

I hope that helps - please let me know if you have any further questions.

Thanks,

Matt

From: Leo Tang (leotang) [mailto:leotang at cisco.com]
Sent: 27 June 2016 04:14
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Cc: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Matt,

Thanks for your professional reply.
Your understanding is 100 percent correct.

We do send Response messages with the public ip address and it works fine here.
The problem is that we have to send Request messages based on the route header which is private ip address.

I saw clearwater doc about multiple network support. Is that a solution for my case ?
I tried but failed.

Thanks.
Leo

From: "Matt Williams (projectclearwater.org)" <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Date: Friday, June 24, 2016 at 11:04 PM
To: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>
Cc: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Leo,

Thanks for your email.

Just to check I'm understanding correctly,

*         Sprout is sending an INVITE to an AS

*         Sprout sends from its private IP address, but this is NAT-ed to a public address before it reaches the AS

*         Sprout includes its private IP address in the Via header

*         when the AS comes to send a response, it tries to send back to the IP address in this Via header, which fails (because it's private and so not routable).

Is that right?

Following RFC 3621 section 18.2.1, I think the right way for this to work is

*         when the AS receives the INVITE, for it to add a "received" parameter to the Via header containing the IP address that it saw the request coming from

*         when the AS wants to reply to the INVITE, for it to use this IP address in preference to the original IP address in the Via header.

To borrow an example from RFC 3261 (emphasis mine):

   Consider a request received by the server transport which looks like,
   in part:

      INVITE sip:bob at biloxi.com<mailto:bob at biloxi.com> SIP/2.0
      Via: SIP/2.0/UDP bobspc.biloxi.com:5060

   The request is received with a source IP address of 192.0.2.4.
   Before passing the request up, the transport adds a "received"
   parameter, so that the request would look like, in part:

      INVITE sip:bob at Biloxi.com<mailto:bob at Biloxi.com> SIP/2.0
      Via: SIP/2.0/UDP bobspc.biloxi.com:5060;received=192.0.2.4

Do you agree?  And do you know why your AS is not behaving in this way?

I don't believe there's currently any option to change the IP address included in the Via header used by Sprout (without also changing the IP address that Sprout binds to), although it would probably be possible to add.

I hope that helps - please let me know if you have any further questions.

Thanks,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Leo Tang (leotang)
Sent: 22 June 2016 10:08
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Chris,

Yes. The private ip address 10.0.0.* is listed in the Via header in the INVITE.

Sure. I will sign up the mail list

Leo.

From: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Date: Wednesday, June 22, 2016 at 4:31 PM
To: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Leo,

You say that "clearwater sends the invite message with its private ip address 10.0.0.*." Do you mean that the private IP address is listed in the Via header in the INVITE, or that the IP packet was received from the private IP address? If you aren't sure, you should be able to find out by taking a packet capture on your server e.g. using tcpdump.

Can I suggest that you sign up to the Project Clearwater mailing list? That way, your messages won't need to be approved by a moderator, and you can see other similar problems that others are having.

Chris

From: Leo Tang (leotang) [mailto:leotang at cisco.com]
Sent: 20 June 2016 11:09
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

And Yes.  That's the trouble routing back to sprout.

From: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>
Date: Monday, June 20, 2016 at 4:31 PM
To: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: Re: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Chris,

Thanks so much for your reply.

The sip message flow is something like this: sip_client -> bono -> sprout -> my server and then go back.

I installed clearwater on aws so it has a private ip 10.0.0.* and a public ip 64.*.*.*

When the sip invite message comes in my server, I check with your sip messages and found clearwater sends the invite message with its private ip address 10.0.0.*.

According to sip protocal, I have to reply the sip messages with your private ip address. But clearwater refuses my reply.

I tried to send message to sprout with clearwater's public ip 64.*.*.*. And I found sprout can receive the messages.

So my question is that is there a way for clearwater to send the sip messages with its public ipaddress ?

I found some docs to describe how to configure clearwater multiple networks. But it Is very complex as I has only a network interface on my aws clearwater.



From: "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Date: Monday, June 20, 2016 at 4:18 PM
To: leo tang <leotang at cisco.com<mailto:leotang at cisco.com>>, "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi Leo,

There may be a way to solve your problem, but it would be helpful to know a little bit more about what you are trying to do.

Are you seeing the wrong value appear in one of the SIP headers coming from Sprout? If so, what symptoms is this causing in your network?

Are you seeing packets come from an unexpected location at the TCP/IP level, and having trouble routing back to your Sprout node? In that case, can you explain the cloud infrastructure that you are using, as our options are limited by what the cloud will allow.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Leo Tang (leotang)
Sent: 16 June 2016 10:35
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] How to let clearwater sends sip messages to its app server with its public ip address

Hi There.

Is there a simple way to let sprout sends sip messages to its app server with its public ip address?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/ff8c73a8/attachment.html>

From chris at projectclearwater.org  Tue Jul  5 05:08:14 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 5 Jul 2016 09:08:14 +0000
Subject: [Project Clearwater] [PCRF in the Clearwater]
In-Reply-To: <CY1PR02MB1181F871A4C9D677B8F7FF16E1390@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <CAGRP3yP=v2PGymYxW1kSYi=5KhSwd1Q3OvGfGO+OWmSO+1CZhA@mail.gmail.com>
	<CY1PR02MB1181F871A4C9D677B8F7FF16E1390@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <CY1PR02MB1181C8AFF5235B216C428DB6E1390@CY1PR02MB1181.namprd02.prod.outlook.com>

Matt (another of the project maintainers) has pointed out to me that Project Clearwater does contain a P-CSCF: Bono.

Unfortunately, Bono does not currently support the Rx interface. It is not something that we are looking at adding in the near future, but we welcome contributions.

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Chris Elford (projectclearwater.org)
Sent: 05 July 2016 09:12
To: Rodrigo Moreira <rodrigo.moreira at ufu.br>; clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] [PCRF in the Clearwater]

Hi Rodrigo,

We have tested Project Clearwater in an VoLTE network using a PCRF. It should be able to provide the I-CSCF and S-CSCF in your network too.

The part of the IMS core that talks to the PCRF (over Rx) is the P-CSCF. Project Clearwater does not include a P-CSCF - Ralf supports the Rf interface for billing, not the Rx interface. I?m not aware of any open source P-CSCF, but if you find one, I would love to hear about it.

I know that Clearwater has been tested with several different P-CSCFs. We use Metaswitch Networks<http://www.metaswitch.com/>? Perimeta for our lab testing, and we?ve found that it works well.

Can I also suggest that you sign up<http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org> to the Project Clearwater mailing list? That way, your messages will not need to be approved by a moderator, and you can see solutions to questions posted by other users.

I hope that helps.

Yours,

Chris

From: Rodrigo Moreira [mailto:rodrigo.moreira at ufu.br]
Sent: 04 July 2016 17:01
To: Chris Elford <Chris.Elford at metaswitch.com<mailto:Chris.Elford at metaswitch.com>>; Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [PCRF in the Clearwater]

Dear,

Can I integrate the PCRF in the CW Cluster?

The Ralf entity has Rx interface?
Thank you!

Att.,
Rodrigo Moreira
Skype: rodrigo.moreir2007
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/be726f72/attachment.html>

From anderson08121995 at gmail.com  Tue Jul  5 09:11:52 2016
From: anderson08121995 at gmail.com (=?UTF-8?B?5YqJ5Lqe5piH?=)
Date: Tue, 5 Jul 2016 21:11:52 +0800
Subject: [Project Clearwater] Cassandra problems while Installing Homer and
	Homestead
Message-ID: <CAMC9rEnYRsK7Bex=BuXkgvBwRodM6k_9kyUxzHCF0G5S-QwWZw@mail.gmail.com>

I installed 6 components respectively on six VM with Ubuntu Server 14.04.

Other 4 components is running, only the components that need the cassandra
will have problems!!

When I command DEBIAN_FRONTEND=noninteractive apt-get install homer --yes,
I saw the
message from the console that wrote "Cassandra is not installed yet,
skipping schema addition for now"!

I also saw the message "Cassandra is not configured yet", and I command
"cassandra status"
it didn't find cassandra.yaml which seem to configure the cassandra.

Can you give me some idea?

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/7a799222/attachment.html>

From kosalayb at gmail.com  Tue Jul  5 14:15:53 2016
From: kosalayb at gmail.com (Kosala)
Date: Tue, 5 Jul 2016 19:15:53 +0100
Subject: [Project Clearwater] Building Ellis
Message-ID: <CAGEe17ZUDha0SonwZDnbtYxN9JWNjizTDNzDm58_81vxCjrj0g@mail.gmail.com>

Hi there,

I followed this like ,
https://github.com/Metaswitch/ellis/blob/dev/docs/development.md to build
Ellis from the source code.

I properly used

git clone --recursive git at github.com:Metaswitch/ellis.git to clone the
source code.

Above link says, this build supports Ubuntu 14.04, with Python 2.7.3

I have Ubuntu 14.04, with Python 2.7.3 environment.

However, I am getting following errors:

1. after make env, I am getting as follows:

Installed /home/kosala/ellis/_env/lib/python2.7/site-packages/tornado-2.3-py2.7.egg
Processing dependencies for tornado==2.3
Finished processing dependencies for tornado==2.3
# Touch the sentinel file
touch /home/kosala/ellis/_env/.eggs_installed

but when I execute "_env/bin/easy_install --allow-hosts=None -f eggs/
eggs/*.egg"

kosala at ubuntu1404:~/ellis$ _env/bin/easy_install --allow-hosts=None -f
eggs/ eggs/*.egg
Not found: eggs/
error: Not a URL, existing file, or requirement spec: 'eggs/*.egg'

eggs folder is not creating in ellis.

2. Then I copied all *.egg from
ellis/_env/lib/python2.7/site-packages/ to eggs folder created in
ellis

Then I run :
_env/bin/easy_install --allow-hosts=None -f eggs/ eggs/*.egg
_env/bin/python setup.py install

both run without errors

3. Then I changed to the common folder and run (as in the instructions)

../_env/bin/python setup.py install

I am getting the following error:
running install
running bdist_egg
running egg_info
writing requirements to metaswitchcommon.egg-info/requires.txt
writing metaswitchcommon.egg-info/PKG-INFO
writing top-level names to metaswitchcommon.egg-info/top_level.txt
writing dependency_links to metaswitchcommon.egg-info/dependency_links.txt
reading manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
writing manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-x86_64/egg
running install_lib
running build_py
running build_ext
generating cffi module 'build/temp.linux-x86_64-2.7/_cffi.c'
already up-to-date
building '_cffi' extension
gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall
-Wstrict-prototypes -fPIC -I/usr/local/include/python2.7 -c
build/temp.linux-x86_64-2.7/_cffi.c -o
build/temp.linux-x86_64-2.7/build/temp.linux-x86_64-2.7/_cffi.o
build/temp.linux-x86_64-2.7/_cffi.c:423:43: fatal error:
namespace_hop.h: No such file or directory
                 #include "namespace_hop.h"
                                           ^
compilation terminated.
error: command 'gcc' failed with exit status 1

Your help to solve this issue is appreciated.

Many Thanks in advance.
Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/592e14ad/attachment.html>

From kosalayb at gmail.com  Tue Jul  5 14:19:25 2016
From: kosalayb at gmail.com (Kosala)
Date: Tue, 5 Jul 2016 19:19:25 +0100
Subject: [Project Clearwater] Building Ellis from source code
Message-ID: <CAGEe17bbe7Q5tntwpQaN0npYdf30WVhYw=DV_7Tr9+DZkL10dw@mail.gmail.com>

Hi there,

I followed this like ,
https://github.com/Metaswitch/ellis/blob/dev/docs/development.md to build
Ellis from the source code.

I properly used

git clone --recursive git at github.com:Metaswitch/ellis.git to clone the
source code.

Above link says, this build supports Ubuntu 14.04, with Python 2.7.3

I have Ubuntu 14.04, with Python 2.7.3 environment.

However, I am getting following errors:

1. after make env, I am getting as follows:

Installed /home/kosala/ellis/_env/lib/python2.7/site-packages/tornado-2.3-py2.7.egg
Processing dependencies for tornado==2.3
Finished processing dependencies for tornado==2.3
# Touch the sentinel file
touch /home/kosala/ellis/_env/.eggs_installed

but when I execute "_env/bin/easy_install --allow-hosts=None -f eggs/
eggs/*.egg"

kosala at ubuntu1404:~/ellis$ _env/bin/easy_install --allow-hosts=None -f
eggs/ eggs/*.egg
Not found: eggs/
error: Not a URL, existing file, or requirement spec: 'eggs/*.egg'

eggs folder is not creating in ellis.

2. Then I copied all *.egg from
ellis/_env/lib/python2.7/site-packages/ to eggs folder created in
ellis

Then I run :
_env/bin/easy_install --allow-hosts=None -f eggs/ eggs/*.egg
_env/bin/python setup.py install

both run without errors


3. Then I changed to the common folder and run (as in the instructions)

../_env/bin/python setup.py installI am getting the following error:
running install
running bdist_egg
running egg_info
writing requirements to metaswitchcommon.egg-info/requires.txt
writing metaswitchcommon.egg-info/PKG-INFO
writing top-level names to metaswitchcommon.egg-info/top_level.txt
writing dependency_links to metaswitchcommon.egg-info/dependency_links.txt
reading manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
writing manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-x86_64/egg
running install_lib
running build_py
running build_ext
generating cffi module 'build/temp.linux-x86_64-2.7/_cffi.c'
already up-to-date
building '_cffi' extension
gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall
-Wstrict-prototypes -fPIC -I/usr/local/include/python2.7 -c
build/temp.linux-x86_64-2.7/_cffi.c -o
build/temp.linux-x86_64-2.7/build/temp.linux-x86_64-2.7/_cffi.o
build/temp.linux-x86_64-2.7/_cffi.c:423:43: fatal error:
namespace_hop.h: No such file or directory
                 #include "namespace_hop.h"
                                           ^
compilation terminated.
error: command 'gcc' failed with exit status 1

Your help to solve this issue is appreciated.

Many Thanks in advance.

Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160705/f0844b3f/attachment.html>

From chris at projectclearwater.org  Wed Jul  6 05:58:26 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 6 Jul 2016 09:58:26 +0000
Subject: [Project Clearwater] Building Ellis
In-Reply-To: <CAGEe17ZUDha0SonwZDnbtYxN9JWNjizTDNzDm58_81vxCjrj0g@mail.gmail.com>
References: <CAGEe17ZUDha0SonwZDnbtYxN9JWNjizTDNzDm58_81vxCjrj0g@mail.gmail.com>
Message-ID: <CY1PR02MB11815E7070AD9D5F240B4606E13A0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Kosala,

Thanks for getting in touch ? we always like to know when we have an issue.

I tried following the same steps as you, and hit exactly the same problems. It turns out that our build instructions were out of date. To run Ellis from your own build, you just need to run `make env`, then move on to the database setup section.

I?ve created a pull request<https://github.com/Metaswitch/ellis/pull/182> to fix this up in the docs.

Please let me know if you have any more problems.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kosala
Sent: 05 July 2016 19:16
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Building Ellis


Hi there,
I followed this like , https://github.com/Metaswitch/ellis/blob/dev/docs/development.md to build Ellis from the source code.
I properly used

git clone --recursive git at github.com:Metaswitch/ellis.git<mailto:git at github.com:Metaswitch/ellis.git> to clone the source code.

Above link says, this build supports Ubuntu 14.04, with Python 2.7.3

I have Ubuntu 14.04, with Python 2.7.3 environment.

However, I am getting following errors:

1. after make env, I am getting as follows:

Installed /home/kosala/ellis/_env/lib/python2.7/site-packages/tornado-2.3-py2.7.egg
Processing dependencies for tornado==2.3
Finished processing dependencies for tornado==2.3
# Touch the sentinel file
touch /home/kosala/ellis/_env/.eggs_installed

but when I execute "_env/bin/easy_install --allow-hosts=None -f eggs/ eggs/*.egg"

kosala at ubuntu1404:~/ellis$ _env/bin/easy_install --allow-hosts=None -f eggs/ eggs/*.egg
Not found: eggs/
error: Not a URL, existing file, or requirement spec: 'eggs/*.egg'

eggs folder is not creating in ellis.

2. Then I copied all *.egg from  ellis/_env/lib/python2.7/site-packages/ to eggs folder created in ellis

Then I run :
_env/bin/easy_install --allow-hosts=None -f eggs/ eggs/*.egg

_env/bin/python setup.py install

both run without errors

3. Then I changed to the common folder and run (as in the instructions)

../_env/bin/python setup.py install

I am getting the following error:
running install
running bdist_egg
running egg_info
writing requirements to metaswitchcommon.egg-info/requires.txt
writing metaswitchcommon.egg-info/PKG-INFO
writing top-level names to metaswitchcommon.egg-info/top_level.txt
writing dependency_links to metaswitchcommon.egg-info/dependency_links.txt
reading manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
writing manifest file 'metaswitchcommon.egg-info/SOURCES.txt'
installing library code to build/bdist.linux-x86_64/egg
running install_lib
running build_py
running build_ext
generating cffi module 'build/temp.linux-x86_64-2.7/_cffi.c'
already up-to-date
building '_cffi' extension
gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/usr/local/include/python2.7 -c build/temp.linux-x86_64-2.7/_cffi.c -o build/temp.linux-x86_64-2.7/build/temp.linux-x86_64-2.7/_cffi.o
build/temp.linux-x86_64-2.7/_cffi.c:423:43: fatal error: namespace_hop.h: No such file or directory
                 #include "namespace_hop.h"
                                           ^
compilation terminated.
error: command 'gcc' failed with exit status 1
Your help to solve this issue is appreciated.
Many Thanks in advance.
Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160706/accdaa86/attachment.html>

From kosalayb at gmail.com  Wed Jul  6 10:31:53 2016
From: kosalayb at gmail.com (Kosala)
Date: Wed, 6 Jul 2016 15:31:53 +0100
Subject: [Project Clearwater] Build Homestead and Crest
Message-ID: <CAGEe17aVGZLRoq-=dSKMb+0duqMjp6x=96=aMWF1EVCkcXr3Vw@mail.gmail.com>

Hi there,

I could build the homestead properly. This is fine.

I have seen that crest/homestead_prov is used as an API to talk to
homestead.

I am trying to use crest/homestead_prov with homestead. I followed the
development guide in
https://github.com/Metaswitch/crest/blob/dev/docs/development.md.

I could successfully follow up to Running the Server section.
Here it is said,

To run the server as part of development use:

make run

>From where can I run this command ? In which folder? I do not understand
this server.

I appreciate, if someone can help me to use homestead API with homestead.

Thanks in advance

Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160706/0a9aa37b/attachment.html>

From kosalayb at gmail.com  Wed Jul  6 12:02:35 2016
From: kosalayb at gmail.com (Kosala)
Date: Wed, 6 Jul 2016 17:02:35 +0100
Subject: [Project Clearwater] Building Homestead from source code
Message-ID: <CAGEe17brG4K9yL2ZqFyiv2_DnXeLcnYM6T4QHKyaTmsebGDfqQ@mail.gmail.com>

Hi team,

I am trying to build Homestead from source code. The first thing, Is this
possible?


Secondly, as I understand, this needs:

1.       Build homestead,

2.       build crest (Crest /Homestead_prov provides the API to access
Homestead)

 1.       I could build homestead properly.

2.       For Crest

As in Crest-development guide (
https://github.com/Metaswitch/crest/blob/dev/docs/development.md), I
followed up to *Running the Server.*

For, Pre-requisites, I followed *only* the section *Configure the APT
software sources* in (
http://clearwater.readthedocs.io/en/latest/Manual_Install.html#configure-the-apt-software-sources
)

Then I could run Pre-requisites without any problem.

I am getting issues at section *running the server*:

>From which folder, should I execute *make run* ?

I assume this should start homestead service and connections to Cassandra?
If I am in the wrong direction, please let me know.

Any help is appreciated.

Many Thanks in advance.

Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160706/2b92caf6/attachment.html>

From kosalayb at gmail.com  Thu Jul  7 05:25:35 2016
From: kosalayb at gmail.com (Kosala)
Date: Thu, 7 Jul 2016 10:25:35 +0100
Subject: [Project Clearwater] Building Homestead
Message-ID: <CAGEe17Z1SC6o84T_HgkpE3A3Z0B+bqr3pTci66sXnMoTwNryhg@mail.gmail.com>

Hi there,

I build the homestead from source code following
https://github.com/Metaswitch/homestead/blob/dev/docs/development.md.

Then, when I try to start homestead, I am getting an error

"Usage : bracket-ipv6-address <IP address>"

I have created a local_config file in /etc/clearwater/local_config
local_ip=10.0.2.15
public_ip=10.0.2.15
public_hostname=homestead
etcd_cluster="10.0.2.11, 10.0.2.12, 10.0.2.13, 10.0.2.14, 10.0.2.15"


How to solve this issue?
Any help is appreciated.

Thanks in advance.

Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160707/e40aee6b/attachment.html>

From chris at projectclearwater.org  Thu Jul  7 12:54:11 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Thu, 7 Jul 2016 16:54:11 +0000
Subject: [Project Clearwater] Building Homestead from source code
In-Reply-To: <CAGEe17brG4K9yL2ZqFyiv2_DnXeLcnYM6T4QHKyaTmsebGDfqQ@mail.gmail.com>
References: <CAGEe17brG4K9yL2ZqFyiv2_DnXeLcnYM6T4QHKyaTmsebGDfqQ@mail.gmail.com>
Message-ID: <CY1PR02MB11814DD4AA61C87E6B6635DDE13B0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Kosala,

It should definitely be possible to build and run Homestead and Homestead-Prov from their source code. I?ll try to help you to do that, but before I do, I should check whether building from source is really the right thing to do. We have Ubuntu packages of all of Project Clearwater available on our repo server, and we recommend install Project Clearwater using these, following the manual install instructions at http://clearwater.readthedocs.io/en/stable/Manual_Install.html. Alternatively, if you just want to try it out, you can use an all-in-one image to quickly spin up a single node running the whole IMS core.

If you need to build from source e.g. to apply a patch, it?s still possible to run `make deb` to build your own debian packages.

If those options do not work for you, I will check with some of the other maintainers tomorrow to find someone who understands how this is supposed to work.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kosala
Sent: 06 July 2016 17:03
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Building Homestead from source code

Hi team,

I am trying to build Homestead from source code. The first thing, Is this possible?

Secondly, as I understand, this needs:
1.       Build homestead,
2.       build crest (Crest /Homestead_prov provides the API to access Homestead)
 1.       I could build homestead properly.
2.       For Crest
As in Crest-development guide (https://github.com/Metaswitch/crest/blob/dev/docs/development.md), I followed up to Running the Server.
For, Pre-requisites, I followed only the section Configure the APT software sources in (http://clearwater.readthedocs.io/en/latest/Manual_Install.html#configure-the-apt-software-sources)
Then I could run Pre-requisites without any problem.
I am getting issues at section running the server:
From which folder, should I execute make run ?
I assume this should start homestead service and connections to Cassandra? If I am in the wrong direction, please let me know.
Any help is appreciated.
Many Thanks in advance.
Kosala

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160707/717ecb26/attachment.html>

From luigi.desimone at unina.it  Thu Jul  7 13:25:59 2016
From: luigi.desimone at unina.it (Luigi De Simone)
Date: Thu, 7 Jul 2016 19:25:59 +0200
Subject: [Project Clearwater] [Clearwater] Installing homer fails
Message-ID: <052D3A5F-FE89-43B0-94E1-DFC4D6FBF4E2@unina.it>

Installed /usr/share/clearwater/homer/python/packages/homer-0.1-py2.7.egg
Processing dependencies for homer==0.1
Finished processing dependencies for homer==0.1
 * Restarting clearwater-infrastructure clearwater-infrastructure                                                                                                                   /usr/share/clearwater/infrastructure/scripts/cassandra: line 49: /usr/share/clearwater/bin/is_address_ipv6.py: No such file or directory
zmq_msg_recv: Resource temporarily unavailable
zmq_msg_recv: Resource temporarily unavailable
Cassandra is not configured yet, skipping schema addition for now
Configuring monit for only localhost access
                                                                                                                                                                             [ OK ]
Cassandra is not configured yet, skipping schema addition for now
Processing triggers for ureadahead (0.100.0-16) ...


From chris at projectclearwater.org  Fri Jul  8 05:47:53 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Fri, 8 Jul 2016 09:47:53 +0000
Subject: [Project Clearwater] [Clearwater] Installing homer fails
In-Reply-To: <052D3A5F-FE89-43B0-94E1-DFC4D6FBF4E2@unina.it>
References: <052D3A5F-FE89-43B0-94E1-DFC4D6FBF4E2@unina.it>
Message-ID: <CY1PR02MB11811B6E89093D11212150F8E13C0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Luigi,

We have also hit this problem. Huw has checked in a fix under https://github.com/Metaswitch/clearwater-cassandra/pull/102. This should be available in the next release of Project Clearwater, due out early next week.

I hope that helps,

Chris

-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Luigi De Simone
Sent: 07 July 2016 18:26
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] [Clearwater] Installing homer fails

Installed /usr/share/clearwater/homer/python/packages/homer-0.1-py2.7.egg
Processing dependencies for homer==0.1
Finished processing dependencies for homer==0.1
 * Restarting clearwater-infrastructure clearwater-infrastructure                                                                                                                   /usr/share/clearwater/infrastructure/scripts/cassandra: line 49: /usr/share/clearwater/bin/is_address_ipv6.py: No such file or directory
zmq_msg_recv: Resource temporarily unavailable
zmq_msg_recv: Resource temporarily unavailable Cassandra is not configured yet, skipping schema addition for now Configuring monit for only localhost access
                                                                                                                                                                             [ OK ] Cassandra is not configured yet, skipping schema addition for now Processing triggers for ureadahead (0.100.0-16) ...
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org



From chris at projectclearwater.org  Mon Jul 11 04:29:31 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Mon, 11 Jul 2016 08:29:31 +0000
Subject: [Project Clearwater] [Clearwater] Installing homer fails
In-Reply-To: <E1EA0DA1-A6B1-4F47-84A9-2A450ED9FF9A@unina.it>
References: <052D3A5F-FE89-43B0-94E1-DFC4D6FBF4E2@unina.it>
	<CY1PR02MB11811B6E89093D11212150F8E13C0@CY1PR02MB1181.namprd02.prod.outlook.com>
	<E1EA0DA1-A6B1-4F47-84A9-2A450ED9FF9A@unina.it>
Message-ID: <CY1PR02MB11818CFEFF1C30BF9134773FE13F0@CY1PR02MB1181.namprd02.prod.outlook.com>

Interesting.

Have you patched your system with Huw's fix? If not, I would wait until this week's new release of Project Clearwater and see if that fixes the problem.

If you are running with Huw's fix, and still seeing this problem on a clean install, then it is likely that something is going wrong creating your Homestead cluster. The best place to look for errors is in the clearwater-etcd and clearwater-cluster-manager logs. You can find these at /var/log/clearwater-etcd and /var/log/clearwater-cluster-manager. I'm happy to take a look at them if needed.

Yours,

Chris

-----Original Message-----
From: Luigi De Simone [mailto:luigi.desimone at unina.it] 
Sent: 08 July 2016 17:13
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Subject: Re: [Project Clearwater] [Clearwater] Installing homer fails

Thanks! Moreover, cassandra.yaml is not automatically generated for some reason...

> Il giorno 08 lug 2016, alle ore 11:47, Chris Elford (projectclearwater.org) <chris at projectclearwater.org> ha scritto:
> 
> Hi Luigi,
> 
> We have also hit this problem. Huw has checked in a fix under https://github.com/Metaswitch/clearwater-cassandra/pull/102. This should be available in the next release of Project Clearwater, due out early next week.
> 
> I hope that helps,
> 
> Chris
> 
> -----Original Message-----
> From: Clearwater 
> [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of 
> Luigi De Simone
> Sent: 07 July 2016 18:26
> To: clearwater at lists.projectclearwater.org
> Subject: [Project Clearwater] [Clearwater] Installing homer fails
> 
> Installed 
> /usr/share/clearwater/homer/python/packages/homer-0.1-py2.7.egg
> Processing dependencies for homer==0.1 Finished processing 
> dependencies for homer==0.1
> * Restarting clearwater-infrastructure clearwater-infrastructure                                                                                                                   /usr/share/clearwater/infrastructure/scripts/cassandra: line 49: /usr/share/clearwater/bin/is_address_ipv6.py: No such file or directory
> zmq_msg_recv: Resource temporarily unavailable
> zmq_msg_recv: Resource temporarily unavailable Cassandra is not configured yet, skipping schema addition for now Configuring monit for only localhost access
>                                                                                                                                                                             [ OK ] Cassandra is not configured yet, skipping schema addition for now Processing triggers for ureadahead (0.100.0-16) ...
> _______________________________________________
> Clearwater mailing list
> Clearwater at lists.projectclearwater.org
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.p
> rojectclearwater.org
> 




From morrisyan123 at gmail.com  Tue Jul 12 06:47:18 2016
From: morrisyan123 at gmail.com (yan morris)
Date: Tue, 12 Jul 2016 18:47:18 +0800
Subject: [Project Clearwater] Memento Application server
Message-ID: <CAM_v+eSfBJDbQ=HUzZkO9jgFYCn3UKi-qjhuHZUnqjK0B8-iFw@mail.gmail.com>

HI ,

I install memento as on sprout cluster

I have set IFCs configuration on Ellis , I can see it on Web UI (configure).

however I cannot make a call if I choose the memento service.

the client would give a message "no route to call ".

my IFCs config is below

<InitialFilterCriteria>
  <TriggerPoint>
  <ConditionTypeCNF>0</ConditionTypeCNF>
  <SPT>
    <ConditionNegated>0</ConditionNegated>
    <Group>0</Group>
    <Method>INVITE</Method>
    <Extension></Extension>
  </SPT>
  </TriggerPoint>
  <ApplicationServer><ServerName>sip:memento at sprout.yan</ServerName>
    <DefaultHandling>0</DefaultHandling>
  </ApplicationServer>
</InitialFilterCriteria>

In addition , I only have one sprout node in cluster.

and I can make a call if I don't use memento as .

Please help me find out the solution of this problem.

Thank you.

Morris Yan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160712/cb65e937/attachment.html>

From eleanor at projectclearwater.org  Tue Jul 12 10:54:43 2016
From: eleanor at projectclearwater.org (Eleanor Merry (projectclearwater.org))
Date: Tue, 12 Jul 2016 14:54:43 +0000
Subject: [Project Clearwater] Ivysaur release note
Message-ID: <BL2PR02MB20840E7A724A344AD8E0732A9B300@BL2PR02MB2084.namprd02.prod.outlook.com>

The release for Project Clearwater sprint "Ivysaur" has been cut. The code for this release is tagged as release-102 in github.

In this release we've upgraded the version of monit we use; we now run the latest version (5.18).

This release also includes the following bug fixes:

*         building sproutlets via the plugins directory is currently broken (https://github.com/Metaswitch/sprout/issues/1473)

*         Disable the ability to configure the chronos connection (https://github.com/Metaswitch/sprout/issues/1463)

*         Allow configuration of FQDN in Route header used when communicating with ASs (https://github.com/Metaswitch/sprout/issues/1462)

*         Sprout returns 504 SERVER_TIMEOUT error when service profile doesn't contain a public identity (https://github.com/Metaswitch/sprout/issues/1453)

*         Sprout's stdout goes to /dev/null (https://github.com/Metaswitch/sprout/issues/965)

*         make full_test fails with valgrind error (https://github.com/Metaswitch/homestead/issues/324)

*         Error log when upgrading homestead (Connection error: Could not connect to localhost:9160) (https://github.com/Metaswitch/homestead/issues/209)

*         Timers with interval 0 never get tombstoned (https://github.com/Metaswitch/chronos/issues/276)

*         Running 'service chronos wait-sync' waits forever (https://github.com/Metaswitch/chronos/issues/274)

*         Chronos runs as the root user (https://github.com/Metaswitch/chronos/issues/197)

*         Homer doesn't start properly on all-in-one images (https://github.com/Metaswitch/crest/issues/283)

*         live-test-aio build fails. AIO staging node is stuck in the Homer postinst script (https://github.com/Metaswitch/crest/issues/281)

*         DEB_VERSION_QUALIFIER ignored in latest clearwater.mk (https://github.com/Metaswitch/clearwater-monit/issues/29)

*         It would be useful to have an overall check_health script (https://github.com/Metaswitch/clearwater-etcd/issues/43)

*         When sending alarm notifications (traps) the callback function isn't called. (https://github.com/Metaswitch/clearwater-net-snmp/issues/6)

*         On a 430 Flow Failed response, we only delete bindings locally (https://github.com/Metaswitch/sprout/issues/1285)



To upgrade to this release, follow the instructions at http://docs.projectclearwater.org/en/stable/Upgrading_a_Clearwater_deployment.html. If you are deploying an all-in-one node, the standard image (http://vm-images.cw-ngv.com/cw-aio.ova) has been updated for this release.

Ellie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160712/7186756b/attachment.html>

From chris at projectclearwater.org  Tue Jul 12 11:19:09 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 12 Jul 2016 15:19:09 +0000
Subject: [Project Clearwater] Memento Application server
In-Reply-To: <CAM_v+eSfBJDbQ=HUzZkO9jgFYCn3UKi-qjhuHZUnqjK0B8-iFw@mail.gmail.com>
References: <CAM_v+eSfBJDbQ=HUzZkO9jgFYCn3UKi-qjhuHZUnqjK0B8-iFw@mail.gmail.com>
Message-ID: <CY1PR02MB1181D76C78F99CAD5B85ABD6E1300@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Yan,

Thank you for getting in touch.

I?ve had a look at your IFC below, and it looks good to me. That means that either Sprout is failing to send a request to Memento, or Memento is failing to handle the call properly. To find out which of these is happening, we should take a look at Sprout?s debug logs. That will tell us:

?         Whether Sprout is loading the memento sproutlet correctly.

?         Whether Sprout is routing the call to memento correctly.

?         Where the call is failing.

You can turn on debug logs following the instructions at http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#sprout.

We should also check that Sprout is configured correctly ? it needs to detect that the server at sip:memento at sprout.yan is actually itself, so that it can route the call correctly. If you send over /etc/clearwater/shared_config, I can help you to check that this is correct.

Finally, can I suggest that you sign up to the Project Clearwater mailing list? That way, your posts will go straight to the mailing list without needing to be approved, and you will be able to see questions from other users.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of yan morris
Sent: 12 July 2016 11:47
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Memento Application server

HI ,

I install memento as on sprout cluster

I have set IFCs configuration on Ellis , I can see it on Web UI (configure).

however I cannot make a call if I choose the memento service.

the client would give a message "no route to call ".
my IFCs config is below


<InitialFilterCriteria>

  <TriggerPoint>

  <ConditionTypeCNF>0</ConditionTypeCNF>

  <SPT>

    <ConditionNegated>0</ConditionNegated>

    <Group>0</Group>

    <Method>INVITE</Method>

    <Extension></Extension>

  </SPT>

  </TriggerPoint>

  <ApplicationServer><ServerName>sip:memento at sprout.yan</ServerName<sip:memento at sprout.yan%3c/ServerName>>

    <DefaultHandling>0</DefaultHandling>

  </ApplicationServer>

</InitialFilterCriteria>



In addition , I only have one sprout node in cluster.



and I can make a call if I don't use memento as .



Please help me find out the solution of this problem.



Thank you.



Morris Yan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160712/b96af84a/attachment.html>

From jake at dccllc.net  Tue Jul 12 15:49:57 2016
From: jake at dccllc.net (Jake Brown)
Date: Tue, 12 Jul 2016 19:49:57 +0000
Subject: [Project Clearwater] Homestead Errors Processing: crest
	homestead-prov
Message-ID: <BY2PR18MB0391308E64B9A3C16049A445A9300@BY2PR18MB0391.namprd18.prod.outlook.com>

Hello,

On a fresh install, while following the manual installation instructions, I received the following error.

Processing triggers for libc-bin (2.19-0ubuntu6.7) ...
Errors were encountered while processing:
crest
homestead-prov
E: Sub-process /usr/bin/dpkg returned an error code (1)

I have attached the output from the install.  Is this a package problem?

Jake Brown

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160712/4f7b4c46/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: installoutput.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160712/4f7b4c46/attachment.txt>

From luigi.desimone at unina.it  Wed Jul 13 06:06:15 2016
From: luigi.desimone at unina.it (Luigi De Simone)
Date: Wed, 13 Jul 2016 12:06:15 +0200
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing on
	clearwater docker deploy
Message-ID: <4FD5C6E9-B72B-413F-A990-A83BFC0B01B5@unina.it>

Hi all, after deploying clearwater with docker, I've just tried sipp stress test and there are some message timeouts. In particular from
/var/log/bono/bono_current.txt there are some sporadic messages like this:

UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()

Other nodes do not exhibit problems.
The sipp error log is below:

sipp: The following events occured:
2016-07-13      09:57:35:333    1468403855.333438: Call-Id: 12-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:57:52:946    1468403872.946879: Call-Id: 44-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:19:863    1468403899.863728: Call-Id: 47-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:20:820    1468403900.820186: Call-Id: 28-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:02:504    1468403942.504959: Call-Id: 50-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:06:724    1468403946.724817: Call-Id: 7-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:466    1468403949.466635: Call-Id: 29-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:921    1468403949.921984: Call-Id: 21-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:26:948    1468403966.948038: Call-Id: 8-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:55:369    1468403995.369205: Call-Id: 46-21655 at 192.168.1.250, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

and sipp.out is:

  Call limit reached (-m 50), 0.000 s period  0 ms scheduler resolution^M
  0 calls (limit 50)                     Peak was 50 calls, after 0 s^M
  0 Running, 15 Paused, 0 Woken up^M
  0 dead call msg (discarded)            0 out-of-call msg (discarded)        ^M
  1 open sockets                        ^M
^M
                                 Messages  Retrans   Timeout   Unexpected-Msg^M
       Pause [ 0ms/2:30]         50                            0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
       Pause [     1:00]         50                            0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
       Pause [$pre_call_delay]   50                            0        ^M
      INVITE ---------->  B-RTD2 50        0                            ^M
         100 <----------         50        0         0         0        ^M
      INVITE <----------         0         0         0         0        ^M
         100 <----------         0         0         0         0        ^M
      INVITE <----------         50        0         0         0        ^M
         100 ---------->         50        0                            ^M
         180 ---------->         50        0                            ^M
         180 <----------         50        0         0         0        ^M
       Pause [   2000ms]         50                            0        ^M
         200 ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
         ACK ---------->         50        0                            ^M
         ACK <----------         40        0         10        0        ^M
      UPDATE ---------->         40        0                            ^M
      UPDATE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD2 40        0         0         0        ^M
       Pause [   6000ms]         40                            0        ^M
         BYE ---------->  B-RTD3 40        0                            ^M
         BYE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD3 40        0         0         0        ^M
------------------------------ Test Terminated --------------------------------^M

The messages with trigger timeouts are always in that point of the scenario.
What is the problem? Any help?

Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160713/821d298d/attachment.html>

From chris at projectclearwater.org  Wed Jul 13 11:31:58 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 13 Jul 2016 15:31:58 +0000
Subject: [Project Clearwater] Homestead Errors Processing:
	crest	homestead-prov
In-Reply-To: <BY2PR18MB0391308E64B9A3C16049A445A9300@BY2PR18MB0391.namprd18.prod.outlook.com>
References: <BY2PR18MB0391308E64B9A3C16049A445A9300@BY2PR18MB0391.namprd18.prod.outlook.com>
Message-ID: <BLUPR02MB11709A6CFF5B8C55610A32E7E1310@BLUPR02MB1170.namprd02.prod.outlook.com>

Hi Jake,

Thanks for getting in touch.

I think the following line in your output is the interesting one:

/var/lib/dpkg/info/crest.postinst: 5: /etc/clearwater/local_config: Syntax error: Unterminated quoted string

Crest's install reads settings from /etc/clearwater/local_config and uses them to set up crest correctly. It looks like there is a syntax error on line 5 of your local_config file, and that is stopping the install from running.

You can debug this issue by logging onto the server and running `bash /etc/clearwater/local_config`. Fix up any syntax errors, and then try the install again.

If you need help setting some of the options, take a look at http://clearwater.readthedocs.io/en/stable/Clearwater_Configuration_Options_Reference.html.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Jake Brown
Sent: 12 July 2016 20:50
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Homestead Errors Processing: crest homestead-prov

Hello,

On a fresh install, while following the manual installation instructions, I received the following error.

Processing triggers for libc-bin (2.19-0ubuntu6.7) ...
Errors were encountered while processing:
crest
homestead-prov
E: Sub-process /usr/bin/dpkg returned an error code (1)

I have attached the output from the install.  Is this a package problem?

Jake Brown

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160713/8a31d83a/attachment.html>

From trey.ormsbee at interoptechnologies.com  Wed Jul 13 19:04:55 2016
From: trey.ormsbee at interoptechnologies.com (Trey Ormsbee)
Date: Wed, 13 Jul 2016 18:04:55 -0500
Subject: [Project Clearwater] homestead hss uar diameter request problem
Message-ID: <1468451095.31863.25.camel@interoptechnologies.com>

Hey all-

I have the latest build installed and am using the icscf function in
sprout for the first time.  After homestead sends the UAR to the HSS,
for a sip register, homestead immediately follows that packet with a
FIN,ACK closing the connection to the HSS.  The homestead log shows
this:

13-07-2016 22:55:02.390 UTC Verbose httpstack.cpp:293: Process request
for URL /impi/555555555554444%
40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%
3A55555555555%40example.com&visited-network=example.com&auth-type=REG
13-07-2016 22:55:02.390 UTC Debug handlers.cpp:591: Parsed HTTP request:
private ID 555555555554444 at ims.mncXXX.mccXXX.3gppnetwork.org, public ID
sip:55555555555 at example.com, visited network example.com, authorization
type REG
13-07-2016 22:55:02.390 UTC Debug cx.cpp:109: Building
User-Authorization request for
555555555554444 at ims.mncXXX.mccXXX.3gppnetwork.org/sip:55555555555 at example.com
13-07-2016 22:55:02.390 UTC Debug freeDiameter: No Session-Id AVP found
in message 0x7fcb74021600
13-07-2016 22:55:02.390 UTC Verbose diameterstack.cpp:1427: Sending
Diameter message of type 300 on transaction 0x7fcb740221f0 with timeout
200
13-07-2016 22:55:02.390 UTC Debug diameterstack.cpp:397: Routing out
callback from freeDiameter
13-07-2016 22:55:02.390 UTC Error diameterstack.cpp:293: Routing error:
'No remaining suitable candidate to route the message to' for message
with Command-Code 300, Destination-Host hss.example.org and
Destination-Realm example.org
13-07-2016 22:55:02.391 UTC Debug freeDiameter: Iterating on rules of
COMMAND: '(generic error format)'.
13-07-2016 22:55:02.391 UTC Debug freeDiameter: Calling callback
registered when query was sent (0x45b880, 0x7fcb740221f0)
13-07-2016 22:55:02.391 UTC Verbose diameterstack.cpp:1097: Got Diameter
response of type 300 - calling callback on transaction 0x7fcb740221f0
13-07-2016 22:55:02.391 UTC Debug communicationmonitor.cpp:82: Checking
communication changes - successful attempts 0, failures 1
13-07-2016 22:55:02.391 UTC Status alarm.cpp:62: homestead issued 1502.3
alarm
13-07-2016 22:55:02.391 UTC Debug handlers.cpp:647: Received
User-Authorization answer with result 3002/0
13-07-2016 22:55:02.391 UTC Verbose httpstack.cpp:69: Sending response
503 to request for URL /impi/555555555554444%
40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%
3A55555555555%40example.com&visited-network=example.com&auth-type=REG
13-07-2016 22:55:02.391 UTC Info load_monitor.cpp:232: Accepted
100.000000% of requests, latency error = -0.076120, overload responses =
0
13-07-2016 22:55:02.391 UTC Status load_monitor.cpp:285: Maximum
incoming request rate/second unchanged - only handled 70 requests in
last 2074733ms, minimum threshold for a change is 103736.648438
13-07-2016 22:55:03.244 UTC Debug diameterresolver.cpp:91:
DiameterResolver::resolve for realm , host xxx.xxx.xxx.xxx, family 2
13-07-2016 22:55:03.244 UTC Debug baseresolver.cpp:514: Attempt to parse
xxx.xxx.xxx.xxx as IP address
13-07-2016 22:55:03.244 UTC Debug diameterresolver.cpp:175: Target is an
IP address - default port/transport
13-07-2016 22:55:03.244 UTC Debug realmmanager.cpp:381: Adding peer:
xxx.xxx.xxx.xxx
13-07-2016 22:55:03.244 UTC Info diameterstack.cpp:833: Peer already
exists
13-07-2016 22:55:03.244 UTC Debug realmmanager.cpp:389: Peer already
exists: xxx.xxx.xxx.xxx
13-07-2016 22:55:03.244 UTC Warning diameterstack.cpp:858: No connected
Diameter peers have been found


Any ideas what is wrong with this?  Bypassing the icscf and going
directly to the scscf like I have in the past sends the MAR with no
problem.  So Im not sure if I am doing something wrong or if something
is broken.

Thanks,
Trey

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160713/27a865bb/attachment.html>

From chris at projectclearwater.org  Thu Jul 14 06:21:07 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Thu, 14 Jul 2016 10:21:07 +0000
Subject: [Project Clearwater] Memento Application server
In-Reply-To: <CAM_v+eTyD1+7hVGgpq-1Kgs8vRmdLYh=WQgVM8H7LCmr0a44rA@mail.gmail.com>
References: <CAM_v+eSfBJDbQ=HUzZkO9jgFYCn3UKi-qjhuHZUnqjK0B8-iFw@mail.gmail.com>
	<CY1PR02MB1181D76C78F99CAD5B85ABD6E1300@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CAM_v+eRa51929Pwi6ti+tCX0X9Gc9z7nNXnQ2ZX40JkRLRNTUw@mail.gmail.com>
	<BLUPR02MB117036EA904AEB34572C6C16E1310@BLUPR02MB1170.namprd02.prod.outlook.com>
	<CAM_v+eTyD1+7hVGgpq-1Kgs8vRmdLYh=WQgVM8H7LCmr0a44rA@mail.gmail.com>
Message-ID: <CY1PR02MB1181A4CB5B8D7F115A6E19F1E1320@CY1PR02MB1181.namprd02.prod.outlook.com>

Nice,

It looks like that tweak has allowed Sprout to try to route the call to Memento. Unfortunately, it looks like Memento is not able to take calls ? that explains why no calls show up in your call list.

I?ve had a look over your Sprout debug logs, and I think I can see what the problem is. Sprout loads Memento as a Sproutlet plugin. (Matt has written a blog about these here<http://www.projectclearwater.org/tadhack-mini-london-and-sproutlets/>.) This allows Memento to receive calls over SIP. It looks like Sprout is not currently loading the Memento sproutlet correctly. From the logs:

13-07-2016 16:05:50.397 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_bgcf.so
13-07-2016 16:05:50.398 UTC Debug pluginloader.cpp:121: Sproutlet bgcf using API version 1
13-07-2016 16:05:50.398 UTC Status pluginloader.cpp:127: Loaded sproutlet bgcf using API version 1
13-07-2016 16:05:50.398 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/memento-as.so
13-07-2016 16:05:50.403 UTC Debug updater.h:91: Started updater thread
13-07-2016 16:05:50.403 UTC Status pluginloader.cpp:157: Finished loading plug-ins

Here, you can see that Sprout attempts to load the BGCF plugin, and succeeds. It then attempts to load the Memento plugin, but never actually loads it.

My current best theory is that your Memento and Sprout code may have been built against different versions, and that the Memento plugin is coming to the conclusion that it should not be enabled.

You should be able to check this by running the following command on your sprout node:

dpkg -l | grep -e memento-as -e "\ssprout[-\s]"

All of the packages listed should have the same version number. If they do not, you should your deployment following the docs at http://clearwater.readthedocs.io/en/stable/Upgrading_a_Clearwater_deployment.html.

If that does not fix your problem, please send me the output of that command, and an up-to-date copy of your sprout logs, and I will see what I can do to help.

Yours,

Chris

From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 13 July 2016 17:22
To: Chris Elford <Chris.Elford at metaswitch.com>
Subject: Re: [Project Clearwater] Memento Application server


HI,

Thank for your time to look my problems.

the logs messages are too many lines , therefore  I use google online docs to record it.

There are two version  " log level2 " and " log leve5".

Please notice that , I use the "ccu" as my zone name in this time , and I can make a call without memento properly.

the sprout IP address is 140.123.103.105.


sprout log (log level = 2):

https://docs.google.com/document/d/1pFwfs4OaU-axvsTEYr1_AHlLTU_7vPNSNQ9dfEXY7CY/edit?usp=sharing

sprout log (log level = 5)

https://docs.google.com/document/d/1CI_HKroVUqGstcCZqmy3fttlh_k1W7g4Bhi8Zcwop8w/edit?usp=sharing

Hope these logs can be useful.


thank you again .

Morris Yan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/9e4f051e/attachment.html>

From trey.ormsbee at interoptechnologies.com  Thu Jul 14 11:38:10 2016
From: trey.ormsbee at interoptechnologies.com (Trey Ormsbee)
Date: Thu, 14 Jul 2016 10:38:10 -0500
Subject: [Project Clearwater] homestead hss uar diameter request problem
In-Reply-To: <1468451095.31863.25.camel@interoptechnologies.com>
References: <1468451095.31863.25.camel@interoptechnologies.com>
Message-ID: <1468510690.31863.26.camel@interoptechnologies.com>

This appeared to be an HSS issue,  the UAR/A's are now working.

-----Original Message-----From: Trey Ormsbee
<trey.ormsbee at interoptechnologies.com>
To: clearwater at lists.projectclearwater.org
<clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] homestead hss uar diameter request problem
Date: Wed, 13 Jul 2016 19:04:55 -0400

Hey all-

I have the latest build installed and am using the icscf function in
sprout for the first time.  After homestead sends the UAR to the HSS,
for a sip register, homestead immediately follows that packet with a
FIN,ACK closing the connection to the HSS.  The homestead log shows
this:

13-07-2016 22:55:02.390 UTC Verbose httpstack.cpp:293: Process request
for URL /impi/555555555554444%
40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%
3A55555555555%40example.com&visited-network=example.com&auth-type=REG
13-07-2016 22:55:02.390 UTC Debug handlers.cpp:591: Parsed HTTP request:
private ID 555555555554444 at ims.mncXXX.mccXXX.3gppnetwork.org, public ID
sip:55555555555 at example.com, visited network example.com, authorization
type REG
13-07-2016 22:55:02.390 UTC Debug cx.cpp:109: Building
User-Authorization request for
555555555554444 at ims.mncXXX.mccXXX.3gppnetwork.org/sip:55555555555 at example.com
13-07-2016 22:55:02.390 UTC Debug freeDiameter: No Session-Id AVP found
in message 0x7fcb74021600
13-07-2016 22:55:02.390 UTC Verbose diameterstack.cpp:1427: Sending
Diameter message of type 300 on transaction 0x7fcb740221f0 with timeout
200
13-07-2016 22:55:02.390 UTC Debug diameterstack.cpp:397: Routing out
callback from freeDiameter
13-07-2016 22:55:02.390 UTC Error diameterstack.cpp:293: Routing error:
'No remaining suitable candidate to route the message to' for message
with Command-Code 300, Destination-Host hss.example.org and
Destination-Realm example.org
13-07-2016 22:55:02.391 UTC Debug freeDiameter: Iterating on rules of
COMMAND: '(generic error format)'.
13-07-2016 22:55:02.391 UTC Debug freeDiameter: Calling callback
registered when query was sent (0x45b880, 0x7fcb740221f0)
13-07-2016 22:55:02.391 UTC Verbose diameterstack.cpp:1097: Got Diameter
response of type 300 - calling callback on transaction 0x7fcb740221f0
13-07-2016 22:55:02.391 UTC Debug communicationmonitor.cpp:82: Checking
communication changes - successful attempts 0, failures 1
13-07-2016 22:55:02.391 UTC Status alarm.cpp:62: homestead issued 1502.3
alarm
13-07-2016 22:55:02.391 UTC Debug handlers.cpp:647: Received
User-Authorization answer with result 3002/0
13-07-2016 22:55:02.391 UTC Verbose httpstack.cpp:69: Sending response
503 to request for URL /impi/555555555554444%
40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%
3A55555555555%40example.com&visited-network=example.com&auth-type=REG
13-07-2016 22:55:02.391 UTC Info load_monitor.cpp:232: Accepted
100.000000% of requests, latency error = -0.076120, overload responses =
0
13-07-2016 22:55:02.391 UTC Status load_monitor.cpp:285: Maximum
incoming request rate/second unchanged - only handled 70 requests in
last 2074733ms, minimum threshold for a change is 103736.648438
13-07-2016 22:55:03.244 UTC Debug diameterresolver.cpp:91:
DiameterResolver::resolve for realm , host xxx.xxx.xxx.xxx, family 2
13-07-2016 22:55:03.244 UTC Debug baseresolver.cpp:514: Attempt to parse
xxx.xxx.xxx.xxx as IP address
13-07-2016 22:55:03.244 UTC Debug diameterresolver.cpp:175: Target is an
IP address - default port/transport
13-07-2016 22:55:03.244 UTC Debug realmmanager.cpp:381: Adding peer:
xxx.xxx.xxx.xxx
13-07-2016 22:55:03.244 UTC Info diameterstack.cpp:833: Peer already
exists
13-07-2016 22:55:03.244 UTC Debug realmmanager.cpp:389: Peer already
exists: xxx.xxx.xxx.xxx
13-07-2016 22:55:03.244 UTC Warning diameterstack.cpp:858: No connected
Diameter peers have been found


Any ideas what is wrong with this?  Bypassing the icscf and going
directly to the scscf like I have in the past sends the MAR with no
problem.  So Im not sure if I am doing something wrong or if something
is broken.

Thanks,
Trey


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/b88e6e51/attachment.html>

From trey.ormsbee at interoptechnologies.com  Thu Jul 14 11:59:37 2016
From: trey.ormsbee at interoptechnologies.com (Trey Ormsbee)
Date: Thu, 14 Jul 2016 10:59:37 -0500
Subject: [Project Clearwater] homestead core dump on MAA
Message-ID: <1468511977.31863.30.camel@interoptechnologies.com>

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a
received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing
trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising
correlating marker with diameter session ID =
homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30
seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in
state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback
registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter
response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received
Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter
'(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) &&
(((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?
I cannot attach a capture/core as it has private data in it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/cca446d2/attachment.html>
-------------- next part --------------
14-07-2016 15:41:53.994 UTC Status utils.cpp:591: Log level set to 5
14-07-2016 15:41:53.994 UTC Info main.cpp:577: Command-line options were: /usr/share/clearwater/bin/homestead --localhost=XXX.XXX.XXX.101 --home-domain=example.com --diameter-conf=/var/lib/homestead/homestead.conf --dns-server=127.0.0.1 --http=XXX.XXX.XXX.101 --http-threads=100 --dest-realm=example1.com --dest-host=hss.example1.com --hss-peer=XXX.XXX.XXX.100 --max-peers=2 --server-name=sip:scscf.sprout.example.com:5054;transport=TCP --impu-cache-ttl=0 --hss-reregistration-time=1800 --sprout-http-name=sprout.example.com:9888 --access-log=/var/log/homestead --log-file=/var/log/homestead --log-level=5 --sas=0.0.0.0,homestead at homestead01.example.com --pidfile=/var/run/homestead/homestead.pid --daemon 
14-07-2016 15:41:53.994 UTC Info main.cpp:276: Local host: XXX.XXX.XXX.101
14-07-2016 15:41:53.994 UTC Info main.cpp:281: Home domain: example.com
14-07-2016 15:41:53.994 UTC Info main.cpp:286: Diameter configuration file: /var/lib/homestead/homestead.conf
14-07-2016 15:41:53.994 UTC Info main.cpp:389: 1 DNS servers passed on the command line
14-07-2016 15:41:53.994 UTC Info main.cpp:291: HTTP address: XXX.XXX.XXX.101
14-07-2016 15:41:53.994 UTC Info main.cpp:296: HTTP threads: 100
14-07-2016 15:41:53.994 UTC Info main.cpp:311: Destination realm: example1.com
14-07-2016 15:41:53.994 UTC Info main.cpp:316: Destination host: hss.example1.com
14-07-2016 15:41:53.994 UTC Info main.cpp:321: Maximum peers: 2
14-07-2016 15:41:53.994 UTC Info main.cpp:326: Server name: sip:scscf.sprout.example.com:5054;transport=TCP
14-07-2016 15:41:53.994 UTC Info main.cpp:331: IMPU cache TTL: 0
14-07-2016 15:41:53.994 UTC Info main.cpp:336: HSS reregistration time: 1800
14-07-2016 15:41:53.994 UTC Info main.cpp:341: Sprout HTTP name: sprout.example.com:9888
14-07-2016 15:41:53.994 UTC Info main.cpp:361: Access log: /var/log/homestead
14-07-2016 15:41:53.994 UTC Info main.cpp:374: SAS set to 0.0.0.0

14-07-2016 15:41:53.994 UTC Info main.cpp:375: System name is set to homestead at homestead01.example.com

14-07-2016 15:41:53.994 UTC Status main.cpp:598: Access logging enabled to /var/log/homestead
14-07-2016 15:41:53.994 UTC Warning main.cpp:604: SAS server option was invalid or not configured - SAS is disabled
14-07-2016 15:41:53.995 UTC Status snmp_agent.cpp:117: AgentX agent initialised
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_latency_us
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_hss_latency_us
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_cache_latency_us
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_hss_digest_latency_us
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_hss_subscription_latency_us
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_incoming_requests
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_rejected_overload
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_diameter_invalid_dest_realm
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table H_diameter_invalid_dest_host
14-07-2016 15:41:53.995 UTC Info snmp_table.h:87: Registering SNMP table cx_mar_results
14-07-2016 15:41:53.996 UTC Info snmp_table.h:87: Registering SNMP table cx_sar_results
14-07-2016 15:41:53.997 UTC Info snmp_table.h:87: Registering SNMP table cx_uar_results
14-07-2016 15:41:53.998 UTC Info snmp_table.h:87: Registering SNMP table cx_lir_results
14-07-2016 15:41:53.999 UTC Info snmp_table.h:87: Registering SNMP table cx_ppr_results
14-07-2016 15:41:54.000 UTC Info snmp_table.h:87: Registering SNMP table cx_rtr_results
14-07-2016 15:41:54.001 UTC Info (Net-SNMP): NET-SNMP version 5.7.2 AgentX subagent connected
14-07-2016 15:41:54.003 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
14-07-2016 15:41:54.003 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
14-07-2016 15:41:54.003 UTC Status load_monitor.cpp:107:    Max bucket size          : 1000
14-07-2016 15:41:54.003 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
14-07-2016 15:41:54.003 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
14-07-2016 15:41:54.003 UTC Status dnscachedresolver.cpp:144: Creating Cached Resolver using servers:
14-07-2016 15:41:54.003 UTC Status dnscachedresolver.cpp:154:     127.0.0.1
14-07-2016 15:41:54.003 UTC Debug alarm.cpp:241: Started reraising alarms every 30 seconds
14-07-2016 15:41:54.003 UTC Debug alarm.cpp:253: Reraising all alarms with a known state
14-07-2016 15:41:54.003 UTC Debug httpresolver.cpp:46: Creating HTTP resolver
14-07-2016 15:41:54.003 UTC Debug baseresolver.cpp:93: Create black list
14-07-2016 15:41:54.003 UTC Status httpresolver.cpp:51: Created HTTP resolver
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:154: Configuring store connection
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:156:   Port:      9160
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:206: Configuring store worker pool
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:207:   Threads:   10
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:208:   Max Queue: 0
14-07-2016 15:41:54.003 UTC Debug cassandra_store.cpp:170: Testing cassandra connection
14-07-2016 15:41:54.003 UTC Debug cassandra_store.cpp:284: Getting thread-local Client
14-07-2016 15:41:54.003 UTC Debug cassandra_store.cpp:289: No thread-local Client - creating one
14-07-2016 15:41:54.003 UTC Debug cassandra_store.cpp:309: Looking to release thread-local client
14-07-2016 15:41:54.003 UTC Debug cassandra_store.cpp:314: Found thread-local client - destroying
14-07-2016 15:41:54.003 UTC Status cassandra_store.cpp:223: Starting store
14-07-2016 15:41:54.005 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
14-07-2016 15:41:54.005 UTC Status httpconnection.cpp:147:   Connection created for server sprout.example.com:9888
14-07-2016 15:41:54.005 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
14-07-2016 15:41:54.005 UTC Status diameterstack.cpp:78: Initializing Diameter stack
14-07-2016 15:41:54.006 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
14-07-2016 15:41:54.006 UTC Debug freeDiameter: Parsing configuration file: /var/lib/homestead/homestead.conf
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Extension /usr/share/clearwater/homestead/lib/freeDiameter//dbg_monitor.fdx added to the list.
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Extension /usr/share/clearwater/homestead/lib/freeDiameter//dict_nasreq.fdx added to the list.
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Extension /usr/share/clearwater/homestead/lib/freeDiameter//dict_sip.fdx added to the list.
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Extension /usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca.fdx added to the list.
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Extension /usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca_3gpp.fdx added to the list.
14-07-2016 15:41:54.007 UTC Debug freeDiameter: Generating fresh Diffie-Hellman parameters of size 1024 (this takes some time)... 
14-07-2016 15:41:54.225 UTC Debug freeDiameter: Loading : /usr/share/clearwater/homestead/lib/freeDiameter//dbg_monitor.fdx
14-07-2016 15:41:54.225 UTC Debug freeDiameter: Checking dependencies for 'dbg_monitor'...
14-07-2016 15:41:54.225 UTC Debug freeDiameter: Extension [/usr/share/clearwater/homestead/lib/freeDiameter//dbg_monitor.fdx] fd_ext_fini has been resolved successfully.
14-07-2016 15:41:54.225 UTC Debug freeDiameter: Loading : /usr/share/clearwater/homestead/lib/freeDiameter//dict_nasreq.fdx
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Checking dependencies for 'dict_nasreq'...
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension [/usr/share/clearwater/homestead/lib/freeDiameter//dict_nasreq.fdx] has no fd_ext_fini function.
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension 'Dictionary definitions for NASREQ' initialized
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Loading : /usr/share/clearwater/homestead/lib/freeDiameter//dict_sip.fdx
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Checking dependencies for 'dict_sip'...
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension [/usr/share/clearwater/homestead/lib/freeDiameter//dict_sip.fdx] has no fd_ext_fini function.
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension 'Dictionary definitions for SIP' initialized
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Loading : /usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca.fdx
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Checking dependencies for 'dict_dcca'...
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension [/usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca.fdx] has no fd_ext_fini function.
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension 'Dictionary definitions for DCCA (rfc4006)' initialized
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Loading : /usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca_3gpp.fdx
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Checking dependencies for 'dict_dcca_3gpp'...
14-07-2016 15:41:54.226 UTC Debug freeDiameter: Extension [/usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca_3gpp.fdx] has no fd_ext_fini function.
14-07-2016 15:41:54.229 UTC Debug freeDiameter: An existing object with the same data was found, ignoring the error...
14-07-2016 15:41:54.229 UTC Debug freeDiameter: An existing object with the same data was found, ignoring the error...
14-07-2016 15:41:54.229 UTC Debug freeDiameter: An existing object with the same data was found, ignoring the error...
14-07-2016 15:41:54.230 UTC Debug freeDiameter: Extension 'Dictionary definitions for DCCA 3GPP' initialized
14-07-2016 15:41:54.230 UTC Status freeDiameter: All extensions loaded.
14-07-2016 15:41:54.230 UTC Status freeDiameter: freeDiameter configuration:
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Default trace level .... : +3
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Configuration file ..... : /var/lib/homestead/homestead.conf
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Diameter Identity ...... : homestead01.example.com (l:27)
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Diameter Realm ......... : homestead.example.com (l:25)
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Tc Timer ............... : 30
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Tw Timer ............... : 30
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Local port ............. : 3868
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Local secure port ...... : 5658
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Number of SCTP streams . : 3
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Number of clients thr .. : 5
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Number of app threads .. : 4
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Local endpoints ........ : Default (use all available)
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Local applications ..... : (none)
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Flags : - IP ........... : Enabled
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - IPv6 ......... : Enabled
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - Relay app .... : Enabled
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - TCP .......... : Enabled
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - SCTP ......... : Enabled
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - Pref. proto .. : SCTP
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - TLS method ... : Separate port
14-07-2016 15:41:54.230 UTC Status freeDiameter:   TLS :   - Certificate .. : /var/lib/homestead/cert.pem
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - Private key .. : /var/lib/homestead/privkey.pem
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - CA (trust) ... : /var/lib/homestead/ca.pem (1 certs)
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - CRL .......... : (none)
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - Priority ..... : (default: 'NORMAL')
14-07-2016 15:41:54.230 UTC Status freeDiameter:           - DH bits ...... : 1024
14-07-2016 15:41:54.230 UTC Status freeDiameter:   Origin-State-Id ........ : 1468510914
14-07-2016 15:41:54.230 UTC Status freeDiameter: Loaded extensions: '/usr/share/clearwater/homestead/lib/freeDiameter//dbg_monitor.fdx'[(no config file)], loaded
14-07-2016 15:41:54.230 UTC Status freeDiameter: Loaded extensions: '/usr/share/clearwater/homestead/lib/freeDiameter//dict_nasreq.fdx'[(no config file)], loaded
14-07-2016 15:41:54.230 UTC Status freeDiameter: Loaded extensions: '/usr/share/clearwater/homestead/lib/freeDiameter//dict_sip.fdx'[(no config file)], loaded
14-07-2016 15:41:54.230 UTC Status freeDiameter: Loaded extensions: '/usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca.fdx'[(no config file)], loaded
14-07-2016 15:41:54.230 UTC Status freeDiameter: Loaded extensions: '/usr/share/clearwater/homestead/lib/freeDiameter//dict_dcca_3gpp.fdx'[(no config file)], loaded
14-07-2016 15:41:54.230 UTC Status freeDiameter: {signal:12}'dbg_monitor'->0x7f6abc5f5e70 
14-07-2016 15:41:54.230 UTC Debug freeDiameter: Core state: 1 -> 2
14-07-2016 15:41:54.230 UTC Status diameterstack.cpp:573: Starting Diameter stack
14-07-2016 15:41:54.231 UTC Status freeDiameter: Local server address(es): 172.26.0.51{---L-}	XXX.XXX.XXX.101{---L-}
14-07-2016 15:41:54.231 UTC Debug freeDiameter: Core state: 2 -> 3
14-07-2016 15:41:54.231 UTC Status handlers.cpp:85: Configuring HssCacheTask
14-07-2016 15:41:54.231 UTC Status handlers.cpp:86:   Dest-Realm:  example1.com
14-07-2016 15:41:54.231 UTC Status handlers.cpp:87:   Dest-Host:   hss.example1.com
14-07-2016 15:41:54.231 UTC Status handlers.cpp:88:   Server-Name: sip:scscf.sprout.example.com:5054;transport=TCP
14-07-2016 15:41:54.231 UTC Status httpstack.cpp:136: Configuring HTTP stack
14-07-2016 15:41:54.231 UTC Status httpstack.cpp:137:   Bind address: XXX.XXX.XXX.101
14-07-2016 15:41:54.231 UTC Status httpstack.cpp:138:   Bind port:    8888
14-07-2016 15:41:54.231 UTC Status httpstack.cpp:139:   Num threads:  100
14-07-2016 15:41:54.739 UTC Debug diameterresolver.cpp:46: Creating Diameter resolver
14-07-2016 15:41:54.739 UTC Debug baseresolver.cpp:75: Create NAPTR cache
14-07-2016 15:41:54.739 UTC Debug baseresolver.cpp:84: Create SRV cache
14-07-2016 15:41:54.739 UTC Debug baseresolver.cpp:93: Create black list
14-07-2016 15:41:54.739 UTC Status diameterresolver.cpp:62: Created Diameter resolver
14-07-2016 15:41:54.739 UTC Status main.cpp:853: Start-up complete - wait for termination signal
14-07-2016 15:41:54.739 UTC Debug diameterresolver.cpp:91: DiameterResolver::resolve for realm , host XXX.XXX.XXX.100, family 2
14-07-2016 15:41:54.739 UTC Debug baseresolver.cpp:514: Attempt to parse XXX.XXX.XXX.100 as IP address
14-07-2016 15:41:54.739 UTC Debug diameterresolver.cpp:175: Target is an IP address - default port/transport
14-07-2016 15:41:54.739 UTC Debug realmmanager.cpp:381: Adding peer: XXX.XXX.XXX.100
14-07-2016 15:41:54.739 UTC Debug freeDiameter: Diameter peer XXX.XXX.XXX.100 added
14-07-2016 15:41:54.739 UTC Debug freeDiameter: Peer timeout reset to 0 seconds (+/- 2)
14-07-2016 15:41:54.740 UTC Warning diameterstack.cpp:858: No connected Diameter peers have been found
14-07-2016 15:41:54.740 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_CLOSED' waiting for next event.
14-07-2016 15:41:57.757 UTC Debug freeDiameter: 'STATE_CLOSED'	<-- 'FDEVP_PSM_TIMEOUT'	((nil),0)	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.757 UTC Debug freeDiameter: XXX.XXX.XXX.100: Connecting...
14-07-2016 15:41:57.757 UTC Debug freeDiameter: 'STATE_CLOSED'	-> 'STATE_WAITCNXACK'	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.757 UTC Debug freeDiameter: Peer timeout reset to 10 seconds
14-07-2016 15:41:57.757 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_WAITCNXACK' waiting for next event.
14-07-2016 15:41:57.757 UTC Debug freeDiameter: Prepared 1 sets of connection parameters to peer XXX.XXX.XXX.100
14-07-2016 15:41:57.757 UTC Debug freeDiameter: Connecting to TCP XXX.XXX.XXX.100(3868)...
14-07-2016 15:41:57.828 UTC Debug freeDiameter: 'STATE_WAITCNXACK'	<-- 'FDEVP_CNX_ESTABLISHED'	(0x7f6aa000ac50,0)	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.828 UTC Debug freeDiameter: XXX.XXX.XXX.100: Connection established, {----} TCP,#636->XXX.XXX.XXX.100(3868)
14-07-2016 15:41:57.828 UTC Debug freeDiameter: GOING TO SEND TO 'XXX.XXX.XXX.100': 'Capabilities-Exchange-Request'0/257 f:R--- src:'(nil)' len:20 {C:264/l:8,C:296/l:8,C:278/l:12,C:257/l:8,C:257/l:8,C:266/l:12,C:269/l:8,C:267/l:12,C:299/l:12,C:260/l:8,C:258/l:12,C:265/l:12,C:265/l:12,C:265/l:12}
14-07-2016 15:41:57.828 UTC Debug freeDiameter: Sending 272b data on connection {----} TCP,#636->XXX.XXX.XXX.100(3868)
14-07-2016 15:41:57.828 UTC Debug freeDiameter: 'STATE_WAITCNXACK'	-> 'STATE_WAITCEA'	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.828 UTC Debug freeDiameter: Peer timeout reset to 10 seconds
14-07-2016 15:41:57.828 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_WAITCEA' waiting for next event.
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Thread terminated
14-07-2016 15:41:57.912 UTC Debug freeDiameter: 'STATE_WAITCEA'	<-- 'FDEVP_CNX_MSG_RECV'	(0x7f6aac00ab70,268)	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Iterating on rules of COMMAND: 'Capabilities-Exchange-Answer'.
14-07-2016 15:41:57.912 UTC Debug diameterstack.cpp:371: Callback (type 12) from freeDiameter: XXX.XXX.XXX.100
14-07-2016 15:41:57.912 UTC Info realmmanager.cpp:118: Successfully connected to XXX.XXX.XXX.100 in realm example1.com
14-07-2016 15:41:57.912 UTC Status freeDiameter: No TLS protection negotiated with peer 'XXX.XXX.XXX.100'.
14-07-2016 15:41:57.912 UTC Status freeDiameter: 'STATE_WAITCEA'	-> 'STATE_OPEN'	'XXX.XXX.XXX.100'
14-07-2016 15:41:57.912 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:41:57.912 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:41:59.740 UTC Debug diameterresolver.cpp:91: DiameterResolver::resolve for realm , host XXX.XXX.XXX.100, family 2
14-07-2016 15:41:59.740 UTC Debug baseresolver.cpp:514: Attempt to parse XXX.XXX.XXX.100 as IP address
14-07-2016 15:41:59.740 UTC Debug diameterresolver.cpp:175: Target is an IP address - default port/transport
14-07-2016 15:42:02.365 UTC Verbose httpstack.cpp:293: Process request for URL /impi/123456789012345%40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%3A19998887777%40example.com&visited-network=example.com&auth-type=REG
14-07-2016 15:42:02.376 UTC Debug handlers.cpp:591: Parsed HTTP request: private ID 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org, public ID sip:19998887777 at example.com, visited network example.com, authorization type REG
14-07-2016 15:42:02.376 UTC Debug cx.cpp:109: Building User-Authorization request for 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org/sip:19998887777 at example.com
14-07-2016 15:42:02.376 UTC Debug freeDiameter: No Session-Id AVP found in message 0x7f6a7c0315d0
14-07-2016 15:42:02.376 UTC Verbose diameterstack.cpp:1427: Sending Diameter message of type 300 on transaction 0x7f6a7c032190 with timeout 200
14-07-2016 15:42:02.376 UTC Debug diameterstack.cpp:397: Routing out callback from freeDiameter
14-07-2016 15:42:02.376 UTC Debug realmmanager.cpp:189: freeDiameter routing score for candidate XXX.XXX.XXX.100 is changing from 98 to 97
14-07-2016 15:42:02.376 UTC Debug freeDiameter: GOING TO SEND TO 'XXX.XXX.XXX.100': '3GPP/User-Authorization-Request'16777216/300 f:RP-- src:'(nil)' len:20 {C:263/l:8,C:260/l:8,C:277/l:12,C:264/l:8,C:296/l:8,C:293/l:8,C:283/l:8,C:1/l:8,V:10415/C:601/l:12,V:10415/C:600/l:12,V:10415/C:623/l:16}
14-07-2016 15:42:02.376 UTC Debug diameterstack.cpp:908: Processing a sent diameter message
14-07-2016 15:42:02.376 UTC Debug diameterstack.cpp:910: Got existing trail ID: 1
14-07-2016 15:42:02.376 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;1
14-07-2016 15:42:02.376 UTC Debug freeDiameter: Sending 376b data on connection {----} TCP,#636->XXX.XXX.XXX.100(3868)
14-07-2016 15:42:02.485 UTC Debug freeDiameter: 'STATE_OPEN'	<-- 'FDEVP_CNX_MSG_RECV'	(0x7f6aac00ab70,252)	'XXX.XXX.XXX.100'
14-07-2016 15:42:02.485 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.485 UTC Debug diameterstack.cpp:901: Got existing trail ID: 1
14-07-2016 15:42:02.485 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;1
14-07-2016 15:42:02.486 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.486 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.486 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.486 UTC Debug freeDiameter: Iterating on rules of AVP: 'Experimental-Result'.
14-07-2016 15:42:02.486 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/User-Authorization-Answer'.
14-07-2016 15:42:02.486 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a7c032190)
14-07-2016 15:42:02.486 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 300 - calling callback on transaction 0x7f6a7c032190
14-07-2016 15:42:02.486 UTC Debug diameterstack.cpp:1375: Got Experimental-Result-Code 2002
14-07-2016 15:42:02.486 UTC Debug handlers.cpp:647: Received User-Authorization answer with result 0/2002
14-07-2016 15:42:02.486 UTC Debug handlers.cpp:662: Got Server-Name sip:scscf.sprout.example.com:5054;transport=TCP
14-07-2016 15:42:02.486 UTC Verbose httpstack.cpp:69: Sending response 200 to request for URL /impi/123456789012345%40ims.mncXXX.mccXXX.3gppnetwork.org/registration-status, args impu=sip%3A19998887777%40example.com&visited-network=example.com&auth-type=REG
14-07-2016 15:42:02.498 UTC Verbose httpstack.cpp:293: Process request for URL /impi/123456789012345%40ims.mncXXX.mccXXX.3gppnetwork.org/av, args impu=sip%3A19998887777%40example.com
14-07-2016 15:42:02.498 UTC Debug handlers.cpp:148: Parsed HTTP request: private ID 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org, public ID sip:19998887777 at example.com, scheme Unknown, authorization 
14-07-2016 15:42:02.498 UTC Debug handlers.cpp:155: Authentication vector cache query disabled - query HSS
14-07-2016 15:42:02.498 UTC Debug cx.cpp:366: Building Multimedia-Auth request for 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org/sip:19998887777 at example.com
14-07-2016 15:42:02.498 UTC Debug freeDiameter: No Session-Id AVP found in message 0x7f6a8c019760
14-07-2016 15:42:02.498 UTC Verbose diameterstack.cpp:1427: Sending Diameter message of type 303 on transaction 0x7f6a8c01a440 with timeout 200
14-07-2016 15:42:02.498 UTC Debug diameterstack.cpp:397: Routing out callback from freeDiameter
14-07-2016 15:42:02.498 UTC Debug realmmanager.cpp:189: freeDiameter routing score for candidate XXX.XXX.XXX.100 is changing from 98 to 97
14-07-2016 15:42:02.498 UTC Debug freeDiameter: GOING TO SEND TO 'XXX.XXX.XXX.100': '3GPP/Multimedia-Auth-Request'16777216/303 f:RP-- src:'(nil)' len:20 {C:263/l:8,C:260/l:8,C:277/l:12,C:283/l:8,C:293/l:8,C:264/l:8,C:296/l:8,C:1/l:8,V:10415/C:601/l:12,V:10415/C:612/l:12,V:10415/C:607/l:16,V:10415/C:602/l:12}
14-07-2016 15:42:02.498 UTC Debug diameterstack.cpp:908: Processing a sent diameter message
14-07-2016 15:42:02.498 UTC Debug diameterstack.cpp:910: Got existing trail ID: 2
14-07-2016 15:42:02.498 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.498 UTC Debug freeDiameter: Sending 444b data on connection {----} TCP,#636->XXX.XXX.XXX.100(3868)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'STATE_OPEN'	<-- 'FDEVP_CNX_MSG_RECV'	(0x7f6aac00ad30,516)	'XXX.XXX.XXX.100'
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]

Advanced stack dump (requires gdb):
14-07-2016 15:42:02.999 UTC Verbose httpstack.cpp:293: Process request for URL /impi/123456789012345%40ims.mncXXX.mccXXX.3gppnetwork.org/av, args impu=sip%3A19998887777%40example.com
14-07-2016 15:42:02.999 UTC Debug handlers.cpp:148: Parsed HTTP request: private ID 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org, public ID sip:19998887777 at example.com, scheme Unknown, authorization 
14-07-2016 15:42:02.999 UTC Debug handlers.cpp:155: Authentication vector cache query disabled - query HSS
14-07-2016 15:42:02.999 UTC Debug cx.cpp:366: Building Multimedia-Auth request for 123456789012345 at ims.mncXXX.mccXXX.3gppnetwork.org/sip:19998887777 at example.com
14-07-2016 15:42:02.999 UTC Debug freeDiameter: No Session-Id AVP found in message 0x7f6a88018fb0
14-07-2016 15:42:02.999 UTC Verbose diameterstack.cpp:1427: Sending Diameter message of type 303 on transaction 0x7f6a88019c90 with timeout 200
14-07-2016 15:42:02.999 UTC Debug diameterstack.cpp:397: Routing out callback from freeDiameter
14-07-2016 15:42:02.999 UTC Debug realmmanager.cpp:189: freeDiameter routing score for candidate XXX.XXX.XXX.100 is changing from 98 to 97
14-07-2016 15:42:02.999 UTC Debug freeDiameter: GOING TO SEND TO 'XXX.XXX.XXX.100': '3GPP/Multimedia-Auth-Request'16777216/303 f:RP-- src:'(nil)' len:20 {C:263/l:8,C:260/l:8,C:277/l:12,C:283/l:8,C:293/l:8,C:264/l:8,C:296/l:8,C:1/l:8,V:10415/C:601/l:12,V:10415/C:612/l:12,V:10415/C:607/l:16,V:10415/C:602/l:12}
14-07-2016 15:42:02.999 UTC Debug diameterstack.cpp:908: Processing a sent diameter message
14-07-2016 15:42:02.999 UTC Debug diameterstack.cpp:910: Got existing trail ID: 3
14-07-2016 15:42:02.999 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;3
14-07-2016 15:42:03.000 UTC Debug freeDiameter: Sending 444b data on connection {----} TCP,#636->XXX.XXX.XXX.100(3868)
14-07-2016 15:42:03.136 UTC Debug freeDiameter: 'STATE_OPEN'	<-- 'FDEVP_CNX_MSG_RECV'	(0x7f6aac00ab70,516)	'XXX.XXX.XXX.100'
14-07-2016 15:42:03.136 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:03.136 UTC Debug diameterstack.cpp:901: Got existing trail ID: 3
14-07-2016 15:42:03.136 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;3
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:03.136 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:03.136 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a88019c90)
14-07-2016 15:42:03.136 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a88019c90
14-07-2016 15:42:03.136 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:03.136 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]

Advanced stack dump (requires gdb):
Could not attach to process.  If your uid matches the uid of the target
process, check the setting of /proc/sys/kernel/yama/ptrace_scope, or try
again as the root user.  For more details, see /etc/sysctl.d/10-ptrace.conf
warning: process 32224 is already traced by process 32454
ptrace: Operation not permitted.
/etc/clearwater/32224: No such file or directory.


warning: td_ta_new failed: generic error

warning: File "/lib/x86_64-linux-gnu/libthread_db-1.0.so" auto-loading has been declined by your `auto-load safe-path' set to "$debugdir:$datadir/auto-load".
To enable execution of this file add
	add-auto-load-safe-path /lib/x86_64-linux-gnu/libthread_db-1.0.so
line to your configuration file "/nonexistent/.gdbinit".
To completely disable this security protection add
	set auto-load safe-path /
line to your configuration file "/nonexistent/.gdbinit".
For more information about this security protection see the
"Auto-loading safe path" section in the GDB manual.  E.g., run from the shell:
	info "(gdb)Auto-loading safe path"

warning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.
Cannot access memory at address 0x7f6ad24e11a8

warning: td_ta_new failed: generic error

warning: File "/lib/x86_64-linux-gnu/libthread_db-1.0.so" auto-loading has been declined by your `auto-load safe-path' set to "$debugdir:$datadir/auto-load".

warning: Unable to find libthread_db matching inferior's thread library, thread debugging will not be available.
Failed to read a valid object file image from memory.
sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85
85	../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S: No such file or directory.
Python Exception <class 'gdb.MemoryError'> Cannot access memory at address 0x7ffe99f12278: 

Thread 1 (process 32224):
#0  sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85
Cannot access memory at address 0x7ffe99f12278
ptrace: No such process.


From chris at projectclearwater.org  Thu Jul 14 12:18:47 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Thu, 14 Jul 2016 16:18:47 +0000
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing
	on	clearwater docker deploy
In-Reply-To: <4FD5C6E9-B72B-413F-A990-A83BFC0B01B5@unina.it>
References: <4FD5C6E9-B72B-413F-A990-A83BFC0B01B5@unina.it>
Message-ID: <CY1PR02MB11815549C0465C89FD021794E1320@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Luigi,

Thank you for letting us know about this issue. It looks like you have hit a threading bug in Bono. The log message you picked out shows that one of Bono's threads is attempting to release a lock that it does not currently own.

We have run stress recently, and didn't see this problem, so I would like to find out what the difference is between your system and ours. That should help use to get a reproduction scenario and debug the problem.

The first thing to check is how many CPUs and how many worker threads you are using. You can find out how many CPUs there are on your server by running `grep processor /proc/cpuinfo | wc -l`. You can find out many worker threads you are using by looking in /etc/clearwater/user_settings. If there is a num_worker_threads option, that will set the number of threads. Otherwise, there will be one per core. If you have more than 1 CPU core on your Bono node, you may be able to reduce the risk of hitting this issue by moving to a node with only 1 core.

I would also like to take a look at some debug logs from your system. Can you please enable debug logging<http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#bono> (log level 5), and send over a log from when this happens?

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Luigi De Simone
Sent: 13 July 2016 11:06
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy

Hi all, after deploying clearwater with docker, I've just tried sipp stress test and there are some message timeouts. In particular from
/var/log/bono/bono_current.txt there are some sporadic messages like this:

UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()

Other nodes do not exhibit problems.
The sipp error log is below:

sipp: The following events occured:
2016-07-13      09:57:35:333    1468403855.333438: Call-Id: 12-21655 at 192.168.1.250<mailto:12-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:57:52:946    1468403872.946879: Call-Id: 44-21655 at 192.168.1.250<mailto:44-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:19:863    1468403899.863728: Call-Id: 47-21655 at 192.168.1.250<mailto:47-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:20:820    1468403900.820186: Call-Id: 28-21655 at 192.168.1.250<mailto:28-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:02:504    1468403942.504959: Call-Id: 50-21655 at 192.168.1.250<mailto:50-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:06:724    1468403946.724817: Call-Id: 7-21655 at 192.168.1.250<mailto:7-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:466    1468403949.466635: Call-Id: 29-21655 at 192.168.1.250<mailto:29-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:921    1468403949.921984: Call-Id: 21-21655 at 192.168.1.250<mailto:21-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:26:948    1468403966.948038: Call-Id: 8-21655 at 192.168.1.250<mailto:8-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:55:369    1468403995.369205: Call-Id: 46-21655 at 192.168.1.250<mailto:46-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

and sipp.out is:

  Call limit reached (-m 50), 0.000 s period  0 ms scheduler resolution^M
  0 calls (limit 50)                     Peak was 50 calls, after 0 s^M
  0 Running, 15 Paused, 0 Woken up^M
  0 dead call msg (discarded)            0 out-of-call msg (discarded)        ^M
  1 open sockets                        ^M
^M
                                 Messages  Retrans   Timeout   Unexpected-Msg^M
       Pause [ 0ms/2:30]         50                            0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
       Pause [     1:00]         50                            0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
       Pause [$pre_call_delay]   50                            0        ^M
      INVITE ---------->  B-RTD2 50        0                            ^M
         100 <----------         50        0         0         0        ^M
      INVITE <----------         0         0         0         0        ^M
         100 <----------         0         0         0         0        ^M
      INVITE <----------         50        0         0         0        ^M
         100 ---------->         50        0                            ^M
         180 ---------->         50        0                            ^M
         180 <----------         50        0         0         0        ^M
       Pause [   2000ms]         50                            0        ^M
         200 ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
         ACK ---------->         50        0                            ^M
         ACK <----------         40        0         10        0        ^M
      UPDATE ---------->         40        0                            ^M
      UPDATE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD2 40        0         0         0        ^M
       Pause [   6000ms]         40                            0        ^M
         BYE ---------->  B-RTD3 40        0                            ^M
         BYE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD3 40        0         0         0        ^M
------------------------------ Test Terminated --------------------------------^M

The messages with trigger timeouts are always in that point of the scenario.
What is the problem? Any help?

Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/f13248e2/attachment.html>

From trey.ormsbee at interoptechnologies.com  Thu Jul 14 14:56:35 2016
From: trey.ormsbee at interoptechnologies.com (Trey Ormsbee)
Date: Thu, 14 Jul 2016 13:56:35 -0500
Subject: [Project Clearwater] homestead core dump on MAA
In-Reply-To: <1468511977.31863.30.camel@interoptechnologies.com>
References: <1468511977.31863.30.camel@interoptechnologies.com>
Message-ID: <1468522595.31863.38.camel@interoptechnologies.com>

It appears this crashed is caused by a missing required parameter in the
MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a
bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee
<trey.ormsbee at interoptechnologies.com>
To: clearwater at lists.projectclearwater.org
<clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a
received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing
trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising
correlating marker with diameter session ID =
homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30
seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in
state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback
registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter
response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received
Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter
'(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) &&
(((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?
I cannot attach a capture/core as it has private data in it. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/e767d5c1/attachment.html>

From Chris.Elford at metaswitch.com  Fri Jul 15 06:41:12 2016
From: Chris.Elford at metaswitch.com (Chris Elford)
Date: Fri, 15 Jul 2016 10:41:12 +0000
Subject: [Project Clearwater] FW: [Clearwater Docker] SIPp stress testing
	on	clearwater docker deploy
In-Reply-To: <CY1PR02MB1181297206A70AD33CCB8553E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <CY1PR02MB11815549C0465C89FD021794E1320@CY1PR02MB1181.namprd02.prod.outlook.com>
	<18d24336-36ba-408a-8477-809ac5ca7f8f@email.android.com>
	<CY1PR02MB1181297206A70AD33CCB8553E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <CY1PR02MB11814E5866B81F3616B074F1E1330@CY1PR02MB1181.namprd02.prod.outlook.com>

Thanks Luigi,

I?m glad to hear that fixed the problem.

I?ve raised a GitHub issue to cover the call failures that you were seeing: https://github.com/Metaswitch/sprout/issues/1488.

It would be great if you could try to hit this issue again with debug logs turned on, and send them over. That way, we may be able to use Bono reliably with multiple cores in the future.

Chris

From: Luigi De Simone [mailto:luigi.desimone at unina.it]
Sent: 14 July 2016 18:19
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Subject: RE: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy


Hi Chris, I would inform you that I've just found a solution in the morning by reducing cpus to 1 exactly :)
So, this is the bug!

Cheerio,

Luigi
Il 14 lug 2016 6:18 PM, "Chris Elford (projectclearwater.org)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> ha scritto:

Hi Luigi,



Thank you for letting us know about this issue. It looks like you have hit a threading bug in Bono. The log message you picked out shows that one of Bono?s threads is attempting to release a lock that it does not currently own.



We have run stress recently, and didn?t see this problem, so I would like to find out what the difference is between your system and ours. That should help use to get a reproduction scenario and debug the problem.



The first thing to check is how many CPUs and how many worker threads you are using. You can find out how many CPUs there are on your server by running `grep processor /proc/cpuinfo | wc -l`. You can find out many worker threads you are using by looking in /etc/clearwater/user_settings. If there is a num_worker_threads option, that will set the number of threads. Otherwise, there will be one per core. If you have more than 1 CPU core on your Bono node, you may be able to reduce the risk of hitting this issue by moving to a node with only 1 core.



I would also like to take a look at some debug logs from your system. Can you please enable debug logging<http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#bono> (log level 5), and send over a log from when this happens?



Yours,



Chris



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Luigi De Simone
Sent: 13 July 2016 11:06
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy



Hi all, after deploying clearwater with docker, I've just tried sipp stress test and there are some message timeouts. In particular from

/var/log/bono/bono_current.txt there are some sporadic messages like this:



UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()



Other nodes do not exhibit problems.

The sipp error log is below:



sipp: The following events occured:

2016-07-13      09:57:35:333    1468403855.333438: Call-Id: 12-21655 at 192.168.1.250<mailto:12-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:57:52:946    1468403872.946879: Call-Id: 44-21655 at 192.168.1.250<mailto:44-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:58:19:863    1468403899.863728: Call-Id: 47-21655 at 192.168.1.250<mailto:47-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:58:20:820    1468403900.820186: Call-Id: 28-21655 at 192.168.1.250<mailto:28-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:02:504    1468403942.504959: Call-Id: 50-21655 at 192.168.1.250<mailto:50-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:06:724    1468403946.724817: Call-Id: 7-21655 at 192.168.1.250<mailto:7-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:09:466    1468403949.466635: Call-Id: 29-21655 at 192.168.1.250<mailto:29-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:09:921    1468403949.921984: Call-Id: 21-21655 at 192.168.1.250<mailto:21-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:26:948    1468403966.948038: Call-Id: 8-21655 at 192.168.1.250<mailto:8-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

2016-07-13      09:59:55:369    1468403995.369205: Call-Id: 46-21655 at 192.168.1.250<mailto:46-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.



and sipp.out is:



  Call limit reached (-m 50), 0.000 s period  0 ms scheduler resolution^M

  0 calls (limit 50)                     Peak was 50 calls, after 0 s^M

  0 Running, 15 Paused, 0 Woken up^M

  0 dead call msg (discarded)            0 out-of-call msg (discarded)        ^M

  1 open sockets                        ^M

^M

                                 Messages  Retrans   Timeout   Unexpected-Msg^M

       Pause [ 0ms/2:30]         50                            0        ^M

    REGISTER ---------->         50        0                            ^M

         401 <----------         50        0         0         0        ^M

    REGISTER ---------->         50        0                            ^M

         200 <----------         50        0         0         0        ^M

    REGISTER ---------->         50        0                            ^M

         401 <----------         50        0         0         0        ^M

    REGISTER ---------->         50        0                            ^M

         200 <----------         50        0         0         0        ^M

       Pause [     1:00]         50                            0        ^M

    REGISTER ---------->  B-RTD1 50        0                            ^M

         200 <----------  E-RTD1 50        0         0         0        ^M

    REGISTER ---------->  B-RTD1 50        0                            ^M

         200 <----------  E-RTD1 50        0         0         0        ^M

       Pause [$pre_call_delay]   50                            0        ^M

      INVITE ---------->  B-RTD2 50        0                            ^M

         100 <----------         50        0         0         0        ^M

      INVITE <----------         0         0         0         0        ^M

         100 <----------         0         0         0         0        ^M

      INVITE <----------         50        0         0         0        ^M

         100 ---------->         50        0                            ^M

         180 ---------->         50        0                            ^M

         180 <----------         50        0         0         0        ^M

       Pause [   2000ms]         50                            0        ^M

         200 ---------->         50        0                            ^M

         200 <----------         50        0         0         0        ^M

         ACK ---------->         50        0                            ^M

         ACK <----------         40        0         10        0        ^M

      UPDATE ---------->         40        0                            ^M

      UPDATE <----------         40        0         0         0        ^M

         200 ---------->         40        0                            ^M

         200 <----------  E-RTD2 40        0         0         0        ^M

       Pause [   6000ms]         40                            0        ^M

         BYE ---------->  B-RTD3 40        0                            ^M

         BYE <----------         40        0         0         0        ^M

         200 ---------->         40        0                            ^M

         200 <----------  E-RTD3 40        0         0         0        ^M

------------------------------ Test Terminated --------------------------------^M



The messages with trigger timeouts are always in that point of the scenario.

What is the problem? Any help?



Luigi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160715/a0350bd1/attachment.html>

From chris at projectclearwater.org  Fri Jul 15 07:00:40 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Fri, 15 Jul 2016 11:00:40 +0000
Subject: [Project Clearwater] homestead core dump on MAA
In-Reply-To: <1468522595.31863.38.camel@interoptechnologies.com>
References: <1468511977.31863.30.camel@interoptechnologies.com>
	<1468522595.31863.38.camel@interoptechnologies.com>
Message-ID: <CY1PR02MB118104F92582B549112BB248E1330@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Trey,

I?m glad you managed to get to the bottom of this. I?d like to get this issue fixed so that other people don?t hit this problem.

Do you know exactly which required parameter was missing in the MAA?

It would be great if you could get us a stack trace including debug symbols. To do that, run `sudo apt-get install bono-dbg sprout-dbg` to install Bono and Sprout debug symbols, then attempt to hit the crash again.

Yours,

Chris


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Trey Ormsbee
Sent: 14 July 2016 19:57
To: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] homestead core dump on MAA

It appears this crashed is caused by a missing required parameter in the MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee <trey.ormsbee at interoptechnologies.com<mailto:Trey%20Ormsbee%20%3ctrey.ormsbee at interoptechnologies.com%3e>>
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> <clearwater at lists.projectclearwater.org<mailto:%22clearwater at lists.projectclearwater.org%22%20%3cclearwater at lists.projectclearwater.org%3e>>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?  I cannot attach a capture/core as it has private data in it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160715/f9fe6de8/attachment.html>

From Chris.Elford at metaswitch.com  Fri Jul 15 07:01:27 2016
From: Chris.Elford at metaswitch.com (Chris Elford)
Date: Fri, 15 Jul 2016 11:01:27 +0000
Subject: [Project Clearwater] homestead core dump on MAA
References: <1468511977.31863.30.camel@interoptechnologies.com>
	<1468522595.31863.38.camel@interoptechnologies.com> 
Message-ID: <CY1PR02MB11818A8730F38B15CAAC0BF4E1330@CY1PR02MB1181.namprd02.prod.outlook.com>

Sorry, I made a mistake there. I should have said `sudo apt-get install homestead-dbg`.

From: Chris Elford (projectclearwater.org)
Sent: 15 July 2016 12:01
To: 'Trey Ormsbee' <trey.ormsbee at interoptechnologies.com>; clearwater at lists.projectclearwater.org
Subject: RE: [Project Clearwater] homestead core dump on MAA

Hi Trey,

I?m glad you managed to get to the bottom of this. I?d like to get this issue fixed so that other people don?t hit this problem.

Do you know exactly which required parameter was missing in the MAA?

It would be great if you could get us a stack trace including debug symbols. To do that, run `sudo apt-get install bono-dbg sprout-dbg` to install Bono and Sprout debug symbols, then attempt to hit the crash again.

Yours,

Chris


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Trey Ormsbee
Sent: 14 July 2016 19:57
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] homestead core dump on MAA

It appears this crashed is caused by a missing required parameter in the MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee <trey.ormsbee at interoptechnologies.com<mailto:Trey%20Ormsbee%20%3ctrey.ormsbee at interoptechnologies.com%3e>>
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> <clearwater at lists.projectclearwater.org<mailto:%22clearwater at lists.projectclearwater.org%22%20%3cclearwater at lists.projectclearwater.org%3e>>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?  I cannot attach a capture/core as it has private data in it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160715/5ea74b51/attachment.html>

From graeme at projectclearwater.org  Fri Jul 15 08:15:47 2016
From: graeme at projectclearwater.org (Graeme Robertson (projectclearwater.org))
Date: Fri, 15 Jul 2016 12:15:47 +0000
Subject: [Project Clearwater] homestead core dump on MAA
In-Reply-To: <CY1PR02MB11818A8730F38B15CAAC0BF4E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <1468511977.31863.30.camel@interoptechnologies.com>
	<1468522595.31863.38.camel@interoptechnologies.com>
	<CY1PR02MB11818A8730F38B15CAAC0BF4E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <CY1PR02MB21401DD7F6C01D1906604547E3330@CY1PR02MB2140.namprd02.prod.outlook.com>

Hi Trey,

I just had a look at this issue and found that we have a fairly trivial bug in Homestead (see https://github.com/Metaswitch/homestead/issues/362#issuecomment-232930184 for details) which I suspect caused your crash. We?d hit this if the MAA contained a SIP-Auth-Data-Item AVP that didn?t contain a SIP-Auth-Scheme AVP ? does that sound right? It sounds like you probably won?t hit this again, but I expect it will be fixed in our next release if you do require a fix for it. Thanks for bringing it to our attention!

Thanks,
Graeme

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Chris Elford
Sent: 15 July 2016 12:01
To: Chris Elford (projectclearwater.org); Trey Ormsbee; clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] homestead core dump on MAA

Sorry, I made a mistake there. I should have said `sudo apt-get install homestead-dbg`.

From: Chris Elford (projectclearwater.org)
Sent: 15 July 2016 12:01
To: 'Trey Ormsbee' <trey.ormsbee at interoptechnologies.com<mailto:trey.ormsbee at interoptechnologies.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Project Clearwater] homestead core dump on MAA

Hi Trey,

I?m glad you managed to get to the bottom of this. I?d like to get this issue fixed so that other people don?t hit this problem.

Do you know exactly which required parameter was missing in the MAA?

It would be great if you could get us a stack trace including debug symbols. To do that, run `sudo apt-get install bono-dbg sprout-dbg` to install Bono and Sprout debug symbols, then attempt to hit the crash again.

Yours,

Chris


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Trey Ormsbee
Sent: 14 July 2016 19:57
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] homestead core dump on MAA

It appears this crashed is caused by a missing required parameter in the MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee <trey.ormsbee at interoptechnologies.com<mailto:Trey%20Ormsbee%20%3ctrey.ormsbee at interoptechnologies.com%3e>>
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> <clearwater at lists.projectclearwater.org<mailto:%22clearwater at lists.projectclearwater.org%22%20%3cclearwater at lists.projectclearwater.org%3e>>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?  I cannot attach a capture/core as it has private data in it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160715/2f9d2694/attachment.html>

From joseph.blackwell at xn--80aqgcrd.xn--p1ai  Wed Jul 13 23:08:15 2016
From: joseph.blackwell at xn--80aqgcrd.xn--p1ai (FedEx International MailService)
Date: Thu, 14 Jul 2016 06:08:15 +0300
Subject: [Project Clearwater] Shipment delivery problem #000849602
Message-ID: <8ad2b6a1e52512afe4a5e40b8408043d@xn--80aqgcrd.xn--p1ai>

Dear Customer,

This is to confirm that one or more of your parcels has been shipped.
Shipment Label is attached to this email.

Thank you for choosing FedEx,
Joseph Blackwell,
Support Agent.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Label_000849602.zip
Type: application/zip
Size: 8202 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160714/5107768c/attachment.zip>

From vijayrg at yahoo.com  Fri Jul 15 13:43:08 2016
From: vijayrg at yahoo.com (Vijay)
Date: Fri, 15 Jul 2016 17:43:08 +0000 (UTC)
Subject: [Project Clearwater] clearwater/ralf docker image is failing with
 too many open files in system and corrupted double-linked list error
References: <1485531634.4179644.1468604588679.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1485531634.4179644.1468604588679.JavaMail.yahoo@mail.yahoo.com>

Hello,?I downloaded clearwater/ralf docker image about 8 days ago and when i launch it, ralf keeps exiting and tries to restart. In the logs inside the container, I see this error:Advanced stack dump (requires gdb):[warn] epoll_create: Too many open files in system[err] evsig_init: socketpair: Too many open files in system[warn] epoll_create: Too many open files in system[err] evsig_init: socketpair: Too many open files in system[warn] epoll_create: Too many open files in system[err] evsig_init: socketpair: Too many open files in system[warn] epoll_create: Too many open files in system[err] evsig_init: socketpair: Too many open files in system*** Error in `/usr/share/clearwater/bin/ralf': corrupted double-linked list: 0x0000000001c3cbf0 ***
I am running on a machine that has very compute resources..Clearwater/ralf image that I downloaded sometime in May did not have any problems.?
?Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160715/a9ecf135/attachment.html>

From andrew.okri at roecastle.com  Sun Jul 17 17:18:11 2016
From: andrew.okri at roecastle.com (Andrew Okri)
Date: Sun, 17 Jul 2016 22:18:11 +0100
Subject: [Project Clearwater] Ellis Mysql connection error
Message-ID: <76698E5C-7801-48DB-92C1-87E900349F68@roecastle.com>

Hello there,
	After running the create_numbers.py script using the python in the ellis home directory, l got the following error. I am not sure what to make of it. Hence l am hoping l could get some help for the forum:-
Traceback (most recent call last):
  File "./create_numbers.py", line 101, in <module>
    standalone(options.start, options.num, options.pstn, options.realm)
  File "./create_numbers.py", line 50, in standalone
    connection.init_connection()
  File "/usr/share/clearwater/ellis/env/lib/python2.7/site-packages/ellis-0.1-py2.7.egg/metaswitch/ellis/data/connection.py", line 60, in init_connection
    pool_recycle=3600)
  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/__init__.py", line 386, in create_engine
    return strategy.create(*args, **kwargs)
  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/strategies.py", line 75, in create
    dbapi = dialect_cls.dbapi(**dbapi_args)
  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/dialects/mysql/mysqldb.py", line 92, in dbapi
    return __import__('MySQLdb')
  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/MySQL_python-1.2.5-py2.7-linux-x86_64.egg/MySQLdb/__init__.py", line 19, in <module>
    import _mysql
ImportError: libmysqlclient.so.18: cannot open shared object file: No such file or directory
Regards
Andrew






From kosalayb at gmail.com  Mon Jul 18 06:29:22 2016
From: kosalayb at gmail.com (Kosala)
Date: Mon, 18 Jul 2016 11:29:22 +0100
Subject: [Project Clearwater] Sprout to Homestead communication
Message-ID: <CAGEe17amE4kA4zPtgTWDt_bA3FPOZ2O_fCpUDbx2EjH=kpkDhQ@mail.gmail.com>

Hi Team,

How is sprout reading data from Cassandra database at Homestead ? Is this
using homestead provisioning API ?
If not, could you please explain me the procedure?

Thanks in advance!
Kosala
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160718/89245f3d/attachment.html>

From chris at projectclearwater.org  Mon Jul 18 07:01:59 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Mon, 18 Jul 2016 11:01:59 +0000
Subject: [Project Clearwater] Sprout to Homestead communication
In-Reply-To: <CAGEe17amE4kA4zPtgTWDt_bA3FPOZ2O_fCpUDbx2EjH=kpkDhQ@mail.gmail.com>
References: <CAGEe17amE4kA4zPtgTWDt_bA3FPOZ2O_fCpUDbx2EjH=kpkDhQ@mail.gmail.com>
Message-ID: <CY1PR02MB1181E6DB01816824EBE40B5EE1360@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Kosala,

That?s a good question.

Homestead exposes its own API, separate to the Homestead Provisioning API. It?s documented in the Homestead codebase: https://github.com/Metaswitch/homestead/blob/dev/docs/homestead_api.md.

Homestead is able to run without Homestead Provisioning, in a deployment with an HSS. It acts as a gateway and cache, allowing Sprout to retrieve the data it needs from the HSS. In this sort of deployment, there is no need for Homestead Provisioning, so we need to expose an API that can be used without Homestead Provisioning. That?s why Homestead has its own API.

I hope that helps.

Yours.

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kosala
Sent: 18 July 2016 11:29
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Sprout to Homestead communication

Hi Team,
How is sprout reading data from Cassandra database at Homestead ? Is this using homestead provisioning API ?
If not, could you please explain me the procedure?

Thanks in advance!
Kosala

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160718/31f69a48/attachment.html>

From andrew.okri at roecastle.com  Mon Jul 18 07:19:59 2016
From: andrew.okri at roecastle.com (Andrew Okri)
Date: Mon, 18 Jul 2016 12:19:59 +0100
Subject: [Project Clearwater] Ellis Mysql connection error
In-Reply-To: <76698E5C-7801-48DB-92C1-87E900349F68@roecastle.com>
References: <76698E5C-7801-48DB-92C1-87E900349F68@roecastle.com>
Message-ID: <A7120662-5931-4ADB-BDC3-AE02F237B720@roecastle.com>

I found the fix for this problem and l like to share for anyone facing this problem. If you are confronted with this problem, chances are you are installing ellis on Ubuntu 16.04 which has a newer python libraries for mysql.  To fit the problem try the following:-

(1) sudo apt-get install libmysqlclient-dev python-mysqldb  and restart mysql and ellis

(2) if the above do not fix it for you, then download the file libmysqlclient.so.18 from the ubuntu launchpad and install it with apt

Before you try the above, ensure that you ellis install config are back to the state it was after you originally installed it. When you have it working, then you can tweak to your hearts content. good tweaking y?all.

Regards
Andrew

> On 17 Jul 2016, at 22:18, Andrew Okri <andrew.okri at roecastle.com> wrote:
> 
> Hello there,
> 	After running the create_numbers.py script using the python in the ellis home directory, l got the following error. I am not sure what to make of it. Hence l am hoping l could get some help for the forum:-
> Traceback (most recent call last):
>  File "./create_numbers.py", line 101, in <module>
>    standalone(options.start, options.num, options.pstn, options.realm)
>  File "./create_numbers.py", line 50, in standalone
>    connection.init_connection()
>  File "/usr/share/clearwater/ellis/env/lib/python2.7/site-packages/ellis-0.1-py2.7.egg/metaswitch/ellis/data/connection.py", line 60, in init_connection
>    pool_recycle=3600)
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/__init__.py", line 386, in create_engine
>    return strategy.create(*args, **kwargs)
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/strategies.py", line 75, in create
>    dbapi = dialect_cls.dbapi(**dbapi_args)
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/dialects/mysql/mysqldb.py", line 92, in dbapi
>    return __import__('MySQLdb')
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/MySQL_python-1.2.5-py2.7-linux-x86_64.egg/MySQLdb/__init__.py", line 19, in <module>
>    import _mysql
> ImportError: libmysqlclient.so.18: cannot open shared object file: No such file or directory
> Regards
> Andrew
> 
> 
> 
> 
> _______________________________________________
> Clearwater mailing list
> Clearwater at lists.projectclearwater.org
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org




From Chris.Elford at metaswitch.com  Mon Jul 18 11:46:02 2016
From: Chris.Elford at metaswitch.com (Chris Elford)
Date: Mon, 18 Jul 2016 15:46:02 +0000
Subject: [Project Clearwater] asdf
Message-ID: <CY1PR02MB11810D23A92F316F40A226C2E1360@CY1PR02MB1181.namprd02.prod.outlook.com>



--

Chris Elford
Product Owner - VoLTE NMS
+44 (0) 20 8362 3883

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160718/4f315fae/attachment.html>

From morrisyan123 at gmail.com  Mon Jul 18 10:02:26 2016
From: morrisyan123 at gmail.com (yan morris)
Date: Mon, 18 Jul 2016 22:02:26 +0800
Subject: [Project Clearwater] Configuration about Bono with two network
	adapters
Message-ID: <CAM_v+eRVnrmFeJ0qA1+R1ccYYtDEhEsJYRZkOPXOjDekWv5Hkg@mail.gmail.com>

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication
of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP
request from Internet.

I configured according this document ,
http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1
disappeared while I type ifconfig .

In addition , when i tried to ping google.com or any other domain name , it
give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not
reachable)
The command and configuration is under below

Local_config:

local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :

ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's
gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160718/eb06ab61/attachment.html>

From shivacharanms at gmail.com  Tue Jul 19 02:27:17 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Tue, 19 Jul 2016 11:57:17 +0530
Subject: [Project Clearwater] Clearwater live test on manuall install
	fails
In-Reply-To: <CY1PR02MB1181E653D76C635F4D132E45E12A0@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <CAJAf6NzshKb00RsphfenyzK7+Kej9m83DqrrfdkQukWJ90QwJg@mail.gmail.com>
	<BLUPR0201MB1843A9F29C2A9D91680AF275E15D0@BLUPR0201MB1843.namprd02.prod.outlook.com>
	<CAJAf6Nz_pFULjadEx6pSC8CDYLgyAt50qE_U=MnWUogNN2ev8A@mail.gmail.com>
	<CAJAf6Nw0F625ddEsnM4=6nVrLed4xueCs0Cb+u9WUb3y66vAiw@mail.gmail.com>
	<SN1PR0201MB18561F58831C23571EAE3311E15E0@SN1PR0201MB1856.namprd02.prod.outlook.com>
	<CAJAf6Nwcj_gz3vxasFeJKqR9brPMT4D0yjc+XvCffb689Ha2KQ@mail.gmail.com>
	<CAJAf6Nw7n3+0h8wGy_VsMKdKQt2nRikgNF8Y2nc2YLbi-0goNw@mail.gmail.com>
	<SN1PR0201MB18568DC3A04764C3D616EA13E1530@SN1PR0201MB1856.namprd02.prod.outlook.com>
	<CY1PR02MB1181E653D76C635F4D132E45E12A0@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <CAJAf6Ny4rDSVSSFKQHR7ZuhFa6ZhNvVGneDfD1R=0NvH+07UPA@mail.gmail.com>

Hi Chris,

Thank you for your suggestions. The Basic calls are working.
Could you provide me information on how to run the live calls with the live
test? Also, the live calls use SIPp client?

Thanks and regards,
Shiva

On Mon, Jun 20, 2016 at 1:38 PM, Chris Elford (projectclearwater.org) <
chris at projectclearwater.org> wrote:

> Hi Shiva,
>
>
>
> One of my colleagues saw your email, and suggested that I check that you
> are running on a 64 bit system.  A few people have hit issues trying to
> install Project Clearwater components on 32 bit systems, but we only build
> 64 bit packages.
>
>
>
> I hope you have managed to sort out your issue and get the packages
> installed.
>
>
>
> Yours,
>
>
>
> Chris
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Chris Elford (projectclearwater.org)
> *Sent:* 13 June 2016 16:10
> *To:* Shiva Charan <shivacharanms at gmail.com>
>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Project Clearwater] Clearwater live test on manuall
> install fails
>
>
>
> Hi Shiva,
>
>
>
> We may be able to help. Can you please send me the output from when you
> run the install command? It would also be great to take a look at the
> contents of /var/log/apt/history.log and /var/log/apt/term.log straight
> afterwards, and the contents of /etc/apt/sources.list.d/clearwater.list.
>
>
>
> Yours,
>
>
>
> Chris
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com
> <shivacharanms at gmail.com>]
> *Sent:* 10 June 2016 14:16
> *To:* Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Project Clearwater] Clearwater live test on manuall
> install fails
>
>
>
> Hi,
>
>
>
> I am trying to do a fresh install of clearwater manual install and seems
> the packages are not being found.
>
> I have entered the source list file for clearwater. Is there any reason
> that I am not able to locate any packages?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Wed, Jun 8, 2016 at 2:50 PM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Chris,
>
>
>
> How do I just make use of only TCP calls? As I would like to present
> positive results for clearwater live tests.
>
> What would be the rake command to do the same?
>
>
>
> And also I have signed up to the mailing list.
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Wed, Jun 8, 2016 at 2:06 PM, Chris Elford (projectclearwater.org) <
> chris at projectclearwater.org> wrote:
>
> Hi Shiva,
>
>
>
> I?m glad you got this working.
>
>
>
> We are aware that our UDP live tests are not very reliable. We have
> several issues open to cover this, and I would like to get them fixed:
>
> ?         https://github.com/Metaswitch/clearwater-live-test/issues/94
>
> ?         https://github.com/Metaswitch/clearwater-live-test/issues/117
>
> ?         https://github.com/Metaswitch/clearwater-live-test/issues/108
>
>
>
> Most of this is to do with our test framework, and we believe that UDP
> calls should work. However, we do most of our testing using TCP, so that is
> likely to be more reliable.
>
>
>
> Can I suggest that you sign up
> <http://www.projectclearwater.org/community/> to the mailing list? That
> way your posts will not have to wait for administrator approval, and you
> will be able to see posts from other users, which may help you with
> problems that you hit.
>
>
>
> Yours,
>
>
>
> Chris
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 08 June 2016 07:38
> *To:* Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Project Clearwater] Clearwater live test on manuall
> install fails
>
>
>
> Hi,
>
>
>
> When I give the rake command with proxy option the call goes through.
>
> But seems TCP options are passing and UDP are failing.
>
> Please suggest.
>
>
>
> clearwater at cwlive:~/clearwater-live-test$ rake test[cwhpe.com]
> SIGNUP_CODE=secret PROXY=bono.cwhpe.com ELLIS=ellis.cwhpe.com
> TESTS="Basic Call - Mainline"
>
> Basic Call - Mainline (TCP) - (6505550001, 6505550004) Passed
>
> Basic Call - Mainline (UDP) - (6505550000, 6505550007) Failed
>
> Endpoint threw exception:
>
>  - sip:6505550000 at bono.cwhpe.com timed out waiting for 200
>
>    -
> /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:205:in
> `rescue in recv_response'
>
>    -
> /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:202:in
> `recv_response'
>
>    -
> /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:225:in
> `recv_response_and_create_dialog'
>
>    - /home/clearwater/clearwater-live-test/lib/tests/basic-call.rb:63:in
> `block (2 levels) in <top (required)>'
>
> Endpoint threw exception:
>
>  - sip:6505550007 at bono.cwhpe.com timed out waiting for ACK
>
>    -
> /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:108:in
> `rescue in recv_request'
>
>    -
> /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:105:in
> `recv_request'
>
>    - /home/clearwater/clearwater-live-test/lib/tests/basic-call.rb:84:in
> `block (2 levels) in <top (required)>'
>
>
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
> On Tue, Jun 7, 2016 at 11:51 PM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Chris,
>
>
>
> The  clearwater VM's are reachable from my test node also tenet is going
> through.
>
>
>
> root at cwlive:~# ping bono.cwhpe.com
>
> PING bono.cwhpe.com (10.10.0.3) 56(84) bytes of data.
>
> 64 bytes from 10.10.0.3: icmp_seq=1 ttl=63 time=1.57 ms
>
> 64 bytes from 10.10.0.3: icmp_seq=2 ttl=63 time=0.725 ms
>
> ^C
>
> --- bono.cwhpe.com ping statistics ---
>
> 2 packets transmitted, 2 received, 0% packet loss, time 1001ms
>
> rtt min/avg/max/mdev = 0.725/1.149/1.574/0.425 ms
>
>
>
> clearwater at cwlive:~$ telnet bono.cwhpe.com 22
>
> Trying 10.10.0.3...
>
> Connected to bono.cwhpe.com.
>
> Escape character is '^]'.
>
> SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.7
>
> ^]
>
> telnet>
>
>
>
>
>
> Am I running the rake command correctly?
>
>
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Tue, Jun 7, 2016 at 10:21 PM, Chris Elford (projectclearwater.org) <
> chris at projectclearwater.org> wrote:
>
> Hi Shiva,
>
>
>
> I have taken a look at your logs, and I do not see any requests arriving
> at Bono targeted at cwhpe.com. The first thing I would check is whether
> cwhpe.com resolves to a DNS record on your test box.
>
>
>
> Yours,
>
>
>
> Chris
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 07 June 2016 16:30
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Project Clearwater] Clearwater live test on manuall install
> fails
>
>
>
> Hi,
>
>
>
> I have a clearwater manual install of clearwater and a VM with clearwater
> live test requirements when I run the command
>
>                      rake test[cwhpe.com] SIGNUP_CODE=secret
>
> the test seems to fails. But when I make calls through zioper client the
> calls go through fine.
> The log file is attached to the mail.
>
>
>
> Please suggest.
>
>
>
> Thanks and regards,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160719/4b4e52ee/attachment.html>

From chris at projectclearwater.org  Tue Jul 19 09:25:47 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 19 Jul 2016 13:25:47 +0000
Subject: [Project Clearwater] clearwater/ralf docker image is failing
 with too many open files in system and corrupted double-linked list error
In-Reply-To: <1485531634.4179644.1468604588679.JavaMail.yahoo@mail.yahoo.com>
References: <1485531634.4179644.1468604588679.JavaMail.yahoo.ref@mail.yahoo.com>
	<1485531634.4179644.1468604588679.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CY1PR02MB118197B44F33262EA0260AF0E1370@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Vijay,

Thank you for getting in touch.

The logs that you have sent look like ralf is trying to create sockets, but hitting some sort of system-defined limit. You may be hitting this now (and not before) if you are running more containers on the same container host, or possibly if ralf is now opening more sockets than before.

You can check the limits on numbers of open files allowed per user on your host using the command `ulimit -n`, for example on my Sprout node:

$ ulimit -n
1024

You can find out how many files are currently open on your host for a user by running (with root permissions) `lsof -u <username> | tail -n +1 | wc -l`.

For example:

$ lsof -u ubuntu | tail -n +1 | wc -l
69
$ lsof -u ralf | tail -n +1 | wc -l
5

You can run these commands inside your containers to find out which ones are using your files.

You may need to increase the per-user limit if you are using lots of containers on the same host. I suggest reading these Ubuntu forum trails before doing so:

?         http://askubuntu.com/questions/181215/too-many-open-files-how-to-find-the-culprit

?         http://askubuntu.com/questions/162229/how-do-i-increase-the-open-files-limit-for-a-non-root-user

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Vijay
Sent: 15 July 2016 18:43
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] clearwater/ralf docker image is failing with too many open files in system and corrupted double-linked list error

Hello,
I downloaded clearwater/ralf docker image about 8 days ago and when i launch it, ralf keeps exiting and tries to restart. In the logs inside the container, I see this error:
Advanced stack dump (requires gdb):
[warn] epoll_create: Too many open files in system
[err] evsig_init: socketpair: Too many open files in system
[warn] epoll_create: Too many open files in system
[err] evsig_init: socketpair: Too many open files in system
[warn] epoll_create: Too many open files in system
[err] evsig_init: socketpair: Too many open files in system
[warn] epoll_create: Too many open files in system
[err] evsig_init: socketpair: Too many open files in system
*** Error in `/usr/share/clearwater/bin/ralf': corrupted double-linked list: 0x0000000001c3cbf0 ***

I am running on a machine that has very compute resources..
Clearwater/ralf image that I downloaded sometime in May did not have any problems.


Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160719/51f0d1f0/attachment.html>

From chris at projectclearwater.org  Tue Jul 19 09:28:48 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 19 Jul 2016 13:28:48 +0000
Subject: [Project Clearwater] Ellis Mysql connection error
In-Reply-To: <A7120662-5931-4ADB-BDC3-AE02F237B720@roecastle.com>
References: <76698E5C-7801-48DB-92C1-87E900349F68@roecastle.com>
	<A7120662-5931-4ADB-BDC3-AE02F237B720@roecastle.com>
Message-ID: <CY1PR02MB118164125116BD818532C59EE1370@CY1PR02MB1181.namprd02.prod.outlook.com>

Thanks for sharing.

We have not been testing Project Clearwater on Ubuntu 16.04, so I'm pleased to hear that you are making progress. Please let us know about issues you hit - it would be great to add full support for 16.04, and any help we can get is appreciated.

Yours,

Chris

-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Andrew Okri
Sent: 18 July 2016 12:20
To: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] Ellis Mysql connection error

I found the fix for this problem and l like to share for anyone facing this problem. If you are confronted with this problem, chances are you are installing ellis on Ubuntu 16.04 which has a newer python libraries for mysql.  To fit the problem try the following:-

(1) sudo apt-get install libmysqlclient-dev python-mysqldb  and restart mysql and ellis

(2) if the above do not fix it for you, then download the file libmysqlclient.so.18 from the ubuntu launchpad and install it with apt

Before you try the above, ensure that you ellis install config are back to the state it was after you originally installed it. When you have it working, then you can tweak to your hearts content. good tweaking y?all.

Regards
Andrew

> On 17 Jul 2016, at 22:18, Andrew Okri <andrew.okri at roecastle.com> wrote:
> 
> Hello there,
> 	After running the create_numbers.py script using the python in the 
> ellis home directory, l got the following error. I am not sure what to make of it. Hence l am hoping l could get some help for the forum:- Traceback (most recent call last):
>  File "./create_numbers.py", line 101, in <module>
>    standalone(options.start, options.num, options.pstn, options.realm)  
> File "./create_numbers.py", line 50, in standalone
>    connection.init_connection()
>  File "/usr/share/clearwater/ellis/env/lib/python2.7/site-packages/ellis-0.1-py2.7.egg/metaswitch/ellis/data/connection.py", line 60, in init_connection
>    pool_recycle=3600)
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/__init__.py", line 386, in create_engine
>    return strategy.create(*args, **kwargs)  File 
> "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/engine/strategies.py", line 75, in create
>    dbapi = dialect_cls.dbapi(**dbapi_args)  File 
> "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/SQLAlchemy-1.0.9-py2.7-linux-x86_64.egg/sqlalchemy/dialects/mysql/mysqldb.py", line 92, in dbapi
>    return __import__('MySQLdb')
>  File "/usr/share/clearwater/ellis/env/local/lib/python2.7/site-packages/MySQL_python-1.2.5-py2.7-linux-x86_64.egg/MySQLdb/__init__.py", line 19, in <module>
>    import _mysql
> ImportError: libmysqlclient.so.18: cannot open shared object file: No 
> such file or directory Regards Andrew
> 
> 
> 
> 
> _______________________________________________
> Clearwater mailing list
> Clearwater at lists.projectclearwater.org
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.p
> rojectclearwater.org


_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org

From chris at projectclearwater.org  Wed Jul 20 05:12:10 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 20 Jul 2016 09:12:10 +0000
Subject: [Project Clearwater] Sprout to Homestead communication
In-Reply-To: <CAGEe17bWGSc=fg6RQ+5L-EntHCGvSyR-9NqQTGajjfi26JRVAg@mail.gmail.com>
References: <CAGEe17amE4kA4zPtgTWDt_bA3FPOZ2O_fCpUDbx2EjH=kpkDhQ@mail.gmail.com>
	<CY1PR02MB1181E6DB01816824EBE40B5EE1360@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CAGEe17bWGSc=fg6RQ+5L-EntHCGvSyR-9NqQTGajjfi26JRVAg@mail.gmail.com>
Message-ID: <CY1PR02MB11814D00F888F06E6155C68AE1080@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Kosala,

I?ve drawn a quick diagram:

[cid:image001.jpg at 01D1E26F.2D301C70]


When you provision a subscriber, Ellis uses the Homestead Prov API to ask the Homestead Prov process to put the subscriber?s details into the homestead_provisioning database. When Sprout needs to get a subscriber?s details, it sends a request to Homestead over the Homestead API. Homestead then uses the data in the homestead_cache and homestead_provisioning keyspaces (or from the HSS if you were using one) to respond to Sprout.

So Sprout never directly reads data from Cassandra: it always uses the Homestead API to get subscriber details. Does that help?

These are quite detailed technical questions ? it sounds like you are trying to do something different and new with Project Clearwater. I?m happy to help if you want to discuss your plans.

Yours,

Chris


From: Kosala [mailto:kosalayb at gmail.com]
Sent: 19 July 2016 09:41
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Subject: Re: [Project Clearwater] Sprout to Homestead communication

Hi Chris,

To keep things clear, I am writing again.

I am not using HSS. I am using Ellis to create accounts of private and public IDs.

I saw that crest/homestead-prov is used by Ellis. When I create accounts in Ellis which store data in homestead_provisioning keyspace {implicit_registration_sets,  private,  public and  service_profiles} and homestead_cache keyspace {impu and impi}
I have the following issues:
1. how sprout is reading homestead_cache ? (using crest/homestead-prov API or using homestead API ?)
2. Which components are reading data from homestead_provisioning keyspace?


Thanks
Kosala


On Mon, Jul 18, 2016 at 12:01 PM, Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> wrote:
Hi Kosala,

That?s a good question.

Homestead exposes its own API, separate to the Homestead Provisioning API. It?s documented in the Homestead codebase: https://github.com/Metaswitch/homestead/blob/dev/docs/homestead_api.md.

Homestead is able to run without Homestead Provisioning, in a deployment with an HSS. It acts as a gateway and cache, allowing Sprout to retrieve the data it needs from the HSS. In this sort of deployment, there is no need for Homestead Provisioning, so we need to expose an API that can be used without Homestead Provisioning. That?s why Homestead has its own API.

I hope that helps.

Yours.

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Kosala
Sent: 18 July 2016 11:29
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Sprout to Homestead communication

Hi Team,
How is sprout reading data from Cassandra database at Homestead ? Is this using homestead provisioning API ?
If not, could you please explain me the procedure?

Thanks in advance!
Kosala


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/4c5c089b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 14731 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/4c5c089b/attachment.jpg>

From gilles.lecorgne at orange.com  Wed Jul 20 06:10:08 2016
From: gilles.lecorgne at orange.com (gilles.lecorgne at orange.com)
Date: Wed, 20 Jul 2016 10:10:08 +0000
Subject: [Project Clearwater] Registration issue
Message-ID: <25779_1469009414_578F4E06_25779_415_1_6c42e01d-7b63-4cbd-9b8a-7b421b419dca@OPEXCLILM31.corporate.adroot.infra.ftgroup>

Hello,

We have a manual deployment of Clearwater nodes, among 1 bono node and 2 sprout nodes. We have a strange behavior when registering a SIP client (we tested with Zoiper and with X-lite). Indeed, it is weird that the SIP client re-transmits the REGISTER message several times even just after successful initial registration.

Please find here, 2 traces from bono node: 1 with 'normal' expected call flow (we got it only once), and 1 with REGISTER messages re-transmissions.

Do you think it is an issue on SIP client or on Clearwater nodes ?

We can provide you any additional information from our deployment (log, ...) if needed.

Thank you for your support,

Best regards,

Gilles Lecorgne

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/1b34f826/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bono_regOK.pcapng
Type: application/octet-stream
Size: 1554720 bytes
Desc: bono_regOK.pcapng
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/1b34f826/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bono_regNOK.pcapng
Type: application/octet-stream
Size: 1304564 bytes
Desc: bono_regNOK.pcapng
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/1b34f826/attachment-0001.obj>

From matt at projectclearwater.org  Wed Jul 20 07:18:24 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Wed, 20 Jul 2016 11:18:24 +0000
Subject: [Project Clearwater] Sprout to Homestead communication
In-Reply-To: <CY1PR02MB11814D00F888F06E6155C68AE1080@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <CAGEe17amE4kA4zPtgTWDt_bA3FPOZ2O_fCpUDbx2EjH=kpkDhQ@mail.gmail.com>
	<CY1PR02MB1181E6DB01816824EBE40B5EE1360@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CAGEe17bWGSc=fg6RQ+5L-EntHCGvSyR-9NqQTGajjfi26JRVAg@mail.gmail.com>
	<CY1PR02MB11814D00F888F06E6155C68AE1080@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <CY1PR0201MB1563576E184FEBEF187E093990080@CY1PR0201MB1563.namprd02.prod.outlook.com>

Kosala,

Just to elaborate/clarify on one of the points below,

?         as Chris says, the Sprout process always accesses data via the Homestead API from the Homestead process - the Sprout process never accesses Cassandra directly

?         the Homestead process actually only reads from the homestead_cache database in Cassandra - the Homestead process never reads from the homestead_provisioning database (contrary to what was suggested below)

?         the Homestead Prov process writes to both homestead_cache and homestead_provisioning.

The split between the homestead_cache and homestead_provisioning databases is that the homestead_provisioning database stores provisioned data in a normalized form - this is very convenient for modification/exposure over the Homestead Prov API, but isn't particularly fast for reads/writes.  Conversely, the homestead_cache database stores data in a denormalized form - this is much faster to access (which is obviously important, as Sprout is on the call path) but less easy to perform provisioning operations against.

I hope that makes sense - please ask if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Chris Elford (projectclearwater.org)
Sent: 20 July 2016 10:12
To: Kosala <kosalayb at gmail.com>; Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] Sprout to Homestead communication

Hi Kosala,

I?ve drawn a quick diagram:

[cid:image001.jpg at 01D1E27E.FF420B10]


When you provision a subscriber, Ellis uses the Homestead Prov API to ask the Homestead Prov process to put the subscriber?s details into the homestead_provisioning database. When Sprout needs to get a subscriber?s details, it sends a request to Homestead over the Homestead API. Homestead then uses the data in the homestead_cache and homestead_provisioning keyspaces (or from the HSS if you were using one) to respond to Sprout.

So Sprout never directly reads data from Cassandra: it always uses the Homestead API to get subscriber details. Does that help?

These are quite detailed technical questions ? it sounds like you are trying to do something different and new with Project Clearwater. I?m happy to help if you want to discuss your plans.

Yours,

Chris


From: Kosala [mailto:kosalayb at gmail.com]
Sent: 19 July 2016 09:41
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Subject: Re: [Project Clearwater] Sprout to Homestead communication

Hi Chris,

To keep things clear, I am writing again.

I am not using HSS. I am using Ellis to create accounts of private and public IDs.

I saw that crest/homestead-prov is used by Ellis. When I create accounts in Ellis which store data in homestead_provisioning keyspace {implicit_registration_sets,  private,  public and  service_profiles} and homestead_cache keyspace {impu and impi}
I have the following issues:
1. how sprout is reading homestead_cache ? (using crest/homestead-prov API or using homestead API ?)
2. Which components are reading data from homestead_provisioning keyspace?


Thanks
Kosala


On Mon, Jul 18, 2016 at 12:01 PM, Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> wrote:
Hi Kosala,

That?s a good question.

Homestead exposes its own API, separate to the Homestead Provisioning API. It?s documented in the Homestead codebase: https://github.com/Metaswitch/homestead/blob/dev/docs/homestead_api.md.

Homestead is able to run without Homestead Provisioning, in a deployment with an HSS. It acts as a gateway and cache, allowing Sprout to retrieve the data it needs from the HSS. In this sort of deployment, there is no need for Homestead Provisioning, so we need to expose an API that can be used without Homestead Provisioning. That?s why Homestead has its own API.

I hope that helps.

Yours.

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Kosala
Sent: 18 July 2016 11:29
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Sprout to Homestead communication

Hi Team,
How is sprout reading data from Cassandra database at Homestead ? Is this using homestead provisioning API ?
If not, could you please explain me the procedure?

Thanks in advance!
Kosala


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/011aaa0c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 14731 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/011aaa0c/attachment.jpg>

From matt at projectclearwater.org  Wed Jul 20 07:26:24 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Wed, 20 Jul 2016 11:26:24 +0000
Subject: [Project Clearwater] Clearwater live test on manuall
	install	fails
In-Reply-To: <CAJAf6Ny4rDSVSSFKQHR7ZuhFa6ZhNvVGneDfD1R=0NvH+07UPA@mail.gmail.com>
References: <CAJAf6NzshKb00RsphfenyzK7+Kej9m83DqrrfdkQukWJ90QwJg@mail.gmail.com>
	<BLUPR0201MB1843A9F29C2A9D91680AF275E15D0@BLUPR0201MB1843.namprd02.prod.outlook.com>
	<CAJAf6Nz_pFULjadEx6pSC8CDYLgyAt50qE_U=MnWUogNN2ev8A@mail.gmail.com>
	<CAJAf6Nw0F625ddEsnM4=6nVrLed4xueCs0Cb+u9WUb3y66vAiw@mail.gmail.com>
	<SN1PR0201MB18561F58831C23571EAE3311E15E0@SN1PR0201MB1856.namprd02.prod.outlook.com>
	<CAJAf6Nwcj_gz3vxasFeJKqR9brPMT4D0yjc+XvCffb689Ha2KQ@mail.gmail.com>
	<CAJAf6Nw7n3+0h8wGy_VsMKdKQt2nRikgNF8Y2nc2YLbi-0goNw@mail.gmail.com>
	<SN1PR0201MB18568DC3A04764C3D616EA13E1530@SN1PR0201MB1856.namprd02.prod.outlook.com>
	<CY1PR02MB1181E653D76C635F4D132E45E12A0@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CAJAf6Ny4rDSVSSFKQHR7ZuhFa6ZhNvVGneDfD1R=0NvH+07UPA@mail.gmail.com>
Message-ID: <CY1PR0201MB1563648F764A8A01233AF72D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

Chris is a bit busy, so he asked me to pick this one up.

The instructions for running the live tests are at http://clearwater.readthedocs.io/en/latest/Running_the_live_tests.html - does that give you what you need?  The live tests actually use a Ruby SIP client called Quaff (https://github.com/rkday/quaff) - sipp is a bit fiddly to script complex scenarios involving multiple UAs.

BTW, can you share what the resolution was for your previous issue?  Was is that you were running 32-bit vs 64-bit or was it something else?  (It's useful so that we know for next time someone has these symptoms.)

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Shiva Charan
Sent: 19 July 2016 07:27
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] Clearwater live test on manuall install fails

Hi Chris,

Thank you for your suggestions. The Basic calls are working.
Could you provide me information on how to run the live calls with the live test? Also, the live calls use SIPp client?

Thanks and regards,
Shiva

On Mon, Jun 20, 2016 at 1:38 PM, Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> wrote:
Hi Shiva,

One of my colleagues saw your email, and suggested that I check that you are running on a 64 bit system.  A few people have hit issues trying to install Project Clearwater components on 32 bit systems, but we only build 64 bit packages.

I hope you have managed to sort out your issue and get the packages installed.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Chris Elford (projectclearwater.org<http://projectclearwater.org>)
Sent: 13 June 2016 16:10
To: Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>>

Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] Clearwater live test on manuall install fails

Hi Shiva,

We may be able to help. Can you please send me the output from when you run the install command? It would also be great to take a look at the contents of /var/log/apt/history.log and /var/log/apt/term.log straight afterwards, and the contents of /etc/apt/sources.list.d/clearwater.list.

Yours,

Chris

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 10 June 2016 14:16
To: Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] Clearwater live test on manuall install fails

Hi,

I am trying to do a fresh install of clearwater manual install and seems the packages are not being found.
I have entered the source list file for clearwater. Is there any reason that I am not able to locate any packages?

Thanks,
Shiva

On Wed, Jun 8, 2016 at 2:50 PM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Chris,

How do I just make use of only TCP calls? As I would like to present positive results for clearwater live tests.
What would be the rake command to do the same?

And also I have signed up to the mailing list.

Thanks,
Shiva

On Wed, Jun 8, 2016 at 2:06 PM, Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> wrote:
Hi Shiva,

I?m glad you got this working.

We are aware that our UDP live tests are not very reliable. We have several issues open to cover this, and I would like to get them fixed:

?         https://github.com/Metaswitch/clearwater-live-test/issues/94

?         https://github.com/Metaswitch/clearwater-live-test/issues/117

?         https://github.com/Metaswitch/clearwater-live-test/issues/108

Most of this is to do with our test framework, and we believe that UDP calls should work. However, we do most of our testing using TCP, so that is likely to be more reliable.

Can I suggest that you sign up<http://www.projectclearwater.org/community/> to the mailing list? That way your posts will not have to wait for administrator approval, and you will be able to see posts from other users, which may help you with problems that you hit.

Yours,

Chris

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 08 June 2016 07:38
To: Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] Clearwater live test on manuall install fails

Hi,

When I give the rake command with proxy option the call goes through.
But seems TCP options are passing and UDP are failing.
Please suggest.

clearwater at cwlive:~/clearwater-live-test$ rake test[cwhpe.com<http://cwhpe.com>] SIGNUP_CODE=secret PROXY=bono.cwhpe.com<http://bono.cwhpe.com> ELLIS=ellis.cwhpe.com<http://ellis.cwhpe.com> TESTS="Basic Call - Mainline"
Basic Call - Mainline (TCP) - (6505550001, 6505550004) Passed
Basic Call - Mainline (UDP) - (6505550000, 6505550007) Failed
Endpoint threw exception:
 - sip:6505550000 at bono.cwhpe.com<mailto:sip%3A6505550000 at bono.cwhpe.com> timed out waiting for 200
   - /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:205:in `rescue in recv_response'
   - /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:202:in `recv_response'
   - /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:225:in `recv_response_and_create_dialog'
   - /home/clearwater/clearwater-live-test/lib/tests/basic-call.rb:63:in `block (2 levels) in <top (required)>'
Endpoint threw exception:
 - sip:6505550007 at bono.cwhpe.com<mailto:sip%3A6505550007 at bono.cwhpe.com> timed out waiting for ACK
   - /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:108:in `rescue in recv_request'
   - /home/clearwater/.rvm/gems/ruby-1.9.3-p551/gems/quaff-0.7.3/lib/call.rb:105:in `recv_request'
   - /home/clearwater/clearwater-live-test/lib/tests/basic-call.rb:84:in `block (2 levels) in <top (required)>'


Thanks,
Shiva


On Tue, Jun 7, 2016 at 11:51 PM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Chris,

The  clearwater VM's are reachable from my test node also tenet is going through.

root at cwlive:~# ping bono.cwhpe.com<http://bono.cwhpe.com>
PING bono.cwhpe.com<http://bono.cwhpe.com> (10.10.0.3) 56(84) bytes of data.
64 bytes from 10.10.0.3<http://10.10.0.3>: icmp_seq=1 ttl=63 time=1.57 ms
64 bytes from 10.10.0.3<http://10.10.0.3>: icmp_seq=2 ttl=63 time=0.725 ms
^C
--- bono.cwhpe.com<http://bono.cwhpe.com> ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.725/1.149/1.574/0.425 ms

clearwater at cwlive:~$ telnet bono.cwhpe.com<http://bono.cwhpe.com> 22
Trying 10.10.0.3...
Connected to bono.cwhpe.com<http://bono.cwhpe.com>.
Escape character is '^]'.
SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.7
^]
telnet>


Am I running the rake command correctly?


Thanks,
Shiva





On Tue, Jun 7, 2016 at 10:21 PM, Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> wrote:
Hi Shiva,

I have taken a look at your logs, and I do not see any requests arriving at Bono targeted at cwhpe.com<http://cwhpe.com>. The first thing I would check is whether cwhpe.com<http://cwhpe.com> resolves to a DNS record on your test box.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 07 June 2016 16:30
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Clearwater live test on manuall install fails

Hi,

I have a clearwater manual install of clearwater and a VM with clearwater live test requirements when I run the command
                     rake test[cwhpe.com<http://cwhpe.com>] SIGNUP_CODE=secret
the test seems to fails. But when I make calls through zioper client the calls go through fine.
The log file is attached to the mail.

Please suggest.

Thanks and regards,
Shiva






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/3526c428/attachment.html>

From matt at projectclearwater.org  Wed Jul 20 09:14:58 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Wed, 20 Jul 2016 13:14:58 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
Message-ID: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/a9cb45c8/attachment.html>

From matt at projectclearwater.org  Wed Jul 20 15:44:10 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Wed, 20 Jul 2016 19:44:10 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
Message-ID: <CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160720/1a91ada0/attachment.html>

From matt at projectclearwater.org  Thu Jul 21 05:48:23 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Thu, 21 Jul 2016 09:48:23 +0000
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing
	on	clearwater docker deploy
In-Reply-To: <A4E02011-E2D0-4AEF-9E41-FA60EE0F0100@unina.it>
References: <CY1PR02MB11815549C0465C89FD021794E1320@CY1PR02MB1181.namprd02.prod.outlook.com>
	<18d24336-36ba-408a-8477-809ac5ca7f8f@email.android.com>
	<CY1PR02MB1181297206A70AD33CCB8553E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
	<CY1PR02MB11814E5866B81F3616B074F1E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
	<A4E02011-E2D0-4AEF-9E41-FA60EE0F0100@unina.it>
Message-ID: <CY1PR0201MB15637F5A6BFD08612C98D54F90090@CY1PR0201MB1563.namprd02.prod.outlook.com>

Luigi,

Chris is a bit busy at the moment, so I've picked this up.  (BTW, it's worth copying in the clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> email address so that others can see your emails.)

Please can you give a bit more context in the logs - I'm not sure if there are important logs before or after the section you've extracted?  (In particular, we trace messages both when we send and when we receive them - I think the first message is from receiving, but I can't tell for sure.)  It would also be really useful to gather the corresponding logs from Sprout.

Thanks,

Matt


From: Luigi De Simone [mailto:luigi.desimone at unina.it]
Sent: 18 July 2016 17:57
To: Chris Elford <Chris.Elford at metaswitch.com>
Subject: Re: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy

Hi Chris, unfortunately the problem still persists, also if I set the host node with 1vCPU, and force to use one worker thread
(by setting /etc/clearwater/user_settings with num_worker_threads=1) by bono service.
Below is the bono log in debug mode, specifically for a message that experience timeout:

....
--start msg--

ACK sip:2010000089 at 192.168.1.107:18906;transport=TCP;ob SIP/2.0^M
Via: SIP/2.0/TCP 192.168.1.107:18906;rport;branch=z9hG4bK-2010000088-6-1.000000-1^M
Route:  <sip:WMg69oZtBz at 192.168.2.121:5060;transport=TCP;lr>, <sip:192.168.2.121:5058;transport=TCP;lr>, <sip:scscf.sprout:5054;transport=tcp;lr;service=scscf;billing-r
ole=charge-orig>, <sip:scscf.sprout:5054;transport=tcp;lr;service=scscf;billing-role=charge-term>, <sip:192.168.2.121:5058;transport=TCP;lr>,<sip:WMg69oZtBz at 192.168.2.1
21:5060;transport=TCP;lr>^M
Max-Forwards: 70^M
From: sip:2010000088 at example.com;tag=1931SIPpTag0061234^M<sip:2010000088 at example.com;tag=1931SIPpTag0061234%5eM>
To: sip:2010000089 at example.com;tag=1931SIPpTag0064321^M<sip:2010000089 at example.com;tag=1931SIPpTag0064321%5eM>
Call-ID: 2010000088-1.000000///6-1931 at 192.168.1.107<mailto:2010000088-1.000000///6-1931 at 192.168.1.107>^M
CSeq: 7 ACK^M
Content-Length: 0^M
^M

--end msg--
18-07-2016 16:49:28.548 UTC Debug pjutils.cpp:1660: Logging SAS Call-ID marker, Call-ID 2010000088-1.000000///6-1931 at 192.168.1.107<mailto:2010000088-1.000000///6-1931 at 192.168.1.107>
18-07-2016 16:49:28.548 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7fa14c12e748 for worker threads
18-07-2016 16:49:28.548 UTC Debug pjsip: tsx0x7fa1500ad Timeout timer event
18-07-2016 16:49:28.548 UTC Debug pjsip: tsx0x7fa1500ad State changed from Terminated to Destroyed, event=TIMER
18-07-2016 16:49:28.548 UTC Debug bono.cpp:382: tsx0x7fa1500ad6e8 - tu_on_tsx_state UAS, TSX_STATE TIMER state=Destroyed
18-07-2016 16:49:28.548 UTC Debug bono.cpp:2260: tsx0x7fa1500ad6e8 - UAS tsx destroyed
18-07-2016 16:49:28.548 UTC Debug bono.cpp:2575: tsx0x7fa1500ad6e8 - Cancel 0 pending UAC transactions
18-07-2016 16:49:28.548 UTC Debug bono.cpp:2584: tsx0x7fa1500ad6e8 - Check target 0, UAC data = (nil), UAC tsx = (nil)
18-07-2016 16:49:28.548 UTC Debug bono.cpp:1815: UASTransaction destructor (0x7fa150002fc0)
18-07-2016 16:49:28.548 UTC Debug bono.cpp:1835: Disconnect UAC transactions from UAS transaction
18-07-2016 16:49:28.548 UTC Debug bono.cpp:1881: Upstream ACR = 0x7fa1500091b0, Downstream ACR = 0x7fa1500091b0
18-07-2016 16:49:28.548 UTC Verbose acr.cpp:643: Sending P-CSCF Ralf ACR (0x7fa1500091b0)
18-07-2016 16:49:28.548 UTC Debug acr.cpp:673: Building message
18-07-2016 16:49:28.548 UTC Debug acr.cpp:690: Adding peers meta-data, 1 ccfs, 0 ecfs
18-07-2016 16:49:28.548 UTC Debug acr.cpp:729: Building event
18-07-2016 16:49:28.548 UTC Debug acr.cpp:734: Adding Account-Record-Type AVP 2
18-07-2016 16:49:28.549 UTC Debug acr.cpp:754: Adding Service-Information AVP group
18-07-2016 16:49:28.549 UTC Debug acr.cpp:764: Adding 0 Subscription-Id AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:790: Adding IMS-Information AVP group
18-07-2016 16:49:28.549 UTC Debug acr.cpp:795: Adding Event-Type AVP group
18-07-2016 16:49:28.549 UTC Debug acr.cpp:824: Adding 0 Calling-Party-Address AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:844: Adding Called-Party-Address AVP
18-07-2016 16:49:28.549 UTC Debug acr.cpp:865: Adding 0 Called-Asserted-Identity AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:886: Adding 0 Associated-URI AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:905: Adding Time-Stamps AVP group
18-07-2016 16:49:28.549 UTC Debug acr.cpp:995: Adding 0 Transit-IOI-List AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1071: Adding 0 Early-Media-Description AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1094: Adding Media AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1297: Adding SDP-Session-Description AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1323: Adding media AVPs for offer
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1330: Adding media AVPs for answer
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1099: Adding 0 Message-Body AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1189: Adding 0 Reason-Header AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1207: Adding 0 Access-Network-Information AVPs
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1225: Adding From-Address AVP
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1240: Adding Route-Header-Received AVP
18-07-2016 16:49:28.549 UTC Debug acr.cpp:1247: Adding Route-Header-Transmitted AVP
18-07-2016 16:49:28.549 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7fa14c12e748
18-07-2016 16:49:28.549 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg ACK/cseq=7 (rdata0x7fa14c12e748)
18-07-2016 16:49:28.549 UTC Debug uri_classifier.cpp:169: home domain: false, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_n
umber_as_phone: false
18-07-2016 16:49:28.549 UTC Debug uri_classifier.cpp:199: Classified URI as 5
18-07-2016 16:49:28.549 UTC Debug pjsip: tsx0x7fa1500ad Incoming Request msg ACK/cseq=7 (rdata0x7fa14c12e748) in state Destroyed
18-07-2016 16:49:28.549 UTC Debug httpresolver.cpp:71: HttpResolver::resolve for host ralf, port 10888, family 2
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:514: Attempt to parse ralf as IP address
18-07-2016 16:49:28.549 UTC Verbose dnscachedresolver.cpp:245: Check cache for ralf type 1
18-07-2016 16:49:28.549 UTC Debug dnscachedresolver.cpp:347: Pulling 1 records from cache for ralf A
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:362: Found 1 A/AAAA records, randomizing
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:504: 192.168.2.114:10888 transport 6 is not blacklisted
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:383: Added a server, now have 1 of 5
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:421: Adding 0 servers from blacklist
18-07-2016 16:49:28.549 UTC Debug baseresolver.cpp:514: Attempt to parse 192.168.2.114 as IP address
18-07-2016 16:49:28.549 UTC Debug httpconnection.cpp:623: Sending HTTP request : http://ralf:10888/call-id/2010000088-1.000000%2F%2F%2F6-1931%40192.168.1.107 (trying 19
2.168.2.114)
18-07-2016 16:49:28.549 UTC Debug httpconnection.cpp:915: Received header http/1.1200ok with value
18-07-2016 16:49:28.549 UTC Debug httpconnection.cpp:915: Received header content-length with value 0
18-07-2016 16:49:28.549 UTC Debug httpconnection.cpp:915: Received header  with value
18-07-2016 16:49:28.549 UTC Debug httpconnection.cpp:638: Received HTTP response: status=200, doc=
18-07-2016 16:49:28.549 UTC Debug acr.cpp:54: Destroyed ACR (0x7fa1500091b0)
18-07-2016 16:49:28.549 UTC Debug bono.cpp:1906: Free original request (0x7fa1500ac248)
18-07-2016 16:49:28.549 UTC Debug pjsip: tdta0x7fa1500a Destroying txdata Request msg INVITE/cseq=7 (tdta0x7fa1500ac1a0)
18-07-2016 16:49:28.549 UTC Debug bono.cpp:1922: UASTransaction destructor completed
18-07-2016 16:49:28.549 UTC Debug pjsip: tdta0x7fa1500c Destroying txdata Response msg 200/INVITE/cseq=7 (tdta0x7fa1500c8810)
18-07-2016 16:49:28.549 UTC Debug pjsip: tsx0x7fa1500a0 Timeout timer event
18-07-2016 16:49:28.549 UTC Debug pjsip: tsx0x7fa1500a0 State changed from Terminated to Destroyed, event=TIMER
18-07-2016 16:49:28.549 UTC Debug bono.cpp:382: tsx0x7fa1500a0da8 - tu_on_tsx_state UAC, TSX_STATE TIMER state=Destroyed
18-07-2016 16:49:28.549 UTC Debug bono.cpp:2946: tsx0x7fa1500a0da8 - uac_data = 0x7fa150058860, uas_data = (nil)
18-07-2016 16:49:28.549 UTC Debug bono.cpp:3033: tsx0x7fa1500a0da8 - UAC tsx destroyed
18-07-2016 16:49:28.549 UTC Debug pjsip: tdta0x7fa15000 Destroying txdata Request msg INVITE/cseq=7 (tdta0x7fa150005d20)
18-07-2016 16:49:28.549 UTC Debug pjsip: tsx0x7fa1500ad Transaction destroyed!
18-07-2016 16:49:28.549 UTC Debug pjsip: tsx0x7fa1500a0 Transaction destroyed!
18-07-2016 16:49:28.549 UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()
18-07-2016 16:49:28.549 UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()
18-07-2016 16:49:28.549 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7fa14c12e748
18-07-2016 16:49:28.549 UTC Debug thread_dispatcher.cpp:199: Request latency = 730us
18-07-2016 16:49:30.003 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg INVITE/cseq=7 (rdata0x7fa14c0d77c0)
18-07-2016 16:49:30.003 UTC Verbose common_sip_processing.cpp:120: RX 1799 bytes Request msg INVITE/cseq=7 (rdata0x7fa14c0d77c0) from TCP 192.168.1.107:18897:

.....

sipp.out:

------------------------------ Scenario Screen -------- [1-9]: Change Screen --
     Users (length)   Port   Total-time  Total-calls  Remote-host
          50 (0 ms)   5060     264.83 s           50  192.168.2.121:5060(TCP)

  Call limit reached (-m 50), 0.373 s period  1 ms scheduler resolution
  0 calls (limit 50)                     Peak was 50 calls, after 0 s
  0 Running, 10 Paused, 2 Woken up
  0 dead call msg (discarded)            0 out-of-call msg (discarded)
  1 open sockets

                                 Messages  Retrans   Timeout   Unexpected-Msg
       Pause [ 0ms/2:30]         50                            0
    REGISTER ---------->         50        0
         401 <----------         50        0         0         0
    REGISTER ---------->         50        0
         200 <----------         50        0         0         0
    REGISTER ---------->         50        0
         401 <----------         50        0         0         0
    REGISTER ---------->         50        0
         200 <----------         50        0         0         0
       Pause [     1:00]         50                            0
    REGISTER ---------->  B-RTD1 50        0
         200 <----------  E-RTD1 50        0         0         0
    REGISTER ---------->  B-RTD1 50        0
         200 <----------  E-RTD1 50        0         0         0
       Pause [$pre_call_delay]   50                            0
      INVITE ---------->  B-RTD2 50        0
         100 <----------         50        0         0         0
      INVITE <----------         0         0         0         0
         100 <----------         0         0         0         0
      INVITE <----------         50        0         0         0
         100 ---------->         50        0
         180 ---------->         50        0
         180 <----------         50        0         0         0
       Pause [   2000ms]         50                            0
         200 ---------->         50        0
         200 <----------         50        0         0         0
         ACK ---------->         50        0
         ACK <----------         41        0         9         0
      UPDATE ---------->         41        0
      UPDATE <----------         41        0         0         0
         200 ---------->         41        0
         200 <----------  E-RTD2 41        0         0         0
       Pause [   6000ms]         41                            0
         BYE ---------->  B-RTD3 41        0
         BYE <----------         41        0         0         0
         200 ---------->         41        0
         200 <----------  E-RTD3 41        0         0         0
------------------------------ Test Terminated --------------------------------

call_load error messages:

sipp: The following events occured:
2016-07-18      18:48:03:968    1468860483.968101: Call-Id: 15-1931 at 192.168.1.107<mailto:15-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:48:22:723    1468860502.723670: Call-Id: 7-1931 at 192.168.1.107<mailto:7-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:48:38:690    1468860518.690775: Call-Id: 27-1931 at 192.168.1.107<mailto:27-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:48:54:571    1468860534.571992: Call-Id: 50-1931 at 192.168.1.107<mailto:50-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:49:12:397    1468860552.397434: Call-Id: 37-1931 at 192.168.1.107<mailto:37-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:49:20:446    1468860560.446247: Call-Id: 48-1931 at 192.168.1.107<mailto:48-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:49:26:442    1468860566.442759: Call-Id: 24-1931 at 192.168.1.107<mailto:24-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:49:52:635    1468860592.635282: Call-Id: 31-1931 at 192.168.1.107<mailto:31-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-18      18:49:55:495    1468860595.495591: Call-Id: 6-1931 at 192.168.1.107<mailto:6-1931 at 192.168.1.107>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

Il giorno 15 lug 2016, alle ore 12:41, Chris Elford <Chris.Elford at metaswitch.com<mailto:Chris.Elford at metaswitch.com>> ha scritto:

Thanks Luigi,

I?m glad to hear that fixed the problem.

I?ve raised a GitHub issue to cover the call failures that you were seeing:https://github.com/Metaswitch/sprout/issues/1488.

It would be great if you could try to hit this issue again with debug logs turned on, and send them over. That way, we may be able to use Bono reliably with multiple cores in the future.

Chris

From: Luigi De Simone [mailto:luigi.desimone at unina.it]
Sent: 14 July 2016 18:19
To: Chris Elford (projectclearwater.org<http://projectclearwater.org>) <chris at projectclearwater.org<mailto:chris at projectclearwater.org>>
Subject: RE: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy

Hi Chris, I would inform you that I've just found a solution in the morning by reducing cpus to 1 exactly :)
So, this is the bug!
Cheerio,
Luigi
Il 14 lug 2016 6:18 PM, "Chris Elford (projectclearwater.org<http://projectclearwater.org>)" <chris at projectclearwater.org<mailto:chris at projectclearwater.org>> ha scritto:
Hi Luigi,

Thank you for letting us know about this issue. It looks like you have hit a threading bug in Bono. The log message you picked out shows that one of Bono?s threads is attempting to release a lock that it does not currently own.

We have run stress recently, and didn?t see this problem, so I would like to find out what the difference is between your system and ours. That should help use to get a reproduction scenario and debug the problem.

The first thing to check is how many CPUs and how many worker threads you are using. You can find out how many CPUs there are on your server by running `grep processor /proc/cpuinfo | wc -l`. You can find out many worker threads you are using by looking in /etc/clearwater/user_settings. If there is a num_worker_threads option, that will set the number of threads. Otherwise, there will be one per core. If you have more than 1 CPU core on your Bono node, you may be able to reduce the risk of hitting this issue by moving to a node with only 1 core.

I would also like to take a look at some debug logs from your system. Can you please enable debug logging<http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#bono>(log level 5), and send over a log from when this happens?

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Luigi De Simone
Sent: 13 July 2016 11:06
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] [Clearwater Docker] SIPp stress testing on clearwater docker deploy

Hi all, after deploying clearwater with docker, I've just tried sipp stress test and there are some message timeouts. In particular from
/var/log/bono/bono_current.txt there are some sporadic messages like this:

UTC Error pjsip: Assert failed: ../src/pj/os_core_unix.c:1287 mutex->owner == pj_thread_this()

Other nodes do not exhibit problems.
The sipp error log is below:

sipp: The following events occured:
2016-07-13      09:57:35:333    1468403855.333438: Call-Id: 12-21655 at 192.168.1.250<mailto:12-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:57:52:946    1468403872.946879: Call-Id: 44-21655 at 192.168.1.250<mailto:44-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:19:863    1468403899.863728: Call-Id: 47-21655 at 192.168.1.250<mailto:47-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:58:20:820    1468403900.820186: Call-Id: 28-21655 at 192.168.1.250<mailto:28-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:02:504    1468403942.504959: Call-Id: 50-21655 at 192.168.1.250<mailto:50-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:06:724    1468403946.724817: Call-Id: 7-21655 at 192.168.1.250<mailto:7-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:466    1468403949.466635: Call-Id: 29-21655 at 192.168.1.250<mailto:29-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:09:921    1468403949.921984: Call-Id: 21-21655 at 192.168.1.250<mailto:21-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:26:948    1468403966.948038: Call-Id: 8-21655 at 192.168.1.250<mailto:8-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.
2016-07-13      09:59:55:369    1468403995.369205: Call-Id: 46-21655 at 192.168.1.250<mailto:46-21655 at 192.168.1.250>, receive timeout on message Call Load Test:31 without label to jump to (ontimeout attribute): aborting call.

and sipp.out is:

  Call limit reached (-m 50), 0.000 s period  0 ms scheduler resolution^M
  0 calls (limit 50)                     Peak was 50 calls, after 0 s^M
  0 Running, 15 Paused, 0 Woken up^M
  0 dead call msg (discarded)            0 out-of-call msg (discarded)        ^M
  1 open sockets                        ^M
^M
                                 Messages  Retrans   Timeout   Unexpected-Msg^M
       Pause [ 0ms/2:30]         50                            0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         401 <----------         50        0         0         0        ^M
    REGISTER ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
       Pause [     1:00]         50                            0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
    REGISTER ---------->  B-RTD1 50        0                            ^M
         200 <----------  E-RTD1 50        0         0         0        ^M
       Pause [$pre_call_delay]   50                            0        ^M
      INVITE ---------->  B-RTD2 50        0                            ^M
         100 <----------         50        0         0         0        ^M
      INVITE <----------         0         0         0         0        ^M
         100 <----------         0         0         0         0        ^M
      INVITE <----------         50        0         0         0        ^M
         100 ---------->         50        0                            ^M
         180 ---------->         50        0                            ^M
         180 <----------         50        0         0         0        ^M
       Pause [   2000ms]         50                            0        ^M
         200 ---------->         50        0                            ^M
         200 <----------         50        0         0         0        ^M
         ACK ---------->         50        0                            ^M
         ACK <----------         40        0         10        0        ^M
      UPDATE ---------->         40        0                            ^M
      UPDATE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD2 40        0         0         0        ^M
       Pause [   6000ms]         40                            0        ^M
         BYE ---------->  B-RTD3 40        0                            ^M
         BYE <----------         40        0         0         0        ^M
         200 ---------->         40        0                            ^M
         200 <----------  E-RTD3 40        0         0         0        ^M
------------------------------ Test Terminated --------------------------------^M

The messages with trigger timeouts are always in that point of the scenario.
What is the problem? Any help?

Luigi
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org<mailto:Clearwater at lists.projectclearwater.org>
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160721/0b8280d0/attachment.html>

From dolucky at yandex.ru  Thu Jul 21 05:08:50 2016
From: dolucky at yandex.ru (Kurguzov Victor)
Date: Thu, 21 Jul 2016 12:08:50 +0300
Subject: [Project Clearwater] Approximate number of calls that can be
	handled simultaneously
Message-ID: <447201469092130@web3g.yandex.ru>

Hello,

i would like to ask if there are any rough numbers about how many (audio & video separately) calls can be proceed at the same time with the minimal configuration of 6 VMs: 1cpu 2gb ram 5gb disk space? Maybe there is available information about how many resources consumes one video and one audio call? Does the connection between the number of calls and consuming resources is linear?

Thanks in advance

--?
Best regards,
Victor



From gilles.lecorgne at orange.com  Thu Jul 21 08:55:30 2016
From: gilles.lecorgne at orange.com (gilles.lecorgne at orange.com)
Date: Thu, 21 Jul 2016 12:55:30 +0000
Subject: [Project Clearwater] Registration issue
Message-ID: <24022_1469105734_5790C646_24022_12878_1_0f2f3b27-abf0-427f-8548-489a2c35d6f4@OPEXCLILM41.corporate.adroot.infra.ftgroup>

Dear,

We just find the root of the issue, it was due to some sprout nodes IP addresses, which are no more used, in relevant DNS zone. We remove thoses addresses and then now it works fine.

Sorry for the request.

Best regards,

Gilles Lecorgne

De : LECORGNE Gilles IMT/OLN
Envoy? : mercredi 20 juillet 2016 12:10
? : clearwater at lists.projectclearwater.org
Cc : GUENDOUZ Isabelle IMT/OLN
Objet : Registration issue

Hello,

We have a manual deployment of Clearwater nodes, among 1 bono node and 2 sprout nodes. We have a strange behavior when registering a SIP client (we tested with Zoiper and with X-lite). Indeed, it is weird that the SIP client re-transmits the REGISTER message several times even just after successful initial registration.

Please find here, 2 traces from bono node: 1 with 'normal' expected call flow (we got it only once), and 1 with REGISTER messages re-transmissions.

Do you think it is an issue on SIP client or on Clearwater nodes ?

We can provide you any additional information from our deployment (log, ...) if needed.

Thank you for your support,

Best regards,

Gilles Lecorgne

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160721/edd10f0f/attachment.html>

From matt at projectclearwater.org  Thu Jul 21 11:39:19 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Thu, 21 Jul 2016 15:39:19 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
	<CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
Message-ID: <CY1PR0201MB156312737D9048A209298AE590090@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

I haven't come across the term physical IP before, and I've seen virtual IP used for a number of different purposes, so just to be clear:

?         private IP addresses are only required to be able to route amongst themselves, not externally - for example, I might use IP addresses in the 192.168.0.0/24 range - obviously, these IP addresses are reused millions of times across the world

?         public IP addresses are required to be able to route externally (e.g. to/from the public Internet) - I must use IP addresses that have been globally allocated to me.

To elaborate slightly further, public IP addresses only need to be routable as far as you want them to be accessible.  For signaling, this probably means you need to have Internet-routable IP addresses.  However, for management, you probably only want your host to be accessible within your management network, so you might be able to use non-Internet (e.g. 10.0.0.0/8) IP addresses on these too.

This means that you only need Internet-routable public IP addresses for those services that are genuinely public, i.e. Bono (for SIP), Ellis (for web provisioning) and Homer (for call service management) - although you might want to block Homer too.  Does that make sense?

Note that if you're trying to deploy at the smallest possible scale, we have all-in-one images (http://clearwater.readthedocs.io/en/latest/All_in_one_Images.html) which contain all components on a single VM, and so only need a single IP address.  However, this is just intended for demonstration purposes - I wouldn't recommend you deploy this for any serious testing or deployment.

If you'd like further advice on this, please can you clarify on which virtualization platform/environment you're trying to deploy - it will be much easier to talk about this in concrete terms, rather than in the abstract!

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 21 July 2016 14:46
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for explaining the benefits and solutions.

I have some questions about solution.

In your instruction , the public IP means physical IP and the private IP means virtual IP , right?

If that is , It means I need 9 public IPs and 12 private IPs to build six components ?

I don't have so many physical IPs .

 Even  I deploy  Clearwater like this structure , when I want to insert new node into Clearwater , I still need a public IP and two private IPs(one for management network ,

the other for siganling network ) to deploy it?

All I want to is that using 2 or 3 physical IPs to deploy Clearwater  and let it could be reached by outside network , does it could happen ?

I am little confused with the solution , if I misunderstand anything , please give me some ideas .

Thank you very much for your time .

Morris

2016-07-21 3:44 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160721/65a76ec9/attachment.html>

From matt at projectclearwater.org  Thu Jul 21 12:12:30 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Thu, 21 Jul 2016 16:12:30 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eSGsN3LNhAZTBWwx3ZWPkm69uDMuuugms=anqhy=1rJ1Q@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
	<CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
	<CY1PR0201MB156312737D9048A209298AE590090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSGsN3LNhAZTBWwx3ZWPkm69uDMuuugms=anqhy=1rJ1Q@mail.gmail.com>
Message-ID: <CY1PR0201MB1563F2C82DE2BB408B367A0690090@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

Yes, that's all correct - good luck!

Matt


From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 21 July 2016 17:07
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for explaining clearly.

After reading the explanation ,

1. I can use virtual ips(192.168.0.0/24<http://192.168.0.0/24>) in management network for public IPs and private IPs , because the management network doesn't need to be reached

outside network.

2.In siganling network , I need the three IPs that can be reached by outside network for public IPs , and the private IPs can use the virtual IP.


Therefore , I only need 3 internet-routable IPs  , and several virtual IPs to deploy the Clearwater .  Do I misunderstand anything ?


I am sorry that I forget to tell you the environment.

Now , I am deploying on Vmware Workstation12

But in the future , I wish I could deploy Clearwater on Openstack.


Thank for your help sincerely.

Morris

2016-07-21 23:39 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

I haven't come across the term physical IP before, and I've seen virtual IP used for a number of different purposes, so just to be clear:

?         private IP addresses are only required to be able to route amongst themselves, not externally - for example, I might use IP addresses in the 192.168.0.0/24<http://192.168.0.0/24> range - obviously, these IP addresses are reused millions of times across the world

?         public IP addresses are required to be able to route externally (e.g. to/from the public Internet) - I must use IP addresses that have been globally allocated to me.

To elaborate slightly further, public IP addresses only need to be routable as far as you want them to be accessible.  For signaling, this probably means you need to have Internet-routable IP addresses.  However, for management, you probably only want your host to be accessible within your management network, so you might be able to use non-Internet (e.g. 10.0.0.0/8<http://10.0.0.0/8>) IP addresses on these too.

This means that you only need Internet-routable public IP addresses for those services that are genuinely public, i.e. Bono (for SIP), Ellis (for web provisioning) and Homer (for call service management) - although you might want to block Homer too.  Does that make sense?

Note that if you're trying to deploy at the smallest possible scale, we have all-in-one images (http://clearwater.readthedocs.io/en/latest/All_in_one_Images.html) which contain all components on a single VM, and so only need a single IP address.  However, this is just intended for demonstration purposes - I wouldn't recommend you deploy this for any serious testing or deployment.

If you'd like further advice on this, please can you clarify on which virtualization platform/environment you're trying to deploy - it will be much easier to talk about this in concrete terms, rather than in the abstract!

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 14:46

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for explaining the benefits and solutions.

I have some questions about solution.

In your instruction , the public IP means physical IP and the private IP means virtual IP , right?

If that is , It means I need 9 public IPs and 12 private IPs to build six components ?

I don't have so many physical IPs .

 Even  I deploy  Clearwater like this structure , when I want to insert new node into Clearwater , I still need a public IP and two private IPs(one for management network ,

the other for siganling network ) to deploy it?

All I want to is that using 2 or 3 physical IPs to deploy Clearwater  and let it could be reached by outside network , does it could happen ?

I am little confused with the solution , if I misunderstand anything , please give me some ideas .
Thank you very much for your time .

Morris

2016-07-21 3:44 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160721/475c90c4/attachment.html>

From matt at projectclearwater.org  Fri Jul 22 06:49:42 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Fri, 22 Jul 2016 10:49:42 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eT7oOuMY-ARFQkg6fAQp2Ub2Jp46vkHmEB43PBdiveMfQ@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
	<CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
	<CY1PR0201MB156312737D9048A209298AE590090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSGsN3LNhAZTBWwx3ZWPkm69uDMuuugms=anqhy=1rJ1Q@mail.gmail.com>
	<CY1PR0201MB1563F2C82DE2BB408B367A0690090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eT7oOuMY-ARFQkg6fAQp2Ub2Jp46vkHmEB43PBdiveMfQ@mail.gmail.com>
Message-ID: <CY1PR0201MB1563815BF919FDE2EAF88F8C900A0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

Yes, you should be able to do this without split management and signaling networks.  Bear in mind that you will need some way of reaching all nodes for management access (but this could be because your PC has a connection directly onto their network, or via a "jump box"), and all nodes will need access to the public Internet to download the Clearwater software (possibly via NAT).

I think the configuration you described should work - please can you describe more about what didn't work?

BTW, if you want to, you should be able to set the "public_ip" and "public_hostname" on Sprout, Homer and Ralf to match the private IP, rather than being public IPs (since you're never going to route to them from the public Internet).

Please let me know.

Thanks,

Matt

From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 22 July 2016 05:45
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for your solution first.

I have a further question.

If I don't separate Claerwater into two network(management and siganling)

Is it possible that I use 3 internet-routable  IPs (for Ellis , Bono , and Homer )and 6 virtual IP for each node as private IP , and let it be reached by outside network?

I had tried before , But it seems not working .

I guess whether I configure something incorrecty  , I changed the local_config in those 3 components like below:
192.168.44.144~192.168.44.149 are my IPs of 6 components of Clearwater.(order by Ellis , Bono , Sprout ,Homer, Homestead , Ralf )
local_ip=192.168.44.144
public_ip=<my internet_routable IP>
public_hostname=<my internet_routable IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"

If the concept is going to work , could you give me some tips about configuration (somewhere wrong or where need to configure)?

Thank you very much!

Morris

2016-07-22 0:12 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Yes, that's all correct - good luck!

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 17:07

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for explaining clearly.

After reading the explanation ,

1. I can use virtual ips(192.168.0.0/24<http://192.168.0.0/24>) in management network for public IPs and private IPs , because the management network doesn't need to be reached

outside network.

2.In siganling network , I need the three IPs that can be reached by outside network for public IPs , and the private IPs can use the virtual IP.


Therefore , I only need 3 internet-routable IPs  , and several virtual IPs to deploy the Clearwater .  Do I misunderstand anything ?


I am sorry that I forget to tell you the environment.

Now , I am deploying on Vmware Workstation12

But in the future , I wish I could deploy Clearwater on Openstack.


Thank for your help sincerely.

Morris

2016-07-21 23:39 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

I haven't come across the term physical IP before, and I've seen virtual IP used for a number of different purposes, so just to be clear:

?         private IP addresses are only required to be able to route amongst themselves, not externally - for example, I might use IP addresses in the 192.168.0.0/24<http://192.168.0.0/24> range - obviously, these IP addresses are reused millions of times across the world

?         public IP addresses are required to be able to route externally (e.g. to/from the public Internet) - I must use IP addresses that have been globally allocated to me.

To elaborate slightly further, public IP addresses only need to be routable as far as you want them to be accessible.  For signaling, this probably means you need to have Internet-routable IP addresses.  However, for management, you probably only want your host to be accessible within your management network, so you might be able to use non-Internet (e.g. 10.0.0.0/8<http://10.0.0.0/8>) IP addresses on these too.

This means that you only need Internet-routable public IP addresses for those services that are genuinely public, i.e. Bono (for SIP), Ellis (for web provisioning) and Homer (for call service management) - although you might want to block Homer too.  Does that make sense?

Note that if you're trying to deploy at the smallest possible scale, we have all-in-one images (http://clearwater.readthedocs.io/en/latest/All_in_one_Images.html) which contain all components on a single VM, and so only need a single IP address.  However, this is just intended for demonstration purposes - I wouldn't recommend you deploy this for any serious testing or deployment.

If you'd like further advice on this, please can you clarify on which virtualization platform/environment you're trying to deploy - it will be much easier to talk about this in concrete terms, rather than in the abstract!

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 14:46

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for explaining the benefits and solutions.

I have some questions about solution.

In your instruction , the public IP means physical IP and the private IP means virtual IP , right?

If that is , It means I need 9 public IPs and 12 private IPs to build six components ?

I don't have so many physical IPs .

 Even  I deploy  Clearwater like this structure , when I want to insert new node into Clearwater , I still need a public IP and two private IPs(one for management network ,

the other for siganling network ) to deploy it?

All I want to is that using 2 or 3 physical IPs to deploy Clearwater  and let it could be reached by outside network , does it could happen ?

I am little confused with the solution , if I misunderstand anything , please give me some ideas .
Thank you very much for your time .

Morris

2016-07-21 3:44 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160722/d7008ee7/attachment.html>

From chris at projectclearwater.org  Fri Jul 22 08:11:06 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Fri, 22 Jul 2016 12:11:06 +0000
Subject: [Project Clearwater] Registration issue
In-Reply-To: <24022_1469105734_5790C646_24022_12878_1_0f2f3b27-abf0-427f-8548-489a2c35d6f4@OPEXCLILM41.corporate.adroot.infra.ftgroup>
References: <24022_1469105734_5790C646_24022_12878_1_0f2f3b27-abf0-427f-8548-489a2c35d6f4@OPEXCLILM41.corporate.adroot.infra.ftgroup>
Message-ID: <BLUPR02MB1170E55E72D84F2AECAE2DD3E10A0@BLUPR02MB1170.namprd02.prod.outlook.com>

Thanks for getting in touch anyway - it's great to get knowledge like this online.

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of gilles.lecorgne at orange.com
Sent: 21 July 2016 13:56
To: clearwater at lists.projectclearwater.org
Cc: GUENDOUZ Isabelle IMT/OLN <isabelle.guendouz at orange.com>
Subject: Re: [Project Clearwater] Registration issue

Dear,

We just find the root of the issue, it was due to some sprout nodes IP addresses, which are no more used, in relevant DNS zone. We remove thoses addresses and then now it works fine.

Sorry for the request.

Best regards,

Gilles Lecorgne

De : LECORGNE Gilles IMT/OLN
Envoy? : mercredi 20 juillet 2016 12:10
? : clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Cc : GUENDOUZ Isabelle IMT/OLN
Objet : Registration issue

Hello,

We have a manual deployment of Clearwater nodes, among 1 bono node and 2 sprout nodes. We have a strange behavior when registering a SIP client (we tested with Zoiper and with X-lite). Indeed, it is weird that the SIP client re-transmits the REGISTER message several times even just after successful initial registration.

Please find here, 2 traces from bono node: 1 with 'normal' expected call flow (we got it only once), and 1 with REGISTER messages re-transmissions.

Do you think it is an issue on SIP client or on Clearwater nodes ?

We can provide you any additional information from our deployment (log, ...) if needed.

Thank you for your support,

Best regards,

Gilles Lecorgne

_________________________________________________________________________________________________________________________



Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc

pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler

a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,

Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.



This message and its attachments may contain confidential or privileged information that may be protected by law;

they should not be distributed, used or copied without authorisation.

If you have received this email in error, please notify the sender and delete this message and its attachments.

As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160722/991d4aa0/attachment.html>

From chris at projectclearwater.org  Fri Jul 22 12:04:49 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Fri, 22 Jul 2016 16:04:49 +0000
Subject: [Project Clearwater] Approximate number of calls that can
	be	handled simultaneously
In-Reply-To: <447201469092130@web3g.yandex.ru>
References: <447201469092130@web3g.yandex.ru>
Message-ID: <BLUPR02MB11704C68ED8490F0A3B817E9E10A0@BLUPR02MB1170.namprd02.prod.outlook.com>

Hi Victor,



We have done some testing using VMs slightly larger than yours:

?         2 vCPUs

?         4GB RAM

?         20GB storage.



We?ve found that, depending on your hardware and traffic profile, you can often get between 100k and 200k BHCA using a single Sprout node, and 200k-400k using Ralf and Homestead. Of course, your mileage may vary, so I?d recommend doing some pretty extensive performance testing before attempting to use this. We have some docs on stress testing available here: http://clearwater.readthedocs.io/en/stable/Clearwater_stress_testing.html.



We expect Clearwater?s performance to scale linearly as you add more nodes to the deployment (scaling horizontally). However, changing the size of individual VMs is likely to have quite non-linear effects.



Yours,



Chris





-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kurguzov Victor
Sent: 21 July 2016 10:09
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Approximate number of calls that can be handled simultaneously



Hello,



i would like to ask if there are any rough numbers about how many (audio & video separately) calls can be proceed at the same time with the minimal configuration of 6 VMs: 1cpu 2gb ram 5gb disk space? Maybe there is available information about how many resources consumes one video and one audio call? Does the connection between the number of calls and consuming resources is linear?



Thanks in advance



--

Best regards,

Victor



_______________________________________________

Clearwater mailing list

Clearwater at lists.projectclearwater.org<mailto:Clearwater at lists.projectclearwater.org>

http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160722/367f6700/attachment.html>

From morrisyan123 at gmail.com  Thu Jul 21 10:51:13 2016
From: morrisyan123 at gmail.com (yan morris)
Date: Thu, 21 Jul 2016 22:51:13 +0800
Subject: [Project Clearwater] Memento Application Server Standalone
Message-ID: <CAM_v+eTvRsZJ4u1R7+dLvGzg5X-hxb96ZC4UZd84ho-rrprr0Q@mail.gmail.com>

Hi ,

I encounter a problem when I install memento-as standalone .

I cannot make a call , it would give the message "Early Media started" .

But when I curl the call-list , I can see the records though it never rings
.

Could you give me some tips about this ?

Below is my configuration about Memento.


Shared_config for Clearwater except the node contains Memento

# Deployment definitions
home_domain=ccu
sprout_hostname=sprout.ccu
memento_hostname=memento.ccu
hs_hostname=hs.ccu:8888
hs_provisioning_hostname=hs.ccu:8889
ralf_hostname=ralf.ccu:10888
xdms_hostname=homer.ccu:7888

# Email server configuration
smtp_smarthost=smtpserver
smtp_username=user
smtp_password=secret
email_recovery_sender=clearwater at example.org

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

memento_enabled='Y'
memento=12345


Shared_config for the node of Memento Application Server

# Deployment definitions
home_domain=ccu
sprout_hostname=memento.ccu
memento_hostname=memento.ccu
hs_hostname=hs.ccu:8888
hs_provisioning_hostname=hs.ccu:8889
ralf_hostname=ralf.ccu:10888
xdms_hostname=homer.ccu:7888

# Email server configuration
smtp_smarthost=smtpserver
smtp_username=user
smtp_password=secret
email_recovery_sender=clearwater at example.org

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

memento_enabled='Y'
memento=12345


My IFC configuration :

<InitialFilterCriteria>
<TriggerPoint>
<ConditionTypeCNF>0</ConditionTypeCNF>
<SPT>
<ConditionNegated>0</ConditionNegated>
<Group>0</Group>
<Method>INVITE</Method>
<Extension></Extension>
</SPT>
</TriggerPoint>
<ApplicationServer>
<ServerName>sip:memento@<memento node's IP>12345</ServerName>
<DefaultHandling>0</DefaultHandling>
</ApplicationServer>
</InitialFilterCriteria>


I have tried use memento IP or memento.zone as the ServerName , but it
didn't work.

Did I configure incorrectly ? Or there are something that I forgot to set.

BTW , I checked the version of each node , they are in the newest version.


Thank you .

Morris Yan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160721/a376f626/attachment.html>

From trey.ormsbee at interoptechnologies.com  Mon Jul 25 15:28:18 2016
From: trey.ormsbee at interoptechnologies.com (Trey Ormsbee)
Date: Mon, 25 Jul 2016 14:28:18 -0500
Subject: [Project Clearwater] homestead core dump on MAA
In-Reply-To: <CY1PR02MB118104F92582B549112BB248E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
References: <1468511977.31863.30.camel@interoptechnologies.com>
	<1468522595.31863.38.camel@interoptechnologies.com>
	<CY1PR02MB118104F92582B549112BB248E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
Message-ID: <1469474898.19076.75.camel@interoptechnologies.com>

Chris-

Sorry for the long delay,  I will not be able to get a stack trace as
the problem was corrected on the HSS before I had a chance to get them.
However, I did narrow down the actual missing AVP that caused the crash.

It is a nested AVP,

Again this is in the MAA:

  AVP (612): SIP-Auth-Data-Item
    AVP: SIP-Auth-Data-Item
      AVP (613): SIP-Item-Number
      AVP (608): SIP-Authentication-Scheme
      AVP (635): SIP-Digest-Authenticate

If 608 is missing,  homestead crashes.  Hopefully that is enough info to
help get this corrected.

Thanks
Trey

-----Original Message-----From: Chris Elford (projectclearwater.org)
<chris at projectclearwater.org>
To: "Ormsbee, Trey" <Trey.Ormsbee at interoptechnologies.com>,
clearwater at lists.projectclearwater.org
<clearwater at lists.projectclearwater.org>
Subject: RE: [Project Clearwater] homestead core dump on MAA
Date: Fri, 15 Jul 2016 07:00:40 -0400

Hi Trey,

 

I?m glad you managed to get to the bottom of this. I?d like to get this
issue fixed so that other people don?t hit this problem.

 

Do you know exactly which required parameter was missing in the MAA?

 

It would be great if you could get us a stack trace including debug
symbols. To do that, run `sudo apt-get install bono-dbg sprout-dbg` to
install Bono and Sprout debug symbols, then attempt to hit the crash
again.

 

Yours,

 

Chris

 

 

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
On Behalf Of Trey Ormsbee
Sent: 14 July 2016 19:57
To: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] homestead core dump on MAA


 

It appears this crashed is caused by a missing required parameter in the
MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a
bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee
<trey.ormsbee at interoptechnologies.com>
To: clearwater at lists.projectclearwater.org
<clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a
received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing
trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising
correlating marker with diameter session ID =
homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30
seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in
state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of
COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback
registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter
response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received
Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter
'(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) &&
(((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?
I cannot attach a capture/core as it has private data in it. 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160725/6513d919/attachment.html>

From chris at projectclearwater.org  Tue Jul 26 04:14:38 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Tue, 26 Jul 2016 08:14:38 +0000
Subject: [Project Clearwater] homestead core dump on MAA
In-Reply-To: <1469474898.19076.75.camel@interoptechnologies.com>
References: <1468511977.31863.30.camel@interoptechnologies.com>
	<1468522595.31863.38.camel@interoptechnologies.com>
	<CY1PR02MB118104F92582B549112BB248E1330@CY1PR02MB1181.namprd02.prod.outlook.com>
	<1469474898.19076.75.camel@interoptechnologies.com>
Message-ID: <CY1PR02MB118185415DC2CBB78E289EC8E10E0@CY1PR02MB1181.namprd02.prod.outlook.com>

Thanks Trey,

I?ve added these diagnostics to out Github issue<https://github.com/Metaswitch/homestead/issues/362>. Graeme thinks he knows what the issue is, and he?s going to try to fix it this sprint.

Thank you for getting the extra diags.

Yours,

Chris

From: Trey Ormsbee [mailto:trey.ormsbee at interoptechnologies.com]
Sent: 25 July 2016 20:28
To: Chris Elford (projectclearwater.org) <chris at projectclearwater.org>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Project Clearwater] homestead core dump on MAA

Chris-

Sorry for the long delay,  I will not be able to get a stack trace as the problem was corrected on the HSS before I had a chance to get them.  However, I did narrow down the actual missing AVP that caused the crash.

It is a nested AVP,

Again this is in the MAA:

  AVP (612): SIP-Auth-Data-Item
    AVP: SIP-Auth-Data-Item
      AVP (613): SIP-Item-Number
      AVP (608): SIP-Authentication-Scheme
      AVP (635): SIP-Digest-Authenticate

If 608 is missing,  homestead crashes.  Hopefully that is enough info to help get this corrected.

Thanks
Trey

-----Original Message-----From: Chris Elford (projectclearwater.org) <chris at projectclearwater.org<mailto:%22Chris%20Elford%20%28projectclearwater.org%29%22%20%3cchris at projectclearwater.org%3e>>
To: "Ormsbee, Trey" <Trey.Ormsbee at interoptechnologies.com<mailto:%22Ormsbee,%20Trey%22%20%3cTrey.Ormsbee at interoptechnologies.com%3e>>, clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> <clearwater at lists.projectclearwater.org<mailto:%22clearwater at lists.projectclearwater.org%22%20%3cclearwater at lists.projectclearwater.org%3e>>
Subject: RE: [Project Clearwater] homestead core dump on MAA
Date: Fri, 15 Jul 2016 07:00:40 -0400

Hi Trey,



I?m glad you managed to get to the bottom of this. I?d like to get this issue fixed so that other people don?t hit this problem.



Do you know exactly which required parameter was missing in the MAA?



It would be great if you could get us a stack trace including debug symbols. To do that, run `sudo apt-get install bono-dbg sprout-dbg` to install Bono and Sprout debug symbols, then attempt to hit the crash again.



Yours,



Chris





From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Trey Ormsbee
Sent: 14 July 2016 19:57
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Project Clearwater] homestead core dump on MAA




It appears this crashed is caused by a missing required parameter in the MAA,  specifically SIP-Number-Auth-Items.  So this is more a note of a bug in the parser of this type of diameter message.

Thanks,
Trey

-----Original Message-----From: Trey Ormsbee <trey.ormsbee at interoptechnologies.com<mailto:Trey%20Ormsbee%20%3ctrey.ormsbee at interoptechnologies.com%3e>>
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org> <clearwater at lists.projectclearwater.org<mailto:%22clearwater at lists.projectclearwater.org%22%20%3cclearwater at lists.projectclearwater.org%3e>>
Subject: [Project Clearwater] homestead core dump on MAA
Date: Thu, 14 Jul 2016 11:59:37 -0400

I am getting a coredump on the latest release of homestead with an MAA.

excerpt is here:
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:888: Processing a received diameter message
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:901: Got existing trail ID: 2
14-07-2016 15:42:02.637 UTC Debug diameterstack.cpp:969: Raising correlating marker with diameter session ID = homestead01.example.com;1468510914;2
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Peer timeout reset to 30 seconds (+/- 2)
14-07-2016 15:42:02.637 UTC Debug freeDiameter: 'XXX.XXX.XXX.100' in state 'STATE_OPEN' waiting for next event.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'Vendor-Specific-Application-Id'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Digest-Authenticate'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of AVP: 'SIP-Auth-Data-Item'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Iterating on rules of COMMAND: '3GPP/Multimedia-Auth-Answer'.
14-07-2016 15:42:02.637 UTC Debug freeDiameter: Calling callback registered when query was sent (0x45b880, 0x7f6a8c01a440)
14-07-2016 15:42:02.637 UTC Verbose diameterstack.cpp:1097: Got Diameter response of type 303 - calling callback on transaction 0x7f6a8c01a440
14-07-2016 15:42:02.637 UTC Debug handlers.cpp:343: Received Multimedia-Auth answer with result code 2001
14-07-2016 15:42:02.637 UTC Error freeDiameter: ERROR: Invalid parameter '(((avp) && (((struct msg_avp_chain *)(avp))->type == MSG_AVP) && (((struct avp *)(avp))->avp_eyec == (0x11355467))) && pdata)', 22

Signal 11 caught

Basic stack dump:
/usr/share/clearwater/bin/homestead[0x492bbd]
/usr/share/clearwater/bin/homestead[0x493d7d]
/usr/share/clearwater/bin/homestead[0x4a9cec]
/lib/x86_64-linux-gnu/libc.so.6(+0x36cb0)[0x7f6acf2c2cb0]
/usr/share/clearwater/bin/homestead[0x4534f5]
/usr/share/clearwater/bin/homestead[0x4778f9]
/usr/share/clearwater/bin/homestead[0x47d8a1]
/usr/share/clearwater/bin/homestead[0x45b911]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x30656)[0x7f6ad1811656]
/usr/share/clearwater/homestead/lib/libfdcore.so.6(+0x3225c)[0x7f6ad181325c]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x8184)[0x7f6ad083c184]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x6d)[0x7f6acf38637d]




Attached is the full startup and error,  any ideas what may cause this?  I cannot attach a capture/core as it has private data in it.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160726/9cf935cd/attachment.html>

From matt at projectclearwater.org  Tue Jul 26 12:08:22 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Tue, 26 Jul 2016 16:08:22 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eSednmUogsCFZ9=UpYLXm1tArLf4L4zBsSKT53a+1ckgA@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
	<CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
	<CY1PR0201MB156312737D9048A209298AE590090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSGsN3LNhAZTBWwx3ZWPkm69uDMuuugms=anqhy=1rJ1Q@mail.gmail.com>
	<CY1PR0201MB1563F2C82DE2BB408B367A0690090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eT7oOuMY-ARFQkg6fAQp2Ub2Jp46vkHmEB43PBdiveMfQ@mail.gmail.com>
	<CY1PR0201MB1563815BF919FDE2EAF88F8C900A0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSP79PQg6Gnhzkkxr6_qOZ8OQPQPmSrwxQuqfvmH1B9jA@mail.gmail.com>
	<CAM_v+eSednmUogsCFZ9=UpYLXm1tArLf4L4zBsSKT53a+1ckgA@mail.gmail.com>
Message-ID: <CY1PR0201MB1563CCA985D12AE23E0504D7900E0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

Thanks for your email.

I've checked the bono_hostname option, and it doesn't actually do anything, so I've removed it from the docs.  What were you looking for it to do?

I think what you might be trying to do is have Bono listen on one IP address for access signaling and one IP address for core signaling.  As I mentioned earlier in the trail, Bono does not currently support this.  Would you be interested in adding this support?

For reference, the public_ip and local_ip values in /etc/clearwater/local_config are for NAT traversal - the local_ip is the local IP address that the Bono node owns, and the public_ip is the NAT-ed IP address that hosts on the public Internet see as Bono's IP address.  (Bono will not try to bind to public_ip.)

I hope that helps - please let me know how you get on.

Thanks,

Matt

From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 25 July 2016 16:22
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

I tried to write the "bono_hostname" into shared_config .

But It seems nothing happened !

I use netstat and find that port 5060 is listened by bono's virtual IP(192.168.44.x), not publice IP , and it is depend on local_ip of local_config.

I think that is why wireshark tell me the port is unreachable .

Are there any methods can let public IP listen on port 5060?

Or are there something can make public IP work properly?


Thank for your time .

Morris

2016-07-23 0:30 GMT+08:00 yan morris <morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>>:
Hi , Matt

I use vmware to install clearwater on 6 Vms , and via NAT I have deployed it properly .

I tried to add 2 internet-routable IPs into Ellis and Bono , and the network works correctly (can ping outside network and be pinged by outside network).
192.168.44.144~192.168.44.149 are my IPs of 6 components of Clearwater.(order by Ellis , Bono , Sprout ,Homer, Homestead , Ralf )

the local_config in Ellis and Bono is like below :
local_ip= Ellis's private IP or Bono's private IP.
public_ip=<my internet_routable IP>
public_hostname=<my internet_routable IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"


and the local_config in the others components is
local_ip=<private IP>
public_ip=<private IP>
public_hostname=<private IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"


I can access Ellis through public IP to create accounts and sign in Clearwater properly.

But I can not sign in Clearwater if I set the Bono's public IP as P-CSCF host in my IMS Client.

I use wireshark to see the error message is that "590 Port unreachable" .

(If I set Bono's private IP as P-CSCF host , I can sign in without errors)

Do you have any ideas about this situation ?

In addition , do I need to change any DNS record?

Thank you very much.

Morris


2016-07-22 18:49 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Yes, you should be able to do this without split management and signaling networks.  Bear in mind that you will need some way of reaching all nodes for management access (but this could be because your PC has a connection directly onto their network, or via a "jump box"), and all nodes will need access to the public Internet to download the Clearwater software (possibly via NAT).

I think the configuration you described should work - please can you describe more about what didn't work?

BTW, if you want to, you should be able to set the "public_ip" and "public_hostname" on Sprout, Homer and Ralf to match the private IP, rather than being public IPs (since you're never going to route to them from the public Internet).

Please let me know.

Thanks,

Matt

From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 22 July 2016 05:45

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for your solution first.

I have a further question.

If I don't separate Claerwater into two network(management and siganling)

Is it possible that I use 3 internet-routable  IPs (for Ellis , Bono , and Homer )and 6 virtual IP for each node as private IP , and let it be reached by outside network?

I had tried before , But it seems not working .

I guess whether I configure something incorrecty  , I changed the local_config in those 3 components like below:
192.168.44.144~192.168.44.149 are my IPs of 6 components of Clearwater.(order by Ellis , Bono , Sprout ,Homer, Homestead , Ralf )
local_ip=192.168.44.144
public_ip=<my internet_routable IP>
public_hostname=<my internet_routable IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"

If the concept is going to work , could you give me some tips about configuration (somewhere wrong or where need to configure)?

Thank you very much!

Morris

2016-07-22 0:12 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Yes, that's all correct - good luck!

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 17:07

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for explaining clearly.

After reading the explanation ,

1. I can use virtual ips(192.168.0.0/24<http://192.168.0.0/24>) in management network for public IPs and private IPs , because the management network doesn't need to be reached

outside network.

2.In siganling network , I need the three IPs that can be reached by outside network for public IPs , and the private IPs can use the virtual IP.


Therefore , I only need 3 internet-routable IPs  , and several virtual IPs to deploy the Clearwater .  Do I misunderstand anything ?


I am sorry that I forget to tell you the environment.

Now , I am deploying on Vmware Workstation12

But in the future , I wish I could deploy Clearwater on Openstack.


Thank for your help sincerely.

Morris

2016-07-21 23:39 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

I haven't come across the term physical IP before, and I've seen virtual IP used for a number of different purposes, so just to be clear:

?         private IP addresses are only required to be able to route amongst themselves, not externally - for example, I might use IP addresses in the 192.168.0.0/24<http://192.168.0.0/24> range - obviously, these IP addresses are reused millions of times across the world

?         public IP addresses are required to be able to route externally (e.g. to/from the public Internet) - I must use IP addresses that have been globally allocated to me.

To elaborate slightly further, public IP addresses only need to be routable as far as you want them to be accessible.  For signaling, this probably means you need to have Internet-routable IP addresses.  However, for management, you probably only want your host to be accessible within your management network, so you might be able to use non-Internet (e.g. 10.0.0.0/8<http://10.0.0.0/8>) IP addresses on these too.

This means that you only need Internet-routable public IP addresses for those services that are genuinely public, i.e. Bono (for SIP), Ellis (for web provisioning) and Homer (for call service management) - although you might want to block Homer too.  Does that make sense?

Note that if you're trying to deploy at the smallest possible scale, we have all-in-one images (http://clearwater.readthedocs.io/en/latest/All_in_one_Images.html) which contain all components on a single VM, and so only need a single IP address.  However, this is just intended for demonstration purposes - I wouldn't recommend you deploy this for any serious testing or deployment.

If you'd like further advice on this, please can you clarify on which virtualization platform/environment you're trying to deploy - it will be much easier to talk about this in concrete terms, rather than in the abstract!

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 14:46

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for explaining the benefits and solutions.

I have some questions about solution.

In your instruction , the public IP means physical IP and the private IP means virtual IP , right?

If that is , It means I need 9 public IPs and 12 private IPs to build six components ?

I don't have so many physical IPs .

 Even  I deploy  Clearwater like this structure , when I want to insert new node into Clearwater , I still need a public IP and two private IPs(one for management network ,

the other for siganling network ) to deploy it?

All I want to is that using 2 or 3 physical IPs to deploy Clearwater  and let it could be reached by outside network , does it could happen ?

I am little confused with the solution , if I misunderstand anything , please give me some ideas .
Thank you very much for your time .

Morris

2016-07-21 3:44 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160726/710bc87f/attachment.html>

From andrew.okri at roecastle.com  Tue Jul 26 15:49:37 2016
From: andrew.okri at roecastle.com (Andrew Okri)
Date: Tue, 26 Jul 2016 20:49:37 +0100
Subject: [Project Clearwater] SIP Registration request timing out
Message-ID: <6316C1DB-1F5A-40BA-8885-AC8908792E66@roecastle.com>

Hi All,
	I have done a manual install of the Clearwater components into separate Virtualbox VMs. They have all started up successfully. But l cannot get a Zoiper soft phone to register to either bono or sprout. The zoiper phone has been used to register and make a call on the all-in-one demo vm, so l know the config works. The Tcpdump on both machines show register requests coming in but l do not see a SIP ACK sent back to the soft phone, hence the time out. The bono and sprout services are running on these machines and there are no error in the logs except for a warning on zmq_msg_recv. 
Has anyone encountered this issue previously, can you share your solution where possible please.

Regards
Andrew


From anderson08121995 at gmail.com  Wed Jul 27 03:14:57 2016
From: anderson08121995 at gmail.com (=?UTF-8?B?5YqJ5Lqe5piH?=)
Date: Wed, 27 Jul 2016 15:14:57 +0800
Subject: [Project Clearwater] About Clearwater webRTC
Message-ID: <CAMC9rEkJnYHhz+SbPJubZUnejdCpbq=v+Q9hVHnxd2=sWtimFg@mail.gmail.com>

Hi,

I am testing Clearwater webRTC. I try the sipml5 from
http://clearwater.readthedocs.io/en/stable/WebRTC_support_in_Clearwater.html
page.

I have installed  clearwater to six VMware respectively and used six public
ip, and follw the page
instructions with above page, but it seems not work to establish websocket
connect to my bono
ip. Then, I try to set SIP outbound proxy options instead of setting
websocket options.
It now work and can make a sipnl5-sipml5 call. I use Wireshark to capture
sip packets, it seems
sipml5 make a websockets-sip transform through there(sipml5) server with
webrtc2sip.

So, I have a question that is clearwater a websockets support or clearwater
just dependent on sipml5 server to transform websockets to sip packets then
sent to bono!

Is clearwater use websocket with all stages(from register to make a call to
speak with other)?

I also try the JSSIP demo, it also cannot make a websocket to the bono 5062
port!!

Looking forward to your reply! Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160727/108ff5e2/attachment.html>

From chris at projectclearwater.org  Wed Jul 27 12:03:12 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 27 Jul 2016 16:03:12 +0000
Subject: [Project Clearwater] Memento Application Server Standalone
In-Reply-To: <CAM_v+eTvRsZJ4u1R7+dLvGzg5X-hxb96ZC4UZd84ho-rrprr0Q@mail.gmail.com>
References: <CAM_v+eTvRsZJ4u1R7+dLvGzg5X-hxb96ZC4UZd84ho-rrprr0Q@mail.gmail.com>
Message-ID: <CY1PR02MB1181D82B09E288AD22A49E95E10F0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Morris,

From what you tell me, it sounds like Memento is getting involved with your calls, but Sprout is not managing to route them to the correct place.

In order to work out where this is going wrong, it would be helpful to see a set of Sprout debug logs<http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#sprout> (log level 5) covering the failed call.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of yan morris
Sent: 21 July 2016 15:51
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] Memento Application Server Standalone

Hi ,

I encounter a problem when I install memento-as standalone .

I cannot make a call , it would give the message "Early Media started" .

But when I curl the call-list , I can see the records though it never rings .

Could you give me some tips about this ?

Below is my configuration about Memento.


Shared_config for Clearwater except the node contains Memento
# Deployment definitions
home_domain=ccu
sprout_hostname=sprout.ccu
memento_hostname=memento.ccu
hs_hostname=hs.ccu:8888
hs_provisioning_hostname=hs.ccu:8889
ralf_hostname=ralf.ccu:10888
xdms_hostname=homer.ccu:7888

# Email server configuration
smtp_smarthost=smtpserver
smtp_username=user
smtp_password=secret
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

memento_enabled='Y'
memento=12345


Shared_config for the node of Memento Application Server
# Deployment definitions
home_domain=ccu
sprout_hostname=memento.ccu
memento_hostname=memento.ccu
hs_hostname=hs.ccu:8888
hs_provisioning_hostname=hs.ccu:8889
ralf_hostname=ralf.ccu:10888
xdms_hostname=homer.ccu:7888

# Email server configuration
smtp_smarthost=smtpserver
smtp_username=user
smtp_password=secret
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

memento_enabled='Y'
memento=12345


My IFC configuration :
<InitialFilterCriteria>
<TriggerPoint>
<ConditionTypeCNF>0</ConditionTypeCNF>
<SPT>
<ConditionNegated>0</ConditionNegated>
<Group>0</Group>
<Method>INVITE</Method>
<Extension></Extension>
</SPT>
</TriggerPoint>
<ApplicationServer>
<ServerName>sip:memento@<memento<sip:memento@%3cmemento> node's IP>12345</ServerName>
<DefaultHandling>0</DefaultHandling>
</ApplicationServer>
</InitialFilterCriteria>


I have tried use memento IP or memento.zone as the ServerName , but it didn't work.
Did I configure incorrectly ? Or there are something that I forgot to set.

BTW , I checked the version of each node , they are in the newest version.


Thank you .

Morris Yan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160727/25153396/attachment.html>

From chris at projectclearwater.org  Wed Jul 27 12:11:58 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 27 Jul 2016 16:11:58 +0000
Subject: [Project Clearwater] SIP Registration request timing out
In-Reply-To: <6316C1DB-1F5A-40BA-8885-AC8908792E66@roecastle.com>
References: <6316C1DB-1F5A-40BA-8885-AC8908792E66@roecastle.com>
Message-ID: <CY1PR02MB11814F9D5910672CAAA456E9E10F0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi Andrew,

Thanks for getting in touch.

I haven't tried running multiple Project Clearwater nodes in separate Virtualbox VMs before. My first suspicion would be that the different nodes may be unable to contact each other. Are you able to e.g. ping your Homestead box from your Sprout box?

Yours,

Chris


-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Andrew Okri
Sent: 26 July 2016 20:50
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] SIP Registration request timing out

Hi All,
	I have done a manual install of the Clearwater components into separate Virtualbox VMs. They have all started up successfully. But l cannot get a Zoiper soft phone to register to either bono or sprout. The zoiper phone has been used to register and make a call on the all-in-one demo vm, so l know the config works. The Tcpdump on both machines show register requests coming in but l do not see a SIP ACK sent back to the soft phone, hence the time out. The bono and sprout services are running on these machines and there are no error in the logs except for a warning on zmq_msg_recv. 
Has anyone encountered this issue previously, can you share your solution where possible please.

Regards
Andrew
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org



From chris at projectclearwater.org  Wed Jul 27 12:23:13 2016
From: chris at projectclearwater.org (Chris Elford (projectclearwater.org))
Date: Wed, 27 Jul 2016 16:23:13 +0000
Subject: [Project Clearwater] About Clearwater webRTC
In-Reply-To: <CAMC9rEkJnYHhz+SbPJubZUnejdCpbq=v+Q9hVHnxd2=sWtimFg@mail.gmail.com>
References: <CAMC9rEkJnYHhz+SbPJubZUnejdCpbq=v+Q9hVHnxd2=sWtimFg@mail.gmail.com>
Message-ID: <CY1PR02MB1181E91B1E1D9D69C0F2F1E6E10F0@CY1PR02MB1181.namprd02.prod.outlook.com>

Hi,

We test Project Clearwater with WebRTC at the start of every sprint (every 2 weeks) to make sure that it continues to work. My colleague, Rob, made a successful call over websockets on Tuesday, using the sipml5 demo site. It sounds like there is some difference between your setup and ours that is causing the problem.

The first thing to check is that you are using a browser that supports the sipml5 demo using websockets. We have found that calls do not work when we use Chrome, but they do work with recent versions of Firefox.

The second thing that I would look at is whether the websocket request is reaching Bono. I suggest running a packet capture on Bono e.g. using tcpdump, then checking to see whether the packets are making it through your network. You should be able to filter on port 5062. If nothing shows up, then it is worth checking that your firewall is configured correctly.

If that does not identify the problem, can you send us debug logs from Bono showing a call? You can find instructions for setting the log level to 5 at http://clearwater.readthedocs.io/en/stable/Troubleshooting_and_Recovery.html#bono.

I hope that helps.

Yours,

Chris

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of ???
Sent: 27 July 2016 08:15
To: clearwater at lists.projectclearwater.org
Subject: [Project Clearwater] About Clearwater webRTC

Hi,

I am testing Clearwater webRTC. I try the sipml5 from http://clearwater.readthedocs.io/en/stable/WebRTC_support_in_Clearwater.html page.
I have installed  clearwater to six VMware respectively and used six public ip, and follw the page
instructions with above page, but it seems not work to establish websocket connect to my bono
ip. Then, I try to set SIP outbound proxy options instead of setting websocket options.
It now work and can make a sipnl5-sipml5 call. I use Wireshark to capture sip packets, it seems
sipml5 make a websockets-sip transform through there(sipml5) server with webrtc2sip.

So, I have a question that is clearwater a websockets support or clearwater just dependent on sipml5 server to transform websockets to sip packets then sent to bono!

Is clearwater use websocket with all stages(from register to make a call to speak with other)?

I also try the JSSIP demo, it also cannot make a websocket to the bono 5062 port!!

Looking forward to your reply! Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160727/c8e577ae/attachment.html>

From rob at projectclearwater.org  Thu Jul 28 07:03:40 2016
From: rob at projectclearwater.org (Robert Day (projectclearwater.org))
Date: Thu, 28 Jul 2016 11:03:40 +0000
Subject: [Project Clearwater] Jigglypuff release note
Message-ID: <BY2PR02MB214917161B7FFF0D77A4252DF4000@BY2PR02MB2149.namprd02.prod.outlook.com>

The release for Project Clearwater sprint "Jigglypuff" has been cut. The code for this release is tagged as release-103 in github.

In this sprint, we've tested and written up new instructions for using Project Clearwater with P-CSCFs and application servers that only support UDP (http://docs.projectclearwater.org/en/stable/Configuring_an_Application_Server.html#sip-over-udp-configuration). We've also started work on some new graylisting functionality, which improves our ability to tell whether a failed server has recovered before sending traffic to it, and which we'll be testing and merging in our next sprint.

This release includes the following bug fixes:

*         There's always a port in the sproutlet record-route headers (https://github.com/Metaswitch/sprout/issues/1479)

*         On a 430 Flow Failed response, we only delete bindings locally (https://github.com/Metaswitch/sprout/issues/1285)

*         Crash in AlarmReqAgent (https://github.com/Metaswitch/cpp-common/issues/519)

*         Multiple knife machines step on each other's toes (https://github.com/Metaswitch/chef/issues/148)

*         Over aggressive filtering of alarms in the Alarm Trap Sender (https://github.com/Metaswitch/clearwater-snmp-handlers/issues/128)

*         Upstart script never raises an alarm when monit is started (https://github.com/Metaswitch/clearwater-monit/issues/30)

*         Minor Path Errors in the Clearwater stress testing document (https://github.com/Metaswitch/clearwater-readthedocs/issues/195)

*         Cacti Manual Instructions don't mention how to access the Web UI (https://github.com/Metaswitch/clearwater-readthedocs/issues/190)

*         Minor Error in the dnsmasq section of the ENUM Guide (https://github.com/Metaswitch/clearwater-readthedocs/issues/187)


To upgrade to this release, follow the instructions at http://docs.projectclearwater.org/en/stable/Upgrading_a_Clearwater_deployment.html. If you are deploying an all-in-one node, the standard image (http://vm-images.cw-ngv.com/cw-aio.ova) has been updated for this release.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160728/55f4f3c2/attachment.html>

From matt at projectclearwater.org  Thu Jul 28 08:37:53 2016
From: matt at projectclearwater.org (Matt Williams (projectclearwater.org))
Date: Thu, 28 Jul 2016 12:37:53 +0000
Subject: [Project Clearwater] Configuration about Bono with two network
 adapters
In-Reply-To: <CAM_v+eRWA4JpxzrPZuJ+hpZ39t7w1J-EQ8YsrA7KnBuEXSdRTA@mail.gmail.com>
References: <CY1PR0201MB1563092708EA4099ADA07E1C90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRmuS+wFamyb=Vo92smWYAYr9Aj18EfE9K9AYKoBCFX7Q@mail.gmail.com>
	<CY1PR0201MB1563224FD0E8E568D376115D90080@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRN78KAe33K4WJ9OtSh=YrqfTzRVUGmcLR3J5rd8ePzow@mail.gmail.com>
	<CY1PR0201MB156312737D9048A209298AE590090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSGsN3LNhAZTBWwx3ZWPkm69uDMuuugms=anqhy=1rJ1Q@mail.gmail.com>
	<CY1PR0201MB1563F2C82DE2BB408B367A0690090@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eT7oOuMY-ARFQkg6fAQp2Ub2Jp46vkHmEB43PBdiveMfQ@mail.gmail.com>
	<CY1PR0201MB1563815BF919FDE2EAF88F8C900A0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eSP79PQg6Gnhzkkxr6_qOZ8OQPQPmSrwxQuqfvmH1B9jA@mail.gmail.com>
	<CAM_v+eSednmUogsCFZ9=UpYLXm1tArLf4L4zBsSKT53a+1ckgA@mail.gmail.com>
	<CY1PR0201MB1563CCA985D12AE23E0504D7900E0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAM_v+eRWA4JpxzrPZuJ+hpZ39t7w1J-EQ8YsrA7KnBuEXSdRTA@mail.gmail.com>
Message-ID: <CY1PR0201MB15635196892138E9B494027F90000@CY1PR0201MB1563.namprd02.prod.outlook.com>

Morris,

Thanks for your email.

No, Bono does not support having two IP addresses for signaling.  As I mentioned earlier, Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that implements this function.

As you say, though, the UE must be able to reach Bono - the approach that we normally use for this is that

?         every node has a private IP address (local_ip)

?         at least Bono and Ellis also have public IP addresses (public_ip) assigned to them, that are NAT-ed (outside the VM) onto their private IP address

?         we configure the UE to contact the public IP address.

For example,

?         when running in EC2, the EC2 infrastructure allocates each node both a public and private IP address, and handles NAT-ing the public address onto the private address (which the VM sees)

?         when running in OpenStack, we create VMs with private IP addresses, and a "router" that connects this to a public network, and then assign a "floating IP" to the VM, which configures the router to perform NAT.
I'm not sure which version of VMware you're using, but I believe vCloud supports these concepts.  Alternatively, with any version of VMware, you could deploy an external NAT.

For production deployments, we'd normally deploy Clearwater with Perimeta rather than Bono, and this offers more deployment flexibility (among other things).

I hope that helps.

Matt

From: yan morris [mailto:morrisyan123 at gmail.com]
Sent: 26 July 2016 18:00
To: Matt Williams (projectclearwater.org) <matt at projectclearwater.org>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

I have little confused about this problem.

Let me explain what I want to do more clearly.

First , non-Internet-routable IP can not be reached by outside network because it is virtual , like I cannot ping others' VM , which ip is 192.168.x.x , right?

But , Bono as P-CSCF , I want to my Bono can be reached by outside network.

Therefore , just like you say , I want to  Bono be reached by Internet-routable IP , in meanwhile I also want that Bono's IP of Clearwater is virtual .

In other word , I want Bono have two IPs , one is internet-routable IP (140.123.x.x) and the other is virtual (192.168.x.x) for Clearwater inter-communication,

and use internet-routable IP as P-CSCF host IP.

(I thought the setting of local_ip and public ip is used to do this.)

Let UE can reach Bono by internet-routable IP.


In addition ,

The last paragraph of your letter , I can not realize that you said , is it means that  UE can reach Bono's public IP ? Otherwise , why I should set internet-routable IP as public ip?

My UE will ask for setting IP address of P-CSCF , as the picture I attached

.[cid:image002.jpg at 01D1E8D2.33E97890]
?
You said Bono won't try to bind to Public IP , so I shouldn't set public IP as P-CSCF host , right?

And It must be set as local_ip of Bono , because port 5060 is listened by local_ip.

Okay , there is a question , how can I let my UE reach Bono ? If I use virtual IP as Bono's local_ip.


If there are anything I misunderstand , or I don't say clearly , please let me know.


Thank you very much.

Morris .

2016-07-27 0:08 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email.

I've checked the bono_hostname option, and it doesn't actually do anything, so I've removed it from the docs.  What were you looking for it to do?

I think what you might be trying to do is have Bono listen on one IP address for access signaling and one IP address for core signaling.  As I mentioned earlier in the trail, Bono does not currently support this.  Would you be interested in adding this support?

For reference, the public_ip and local_ip values in /etc/clearwater/local_config are for NAT traversal - the local_ip is the local IP address that the Bono node owns, and the public_ip is the NAT-ed IP address that hosts on the public Internet see as Bono's IP address.  (Bono will not try to bind to public_ip.)

I hope that helps - please let me know how you get on.

Thanks,

Matt

From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 25 July 2016 16:22

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

I tried to write the "bono_hostname" into shared_config .

But It seems nothing happened !

I use netstat and find that port 5060 is listened by bono's virtual IP(192.168.44.x), not publice IP , and it is depend on local_ip of local_config.

I think that is why wireshark tell me the port is unreachable .

Are there any methods can let public IP listen on port 5060?

Or are there something can make public IP work properly?


Thank for your time .

Morris

2016-07-23 0:30 GMT+08:00 yan morris <morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>>:
Hi , Matt

I use vmware to install clearwater on 6 Vms , and via NAT I have deployed it properly .

I tried to add 2 internet-routable IPs into Ellis and Bono , and the network works correctly (can ping outside network and be pinged by outside network).
192.168.44.144~192.168.44.149 are my IPs of 6 components of Clearwater.(order by Ellis , Bono , Sprout ,Homer, Homestead , Ralf )

the local_config in Ellis and Bono is like below :
local_ip= Ellis's private IP or Bono's private IP.
public_ip=<my internet_routable IP>
public_hostname=<my internet_routable IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"


and the local_config in the others components is
local_ip=<private IP>
public_ip=<private IP>
public_hostname=<private IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"


I can access Ellis through public IP to create accounts and sign in Clearwater properly.

But I can not sign in Clearwater if I set the Bono's public IP as P-CSCF host in my IMS Client.

I use wireshark to see the error message is that "590 Port unreachable" .

(If I set Bono's private IP as P-CSCF host , I can sign in without errors)

Do you have any ideas about this situation ?

In addition , do I need to change any DNS record?

Thank you very much.

Morris

2016-07-22 18:49 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Yes, you should be able to do this without split management and signaling networks.  Bear in mind that you will need some way of reaching all nodes for management access (but this could be because your PC has a connection directly onto their network, or via a "jump box"), and all nodes will need access to the public Internet to download the Clearwater software (possibly via NAT).

I think the configuration you described should work - please can you describe more about what didn't work?

BTW, if you want to, you should be able to set the "public_ip" and "public_hostname" on Sprout, Homer and Ralf to match the private IP, rather than being public IPs (since you're never going to route to them from the public Internet).

Please let me know.

Thanks,

Matt

From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 22 July 2016 05:45

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for your solution first.

I have a further question.

If I don't separate Claerwater into two network(management and siganling)

Is it possible that I use 3 internet-routable  IPs (for Ellis , Bono , and Homer )and 6 virtual IP for each node as private IP , and let it be reached by outside network?

I had tried before , But it seems not working .

I guess whether I configure something incorrecty  , I changed the local_config in those 3 components like below:
192.168.44.144~192.168.44.149 are my IPs of 6 components of Clearwater.(order by Ellis , Bono , Sprout ,Homer, Homestead , Ralf )
local_ip=192.168.44.144
public_ip=<my internet_routable IP>
public_hostname=<my internet_routable IP>
etcd_cluster="192.168.44.144,192.168.44.145,192.168.44.146,192.168.44.147,192.168.44.148,192.168.44.149"

If the concept is going to work , could you give me some tips about configuration (somewhere wrong or where need to configure)?

Thank you very much!

Morris

2016-07-22 0:12 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Yes, that's all correct - good luck!

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 17:07

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for explaining clearly.

After reading the explanation ,

1. I can use virtual ips(192.168.0.0/24<http://192.168.0.0/24>) in management network for public IPs and private IPs , because the management network doesn't need to be reached

outside network.

2.In siganling network , I need the three IPs that can be reached by outside network for public IPs , and the private IPs can use the virtual IP.


Therefore , I only need 3 internet-routable IPs  , and several virtual IPs to deploy the Clearwater .  Do I misunderstand anything ?


I am sorry that I forget to tell you the environment.

Now , I am deploying on Vmware Workstation12

But in the future , I wish I could deploy Clearwater on Openstack.


Thank for your help sincerely.

Morris

2016-07-21 23:39 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

I haven't come across the term physical IP before, and I've seen virtual IP used for a number of different purposes, so just to be clear:

?         private IP addresses are only required to be able to route amongst themselves, not externally - for example, I might use IP addresses in the 192.168.0.0/24<http://192.168.0.0/24> range - obviously, these IP addresses are reused millions of times across the world

?         public IP addresses are required to be able to route externally (e.g. to/from the public Internet) - I must use IP addresses that have been globally allocated to me.

To elaborate slightly further, public IP addresses only need to be routable as far as you want them to be accessible.  For signaling, this probably means you need to have Internet-routable IP addresses.  However, for management, you probably only want your host to be accessible within your management network, so you might be able to use non-Internet (e.g. 10.0.0.0/8<http://10.0.0.0/8>) IP addresses on these too.

This means that you only need Internet-routable public IP addresses for those services that are genuinely public, i.e. Bono (for SIP), Ellis (for web provisioning) and Homer (for call service management) - although you might want to block Homer too.  Does that make sense?

Note that if you're trying to deploy at the smallest possible scale, we have all-in-one images (http://clearwater.readthedocs.io/en/latest/All_in_one_Images.html) which contain all components on a single VM, and so only need a single IP address.  However, this is just intended for demonstration purposes - I wouldn't recommend you deploy this for any serious testing or deployment.

If you'd like further advice on this, please can you clarify on which virtualization platform/environment you're trying to deploy - it will be much easier to talk about this in concrete terms, rather than in the abstract!

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 21 July 2016 14:46

To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thank for explaining the benefits and solutions.

I have some questions about solution.

In your instruction , the public IP means physical IP and the private IP means virtual IP , right?

If that is , It means I need 9 public IPs and 12 private IPs to build six components ?

I don't have so many physical IPs .

 Even  I deploy  Clearwater like this structure , when I want to insert new node into Clearwater , I still need a public IP and two private IPs(one for management network ,

the other for siganling network ) to deploy it?

All I want to is that using 2 or 3 physical IPs to deploy Clearwater  and let it could be reached by outside network , does it could happen ?

I am little confused with the solution , if I misunderstand anything , please give me some ideas .
Thank you very much for your time .

Morris

2016-07-21 3:44 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

There are two main benefits of separating management and signaling (and these are often required in production networks).

?         It improves security.  Obviously all nodes need to be on the signaling network, but not all need to be on the (same) management network... or at least it's not necessary for traffic to be routable between two nodes on the management network.  This means that if one node's security was compromised, it couldn't be used to escalate to accessing other nodes.

?         It prevents an overload of traffic on the signaling network from overloading the management network (meaning that an administrator can still get in to manage the system).

On which virtualization platform are you installing Project Clearwater?  For example, on OpenStack, we have HEAT templates (https://github.com/Metaswitch/clearwater-heat) that

?         install all the Project Clearwater components on separate VMs

?         use separate management and signaling networks

?         use 6 public and 6 private IPs (one per node) on the management network

?         use just 3 public IPs (for Bono, Ellis and Homer) and 6 private IPs on the signaling network.

I hope that helps - please let me know how you get on.

Thanks,

Matt


From: yan morris [mailto:morrisyan123 at gmail.com<mailto:morrisyan123 at gmail.com>]
Sent: 20 July 2016 15:44
To: Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>
Subject: Re: [Project Clearwater] Configuration about Bono with two network adapters

Hi , Matt

Thanks for your answers.

Now, I understand the "network namespace" after reading the documents .

However , There are two questions I want to ask .

First is what is benefits allow separation of management from signaling ?

The second is , How sould I do if I install all of Clearwater components in VMs , which have Virtual IPs , and I want to let the users of outside network can access my clearwater ?  I tried to use six physical IPs , but there are't more IPs for the second sprout or bono . Are there solutions can help me use only two physical IPs (for Bono and Ellis) to built the Clearwater ?

Thank you very much.

Morris

2016-07-20 21:14 GMT+08:00 Matt Williams (projectclearwater.org<http://projectclearwater.org>) <matt at projectclearwater.org<mailto:matt at projectclearwater.org>>:
Morris,

Thanks for your email!

If I understand correctly, you're looking to use eth0 for management and core signaling, and eth1 for access signaling - is that right?

Unfortunately, the multiple network support in Clearwater only allows separation of management from signaling, not access signaling from core signaling.  Metaswitch produces a combined P-CSCF/SBC called Perimeta (http://www.metaswitch.com/perimeta-session-border-controller-sbc) that can be dropped in to replace Bono and supports this function.

Regarding where eth1 has gone on your existing Bono node, Clearwater's multiple network support uses "network namespaces" - you should still be able to see eth1 if you run "ip netns exec signaling ifconfig".  You can read more about these at http://www.projectclearwater.org/multiple-networks-support-part-1/, http://www.projectclearwater.org/multiple-networks-support-part-2/ and http://www.projectclearwater.org/multiple-networks-support-part-3/.

I hope that helps - please let me know if you have any questions.

Thanks,

Matt


From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of yan morris
Sent: 18 July 2016 15:02
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Project Clearwater] Configuration about Bono with two network adapters

Hi ,

I am trying to use two network adapters in my Bono.

One is virtual ip address (eth0), and it is  used for inter-communication of Clearwater-infrastructure.

The other is physical address (eth1), and it is used for getting SIP request from Internet.

I configured according this document , http://clearwater.readthedocs.io/en/stable/Multiple_Network_Support.html

However,when I run service clearwater-infrastructure restart , eth1 disappeared while I type ifconfig .

In addition , when i tried to ping google.com<http://google.com> or any other domain name , it give a error message "network is unreachable."
As expected , I cannot sign in my Clearwater.(Get message 590 port is not reachable)
The command and configuration is under below

Local_config:
local_ip=my virtual ip
public_ip=my physical ip
public_hostname= my clearwater zone
etcd_cluster = six components virtual ips
signaling_namespace=signaling
signaling_dns_server=my dns server ip
management_local_ip=my virtual ip

Network namespace command :
ip netns add signaling
ip link set eth1 netns signaling
ip netns exec signaling ifconfig lo up
ip netns exec signaling ifconfig eth1 <my physical ip/16> up
ip netns exec signaling route add default gateway <my physical ip's gateway> dev eth1


Are there anything I forgot to configure? Or something that I did wrong.

Could you give me some ideas about this situation.

Thank you.

Morris Yan.








-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160728/f9225961/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 8013 bytes
Desc: image002.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160728/f9225961/attachment.jpg>

From vijayrg at yahoo.com  Fri Jul 29 16:06:32 2016
From: vijayrg at yahoo.com (Vijay)
Date: Fri, 29 Jul 2016 20:06:32 +0000 (UTC)
Subject: [Project Clearwater] sprout docker - sprout failing to start
References: <1007758877.6400809.1469822792460.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <1007758877.6400809.1469822792460.JavaMail.yahoo@mail.yahoo.com>

Hello,I built sprout images 3 weeks ago. Sprout is failing to start. There is httpstack exception that is causing it to go down.. Here is the log...
29-07-2016 18:37:54.083 UTC Status httpstack.cpp:136: Configuring HTTP stack29-07-2016 18:37:54.083 UTC Status httpstack.cpp:137: ? Bind address: 172.16.64.629-07-2016 18:37:54.083 UTC Status httpstack.cpp:138: ? Bind port: ? ?988829-07-2016 18:37:54.083 UTC Status httpstack.cpp:139: ? Num threads: ?60029-07-2016 18:37:54.083 UTC Status main.cpp:1982: Initialise S-CSCF authentication module29-07-2016 18:37:54.083 UTC Status pluginloader.cpp:63: Loading plug-ins from /usr/share/clearwater/sprout/plugins29-07-2016 18:37:54.083 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_bgcf.so29-07-2016 18:37:54.085 UTC Status bgcfservice.cpp:68: No BGCF configuration (file ./bgcf.json does not exist)29-07-2016 18:37:54.085 UTC Status pluginloader.cpp:127: Loaded sproutlet bgcf using API version 129-07-2016 18:37:54.085 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_scscf.so29-07-2016 18:37:54.087 UTC Status pluginloader.cpp:127: Loaded sproutlet scscf using API version 129-07-2016 18:37:54.087 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_mmtel_as.so29-07-2016 18:37:54.089 UTC Status mmtelasplugin.cpp:95: Creating connection to XDMS homer:788829-07-2016 18:37:54.089 UTC Status httpconnection.cpp:114: Configuring HTTP Connection29-07-2016 18:37:54.089 UTC Status httpconnection.cpp:115: ? Connection created for server homer:788829-07-2016 18:37:54.089 UTC Status httpconnection.cpp:116: ? Connection will use a response timeout of 500ms29-07-2016 18:37:54.089 UTC Status pluginloader.cpp:127: Loaded sproutlet mmtel using API version 129-07-2016 18:37:54.089 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_icscf.so29-07-2016 18:37:54.091 UTC Status scscfselector.cpp:72: No S-CSCF configuration data (file ./s-cscf.json does not exist)29-07-2016 18:37:54.091 UTC Warning scscfselector.cpp:166: The S-CSCF json file is empty/invalid. Using default values29-07-2016 18:37:54.091 UTC Status pluginloader.cpp:127: Loaded sproutlet icscf using API version 129-07-2016 18:37:54.091 UTC Status pluginloader.cpp:157: Finished loading plug-ins29-07-2016 18:37:54.151 UTC Error main.cpp:2137: Caught HttpStack::Exception - evhtp_use_threads - -1
netstat -ntlup does not show anything bound to port 9888. Is any configuration missing?
?Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160729/a34cb38a/attachment.html>

From vijayrg at yahoo.com  Fri Jul 29 17:03:55 2016
From: vijayrg at yahoo.com (Vijay)
Date: Fri, 29 Jul 2016 14:03:55 -0700
Subject: [Project Clearwater] sprout docker - sprout failing to start
References: <1007758877.6400809.1469822792460.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <E16261C1-248A-4E42-8974-BA502623009D@yahoo.com>

Hello,
I built sprout images 3 weeks ago. Sprout is failing to start. There is httpstack exception that is causing it to go down.. Here is the log...

29-07-2016 18:37:54.083 UTC Status httpstack.cpp:136: Configuring HTTP stack
29-07-2016 18:37:54.083 UTC Status httpstack.cpp:137:   Bind address: 172.16.64.6
29-07-2016 18:37:54.083 UTC Status httpstack.cpp:138:   Bind port:    9888
29-07-2016 18:37:54.083 UTC Status httpstack.cpp:139:   Num threads:  600
29-07-2016 18:37:54.083 UTC Status main.cpp:1982: Initialise S-CSCF authentication module
29-07-2016 18:37:54.083 UTC Status pluginloader.cpp:63: Loading plug-ins from /usr/share/clearwater/sprout/plugins
29-07-2016 18:37:54.083 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_bgcf.so
29-07-2016 18:37:54.085 UTC Status bgcfservice.cpp:68: No BGCF configuration (file ./bgcf.json does not exist)
29-07-2016 18:37:54.085 UTC Status pluginloader.cpp:127: Loaded sproutlet bgcf using API version 1
29-07-2016 18:37:54.085 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_scscf.so
29-07-2016 18:37:54.087 UTC Status pluginloader.cpp:127: Loaded sproutlet scscf using API version 1
29-07-2016 18:37:54.087 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_mmtel_as.so
29-07-2016 18:37:54.089 UTC Status mmtelasplugin.cpp:95: Creating connection to XDMS homer:7888
29-07-2016 18:37:54.089 UTC Status httpconnection.cpp:114: Configuring HTTP Connection
29-07-2016 18:37:54.089 UTC Status httpconnection.cpp:115:   Connection created for server homer:7888
29-07-2016 18:37:54.089 UTC Status httpconnection.cpp:116:   Connection will use a response timeout of 500ms
29-07-2016 18:37:54.089 UTC Status pluginloader.cpp:127: Loaded sproutlet mmtel using API version 1
29-07-2016 18:37:54.089 UTC Status pluginloader.cpp:93: Attempt to load plug-in /usr/share/clearwater/sprout/plugins/sprout_icscf.so
29-07-2016 18:37:54.091 UTC Status scscfselector.cpp:72: No S-CSCF configuration data (file ./s-cscf.json does not exist)
29-07-2016 18:37:54.091 UTC Warning scscfselector.cpp:166: The S-CSCF json file is empty/invalid. Using default values
29-07-2016 18:37:54.091 UTC Status pluginloader.cpp:127: Loaded sproutlet icscf using API version 1
29-07-2016 18:37:54.091 UTC Status pluginloader.cpp:157: Finished loading plug-ins
29-07-2016 18:37:54.151 UTC Error main.cpp:2137: Caught HttpStack::Exception - evhtp_use_threads - -1

netstat -ntlup does not show anything bound to port 9888. Is any configuration missing?

 
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160729/4ec89fa7/attachment.html>

From h_bouzidi at esi.dz  Sat Jul 30 06:47:52 2016
From: h_bouzidi at esi.dz (Bouzidi Hocine)
Date: Sat, 30 Jul 2016 12:47:52 +0200
Subject: [Project Clearwater] Clearwater SIPp Node Errors 401, 403 and 503
Message-ID: <CABNCMD0nCg0WxXe6UXPWco-gBqnRGfpy0PfgG=0MoDLYfuvj1w@mail.gmail.com>

Hello,

I deployed the clearwater system on OpenStack using manual installation, I
generated 1000 numbers starting at sip:6505550000 at ims.cl
sudo bash -c "export PATH=/usr/share/clearwater/ellis/env/bin:$PATH ;
              cd /usr/share/clearwater/ellis/src/metaswitch/ellis/tools/ ;
              python create_numbers.py --start 6505550000 --count 1000"

I have created numbers in bulk, and created the SIPp node following the
instructions at :
http://clearwater.readthedocs.io/en/latest/Clearwater_stress_testing.html
However, when I start the SIPp node, all requests are rejected by Bono with
either 401, 403 or 503 error code.



I put below my configuration and logs of different machines.

I would be grateful, to help me solve this problem,
Thanks and Regards,
Hocine.

************************************************************
**************************************************************

ellis :             192.168.1.30
bono :           192.168.1.31
sprout :         192.168.1.32
homer :         192.168.1.33
hs :                192.168.1.34
ralf :              192.168.1.35
SIPp node : 192.168.1.3

************************************************************
**************************************************************

[ellis]root at ellis:/var/log/ellis# lsb_release -a
No LSB modules are available.
Distributor ID:    Ubuntu
Description:    Ubuntu 14.04.4 LTS
Release:    14.04
Codename:    trusty

************************************************************
**************************************************************

local_config for : (ellis, bono, sprout, homer, homestead, ralf) :

local_ip=(192.168.1.31)/*for bono*/
public_ip=pub_ip_bono
public_hostname=bono.ims.cl
etcd_cluster="192.168.1.30,192.168.1.31,192.168.1.32,192.
168.1.33,192.168.1.34,192.168.1.35"

************************************************************
**************************************************************

shared_config for : (ellis, bono, sprout, homer, homestead, ralf) :

# Deployment definitions
home_domain=ims.cl
sprout_hostname=sprout.ims.cl
hs_hostname=hs.ims.cl:8888
hs_provisioning_hostname=hs.ims.cl:8889
ralf_hostname=ralf.ims.cl:10888
xdms_hostname=homer.ims.cl:7888

# Email server configuration
#smtp_smarthost=<smtp server>
#smtp_username=<username>
#smtp_password=<password>
#email_recovery_sender=clearwater at example.org

# Keys
signup_key="secret"
turn_workaround="secret"
ellis_api_key="secret"
ellis_cookie_key="secret"

************************************************************
**************************************************************

local_config for SIPp node :

home_domain=ims.cl
local_ip=192.168.1.3
bono_servers=192.168.1.31
stress_target=192.168.1.31
base=6505550000
count=1000

************************************************************
**************************************************************

shared_config for SIPp node :

home_domain=ims.cl

************************************************************
**************************************************************

chronos de sprout :

[http]
bind-address = 192.168.1.32
bind-port = 7253
threads = 50

[logging]
folder = /var/log/chronos
level = 2

[alarms]
enabled = true

[exceptions]
max_ttl = 600

************************************************************
**************************************************************

chronos de ralf :

[http]
bind-address = 192.168.1.35
bind-port = 7253
threads = 50

[logging]
folder = /var/log/chronos
level = 2

[alarms]
enabled = true

[exceptions]
max_ttl = 600

************************************************************
**************************************************************

Dns config :

$TTL 5m ; Default TTL

@                 3600       IN SOA  ns admin ( 2014010800 ; Serial
                                          3600       ; Refresh
                                          3600       ; Retry
                                          3600       ; Expire
                                          300 )      ; Minimum TTL
@                 3600       IN NS   ns
ns                3600       IN A     pub_ip_dns ; IPv4 address of BIND
server
bono                            IN A     pub_ip_bono
@                                  IN A     pub_ip_bono
@                                  IN NAPTR 1 1 "S" "SIP+D2T" "" _sip._tcp
@                                  IN NAPTR 2 1 "S" "SIP+D2U" "" _sip._udp
_sip._tcp                    IN SRV   0 0 5060 bono
_sip._udp                   IN SRV   0 0 5060 bono
sprout                          IN A     pub_ip_sprout
scscf.sprout               IN A     pub_ip_sprout
sprout                          IN NAPTR 1 1 "S" "SIP+D2T" ""
_sip._tcp.sprout
_sip._tcp.sprout       IN SRV   0 0 5054 sprout
scscf.sprout               IN NAPTR 1 1 "S" "SIP+D2T" ""
_sip._tcp.scscf.sprout
_sip._tcp.scscf.sprout IN SRV   0 0 5054 sprout
icscf.sprout               IN A     pub_ip_sprout
icscf.sprout               IN NAPTR 1 1 "S" "SIP+D2T" ""
_sip._tcp.icscf.sprout
_sip._tcp.icscf.sprout IN SRV   0 0 5052 sprout
homestead                IN A     pub_ip_hs
hs                                IN A     pub_ip_hs
homer                        IN A     pub_ip_homer
ralf                              IN A     pub_ip_ralf
ellis                            IN A     pub_ip_ellis
benchmark              IN A     pub_ip_sip_stress_testing

************************************************************
**************************************************************

Ping results :

64 bytes from ellis.ims.cl: icmp_seq=1 ttl=60 time=1.39 ms
64 bytes from bono.ims.cl: icmp_seq=2 ttl=60 time=0.681 ms
64 bytes from sprout.ims.cl: icmp_seq=2 ttl=60 time=0.999 ms
64 bytes from homer.ims.cl: icmp_seq=3 ttl=60 time=0.754 ms
64 bytes from hs.ims.cl: icmp_seq=3 ttl=63 time=0.554 ms
64 bytes from ralf.ims.cl: icmp_seq=3 ttl=60 time=0.953 ms
64 bytes from scscf.sprout.ims.cl: icmp_seq=3 ttl=60 time=1.17 ms
64 bytes from icscf.sprout.ims.cl: icmp_seq=2 ttl=60 time=1.08 ms

************************************************************
**************************************************************

Sip stress testing logs in SIPp node : 192.168.1.3

1 - sip-stress_counts.csv :

CurrentTime;ElapsedTime;1_Pause_Sessions;1_Pause_Unexp;
2_REGISTER_Sent;2_REGISTER_Retrans;3_401_Recv;3_401_
Retrans;3_401_Timeout;3_401_Unexp;4_REGISTER_Sent;4_
REGISTER_Retrans;5_200_Recv;5_200_Retrans;5_200_Timeout;5_
200_Unexp;6_REGISTER_Sent;6_REGISTER_Retrans;7_401_Recv;7_
401_Retrans;7_401_Timeout;7_401_Unexp;8_REGISTER_Sent;8_
REGISTER_Retrans;9_200_Recv;9_200_Retrans;9_200_Timeout;9_
200_Unexp;10_Pause_Sessions;10_Pause_Unexp;11_REGISTER_
Sent;11_REGISTER_Retrans;12_200_Recv;12_200_Retrans;12_
200_Timeout;12_200_Unexp;13_REGISTER_Sent;13_REGISTER_
Retrans;14_200_Recv;14_200_Retrans;14_200_Timeout;14_200_
Unexp;15_Pause_Sessions;15_Pause_Unexp;17_Pause_Sessions;
17_Pause_Unexp;18_INVITE_Sent;18_INVITE_Retrans;19_100_Recv;
19_100_Retrans;19_100_Timeout;19_100_Unexp;20_INVITE_Recv;
20_INVITE_Retrans;20_INVITE_Timeout;20_INVITE_Unexp;22_
100_Recv;22_100_Retrans;22_100_Timeout;22_100_Unexp;23_
INVITE_Recv;23_INVITE_Retrans;23_INVITE_Timeout;23_INVITE_
Unexp;25_100_Sent;25_100_Retrans;26_180_Sent;26_180_
Retrans;27_180_Recv;27_180_Retrans;27_180_Timeout;27_180_
Unexp;28_Pause_Sessions;28_Pause_Unexp;29_200_Sent;29_
200_Retrans;30_200_Recv;30_200_Retrans;30_200_Timeout;30_
200_Unexp;31_ACK_Sent;31_ACK_Retrans;32_ACK_Recv;32_ACK_
Retrans;32_ACK_Timeout;32_ACK_Unexp;33_UPDATE_Sent;33_
UPDATE_Retrans;34_UPDATE_Recv;34_UPDATE_Retrans;34_UPDATE_
Timeout;34_UPDATE_Unexp;35_200_Sent;35_200_Retrans;36_
200_Recv;36_200_Retrans;36_200_Timeout;36_200_Unexp;37_
Pause_Sessions;37_Pause_Unexp;38_BYE_Sent;38_BYE_Retrans;39_
BYE_Recv;39_BYE_Retrans;39_BYE_Timeout;39_BYE_Unexp;40_
200_Sent;40_200_Retrans;41_200_Recv;41_200_Retrans;41_
200_Timeout;41_200_Unexp;42_Pause_Sessions;42_Pause_Unexp;
2016-07-30      04:48:58:500    1469846938.500563;00:00:00:
011;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
2016-07-30      04:49:58:502    1469846998.502974;00:01:00:
014;500;0;42;0;0;0;36;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
2016-07-30      04:50:58:504    1469847058.504622;00:02:00:
015;500;0;92;0;0;0;86;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
2016-07-30      04:51:58:505    1469847118.505831;00:03:00:
017;500;0;141;0;0;0;129;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
2016-07-30      04:52:58:506    1469847178.506461;00:04:00:
017;500;0;198;0;0;0;188;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
2016-07-30      04:53:58:509    1469847238.509161;00:05:00:
020;500;0;245;0;0;0;236;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;
0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;

2 - sip-stress_errors.log :

sipp: The following events occured:
2016-07-30      10:37:34:620    1469867854.620808: Aborting call on
unexpected message for Call-Id '278-7048 at 192.168.1.3': while expecting
'401' (index 3), received 'SIP/2.0 403 Forbidden
Via: SIP/2.0/UDP 192.168.1.3:17935;rport=17935;received=192.168.1.3;branch=
z9hG4bK-7048-278-2-6505550444-
Call-ID: 6505550444///278-7048 at 192.168.1.3
From: <sip:6505550444 at ims.cl>;tag=7048SIPpTag00278
To: <sip:6505550444 at ims.cl>;tag=z9hG4bKPjkl8MxPlBeHQfAfafWpFy0dCwc6ddxiuT
CSeq: 1 REGISTER
Content-Length:  0

2016-07-30      10:37:36:507    1469867856.507272: Aborting call on
unexpected message for Call-Id '472-7048 at 192.168.1.3': while expecting
'401' (index 3), received 'SIP/2.0 403 Forbidden
Via: SIP/2.0/UDP 192.168.1.3:29919;rport=29919;received=192.168.1.3;branch=
z9hG4bK-7048-472-2-6505550056-
Call-ID: 6505550056///472-7048 at 192.168.1.3
From: <sip:6505550056 at ims.cl>;tag=7048SIPpTag00472
To: <sip:6505550056 at ims.cl>;tag=z9hG4bKPj.RjEm.RjZAiHN6eVY2B4V0tKa.VdqJtn
CSeq: 1 REGISTER
Content-Length:


3 - cat /usr/share/clearwater/sip-stress/users.csv.1 (SIPp node :
192.168.1.3)

USER
6505550000;[authentication username=6505550000 at ims.cl
password=7kkzTyGW];6505550001;[authentication username=6505550001 at ims.cl
 password=7kkzTyGW]
6505550002;[authentication username=6505550002 at ims.cl
password=7kkzTyGW];6505550003;[authentication username=6505550003 at ims.cl
 password=7kkzTyGW]
6505550004;[authentication username=6505550004 at ims.cl
password=7kkzTyGW];6505550005;[authentication username=6505550005 at ims.cl
 password=7kkzTyGW]
*
*
*


************************************************************
**************************************************************

Ellis_log :

[ellis]root at ellis:/var/log/ellis# cat ellis_20160730T100000Z.txt
30-07-2016 08:00:05.890 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.34ms
30-07-2016 08:00:15.933 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 1.07ms
30-07-2016 08:00:25.985 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.39ms
30-07-2016 08:00:36.030 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.98ms
30-07-2016 08:00:46.094 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.35ms
30-07-2016 08:00:56.176 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.36ms
30-07-2016 08:01:06.208 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.32ms
30-07-2016 08:01:16.233 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.53ms
30-07-2016 08:01:26.298 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.95ms
30-07-2016 08:01:36.345 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.96ms
30-07-2016 08:01:46.372 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.40ms
30-07-2016 08:01:56.448 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 0.54ms
30-07-2016 08:02:06.476 UTC INFO web.py:1447: 200 GET /ping (0.0.0.0) 2.20ms

************************************************************
**************************************************************

Bono_logs :

[bono]root at bono:/var/log/bono# tail -f log_current.txt
30-07-2016 08:23:45.065 UTC Call-Disconnected: CALL_ID=6505550182///
409-6675 at 192.168.1.3 REASON=401
30-07-2016 08:23:45.086 UTC Call-Disconnected: CALL_ID=6505550182///
409-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:46.255 UTC Call-Disconnected: CALL_ID=6505550210///
395-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:47.800 UTC Call-Disconnected: CALL_ID=6505550056///
472-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:51.497 UTC Call-Disconnected: CALL_ID=6505550942///
29-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:51.610 UTC Call-Disconnected: CALL_ID=6505550956///
22-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:52.268 UTC Call-Disconnected: CALL_ID=6505550590///
205-6675 at 192.168.1.3 REASON=403
30-07-2016 08:23:55.526 UTC Call-Disconnected: CALL_ID=6505550576///
212-6675 at 192.168.1.3 REASON=403

[bono]root at bono:/var/log/bono# tail -f bono_current.txt
30-07-2016 08:24:00.865 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 13068ms,
minimum threshold for a change is 3909.096191
30-07-2016 08:24:08.866 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
30-07-2016 08:24:10.008 UTC Status connection_pool.cpp:447: Recycle TCP
connection slot 5
30-07-2016 08:24:14.019 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 13155ms,
minimum threshold for a change is 3935.121094
30-07-2016 08:24:23.803 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 9784ms,
minimum threshold for a change is 2926.737061
30-07-2016 08:24:23.871 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
30-07-2016 08:24:31.333 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 7528ms,
minimum threshold for a change is 2251.888184
30-07-2016 08:24:38.876 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
30-07-2016 08:24:40.036 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 8704ms,
minimum threshold for a change is 2603.670898
30-07-2016 08:24:47.807 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 7771ms,
minimum threshold for a change is 2324.578369

************************************************************
**************************************************************

Sprout_logs :

[sprout]root at sprout:/var/log/sprout# tail -f access_current.txt
30-07-2016 08:24:43.600 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:24:53.659 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:03.745 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:13.815 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:23.862 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:25.064 UTC 200 POST /authentication-timeout 0.005699
seconds
30-07-2016 08:25:33.927 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:43.975 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:25:54.090 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:26:04.234 UTC 200 GET /ping 0.000000 seconds


[sprout]root at sprout:/var/log/sprout# tail -f log_current.txt
30-07-2016 08:22:13.464 UTC Auth-Failure: Private
Identity=6505550810 at ims.cl Public
Identity=sip:6505550810 at ims.cl
30-07-2016 08:22:23.094 UTC Auth-Failure: Private
Identity=6505550914 at ims.cl Public
Identity=sip:6505550914 at ims.cl
30-07-2016 08:22:40.326 UTC Auth-Failure: Private
Identity=6505550908 at ims.cl Public
Identity=sip:6505550908 at ims.cl
30-07-2016 08:22:42.571 UTC Auth-Failure: Private
Identity=6505550196 at ims.cl Public
Identity=sip:6505550196 at ims.cl
30-07-2016 08:22:49.856 UTC Auth-Failure: Private
Identity=6505550272 at ims.cl Public
Identity=sip:6505550272 at ims.cl
30-07-2016 08:22:50.968 UTC Auth-Failure: Private
Identity=6505550782 at ims.cl Public
Identity=sip:6505550782 at ims.cl
30-07-2016 08:23:13.020 UTC Auth-Failure: Private
Identity=6505550236 at ims.cl Public
Identity=sip:6505550236 at ims.cl
30-07-2016 08:23:45.078 UTC Auth-Failure: Private
Identity=6505550182 at ims.cl Public
Identity=sip:6505550182 at ims.cl
30-07-2016 08:24:55.072 UTC Auth-Failure: Private
Identity=6505550808 at ims.cl Public
Identity=sip:6505550808 at ims.cl
30-07-2016 08:26:43.027 UTC Auth-Failure: Private
Identity=6505550090 at ims.cl Public
Identity=sip:6505550090 at ims.cl

[sprout]root at sprout:/var/log/sprout# tail -f sprout_current.txt
30-07-2016 08:27:51.005 UTC Error httpconnection.cpp:762: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
30-07-2016 08:27:51.005 UTC Error hssconnection.cpp:149: Failed to get
Authentication Vector for 6505550046 at ims.cl
30-07-2016 08:27:51.105 UTC Error httpconnection.cpp:762: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
30-07-2016 08:27:51.105 UTC Error hssconnection.cpp:149: Failed to get
Authentication Vector for 6505550302 at ims.cl
30-07-2016 08:27:51.474 UTC Error authentication.cpp:1134: Authentication
failed, Invalid authorization digest (PJSIP_EAUTHINVALIDDIGEST)
30-07-2016 08:27:53.358 UTC Error httpconnection.cpp:762: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
30-07-2016 08:27:53.358 UTC Error hssconnection.cpp:149: Failed to get
Authentication Vector for 6505550420 at ims.cl
30-07-2016 08:27:53.359 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 5400ms,
minimum threshold for a change is 1350.000000
30-07-2016 08:27:55.616 UTC Error httpconnection.cpp:762: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
30-07-2016 08:27:55.616 UTC Error hssconnection.cpp:149: Failed to get
Authentication Vector for 6505550186 at ims.cl

************************************************************
**************************************************************

Homer logs :

[homer]root at homer:/var/log/homer# cat homer_20160729T160000Z.txt
29-07-2016 14:09:08.931 UTC INFO base.py:261: Received request from
localhost - PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550201%40ims.cl/simservs.xml
29-07-2016 14:09:08.933 UTC INFO xsd.py:76: Performing XSD validation
29-07-2016 14:09:09.248 UTC INFO base.py:274: Sending 200 response to
localhost for PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550201%40ims.cl/simservs.xml
29-07-2016 14:09:21.152 UTC INFO base.py:261: Received request from
localhost - PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550639%40ims.cl/simservs.xml
29-07-2016 14:09:21.154 UTC INFO xsd.py:76: Performing XSD validation
29-07-2016 14:09:21.162 UTC INFO base.py:274: Sending 200 response to
localhost for PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550639%40ims.cl/simservs.xml
29-07-2016 14:09:26.452 UTC INFO base.py:261: Received request from
localhost - PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550782%40ims.cl/simservs.xml
29-07-2016 14:09:26.452 UTC INFO xsd.py:76: Performing XSD validation
29-07-2016 14:09:26.458 UTC INFO base.py:274: Sending 200 response to
localhost for PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550782%40ims.cl/simservs.xml
29-07-2016 14:09:31.049 UTC INFO base.py:261: Received request from
localhost - PUT
http://http_homer/org.etsi.ngn.simservs/users/sip%3A6505550238%40ims.cl/simservs.xml

************************************************************
**************************************************************

Homestead logs :

[homestead]root at hs:/var/log/homestead# tail -f access_current.txt
30-07-2016 08:31:39.008 UTC 200 GET /impi/6505550516%
40ims.cl/registration-status 0.000078 seconds
30-07-2016 08:31:39.013 UTC 404 GET /impi/6505550516%40ims.cl/av0.001185
seconds
30-07-2016 08:31:39.797 UTC 200 GET /impi/6505550156%
40ims.cl/registration-status 0.000063 seconds
30-07-2016 08:31:39.802 UTC 404 GET /impi/6505550156%40ims.cl/av0.001314
seconds
30-07-2016 08:31:43.599 UTC 200 GET /impi/6505550628%
40ims.cl/registration-status 0.000092 seconds
30-07-2016 08:31:43.603 UTC 200 GET /impi/6505550628%40ims.cl/av0.001139
seconds
30-07-2016 08:31:43.628 UTC 200 GET /impi/6505550628%
40ims.cl/registration-status 0.000056 seconds
30-07-2016 08:31:43.636 UTC 200 PUT
/impu/sip%3A6505550628%40ims.cl/reg-data 0.001479
seconds
30-07-2016 08:31:44.481 UTC 200 GET /impi/6505550670%
40ims.cl/registration-status 0.000097 seconds
30-07-2016 08:31:44.484 UTC 404 GET /impi/6505550670%40ims.cl/av0.001131
seconds
30-07-2016 08:31:44.656 UTC 200 PUT
/impu/sip%3A6505550944%40ims.cl/reg-data 0.001341
seconds
30-07-2016 08:31:45.981 UTC 200 GET /impi/6505550060%
40ims.cl/registration-status 0.000096 seconds
30-07-2016 08:31:45.985 UTC 404 GET /impi/6505550060%40ims.cl/av0.001087
seconds

[homestead]root at hs:/var/log/homestead# tail -f homestead_current.txt
30-07-2016 08:31:17.865 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 21 requests in last 6852ms,
minimum threshold for a change is 2053.612793
30-07-2016 08:31:27.025 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
30-07-2016 08:31:31.596 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 21 requests in last 13732ms,
minimum threshold for a change is 4115.617676
30-07-2016 08:31:36.324 UTC Status alarm.cpp:62: homestead issued 1501.1
alarm
30-07-2016 08:31:39.009 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 21 requests in last 7412ms,
minimum threshold for a change is 2221.450439
30-07-2016 08:31:42.039 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
30-07-2016 08:31:49.028 UTC Status load_monitor.cpp:285: Maximum incoming
request rate/second unchanged - only handled 21 requests in last 10020ms,
minimum threshold for a change is 3003.093994

************************************************************
**************************************************************

Ralf  logs :

[ralf]root at ralf:/var/log/ralf# tail -f access_current.txt
30-07-2016 08:33:04.253 UTC 200 POST
/call-id/6505550206%2F%2F%2F397-6860%40192.168.1.3
0.000102 seconds
30-07-2016 08:33:06.682 UTC 200 POST
/call-id/6505550514%2F%2F%2F243-6860%40192.168.1.3
0.000129 seconds
30-07-2016 08:33:06.786 UTC 200 GET /ping 0.000000 seconds
30-07-2016 08:33:07.288 UTC 200 POST
/call-id/6505550878%2F%2F%2F61-6860%40192.168.1.3
0.000097 seconds
30-07-2016 08:33:08.146 UTC 200 POST
/call-id/6505550172%2F%2F%2F414-6860%40192.168.1.3
0.000158 seconds
30-07-2016 08:33:08.267 UTC 200 POST
/call-id/6505550780%2F%2F%2F110-6860%40192.168.1.3
0.000088 seconds
30-07-2016 08:33:09.995 UTC 200 POST
/call-id/6505550862%2F%2F%2F69-6860%40192.168.1.3
0.000136 seconds
30-07-2016 08:33:11.214 UTC 200 POST
/call-id/6505550192%2F%2F%2F404-6860%40192.168.1.3
0.000113 seconds
30-07-2016 08:33:12.733 UTC 200 POST
/call-id/6505550034%2F%2F%2F483-6860%40192.168.1.3
0.000103 seconds
30-07-2016 08:33:13.037 UTC 200 POST
/call-id/6505550854%2F%2F%2F73-6860%40192.168.1.3
0.000123 seconds
30-07-2016 08:33:14.125 UTC 200 POST
/call-id/6505550758%2F%2F%2F121-6860%40192.168.1.3
0.000134 seconds
30-07-2016 08:33:14.742 UTC 200 POST
/call-id/6505550094%2F%2F%2F453-6860%40192.168.1.3
0.000093 seconds



[ralf]root at ralf:/var/log/ralf# tail -f ralf_current.txt
30-07-2016 08:33:54.508 UTC Error peer_message_sender.cpp:145: Failed to
connect to all CCFs, message not sent
30-07-2016 08:33:54.508 UTC Warning session_manager.cpp:414: Session for
6505550928///36-6860 at 192.168.1.3 received error from CDF
30-07-2016 08:33:55.760 UTC Error diameterstack.cpp:293: Routing error: 'No
remaining suitable candidate to route the message to' for message with
Command-Code 271, Destination-Host  and Destination-Realm ims.cl
30-07-2016 08:33:55.761 UTC Warning peer_message_sender.cpp:125: Failed to
send ACR to  (number 0)
30-07-2016 08:33:55.761 UTC Error peer_message_sender.cpp:145: Failed to
connect to all CCFs, message not sent
30-07-2016 08:33:55.761 UTC Warning session_manager.cpp:414: Session for
6505550162///419-6860 at 192.168.1.3 received error from CDF
30-07-2016 08:33:56.680 UTC Error diameterstack.cpp:293: Routing error: 'No
remaining suitable candidate to route the message to' for message with
Command-Code 271, Destination-Host  and Destination-Realm ims.cl
30-07-2016 08:33:56.681 UTC Warning peer_message_sender.cpp:125: Failed to
send ACR to  (number 0)
30-07-2016 08:33:56.681 UTC Error peer_message_sender.cpp:145: Failed to
connect to all CCFs, message not sent
30-07-2016 08:33:56.681 UTC Warning session_manager.cpp:414: Session for
6505550954///23-6860 at 192.168.1.3 received error from CDF
30-07-2016 08:33:57.543 UTC Error diameterstack.cpp:854: No Diameter peers
have been found

************************************************************
**************************************************************

ELLIS

[ellis]root at ellis:/var/log/ellis# monit summary
Monit 5.18.1 uptime: 21h 36m
 Service Name                      Status                      Type

 node-ellis.ims.cl                Running                     System
 ntp_process                         Running
Process
 nginx_process                    Running                     Process
 mysql_process                    Running                     Process
 ellis_process
 Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 nginx_uptime                     Status ok                   Program
 monit_uptime                     Status ok                   Program
 poll_ellis                       Status ok                   Program
 poll_ellis_https                 Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program

************************************************************
**************************************************************

BONO

[bono]root at bono:/var/log/bono# monit summary
Monit 5.18.1 uptime: 21h 37m
 Service Name                     Status                      Type
 node-bono.ims.cl                 Running                     System
 restund_process                  Running                     Process
 ntp_process                      Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 bono_process                     Running                     Process
 poll_restund                     Status ok                   Program
 monit_uptime                     Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program
 poll_bono                        Status ok                   Program

************************************************************
**************************************************************

SPROUT

[sprout]root at sprout:/var/log/sprout# monit summary
Monit 5.18.1 uptime: 21h 37m
 Service Name                     Status                      Type
 node-sprout.ims.cl               Running                     System
 sprout_process                   Running                     Process
 snmpd_process                    Running                     Process
 ntp_process                      Running                     Process
 memcached_process                Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 chronos_process                  Running                     Process
 astaire_process                  Running                     Process
 sprout_uptime                    Status ok                   Program
 poll_sprout_sip                  Status ok                   Program
 poll_sprout_http                 Status ok                   Program
 monit_uptime                     Status ok                   Program
 memcached_uptime                 Status ok                   Program
 poll_memcached                   Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program
 chronos_uptime                   Status ok                   Program
 poll_chronos                     Status ok                   Program
 astaire_uptime                   Status ok                   Program

************************************************************
**************************************************************

HOMER

[homer]root at homer:/var/log/homer# monit summary
Monit 5.18.1 uptime: 21h 38m
 Service Name                     Status                      Type
 node-homer.ims.cl                Running                     System
 ntp_process                      Running                     Process
 nginx_process                    Running                     Process
 homer_process                    Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 cassandra_process                Running                     Process
 nginx_uptime                     Status ok                   Program
 monit_uptime                     Status ok                   Program
 poll_homer                       Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program
 cassandra_uptime                 Status ok                   Program
 poll_cassandra                   Status ok                   Program

************************************************************
**************************************************************

HOMESTEAD

[homestead]root at hs:/var/log/homestead# monit summary
Monit 5.18.1 uptime: 21h 38m
 Service Name                     Status                      Type
 node-hs.ims.cl                   Running                     System
 ntp_process                      Running                     Process
 nginx_process                    Running                     Process
 homestead_process                Running                     Process
 homestead-prov_process           Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 cassandra_process                Running                     Process
 nginx_uptime                     Status ok                   Program
 monit_uptime                     Status ok                   Program
 homestead_uptime                 Status ok                   Program
 poll_homestead                   Status ok                   Program
 poll_homestead-prov              Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program
 cassandra_uptime                 Status ok                   Program
 poll_cassandra                   Status ok                   Program

************************************************************
**************************************************************

RALF

[ralf]root at ralf:/var/log/ralf# monit summary
Monit 5.18.1 uptime: 21h 38m
 Service Name                     Status                      Type
 node-ralf.ims.cl                 Running                     System
 snmpd_process                    Running                     Process
 ralf_process                     Running                     Process
 ntp_process                      Running                     Process
 memcached_process                Running                     Process
 clearwater_queue_manager_pro...  Running                     Process
 etcd_process                     Running                     Process
 clearwater_diags_monitor_pro...  Running                     Process
 clearwater_config_manager        Running                     Process
 clearwater_cluster_manager       Running                     Process
 chronos_process                  Running                     Process
 astaire_process                  Running                     Process
 poll_ralf                        Status ok                   Program
 monit_uptime                     Status ok                   Program
 memcached_uptime                 Status ok                   Program
 poll_memcached                   Status ok                   Program
 clearwater_queue_manager_uptime  Status ok                   Program
 etcd_uptime                      Status ok                   Program
 poll_etcd_cluster                Status ok                   Program
 poll_etcd                        Status ok                   Program
 chronos_uptime                   Status ok                   Program
 poll_chronos                     Status ok                   Program
 astaire_uptime                   Status ok                   Program
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160730/f9fcf3de/attachment.html>

