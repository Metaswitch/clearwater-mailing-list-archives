From sainath.ellendula at wipro.com  Mon Jan  4 07:07:28 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Mon, 4 Jan 2016 12:07:28 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
Message-ID: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Team,


I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.


Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.


Getting error while configuring X-Lite (503 service unavailable):


Please find the X-Lite Configuration in attached screenshot.


Can anyone please help me here to proceed further.


Thanks in advance!!


Regards,

Sai


The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/01351594/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: xlite_configuration.jpg
Type: image/jpeg
Size: 111763 bytes
Desc: xlite_configuration.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/01351594/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Ellis_signup_phone_numbers.jpg
Type: image/jpeg
Size: 77738 bytes
Desc: Ellis_signup_phone_numbers.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/01351594/attachment-0001.jpg>

From Eleanor.Merry at metaswitch.com  Mon Jan  4 07:52:23 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Mon, 4 Jan 2016 12:52:23 +0000
Subject: [Clearwater] Cannot launch Ellis URL !
In-Reply-To: <CAALtxontDLERB9DcHcc6zh+ioXLFs8CJo9L6veGVhMBR2-LWNg@mail.gmail.com>
References: <CAALtxo=W14m3QtNq4U03u0xeMiA_WoFNaGHPhvkOBS=LORL6EA@mail.gmail.com>
	<CAALtxontDLERB9DcHcc6zh+ioXLFs8CJo9L6veGVhMBR2-LWNg@mail.gmail.com>
Message-ID: <BN3PR02MB1255EA46B953403D16CE5B979BF20@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Indresh,

Which version of the AMI are you using? I?ve just tried with ?Clearwater 2015-12-22? and this has worked.
Is Ellis running on your AMI? Can you please send me the logs from /var/log/ellis?

Ellie

From: indresh singh [mailto:singh.ik at gmail.com]
Sent: 30 December 2015 18:22
To: clearwater at lists.projectclearwater.org
Subject: Fwd: Cannot launch Ellis URL !

Hi,

I am trying out the clearwater IMS and have done an EC-2 installation using the instructions described at ?All-in-one EC2 AMI Installation?. I have successfully connected to the server using ?ubuntu? login.
But when I try to lauch the ?Ellis URL? using http:// http://ec2-52-90-122-124.compute-1.amazonaws.com/ address in chrome browser I get ?This webpage is not available?. Would someone be able to help me understand what is going wrong here.
Best Regards,

Indresh K Singh





--
Indresh K Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/a3e9788c/attachment.html>

From Eleanor.Merry at metaswitch.com  Mon Jan  4 07:54:45 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Mon, 4 Jan 2016 12:54:45 +0000
Subject: [Clearwater] Finding problem in making ellis node up
In-Reply-To: <KL1PR03MB14006B1A6974EC1FB8F3723BF2FE0@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB14009340C5EFFBBFCE47EE21F2090@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251D2FAE77FBB24AE9BCF8F9B090@BLUPR02MB1251.namprd02.prod.outlook.com>
	<KL1PR03MB14005D05A09F392FF39B7A81F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB15636CB50053FFE490417ACE90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400F8711732C88D0C0FE81CF2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563C8FD2C453530EAF705ED90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB140088AC21129EF04D6F5C08F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB15632D5BF84476143C7D92CF90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400986BED6576D83FBE7453F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB15630B46D69BEABC4507B64090E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400C9E9CEC9050DD9E819AFF2FB0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563878539FABEE9709FC42490FB0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB140040ED0144D8291EEB01B9F2FC0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB156376AC7A74F02E6F278E6690FC0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400718AD0034900E019BB04F2FD0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563A4533C20961CFA536A0690FD0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400E69A6015B530F389E11DF2FD0@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB1563D9C36B8025D7F4A2CC6090FE0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB14006B1A6974EC1FB8F3723BF2FE0@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BN3PR02MB12554A4AAEEFAB0C5D9FAA269BF20@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Sai,

I'm back from vacation now, so I've picked this up from Matt.

Running upload_scscf_json won't work if the underlying etcd cluster is unhealthy. Can you please send me new clearwater-etcd logs from your Sprout node (in /var/log/clearwater-etcd and /var/log/clearwater-config-manager)?

Also, can you set the correct date on your VMs? This will make debugging easier.

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com
Sent: 31 December 2015 11:03
To: Matt Williams
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Finding problem in making ellis node up


Hi Matt,



Thanks for your quick response.



I have missed the below while copying config file. Modified the below missing characters and now its running fine.



I was trying to setting up S-CSCF configuration copied the content below into /etc/clearwater/s-cscf.json


{
   "s-cscfs" : [
       {   "server" : "sip:pes.com:5054;transport=TCP",
           "priority" : 0,
           "weight" : 100,
           "capabilities" : [<comma separated capabilities>]
       }
   ]
}


Then I have executed command : sudo /usr/share/clearwater/clearwater-config-manager/scripts/upload_scscf_json getting below error


Upload JSON configuration file failed to http://192.168.56.12:4000/v2/keys/clearwater/site1/configuration/scscf_json
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   469  100    35  100   434      5     72  0:00:07  0:00:06  0:00:01     0
{"message":"Internal Server Error"}root at sprout:/etc/clearwater#



And sometimes when I was connecting to sprout, homer & homestead nodes observed below error then after couple of seconds this error is not observed.

nc: connect to 127.0.0.1 port 9160 (tcp) failed: Connection refused

Failed to connect to '127.0.0.1:7199': Connection refused

TCP poll failed to 127.0.0.1 9160



The current date is showing as December 14 is correct only.. As I forget update the VM timing at the time of installation, With this any issue occur further??



Thanks in advance!!



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Thursday, December 31, 2015 3:20 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for these diagnostics.



monit.log shows that it's killing Sprout (and Memento) because it can't poll it.  The reason it can't poll it is that it can't find the "local_ip" parameter in /etc/clearwater/config.  Double-checking the configuration files you sent me yesterday, /etc/clearwater/config reads:





cal_ip=192.168.56.12

public_ip=192.168.56.12

public_hostname=sprout

etcd_cluster="192.168.56.10,192.168.56.11,192.168.56.12,192.168.56.13,192.168.56.14,192.168.56.15"



So it looks as though you've lost the first two characters of "local_ip".  Please can you fix this up and double-check all the configuration files?  (It's really important that all the configuration files are intact.)  I've raised an issue (https://github.com/Metaswitch/clearwater-infrastructure/issues/282) to consider whether we should do more up-front configuration checking to pick up this kind of misconfiguration earlier.



Looking at the clearwater-etcd.log file, we see it complaining that 2 URLs don't match because one does not contain a hostname/IP address.  This is also because the local_ip isn't set.  I'm not completely sure that fixing this will fix etcd, but it's worth fixing the local_ip issue and then seeing if the etcd problem goes away.



BTW, it looks as though your Sprout node isn't synchronized to NTP.  (There are logs in syslog about "ntpd_intres[4985]: host name not found: 0.ubuntu.pool.ntp.org".)  This isn't a problem at this stage, but it makes reading the diagnostics a bit difficult - the sprout VM thinks the current date is December 14!  Please can you take a look?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 30 December 2015 12:53
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response.



1) Yes, Sprout's public_hostname is set to sprout and it got resolved locally. Please find the attachment of  /var/log/sprout/sprout_current.txt.

2) In Shared_config xdms variable is now changed to homer.pes.com

3) I have assigned 2GB RAM for sprout node, As i did for Homer & Homestead. Please find attachment of /var/log/syslog and /var/log/monit.log.

4) Please find attachment of etcd logs /var/log/clearwater-etcd/clearwater-etcd.log.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 30 December 2015 16:27
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.



Please can you check your configuration?

*         Sprout's public_hostname is now set to "sprout".  Please can you confirm that this resolves locally?  Check /var/log/sprout/sprout_current.txt for the "Failed to decode IP address" log we saw before.  If this does resolve locally, please share /var/log/sprout/sprout_current.txt.

*         I notice that /etc/clearwater/shared_config's xdms_hostname variable is set to homer.pes, not homer.pes.com - that won't be the problem, but please can you fix it?

*         Memento isn't starting because Cassandra isn't running (or at least not running stably).

*         It looks as though Cassandra is cyclically restarting in the same way that we saw on the Homestead and Homer nodes.  Please can you check that your Sprout node has enough RAM too?  (If it does have enough RAM, it's possible that something else is causing it to restart - in this case, sharing /var/log/syslog and /var/log/monit.log would help.)

*         For some reason, etcd is not running.  Please can you share /var/log/clearwater-etcd/clearwater-etcd.log.*?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 30 December 2015 10:32
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response..



Now i am facing problem to make sprout node UP.



Pls find the output of monit summary below:



root at sprout:/var/log/cassandra# monit summary

The Monit daemon 5.8.1 uptime: 20m



Process 'sprout_process'            Does not exist

Program 'poll_sprout_sip'           Initializing

Program 'poll_sprout_http'          Initializing

Process 'snmpd_process'             Running

Process 'ntp_process'               Running

System 'node-sprout'                Running

Process 'nginx_process'             Running

Process 'memento_process'           Does not exist

Program 'poll_memento'              Initializing

Program 'poll_memento_https'        Initializing

Process 'memcached_process'         Does not exist

Program 'poll_memcached'            Initializing

Process 'etcd_process'              Does not exist

Program 'poll_etcd_cluster'         Not monitored

Program 'poll_etcd'                 Not monitored

Process 'clearwater_diags_monitor_process' Running

Process 'clearwater_config_manager' Running

Process 'clearwater_cluster_manager' Running

Process 'cassandra_process'         Running

Program 'poll_cassandra'            Status ok

Process 'chronos_process'           Running

Program 'poll_chronos'              Status ok

Process 'astaire_process'           Running

root at sprout:/var/log/cassandra#





Please find attachment of /etc/clearwater/ , memcached.log , chronos_current.txt , memento_current.txt & cassandra log.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 29 December 2015 15:24
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for these diagnostics.



The key Sprout log (from /var/log/sprout/sprout_current.txt) is:



12-12-2015 17:35:44.664 UTC Error stack.cpp:222: Failed to decode IP address L-185000474 (gethostbyname() has returned error (PJ_ERESOLVE))

12-12-2015 17:35:44.665 UTC Error pjsip: Assert failed: stack.cpp:739 status == 0



Basically, this is saying that it's trying to resolve the "public_hostname" configuration option (which is set to "L-185000474").  As Ellie observed below, this looks odd (and the trace shows that it can't be resolved).  Please can you check and correct this configuration?  It must be resolvable by Sprout itself.



For Cassandra, the issue is that the OOM (out-of-memory) killer is killing the Cassandra process because it's taking up too much memory.  We can see this from /var/log/syslog:



Dec 11 23:13:21 sprout kernel: [   63.260285] clearwater-etcd invoked oom-killer: gfp_mask=0x200da, order=0, oom_score_adj=0

Dec 11 23:13:21 sprout kernel: [   63.260290] clearwater-etcd cpuset=/ mems_allowed=0

Dec 11 23:13:21 sprout kernel: [   63.260297] CPU: 0 PID: 2602 Comm: clearwater-etcd Not tainted 3.16.0-30-generic #40~14.04.1-Ubuntu

...

Dec 11 23:13:21 sprout kernel: [   63.260769] Out of memory: Kill process 2230 (java) score 351 or sacrifice child

Dec 11 23:13:21 sprout kernel: [   63.260824] Killed process 2230 (java) total-vm:820580kB, anon-rss:337096kB, file-rss:16952kB



To run cleanly, Clearwater nodes need ~2 GB RAM (http://clearwater.readthedocs.org/en/stable/Manual_Install/ says "EC2 t2.small", which I will clarify).  The meminfo.txt file in the diagnostics bundle suggests that you're running on a VM with 0.5 GB RAM + 0.5 GB swap.  Please can you increase the RAM available to this VM?

Manual Install - Clearwater Docs Home<http://clearwater.readthedocs.org/en/stable/Manual_Install/>

clearwater.readthedocs.org

Manual Install Instructions. These instructions will take you through installing a minimal Clearwater system using the latest binary packages provided by the ...






Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 29 December 2015 05:56
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Please find the attachment of diagnostics, sprout_current.txt & cassandra logs.



Yes, I have installed memento application server from path http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 28 December 2015 16:14
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.  Please can you share the diagnostics?



For Sprout, please can you gather /var/log/sprout/sprout_current.txt?



For Homer and Homestead, I suspect that Cassandra is the root cause.  Please can you gather the contents of /var/log/cassandra?



Also, you say that Cassandra is not coming up on Sprout.  Is that correct?  Unless you've also installed Memento (https://github.com/Metaswitch/memento), Sprout shouldn't be running Cassandra - please can you confirm?





Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 28 December 2015 07:07
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response.



I have updated below changes to Ellis as well to all nodes.



Facing another issue in Sprout, Homer & homestead process. As sprout_process, Homer_process, Homestead_process as well as cassandra process for all three nodes are not coming UP.



Followed steps from http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html



Configuration done same as Ellis and Bono.



Could you please guide me how to proceed further.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 23 December 2015 19:45
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.



Yes, you're correct that you shouldn't need to set up /etc/clearwater/config - it should automatically be created to be:



if [ -f /etc/clearwater/shared_config ]

then

  . /etc/clearwater/shared_config

fi



. /etc/clearwater/local_config



if [ -f /etc/clearwater/user_settings ]

then

  . /etc/clearwater/user_settings

fi



However, on your system, the /etc/clearwater/config file is instead an exact copy of /etc/clearwater/shared_config.



Is it possible that you accidentally copied /etc/clearwater/shared_config over /etc/clearwater/config at some point?  If not, maybe there's a bug in Clearwater in which shared_config can be copied over config (although I haven't seen this happen before)?



Please can you try fixing this by replacing your /etc/clearwater/config file with the content above?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 13:56
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Matt,



I have followed process to install and configuration from below path



http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html  and I could not find anywhere about config file

Manual Install - Clearwater Docs Home<http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html>

clearwater.readthedocs.org

Manual Install Instructions. These instructions will take you through installing a minimal Clearwater system using the latest binary packages provided by the ...


/etc/clearwater/config for configuration.



Process followed for configuration:

On each machine create the file /etc/clearwater/local_config

Log onto any node in the deployment and create the file /etc/clearwater/shared_config



Please correct me if I am wrong and guide me how to proceed further.



Thanks in advance!!



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Wednesday, December 23, 2015 7:09 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for sharing this.



I think the issue is that your /etc/clearwater/config file is a direct copy of your /etc/clearwater/shared_config file.  The /etc/clearwater/config file is automatically created as part of installing the clearwater-infrastructure package (which all Clearwater components depend on), and includes the /etc/clearwater/local_config and /etc/clearwater/shared_config files.



/etc/clearwater/config should read:



if [ -f /etc/clearwater/shared_config ]

then

  . /etc/clearwater/shared_config

fi



. /etc/clearwater/local_config



if [ -f /etc/clearwater/user_settings ]

then

  . /etc/clearwater/user_settings

fi



Please can you correct it on the ellis node, and check that it's correct on all your other nodes too?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 13:06
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Please find the attachment of /etc/clearwater directory.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 23 December 2015 16:36
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your fast response.  Would you be able to tar up your /etc/clearwater directory and send to me to check the configuration?



Please run "tar zcf etc.clearwater.tar.gz /etc/clearwater" and send me the resulting etc.clearwater.tar.gz file.



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 10:29
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Matt,



Yes Configuration is written to /etc/clearwater/local_config not /etc/clearwater/local_configuration



Merry Christmas in advance :)



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Wednesday, December 23, 2015 3:48 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Ellie is on vacation, so I've picked this up.



Well spotted on the clearwater-etcdctl issue - that could easily be the root cause of all the issues you're seeing.



clearwater-etcdctl only gives the "Could not determine local IP address" if it can't find local_ip in /etc/clearwater/local_config.  As Ellie observed below, it looks like you might have written your local configuration to /etc/clearwater/local_configuration rather than /etc/clearwater/local_config.



Please can you confirm that your configuration is written to /etc/clearwater/local_config and not /etc/clearwater/local_configuration?



Also, it looks as though you might not be subscribed to the mailing list (meaning that you might not see all responses to your question) - you can subscribe at http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org.



Thanks,



Matt





--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 23 December 2015 06:21
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Finding problem in making ellis node up



Hi Ellie,



Yes, I have added shared configuration file to Ellis.



In /etc/clearwater/local_config --> etcd_cluster given as IP's of all other nodes(bono,sprout, homer,homestead & ralf) including Ellis as well.



When i entered command cluster-health & etcdctl member list getting below error:



root at ellis:/etc/clearwater# sudo clearwater-etcdctl cluster-health

Could not determine local IP address

root at ellis:/etc/clearwater# sudo clearwater-etcdctl member list

Could not determine local IP address

root at ellis:/etc/clearwater#



Coming to public hostname given as system's  hostname.



After i was trying to send logs, ellis Logs are not generating in path (in /var/log/ellis), Even after keeping "To turn on debug logging for Ellis, write LOG_LEVEL

= logging.DEBUG to the local_settings.py file (at /usr/share/clearwater/ellis/local_settings.py)."



Could you please guide me, am i following correct process.



Thanks in advance!!



Regards,

Sai



________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 07 December 2015 23:11
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Sainath,



Have you added the shared configuration file to Ellis yet? Ellis needs this in order to run successfully (but not to install).



Also, how have you set up the etcd cluster on each node? Looking at the etcd_cluster below you don't have the Ellis node being part of the initial etcd cluster. On the initial install your etcd cluster value should be identical on each node (i.e. the etcd_cluster should contain the IP addresses of every initial node). What's the output of running "sudo clearwater-etcdctl cluster-health" and "sudo clearwater-etcdctl member list"?



In the details below you've put the config as being in "/etc/clearwater/local_configuration" - it needs to be in "/etc/clearwater/local_config.



Also, the public hostname looks like it's 'L-185000474', which doesn't look correct at all. Has this just been mangled by the mailing list?



Finally, if none of the above helps can you please send me the Ellis logs (in /var/log/ellis)?



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 07 December 2015 10:47
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Reg: Finding problem in making ellis node up



Hi Ellie,



I have followed all the steps and installed Ellis successfully.



Steps followed for installation from below path :



http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html



Configuration: /etc/clearwater/local_configuration



local_ip=192.168.56.10

public_ip=10.156.60.190

public_hostname=L-185000474

etcd_cluster="192.168.56.11,192.168.56.12,192.168.56.13,192.168.56.14,192.168.56.15"



hosts: cd /etc/hosts



127.0.0.1       localhost

#127.0.1.1       ellis

192.168.56.10   ellis



# The following lines are desirable for IPv6 capable hosts

::1     localhost ip6-localhost ip6-loopback

ff02::1 ip6-allnodes

ff02::2 ip6-allrouters



After successful installation, Still Specific node "Ellis" is not coming UP.



Command : Monit status, Pls find attachment for ellis process.



Please guide me here, Am i following  correct process.



Thanks in advance!!



Regards,

Sainath









The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/42359737/attachment.html>

From Eleanor.Merry at metaswitch.com  Mon Jan  4 07:55:19 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Mon, 4 Jan 2016 12:55:19 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Sai,

You can use Ellis for this. If you go to the Dashboard in Ellis, you'll see something like the following for each number:

Private Identity:
6505550848 at example.com<mailto:6505550848 at example.com>
Password: Not available

The password is only shown once (as it is stored securely). To generate a new password, click the reset button.

Also, I notice that you've set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone


Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai


The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/7a7e9314/attachment.html>

From sainath.ellendula at wipro.com  Mon Jan  4 08:53:19 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Mon, 4 Jan 2016 13:53:19 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Dashboard in Ellis, I did not see anything expect "Add private identity". Where exactly reset button can find?


I have tried in different browser to see any changes but it did not worked.


Please find the attached screenshot.


Thanks in advance!!


Regards,

Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 04 January 2016 18:25
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Configuration issue in x-lite softphone


Hi Sai,



You can use Ellis for this. If you go to the Dashboard in Ellis, you'll see something like the following for each number:



Private Identity:

6505550848 at example.com<mailto:6505550848 at example.com>

Password: Not available



The password is only shown once (as it is stored securely). To generate a new password, click the reset button.



Also, I notice that you've set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone



Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/1d913b3a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Ellis_dashboard.png
Type: image/png
Size: 58224 bytes
Desc: Ellis_dashboard.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/1d913b3a/attachment.png>

From Eleanor.Merry at metaswitch.com  Mon Jan  4 09:08:21 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Mon, 4 Jan 2016 14:08:21 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BN3PR02MB12551990DA68F52460006CE79BF20@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Sai,

Are you using a HSS? If so you'll need to get the password from the HSS (and how to find the password will depend on what HSS you're using).

If you're not using a HSS, then how many Ellis users do you have? It looks like the 'sainath' user has created three subscribers (6505550073, 6505550473 and 6505550698). Only the 'sainath' user will see these users on the dashboard. If you don't have the log in details for the 'sainath' user anymore then you can just create a new subscriber with your current log-in (the 'create' button in the add a new private identity section on the dashboard).

Ellie

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 04 January 2016 13:53
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Re: Configuration issue in x-lite softphone


Hi Ellie,



Dashboard in Ellis, I did not see anything expect "Add private identity". Where exactly reset button can find?



I have tried in different browser to see any changes but it did not worked.



Please find the attached screenshot.



Thanks in advance!!



Regards,

Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 18:25
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone


Hi Sai,



You can use Ellis for this. If you go to the Dashboard in Ellis, you'll see something like the following for each number:



Private Identity:

6505550848 at example.com<mailto:6505550848 at example.com>

Password: Not available



The password is only shown once (as it is stored securely). To generate a new password, click the reset button.



Also, I notice that you've set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone



Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/b510c9f5/attachment.html>

From sainath.ellendula at wipro.com  Mon Jan  4 09:21:36 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Mon, 4 Jan 2016 14:21:36 +0000
Subject: [Clearwater] Finding problem in making ellis node up
In-Reply-To: <BN3PR02MB12554A4AAEEFAB0C5D9FAA269BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB14009340C5EFFBBFCE47EE21F2090@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251D2FAE77FBB24AE9BCF8F9B090@BLUPR02MB1251.namprd02.prod.outlook.com>
	<KL1PR03MB14005D05A09F392FF39B7A81F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB15636CB50053FFE490417ACE90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400F8711732C88D0C0FE81CF2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563C8FD2C453530EAF705ED90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB140088AC21129EF04D6F5C08F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB15632D5BF84476143C7D92CF90E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400986BED6576D83FBE7453F2E60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB15630B46D69BEABC4507B64090E60@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400C9E9CEC9050DD9E819AFF2FB0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563878539FABEE9709FC42490FB0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB140040ED0144D8291EEB01B9F2FC0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB156376AC7A74F02E6F278E6690FC0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400718AD0034900E019BB04F2FD0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<CY1PR0201MB1563A4533C20961CFA536A0690FD0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB1400E69A6015B530F389E11DF2FD0@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<CY1PR0201MB1563D9C36B8025D7F4A2CC6090FE0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<KL1PR03MB14006B1A6974EC1FB8F3723BF2FE0@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB12554A4AAEEFAB0C5D9FAA269BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB1400BD916C4F664F551D442CF2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Please find the attachment of clearwater-etcd logs from Sprout node (in /var/log/clearwater-etcd and /var/log/clearwater-config-manager)


Thanks in advance!!


Regards,

Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 04 January 2016 18:24
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: clearwater at lists.projectclearwater.org
Subject: RE: Finding problem in making ellis node up


Hi Sai,



I?m back from vacation now, so I?ve picked this up from Matt.



Running upload_scscf_json won?t work if the underlying etcd cluster is unhealthy. Can you please send me new clearwater-etcd logs from your Sprout node (in /var/log/clearwater-etcd and /var/log/clearwater-config-manager)?



Also, can you set the correct date on your VMs? This will make debugging easier.



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com
Sent: 31 December 2015 11:03
To: Matt Williams
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Finding problem in making ellis node up



Hi Matt,



Thanks for your quick response.



I have missed the below while copying config file. Modified the below missing characters and now its running fine.



I was trying to setting up S-CSCF configuration copied the content below into /etc/clearwater/s-cscf.json



{

   "s-cscfs" : [

       {   "server" : "sip:pes.com:5054;transport=TCP",

           "priority" : 0,

           "weight" : 100,

           "capabilities" : [<comma separated capabilities>]

       }

   ]

}



Then I have executed command : sudo /usr/share/clearwater/clearwater-config-manager/scripts/upload_scscf_json getting below error



Upload JSON configuration file failed to http://192.168.56.12:4000/v2/keys/clearwater/site1/configuration/scscf_json

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current

                                 Dload  Upload   Total   Spent    Left  Speed

100   469  100    35  100   434      5     72  0:00:07  0:00:06  0:00:01     0

{"message":"Internal Server Error"}root at sprout:/etc/clearwater#



And sometimes when I was connecting to sprout, homer & homestead nodes observed below error then after couple of seconds this error is not observed.

nc: connect to 127.0.0.1 port 9160 (tcp) failed: Connection refused

Failed to connect to '127.0.0.1:7199': Connection refused

TCP poll failed to 127.0.0.1 9160



The current date is showing as December 14 is correct only.. As I forget update the VM timing at the time of installation, With this any issue occur further??



Thanks in advance!!



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Thursday, December 31, 2015 3:20 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for these diagnostics.



monit.log shows that it's killing Sprout (and Memento) because it can't poll it.  The reason it can't poll it is that it can't find the "local_ip" parameter in /etc/clearwater/config.  Double-checking the configuration files you sent me yesterday, /etc/clearwater/config reads:





cal_ip=192.168.56.12

public_ip=192.168.56.12

public_hostname=sprout

etcd_cluster="192.168.56.10,192.168.56.11,192.168.56.12,192.168.56.13,192.168.56.14,192.168.56.15"



So it looks as though you've lost the first two characters of "local_ip".  Please can you fix this up and double-check all the configuration files?  (It's really important that all the configuration files are intact.)  I've raised an issue (https://github.com/Metaswitch/clearwater-infrastructure/issues/282) to consider whether we should do more up-front configuration checking to pick up this kind of misconfiguration earlier.



Looking at the clearwater-etcd.log file, we see it complaining that 2 URLs don't match because one does not contain a hostname/IP address.  This is also because the local_ip isn't set.  I'm not completely sure that fixing this will fix etcd, but it's worth fixing the local_ip issue and then seeing if the etcd problem goes away.



BTW, it looks as though your Sprout node isn't synchronized to NTP.  (There are logs in syslog about "ntpd_intres[4985]: host name not found: 0.ubuntu.pool.ntp.org".)  This isn't a problem at this stage, but it makes reading the diagnostics a bit difficult - the sprout VM thinks the current date is December 14!  Please can you take a look?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 30 December 2015 12:53
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response.



1) Yes, Sprout's public_hostname is set to sprout and it got resolved locally. Please find the attachment of  /var/log/sprout/sprout_current.txt.

2) In Shared_config xdms variable is now changed to homer.pes.com

3) I have assigned 2GB RAM for sprout node, As i did for Homer & Homestead. Please find attachment of /var/log/syslog and /var/log/monit.log.

4) Please find attachment of etcd logs /var/log/clearwater-etcd/clearwater-etcd.log.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 30 December 2015 16:27
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.



Please can you check your configuration?

?         Sprout's public_hostname is now set to "sprout".  Please can you confirm that this resolves locally?  Check /var/log/sprout/sprout_current.txt for the "Failed to decode IP address" log we saw before.  If this does resolve locally, please share /var/log/sprout/sprout_current.txt.

?         I notice that /etc/clearwater/shared_config's xdms_hostname variable is set to homer.pes, not homer.pes.com - that won't be the problem, but please can you fix it?

?         Memento isn't starting because Cassandra isn't running (or at least not running stably).

?         It looks as though Cassandra is cyclically restarting in the same way that we saw on the Homestead and Homer nodes.  Please can you check that your Sprout node has enough RAM too?  (If it does have enough RAM, it's possible that something else is causing it to restart - in this case, sharing /var/log/syslog and /var/log/monit.log would help.)

?         For some reason, etcd is not running.  Please can you share /var/log/clearwater-etcd/clearwater-etcd.log.*?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 30 December 2015 10:32
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response..



Now i am facing problem to make sprout node UP.



Pls find the output of monit summary below:



root at sprout:/var/log/cassandra# monit summary

The Monit daemon 5.8.1 uptime: 20m



Process 'sprout_process'            Does not exist

Program 'poll_sprout_sip'           Initializing

Program 'poll_sprout_http'          Initializing

Process 'snmpd_process'             Running

Process 'ntp_process'               Running

System 'node-sprout'                Running

Process 'nginx_process'             Running

Process 'memento_process'           Does not exist

Program 'poll_memento'              Initializing

Program 'poll_memento_https'        Initializing

Process 'memcached_process'         Does not exist

Program 'poll_memcached'            Initializing

Process 'etcd_process'              Does not exist

Program 'poll_etcd_cluster'         Not monitored

Program 'poll_etcd'                 Not monitored

Process 'clearwater_diags_monitor_process' Running

Process 'clearwater_config_manager' Running

Process 'clearwater_cluster_manager' Running

Process 'cassandra_process'         Running

Program 'poll_cassandra'            Status ok

Process 'chronos_process'           Running

Program 'poll_chronos'              Status ok

Process 'astaire_process'           Running

root at sprout:/var/log/cassandra#





Please find attachment of /etc/clearwater/ , memcached.log , chronos_current.txt , memento_current.txt & cassandra log.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 29 December 2015 15:24
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for these diagnostics.



The key Sprout log (from /var/log/sprout/sprout_current.txt) is:



12-12-2015 17:35:44.664 UTC Error stack.cpp:222: Failed to decode IP address L-185000474 (gethostbyname() has returned error (PJ_ERESOLVE))

12-12-2015 17:35:44.665 UTC Error pjsip: Assert failed: stack.cpp:739 status == 0



Basically, this is saying that it's trying to resolve the "public_hostname" configuration option (which is set to "L-185000474").  As Ellie observed below, this looks odd (and the trace shows that it can't be resolved).  Please can you check and correct this configuration?  It must be resolvable by Sprout itself.



For Cassandra, the issue is that the OOM (out-of-memory) killer is killing the Cassandra process because it's taking up too much memory.  We can see this from /var/log/syslog:



Dec 11 23:13:21 sprout kernel: [   63.260285] clearwater-etcd invoked oom-killer: gfp_mask=0x200da, order=0, oom_score_adj=0

Dec 11 23:13:21 sprout kernel: [   63.260290] clearwater-etcd cpuset=/ mems_allowed=0

Dec 11 23:13:21 sprout kernel: [   63.260297] CPU: 0 PID: 2602 Comm: clearwater-etcd Not tainted 3.16.0-30-generic #40~14.04.1-Ubuntu

...

Dec 11 23:13:21 sprout kernel: [   63.260769] Out of memory: Kill process 2230 (java) score 351 or sacrifice child

Dec 11 23:13:21 sprout kernel: [   63.260824] Killed process 2230 (java) total-vm:820580kB, anon-rss:337096kB, file-rss:16952kB



To run cleanly, Clearwater nodes need ~2 GB RAM (http://clearwater.readthedocs.org/en/stable/Manual_Install/ says "EC2 t2.small", which I will clarify).  The meminfo.txt file in the diagnostics bundle suggests that you're running on a VM with 0.5 GB RAM + 0.5 GB swap.  Please can you increase the RAM available to this VM?

Manual Install - Clearwater Docs Home<http://clearwater.readthedocs.org/en/stable/Manual_Install/>

clearwater.readthedocs.org

Manual Install Instructions. These instructions will take you through installing a minimal Clearwater system using the latest binary packages provided by the ...






Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 29 December 2015 05:56
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Please find the attachment of diagnostics, sprout_current.txt & cassandra logs.



Yes, I have installed memento application server from path http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 28 December 2015 16:14
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.  Please can you share the diagnostics?



For Sprout, please can you gather /var/log/sprout/sprout_current.txt?



For Homer and Homestead, I suspect that Cassandra is the root cause.  Please can you gather the contents of /var/log/cassandra?



Also, you say that Cassandra is not coming up on Sprout.  Is that correct?  Unless you've also installed Memento (https://github.com/Metaswitch/memento), Sprout shouldn't be running Cassandra - please can you confirm?





Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 28 December 2015 07:07
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Thanks for your response.



I have updated below changes to Ellis as well to all nodes.



Facing another issue in Sprout, Homer & homestead process. As sprout_process, Homer_process, Homestead_process as well as cassandra process for all three nodes are not coming UP.



Followed steps from http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html



Configuration done same as Ellis and Bono.



Could you please guide me how to proceed further.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 23 December 2015 19:45
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your email.



Yes, you're correct that you shouldn't need to set up /etc/clearwater/config - it should automatically be created to be:



if [ -f /etc/clearwater/shared_config ]

then

  . /etc/clearwater/shared_config

fi



. /etc/clearwater/local_config



if [ -f /etc/clearwater/user_settings ]

then

  . /etc/clearwater/user_settings

fi



However, on your system, the /etc/clearwater/config file is instead an exact copy of /etc/clearwater/shared_config.



Is it possible that you accidentally copied /etc/clearwater/shared_config over /etc/clearwater/config at some point?  If not, maybe there's a bug in Clearwater in which shared_config can be copied over config (although I haven't seen this happen before)?



Please can you try fixing this by replacing your /etc/clearwater/config file with the content above?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 13:56
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Matt,



I have followed process to install and configuration from below path



http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html  and I could not find anywhere about config file

Manual Install - Clearwater Docs Home<http://clearwater.readthedocs.org/en/latest/Manual_Install/index.html>

clearwater.readthedocs.org

Manual Install Instructions. These instructions will take you through installing a minimal Clearwater system using the latest binary packages provided by the ...


/etc/clearwater/config for configuration.



Process followed for configuration:

On each machine create the file /etc/clearwater/local_config

Log onto any node in the deployment and create the file /etc/clearwater/shared_config



Please correct me if I am wrong and guide me how to proceed further.



Thanks in advance!!



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Wednesday, December 23, 2015 7:09 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for sharing this.



I think the issue is that your /etc/clearwater/config file is a direct copy of your /etc/clearwater/shared_config file.  The /etc/clearwater/config file is automatically created as part of installing the clearwater-infrastructure package (which all Clearwater components depend on), and includes the /etc/clearwater/local_config and /etc/clearwater/shared_config files.



/etc/clearwater/config should read:



if [ -f /etc/clearwater/shared_config ]

then

  . /etc/clearwater/shared_config

fi



. /etc/clearwater/local_config



if [ -f /etc/clearwater/user_settings ]

then

  . /etc/clearwater/user_settings

fi



Please can you correct it on the ellis node, and check that it's correct on all your other nodes too?



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 13:06
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Finding problem in making ellis node up



Hi Matt,



Please find the attachment of /etc/clearwater directory.



Thanks in advance!!



Regards,

Sai



________________________________

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Sent: 23 December 2015 16:36
To: Sainath Ellendula (WT01 - Product Engineering Service)
Cc: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Thanks for your fast response.  Would you be able to tar up your /etc/clearwater directory and send to me to check the configuration?



Please run "tar zcf etc.clearwater.tar.gz /etc/clearwater" and send me the resulting etc.clearwater.tar.gz file.



Thanks,



Matt



--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 23 December 2015 10:29
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Matt,



Yes Configuration is written to /etc/clearwater/local_config not /etc/clearwater/local_configuration



Merry Christmas in advance :)



Regards,

Sai



From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Wednesday, December 23, 2015 3:48 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Sai,



Ellie is on vacation, so I've picked this up.



Well spotted on the clearwater-etcdctl issue - that could easily be the root cause of all the issues you're seeing.



clearwater-etcdctl only gives the "Could not determine local IP address" if it can't find local_ip in /etc/clearwater/local_config.  As Ellie observed below, it looks like you might have written your local configuration to /etc/clearwater/local_configuration rather than /etc/clearwater/local_config.



Please can you confirm that your configuration is written to /etc/clearwater/local_config and not /etc/clearwater/local_configuration?



Also, it looks as though you might not be subscribed to the mailing list (meaning that you might not see all responses to your question) - you can subscribe at http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org.



Thanks,



Matt





--



Matt Williams
Lead Architect, Project Clearwater

+44 (0) 20 8366 1177



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 23 December 2015 06:21
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Finding problem in making ellis node up



Hi Ellie,



Yes, I have added shared configuration file to Ellis.



In /etc/clearwater/local_config --> etcd_cluster given as IP's of all other nodes(bono,sprout, homer,homestead & ralf) including Ellis as well.



When i entered command cluster-health & etcdctl member list getting below error:



root at ellis:/etc/clearwater# sudo clearwater-etcdctl cluster-health

Could not determine local IP address

root at ellis:/etc/clearwater# sudo clearwater-etcdctl member list

Could not determine local IP address

root at ellis:/etc/clearwater#



Coming to public hostname given as system's  hostname.



After i was trying to send logs, ellis Logs are not generating in path (in /var/log/ellis), Even after keeping "To turn on debug logging for Ellis, write LOG_LEVEL

= logging.DEBUG to the local_settings.py file (at /usr/share/clearwater/ellis/local_settings.py)."



Could you please guide me, am i following correct process.



Thanks in advance!!



Regards,

Sai



________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 07 December 2015 23:11
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Finding problem in making ellis node up



Hi Sainath,



Have you added the shared configuration file to Ellis yet? Ellis needs this in order to run successfully (but not to install).



Also, how have you set up the etcd cluster on each node? Looking at the etcd_cluster below you don?t have the Ellis node being part of the initial etcd cluster. On the initial install your etcd cluster value should be identical on each node (i.e. the etcd_cluster should contain the IP addresses of every initial node). What?s the output of running ?sudo clearwater-etcdctl cluster-health? and ?sudo clearwater-etcdctl member list??



In the details below you?ve put the config as being in ?/etc/clearwater/local_configuration? ? it needs to be in ?/etc/clearwater/local_config.



Also, the public hostname looks like it?s ?L-185000474?, which doesn?t look correct at all. Has this just been mangled by the mailing list?



Finally, if none of the above helps can you please send me the Ellis logs (in /var/log/ellis)?



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 07 December 2015 10:47
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Reg: Finding problem in making ellis node up



Hi Ellie,



I have followed all the steps and installed Ellis successfully.



Steps followed for installation from below path :



http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html



Configuration: /etc/clearwater/local_configuration



local_ip=192.168.56.10

public_ip=10.156.60.190

public_hostname=L-185000474

etcd_cluster="192.168.56.11,192.168.56.12,192.168.56.13,192.168.56.14,192.168.56.15"



hosts: cd /etc/hosts



127.0.0.1       localhost

#127.0.1.1       ellis

192.168.56.10   ellis



# The following lines are desirable for IPv6 capable hosts

::1     localhost ip6-localhost ip6-loopback

ff02::1 ip6-allnodes

ff02::2 ip6-allrouters



After successful installation, Still Specific node "Ellis" is not coming UP.



Command : Monit status, Pls find attachment for ellis process.



Please guide me here, Am i following  correct process.



Thanks in advance!!



Regards,

Sainath









The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/c1a242dc/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: config-manager_20160104T190000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/c1a242dc/attachment.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: clearwater-etcd.7z
Type: application/octet-stream
Size: 1716468 bytes
Desc: clearwater-etcd.7z
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160104/c1a242dc/attachment.obj>

From sainath.ellendula at wipro.com  Tue Jan  5 05:41:30 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Tue, 5 Jan 2016 10:41:30 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <BN3PR02MB12551990DA68F52460006CE79BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB12551990DA68F52460006CE79BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB1400E3643067346D364753FAF2F30@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,



Yes,  Even if login with 'sainath' user could not find reset button to set the password.



I have another dought, In /etc/clearwater Shared_config configured as :


# HSS configuration

hss_hostname=hss.pes.com
hss_port=3868

But here i was not installed any external HSS kookups(OpenIMSCore HSS), By default clearwater deployment include homestead(HSS). So it it correct to give  hss_hostname=hss.pes.com or should i need to provide homestead domain(homestead.pes.com)

or

Can we comment the above 2 lines in shared_config??

Could you please guide me here.

Thanks in advance!!

Regards,
Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 04 January 2016 19:38
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Configuration issue in x-lite softphone


Hi Sai,



Are you using a HSS? If so you?ll need to get the password from the HSS (and how to find the password will depend on what HSS you?re using).



If you?re not using a HSS, then how many Ellis users do you have? It looks like the ?sainath? user has created three subscribers (6505550073, 6505550473 and 6505550698). Only the ?sainath? user will see these users on the dashboard. If you don?t have the log in details for the ?sainath? user anymore then you can just create a new subscriber with your current log-in (the ?create? button in the add a new private identity section on the dashboard).



Ellie



From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 04 January 2016 13:53
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Re: Configuration issue in x-lite softphone



Hi Ellie,



Dashboard in Ellis, I did not see anything expect "Add private identity". Where exactly reset button can find?



I have tried in different browser to see any changes but it did not worked.



Please find the attached screenshot.



Thanks in advance!!



Regards,

Sai

________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 18:25
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone



Hi Sai,



You can use Ellis for this. If you go to the Dashboard in Ellis, you?ll see something like the following for each number:



Private Identity:

6505550848 at example.com<mailto:6505550848 at example.com>

Password: Not available



The password is only shown once (as it is stored securely). To generate a new password, click the reset button.



Also, I notice that you?ve set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone



Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160105/d792799b/attachment.html>

From fmalka at modulo.co.il  Tue Jan  5 10:17:36 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Tue, 5 Jan 2016 17:17:36 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>

Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160105/b2628ea9/attachment.html>

From fcosta at daitangroup.com  Wed Jan  6 05:28:50 2016
From: fcosta at daitangroup.com (=?iso-8859-1?Q?Felipe_Miney_Gon=E7alves_da_Costa?=)
Date: Wed, 6 Jan 2016 10:28:50 +0000
Subject: [Clearwater] Sprout WSS support
In-Reply-To: <CO1PR02MB240701E37CD7EF4B2CD90649B900@CO1PR02MB240.namprd02.prod.outlook.com>
References: <CP1PR80MB1678A7B07E0EC65F202307BD1910@CP1PR80MB167.lamprd80.prod.outlook.com>,
	<CO1PR02MB240701E37CD7EF4B2CD90649B900@CO1PR02MB240.namprd02.prod.outlook.com>
Message-ID: <CP1PR80MB1141E2EA7E996B78EA8F0C85D1F40@CP1PR80MB1141.lamprd80.prod.outlook.com>

Hi Ellie,


 I finally got to look into wss support, and will work on adding this to Sprout.


 Do you think wss support would be a global configuration parameter (deciding at launch time if websockets will be secure), or is there a way to make this "client based"?

 Also, please share with me whatever the team has already thought about this wss support, to ensure I take it into consideration.


 Thanks,


 Felipe


________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: Thursday, July 9, 2015 1:42 PM
To: Felipe Miney Gon?alves da Costa; clearwater at lists.projectclearwater.org
Subject: RE: Sprout WSS support


Hi Felipe,



Clearwater doesn't implement this, and we're not currently working on supporting secure websockets.



Do you have a particular need/timeframe for this function? Would you like to contribute to Clearwater by helping to add the support for this?



Ellie



From: clearwater-bounces at lists.projectclearwater.org [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Felipe Miney Gon?alves da Costa
Sent: 08 July 2015 20:52
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Sprout WSS support



 Hi,



 I found some threads in the mailing list regarding support for secure websockets, but in the end it was not clear if clearwater already implements this. If not, how far is this feature down the roadmap?



 Thanks



 Felipe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/34ee397f/attachment.html>

From fmalka at modulo.co.il  Wed Jan  6 06:07:00 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Wed, 6 Jan 2016 13:07:00 +0200
Subject: [Clearwater] mmtel conference on 3rd party applications
Message-ID: <7e73f78642ec1d60d7d5cd3598549c01@mail.gmail.com>

Hello,



Is there any documentation on configuring the S-CSCF to return the mmtel
conference focus id upon a specific conference factory URI?



*Franck Malka*

[image: cid:image003.jpg at 01CFF8F3.C92A2EC0]
<http://www.facebook.com/modulocs>[image:
cid:image004.jpg at 01CFF8F3.C92A2EC0] <http://www.twitter.com/modulocs>[image:
cid:image005.jpg at 01CFF8F3.C92A2EC0]
<http://www.linkedin.com/company/modulo-communications-systems-ltd.>





Mobile   +972 54 488 9090

Tel        +972 72 274 4002
Fax       +972   3 774 1114

Skype   franck.malka





http://www.modulo.co.il/

14 Imber St. Kyriat Arie,

PO Box 4098,

Petah Tikva 49514

[image: cid:image002.jpg at 01CFF8F3.C92A2EC0]



[image: cid:image007.png at 01CFF8F3.C92A2EC0]

NOTE: The contents of this email and any attachments are confidential. They
are intended for the named recipient(s) only. If you have received this
email in error, please notify the system manager or the sender immediately
and do not disclose the contents to anyone or make copies thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 856 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 827 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 861 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.jpg
Type: image/jpeg
Size: 3786 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 877 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/2b707c1f/attachment.png>

From sainath.ellendula at wipro.com  Wed Jan  6 06:10:05 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Wed, 6 Jan 2016 11:10:05 +0000
Subject: [Clearwater] Issue with ellis
Message-ID: <KL1PR03MB140043A4085785F11A540ECDF2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi,

I have installed Clearwater manually and all VMs are running including Cassandra process.

I have created a user in "Ellis" and I could able to sign up.

First time when I have created number but did not displayed password. Is there any other way to see the password in any of the path in Ellis machine. As I am not even getting a reset button to reset the password.


When I logged in, and created a new entry as internal. And getting a pop-up saying that "Failed to update the server (see detailed diagnostics in developer
console). Please refresh the page. "

Can anyone guide me.

Regards,
Sainath




The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/6b8908fc/attachment.html>

From Eleanor.Merry at metaswitch.com  Wed Jan  6 07:06:56 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Wed, 6 Jan 2016 12:06:56 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <KL1PR03MB1400E3643067346D364753FAF2F30@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB12551990DA68F52460006CE79BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB1400E3643067346D364753FAF2F30@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BN3PR02MB12550309C3244CA3BA0B3FDA9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Sai,

Using Ellis and using an external HSS are mutually exclusive.

If you want to use a HSS, you first need to install a HSS (e.g. OpenIMSCore HSS - see http://clearwater.readthedocs.org/en/latest/External_HSS_Integration/index.html and http://clearwater.readthedocs.org/en/latest/OpenIMSCore_HSS_Integration/index.html for guidance).
If you don't want to use a HSS, then you don't want to set any of the hss_* parameters in the shared_config. Please can you delete these from the shared_config.

For the Ellis issue, can you please send me what Ellis users/subscribers there are? You can get this by running 'sudo mysql', 'use ellis;' and then 'select * from users;' and 'select * from numbers;'

Ellie

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 05 January 2016 10:42
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Re: Configuration issue in x-lite softphone


Hi Ellie,



Yes,  Even if login with 'sainath' user could not find reset button to set the password.



I have another dought, In /etc/clearwater Shared_config configured as :



# HSS configuration
hss_hostname=hss.pes.com
hss_port=3868

But here i was not installed any external HSS kookups(OpenIMSCore HSS), By default clearwater deployment include homestead(HSS). So it it correct to give  hss_hostname=hss.pes.com or should i need to provide homestead domain(homestead.pes.com)

or

Can we comment the above 2 lines in shared_config??

Could you please guide me here.

Thanks in advance!!

Regards,
Sai
________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 19:38
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone


Hi Sai,



Are you using a HSS? If so you'll need to get the password from the HSS (and how to find the password will depend on what HSS you're using).



If you're not using a HSS, then how many Ellis users do you have? It looks like the 'sainath' user has created three subscribers (6505550073, 6505550473 and 6505550698). Only the 'sainath' user will see these users on the dashboard. If you don't have the log in details for the 'sainath' user anymore then you can just create a new subscriber with your current log-in (the 'create' button in the add a new private identity section on the dashboard).



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 04 January 2016 13:53
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Configuration issue in x-lite softphone



Hi Ellie,



Dashboard in Ellis, I did not see anything expect "Add private identity". Where exactly reset button can find?



I have tried in different browser to see any changes but it did not worked.



Please find the attached screenshot.



Thanks in advance!!



Regards,

Sai

________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 18:25
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone



Hi Sai,



You can use Ellis for this. If you go to the Dashboard in Ellis, you'll see something like the following for each number:



Private Identity:

6505550848 at example.com<mailto:6505550848 at example.com>

Password: Not available



The password is only shown once (as it is stored securely). To generate a new password, click the reset button.



Also, I notice that you've set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone



Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0efd8647/attachment.html>

From Eleanor.Merry at metaswitch.com  Wed Jan  6 07:24:12 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Wed, 6 Jan 2016 12:24:12 +0000
Subject: [Clearwater] Issue with ellis
In-Reply-To: <KL1PR03MB140043A4085785F11A540ECDF2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB140043A4085785F11A540ECDF2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BN3PR02MB1255049DDF6CE8D13F5997F99BF40@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Sai,

Can you please send me the Ellis logs when you try and create a subscriber? These are in /var/log/ellis/.
Can you also send me a screenshot of the dashboard page (when you're logged in as the user that is creating subscribers)?

Thanks,

Ellie

PS As I mentioned in my other email, you can't use Ellis if you're using an external HSS (or if you've set Homestead up to attempt to talk to an external HSS).

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 06 January 2016 11:10
To: Eleanor Merry; clearwater at lists.projectclearwater.org; Matt Williams
Subject: Issue with ellis

Hi,

I have installed Clearwater manually and all VMs are running including Cassandra process.

I have created a user in "Ellis" and I could able to sign up.

First time when I have created number but did not displayed password. Is there any other way to see the password in any of the path in Ellis machine. As I am not even getting a reset button to reset the password.


When I logged in, and created a new entry as internal. And getting a pop-up saying that "Failed to update the server (see detailed diagnostics in developer
console). Please refresh the page. "

Can anyone guide me.

Regards,
Sainath




The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/3d04fb0a/attachment.html>

From Eleanor.Merry at metaswitch.com  Wed Jan  6 08:44:21 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Wed, 6 Jan 2016 13:44:21 +0000
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
Message-ID: <BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Franck,

Your trigger is using the Conjunctive Normal Form, so it matches a message if at least of one of each entry in your groups is true. Group 0 in your IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or "MESSAGE" or session case 0 or session case 1), so this should match any INVITE and any MESSAGE requests, and any SUSCRIBE requests that are originating registered or terminating registered.

This IFC should be triggered for originating and terminating INVITEs therefore ? can you please send me the Sprout debug logs for a call? To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit).

Also, you don?t need this complicated a trigger if you just want to match all INVITEs ? you could just use:

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 05 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] Configuration of iFCs rules

Thanks Ellie,

I reviewed the spec and the links provided.
But I could not reach a situation where the application server gets notified of both originating and terminating SIP INVITEs?
This is the trigger I used lastly.

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Is there a known issue getting the terminating party SIP INVITEs?

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, October 1, 2015 3:08 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

We?ve got some examples of iFC configuration in http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl and https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.

For a full description of how to configure iFCs, I recommend that you check out TS 29.228 (release 10, Annex C and F).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 01 October 2015 12:31
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Configuration of iFCs rules

Hi,

I could not find in the doc pages a full guide for the configuration of iFC rules.
I need to configure a rule for 3rd party registrar and for MMTel Conferencing.
I there some information available around this topic somewhere?

-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/097b476c/attachment.html>

From fmalka at modulo.co.il  Wed Jan  6 08:50:41 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Wed, 6 Jan 2016 15:50:41 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>

Hi Ellie,



Thanks for the comment.

I think I originally misunderstood the problem I have.

I do get originating and terminating triggers on the MMTEL AS.

This works fine.



The problem I face is with MMTEL Conference.

In this specific scenario, the MMTEL AS sends the INVITE Request with the
conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
leg for it with the conference focus id.



I thought we were missing the terminating trigger but It was a
misinterpretation of the logs.

We are missing the terminating leg for the conf-factory.

I am not sure where and how shall we configure this specific trigger for
the conferencing feature.



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Wednesday, January 6, 2016 3:44 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



Your trigger is using the Conjunctive Normal Form, so it matches a message
if at least of one of each entry in your groups is true. Group 0 in your
IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
"MESSAGE" or session case 0 or session case 1), so this should match any
INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
originating registered or terminating registered.



This IFC should be triggered for originating and terminating INVITEs
therefore ? can you please send me the Sprout debug logs for a call? To
turn on debug logging create/edit the file /etc/clearwater/user_settings,
add log_level=5 and then restart Sprout (service sprout stop ? it?s
automatically restarted by monit).



Also, you don?t need this complicated a trigger if you just want to match
all INVITEs ? you could just use:



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 05 January 2016 15:18
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/123be845/attachment.html>

From sainath.ellendula at wipro.com  Wed Jan  6 08:23:25 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Wed, 6 Jan 2016 13:23:25 +0000
Subject: [Clearwater] Configuration issue in x-lite softphone
In-Reply-To: <BN3PR02MB12550309C3244CA3BA0B3FDA9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB140029D39184F717773636D9F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255FDD8794D17A486CB48F89BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB140044CECBCCF5E6B35C5068F2F20@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB12551990DA68F52460006CE79BF20@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB1400E3643067346D364753FAF2F30@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB12550309C3244CA3BA0B3FDA9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB14004BB0EC34CB355FA33885F2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Thanks for your response.


OK. I have deleted the Hss parameters from shared_config.


Please find the attached screenshot for mysql.


Thanks in advance!!


Regards,

Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 06 January 2016 17:36
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Configuration issue in x-lite softphone


Hi Sai,



Using Ellis and using an external HSS are mutually exclusive.



If you want to use a HSS, you first need to install a HSS (e.g. OpenIMSCore HSS ? see http://clearwater.readthedocs.org/en/latest/External_HSS_Integration/index.html and http://clearwater.readthedocs.org/en/latest/OpenIMSCore_HSS_Integration/index.html for guidance).

If you don?t want to use a HSS, then you don?t want to set any of the hss_* parameters in the shared_config. Please can you delete these from the shared_config.



For the Ellis issue, can you please send me what Ellis users/subscribers there are? You can get this by running ?sudo mysql?, ?use ellis;? and then ?select * from users;? and ?select * from numbers;?



Ellie



From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 05 January 2016 10:42
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Re: Configuration issue in x-lite softphone



Hi Ellie,



Yes,  Even if login with 'sainath' user could not find reset button to set the password.



I have another dought, In /etc/clearwater Shared_config configured as :



# HSS configuration

hss_hostname=hss.pes.com

hss_port=3868



But here i was not installed any external HSS kookups(OpenIMSCore HSS), By default clearwater deployment include homestead(HSS). So it it correct to give  hss_hostname=hss.pes.com or should i need to provide homestead domain(homestead.pes.com)



or



Can we comment the above 2 lines in shared_config??



Could you please guide me here.



Thanks in advance!!



Regards,

Sai

________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 19:38
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone



Hi Sai,



Are you using a HSS? If so you?ll need to get the password from the HSS (and how to find the password will depend on what HSS you?re using).



If you?re not using a HSS, then how many Ellis users do you have? It looks like the ?sainath? user has created three subscribers (6505550073, 6505550473 and 6505550698). Only the ?sainath? user will see these users on the dashboard. If you don?t have the log in details for the ?sainath? user anymore then you can just create a new subscriber with your current log-in (the ?create? button in the add a new private identity section on the dashboard).



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 04 January 2016 13:53
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Configuration issue in x-lite softphone



Hi Ellie,



Dashboard in Ellis, I did not see anything expect "Add private identity". Where exactly reset button can find?



I have tried in different browser to see any changes but it did not worked.



Please find the attached screenshot.



Thanks in advance!!



Regards,

Sai

________________________________

From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 04 January 2016 18:25
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Configuration issue in x-lite softphone



Hi Sai,



You can use Ellis for this. If you go to the Dashboard in Ellis, you?ll see something like the following for each number:



Private Identity:

6505550848 at example.com<mailto:6505550848 at example.com>

Password: Not available



The password is only shown once (as it is stored securely). To generate a new password, click the reset button.



Also, I notice that you?ve set the domain value in your X-Lite configuration to homestead.pes.com. This should be the root domain of your Clearwater deployment (e.g. resolve to your Bono nodes/the value of home_domain in your shared_config file).



Ellie



From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>
Sent: 04 January 2016 12:07
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>; Matt Williams
Subject: [Clearwater] Configuration issue in x-lite softphone



Hi Team,



I was working on Clearwater IMS deployment and configured Ellis, Bono, Sprout, Homer & Homestead manually.



Now i have signup successfully on ellis and shown a new account with phone number, PFA for the same and here i did not observed any "password" . Could you please help me here how to get a password.



Getting error while configuring X-Lite (503 service unavailable):



Please find the X-Lite Configuration in attached screenshot.



Can anyone please help me here to proceed further.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/45d583fc/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: users_mysql.png
Type: image/png
Size: 56988 bytes
Desc: users_mysql.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/45d583fc/attachment.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: numbers_mysql.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/45d583fc/attachment.txt>

From sainath.ellendula at wipro.com  Wed Jan  6 08:23:15 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Wed, 6 Jan 2016 13:23:15 +0000
Subject: [Clearwater] Issue with ellis
In-Reply-To: <BN3PR02MB1255049DDF6CE8D13F5997F99BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB140043A4085785F11A540ECDF2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BN3PR02MB1255049DDF6CE8D13F5997F99BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB14008097812BC5A93FEAAACAF2F40@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Please find the attached logs from /var/log/ellis/ and screenshots of dashboard page.


Thanks in advance!!


Regards,

Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 06 January 2016 17:54
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Issue with ellis


Hi Sai,



Can you please send me the Ellis logs when you try and create a subscriber? These are in /var/log/ellis/.

Can you also send me a screenshot of the dashboard page (when you're logged in as the user that is creating subscribers)?



Thanks,



Ellie



PS As I mentioned in my other email, you can't use Ellis if you're using an external HSS (or if you've set Homestead up to attempt to talk to an external HSS).



From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 06 January 2016 11:10
To: Eleanor Merry; clearwater at lists.projectclearwater.org; Matt Williams
Subject: Issue with ellis



Hi,



I have installed Clearwater manually and all VMs are running including Cassandra process.



I have created a user in "Ellis" and I could able to sign up.



First time when I have created number but did not displayed password. Is there any other way to see the password in any of the path in Ellis machine. As I am not even getting a reset button to reset the password.



When I logged in, and created a new entry as internal. And getting a pop-up saying that "Failed to update the server (see detailed diagnostics in developer

console). Please refresh the page. "



Can anyone guide me.



Regards,

Sainath









The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

[http://www.wipro.com/wp-content/themes/images/logo.jpg]<http://www.wipro.com/>

Wipro - IT Services, Consulting, System Integration & IT ...<http://www.wipro.com/>
www.wipro.com
Wipro delivers IT Services, Business and Technology Consulting, IT Outsourcing and System Integration services & solutions.



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0f36f528/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis_20160106T170000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0f36f528/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis-1_20160106T170000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0f36f528/attachment-0001.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: address_numbers.png
Type: image/png
Size: 63802 bytes
Desc: address_numbers.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0f36f528/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Dashboard_error.png
Type: image/png
Size: 75750 bytes
Desc: Dashboard_error.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160106/0f36f528/attachment-0001.png>

From fmalka at modulo.co.il  Thu Jan  7 05:17:06 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Thu, 7 Jan 2016 12:17:06 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
Message-ID: <5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>

Hello Again,



I think I am getting closer to my problem here.



In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
according to the P-Served-User Header sescase tag.



So when the calls come-in to the AS with

P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg

The sescase tag is orig, so the AS threat the call as an originating leg
and return the call to the S-CSCF as for any usual call.



Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
the header to

P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg

And to return the request to the AS, then the AS shall detect the
terminating leg and forward handle the call as a conference call.



My problem here is that the S-CSCF do not change the sescase tag to term,
so the INVITE request is going back and forward between the S-CSCF and the
AS and nobody handles it.



So, the refined question would be: How do I configure the S-CSCF to change
the leg type here?



See attached pcap.



-Franck.



*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* Wednesday, January 6, 2016 3:51 PM
*To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Ellie,



Thanks for the comment.

I think I originally misunderstood the problem I have.

I do get originating and terminating triggers on the MMTEL AS.

This works fine.



The problem I face is with MMTEL Conference.

In this specific scenario, the MMTEL AS sends the INVITE Request with the
conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
leg for it with the conference focus id.



I thought we were missing the terminating trigger but It was a
misinterpretation of the logs.

We are missing the terminating leg for the conf-factory.

I am not sure where and how shall we configure this specific trigger for
the conferencing feature.



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Wednesday, January 6, 2016 3:44 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



Your trigger is using the Conjunctive Normal Form, so it matches a message
if at least of one of each entry in your groups is true. Group 0 in your
IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
"MESSAGE" or session case 0 or session case 1), so this should match any
INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
originating registered or terminating registered.



This IFC should be triggered for originating and terminating INVITEs
therefore ? can you please send me the Sprout debug logs for a call? To
turn on debug logging create/edit the file /etc/clearwater/user_settings,
add log_level=5 and then restart Sprout (service sprout stop ? it?s
automatically restarted by monit).



Also, you don?t need this complicated a trigger if you just want to match
all INVITEs ? you could just use:



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 05 January 2016 15:18
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/8d89aece/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: conf-factory.pcap.pcapng
Type: application/octet-stream
Size: 481296 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/8d89aece/attachment.obj>

From Eleanor.Merry at metaswitch.com  Thu Jan  7 06:34:46 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Thu, 7 Jan 2016 11:34:46 +0000
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
Message-ID: <BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Frank,

Can you send me the Sprout debug logs for this call?

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 10:17
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] Configuration of iFCs rules

Hello Again,

I think I am getting closer to my problem here.

In fact, the UE dials to the conf-factory and the MMTEL AS routes the call according to the P-Served-User Header sescase tag.

So when the calls come-in to the AS with
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=orig;regstate=reg
The sescase tag is orig, so the AS threat the call as an originating leg and return the call to the S-CSCF as for any usual call.

Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change the header to
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=term;regstate=reg
And to return the request to the AS, then the AS shall detect the terminating leg and forward handle the call as a conference call.

My problem here is that the S-CSCF do not change the sescase tag to term, so the INVITE request is going back and forward between the S-CSCF and the AS and nobody handles it.

So, the refined question would be: How do I configure the S-CSCF to change the leg type here?

See attached pcap.

-Franck.

From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: Wednesday, January 6, 2016 3:51 PM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Ellie,

Thanks for the comment.
I think I originally misunderstood the problem I have.
I do get originating and terminating triggers on the MMTEL AS.
This works fine.

The problem I face is with MMTEL Conference.
In this specific scenario, the MMTEL AS sends the INVITE Request with the conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT leg for it with the conference focus id.

I thought we were missing the terminating trigger but It was a misinterpretation of the logs.
We are missing the terminating leg for the conf-factory.
I am not sure where and how shall we configure this specific trigger for the conferencing feature.

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Wednesday, January 6, 2016 3:44 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

Your trigger is using the Conjunctive Normal Form, so it matches a message if at least of one of each entry in your groups is true. Group 0 in your IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or "MESSAGE" or session case 0 or session case 1), so this should match any INVITE and any MESSAGE requests, and any SUSCRIBE requests that are originating registered or terminating registered.

This IFC should be triggered for originating and terminating INVITEs therefore ? can you please send me the Sprout debug logs for a call? To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit).

Also, you don?t need this complicated a trigger if you just want to match all INVITEs ? you could just use:

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 05 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Thanks Ellie,

I reviewed the spec and the links provided.
But I could not reach a situation where the application server gets notified of both originating and terminating SIP INVITEs?
This is the trigger I used lastly.

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Is there a known issue getting the terminating party SIP INVITEs?

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, October 1, 2015 3:08 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

We?ve got some examples of iFC configuration in http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl and https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.

For a full description of how to configure iFCs, I recommend that you check out TS 29.228 (release 10, Annex C and F).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 01 October 2015 12:31
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Configuration of iFCs rules

Hi,

I could not find in the doc pages a full guide for the configuration of iFC rules.
I need to configure a rule for 3rd party registrar and for MMTel Conferencing.
I there some information available around this topic somewhere?

-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/d0d6b1b1/attachment.html>

From fmalka at modulo.co.il  Thu Jan  7 06:42:14 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Thu, 7 Jan 2016 13:42:14 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
Message-ID: <cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>

Can you tell me how to enable debug logs?

The only thing I see in the sprout log is



[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt

07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14390.840820 (based on a smoothed mean
latency of 1301 and 0 upstream overload responses)

07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14400.557617 (based on a smoothed mean
latency of 2830 and 0 upstream overload responses)

07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14410.234375 (based on a smoothed mean
latency of 3231 and 0 upstream overload responses)

07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14419.383789 (based on a smoothed mean
latency of 8509 and 0 upstream overload responses)

07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, January 7, 2016 1:35 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Frank,



Can you send me the Sprout debug logs for this call?



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 07 January 2016 10:17
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hello Again,



I think I am getting closer to my problem here.



In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
according to the P-Served-User Header sescase tag.



So when the calls come-in to the AS with

P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg

The sescase tag is orig, so the AS threat the call as an originating leg
and return the call to the S-CSCF as for any usual call.



Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
the header to

P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg

And to return the request to the AS, then the AS shall detect the
terminating leg and forward handle the call as a conference call.



My problem here is that the S-CSCF do not change the sescase tag to term,
so the INVITE request is going back and forward between the S-CSCF and the
AS and nobody handles it.



So, the refined question would be: How do I configure the S-CSCF to change
the leg type here?



See attached pcap.



-Franck.



*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* Wednesday, January 6, 2016 3:51 PM
*To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Ellie,



Thanks for the comment.

I think I originally misunderstood the problem I have.

I do get originating and terminating triggers on the MMTEL AS.

This works fine.



The problem I face is with MMTEL Conference.

In this specific scenario, the MMTEL AS sends the INVITE Request with the
conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
leg for it with the conference focus id.



I thought we were missing the terminating trigger but It was a
misinterpretation of the logs.

We are missing the terminating leg for the conf-factory.

I am not sure where and how shall we configure this specific trigger for
the conferencing feature.



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Wednesday, January 6, 2016 3:44 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



Your trigger is using the Conjunctive Normal Form, so it matches a message
if at least of one of each entry in your groups is true. Group 0 in your
IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
"MESSAGE" or session case 0 or session case 1), so this should match any
INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
originating registered or terminating registered.



This IFC should be triggered for originating and terminating INVITEs
therefore ? can you please send me the Sprout debug logs for a call? To
turn on debug logging create/edit the file /etc/clearwater/user_settings,
add log_level=5 and then restart Sprout (service sprout stop ? it?s
automatically restarted by monit).



Also, you don?t need this complicated a trigger if you just want to match
all INVITEs ? you could just use:



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 05 January 2016 15:18
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/9c63cde4/attachment.html>

From Eleanor.Merry at metaswitch.com  Thu Jan  7 06:46:28 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Thu, 7 Jan 2016 11:46:28 +0000
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
Message-ID: <BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Franck,

To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit). The logs are output in /var/log/sprout/.

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 11:42
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] Configuration of iFCs rules

Can you tell me how to enable debug logs?
The only thing I see in the sprout log is

[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14390.840820 (based on a smoothed mean latency of 1301 and 0 upstream overload responses)
07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14400.557617 (based on a smoothed mean latency of 2830 and 0 upstream overload responses)
07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14410.234375 (based on a smoothed mean latency of 3231 and 0 upstream overload responses)
07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14419.383789 (based on a smoothed mean latency of 8509 and 0 upstream overload responses)
07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, January 7, 2016 1:35 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Frank,

Can you send me the Sprout debug logs for this call?

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 10:17
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hello Again,

I think I am getting closer to my problem here.

In fact, the UE dials to the conf-factory and the MMTEL AS routes the call according to the P-Served-User Header sescase tag.

So when the calls come-in to the AS with
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=orig;regstate=reg
The sescase tag is orig, so the AS threat the call as an originating leg and return the call to the S-CSCF as for any usual call.

Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change the header to
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=term;regstate=reg
And to return the request to the AS, then the AS shall detect the terminating leg and forward handle the call as a conference call.

My problem here is that the S-CSCF do not change the sescase tag to term, so the INVITE request is going back and forward between the S-CSCF and the AS and nobody handles it.

So, the refined question would be: How do I configure the S-CSCF to change the leg type here?

See attached pcap.

-Franck.

From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: Wednesday, January 6, 2016 3:51 PM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Ellie,

Thanks for the comment.
I think I originally misunderstood the problem I have.
I do get originating and terminating triggers on the MMTEL AS.
This works fine.

The problem I face is with MMTEL Conference.
In this specific scenario, the MMTEL AS sends the INVITE Request with the conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT leg for it with the conference focus id.

I thought we were missing the terminating trigger but It was a misinterpretation of the logs.
We are missing the terminating leg for the conf-factory.
I am not sure where and how shall we configure this specific trigger for the conferencing feature.

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Wednesday, January 6, 2016 3:44 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

Your trigger is using the Conjunctive Normal Form, so it matches a message if at least of one of each entry in your groups is true. Group 0 in your IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or "MESSAGE" or session case 0 or session case 1), so this should match any INVITE and any MESSAGE requests, and any SUSCRIBE requests that are originating registered or terminating registered.

This IFC should be triggered for originating and terminating INVITEs therefore ? can you please send me the Sprout debug logs for a call? To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit).

Also, you don?t need this complicated a trigger if you just want to match all INVITEs ? you could just use:

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 05 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Thanks Ellie,

I reviewed the spec and the links provided.
But I could not reach a situation where the application server gets notified of both originating and terminating SIP INVITEs?
This is the trigger I used lastly.

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Is there a known issue getting the terminating party SIP INVITEs?

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, October 1, 2015 3:08 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

We?ve got some examples of iFC configuration in http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl and https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.

For a full description of how to configure iFCs, I recommend that you check out TS 29.228 (release 10, Annex C and F).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 01 October 2015 12:31
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Configuration of iFCs rules

Hi,

I could not find in the doc pages a full guide for the configuration of iFC rules.
I need to configure a rule for 3rd party registrar and for MMTel Conferencing.
I there some information available around this topic somewhere?

-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/98c30567/attachment.html>

From fmalka at modulo.co.il  Thu Jan  7 07:28:18 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Thu, 7 Jan 2016 14:28:18 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
Message-ID: <811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>

Attached the requested logs:



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, January 7, 2016 1:46 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



To turn on debug logging create/edit the file
/etc/clearwater/user_settings, add log_level=5 and then restart Sprout
(service sprout stop ? it?s automatically restarted by monit). The logs are
output in /var/log/sprout/.



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 07 January 2016 11:42
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Can you tell me how to enable debug logs?

The only thing I see in the sprout log is



[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt

07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14390.840820 (based on a smoothed mean
latency of 1301 and 0 upstream overload responses)

07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14400.557617 (based on a smoothed mean
latency of 2830 and 0 upstream overload responses)

07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14410.234375 (based on a smoothed mean
latency of 3231 and 0 upstream overload responses)

07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14419.383789 (based on a smoothed mean
latency of 8509 and 0 upstream overload responses)

07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, January 7, 2016 1:35 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Frank,



Can you send me the Sprout debug logs for this call?



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 07 January 2016 10:17
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hello Again,



I think I am getting closer to my problem here.



In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
according to the P-Served-User Header sescase tag.



So when the calls come-in to the AS with

P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg

The sescase tag is orig, so the AS threat the call as an originating leg
and return the call to the S-CSCF as for any usual call.



Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
the header to

P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg

And to return the request to the AS, then the AS shall detect the
terminating leg and forward handle the call as a conference call.



My problem here is that the S-CSCF do not change the sescase tag to term,
so the INVITE request is going back and forward between the S-CSCF and the
AS and nobody handles it.



So, the refined question would be: How do I configure the S-CSCF to change
the leg type here?



See attached pcap.



-Franck.



*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* Wednesday, January 6, 2016 3:51 PM
*To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Ellie,



Thanks for the comment.

I think I originally misunderstood the problem I have.

I do get originating and terminating triggers on the MMTEL AS.

This works fine.



The problem I face is with MMTEL Conference.

In this specific scenario, the MMTEL AS sends the INVITE Request with the
conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
leg for it with the conference focus id.



I thought we were missing the terminating trigger but It was a
misinterpretation of the logs.

We are missing the terminating leg for the conf-factory.

I am not sure where and how shall we configure this specific trigger for
the conferencing feature.



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Wednesday, January 6, 2016 3:44 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



Your trigger is using the Conjunctive Normal Form, so it matches a message
if at least of one of each entry in your groups is true. Group 0 in your
IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
"MESSAGE" or session case 0 or session case 1), so this should match any
INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
originating registered or terminating registered.



This IFC should be triggered for originating and terminating INVITEs
therefore ? can you please send me the Sprout debug logs for a call? To
turn on debug logging create/edit the file /etc/clearwater/user_settings,
add log_level=5 and then restart Sprout (service sprout stop ? it?s
automatically restarted by monit).



Also, you don?t need this complicated a trigger if you just want to match
all INVITEs ? you could just use:



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 05 January 2016 15:18
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/c7de419f/attachment.html>
-------------- next part --------------
07-01-2016 12:02:07.524 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:02:12.509 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:04:22.337 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
07-01-2016 12:04:39.534 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:04:42.522 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:07:10.542 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:07:12.538 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:08:52.372 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
07-01-2016 12:09:41.566 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:09:42.555 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:12:11.569 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:12:12.567 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:13:22.423 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
07-01-2016 12:14:41.581 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:14:42.579 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:17:11.611 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:17:12.595 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:17:52.474 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
07-01-2016 12:19:41.627 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:19:42.608 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:22:11.641 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:22:12.622 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:22:22.503 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
07-01-2016 12:24:41.652 UTC Subscription: USER_URI=sip:6505550439 at example.com SUBSCRIPTION_ID=194729954951299078 CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:24:42.634 UTC Registration: USER_URI=sip:6505550439 at example.com BINDING_ID=sip:6505550439 at 10.0.0.72:64499;transport=udp CONTACT_URI=sip:6505550439 at 10.0.0.72:64499;transport=udp EXPIRES=300
07-01-2016 12:26:52.566 UTC Registration: USER_URI=sip:6505550955 at example.com BINDING_ID=<urn:uuid:848cde16-4041-4c7e-93ad-13528efe960c> CONTACT_URI=sip:6505550955 at 10.0.0.72 EXPIRES=300
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sprout_current.zip
Type: application/x-zip-compressed
Size: 41120 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160107/c7de419f/attachment.bin>

From fmalka at modulo.co.il  Fri Jan  8 00:00:12 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Fri, 8 Jan 2016 07:00:12 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
Message-ID: <CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>

Hi

Further investigating this issue, i was told by the MMTEL AS guys that i
need to configure an iFC for a Public Service Identity (PSI) with
conf-factory URI.

any guidelines on how would look the syntax of such an iFC?

Franck
On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il> wrote:

> Attached the requested logs:
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:46 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> To turn on debug logging create/edit the file
> /etc/clearwater/user_settings, add log_level=5 and then restart Sprout
> (service sprout stop ? it?s automatically restarted by monit). The logs are
> output in /var/log/sprout/.
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 11:42
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Can you tell me how to enable debug logs?
>
> The only thing I see in the sprout log is
>
>
>
> [cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
>
> 07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14390.840820 (based on a smoothed mean
> latency of 1301 and 0 upstream overload responses)
>
> 07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14400.557617 (based on a smoothed mean
> latency of 2830 and 0 upstream overload responses)
>
> 07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14410.234375 (based on a smoothed mean
> latency of 3231 and 0 upstream overload responses)
>
> 07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14419.383789 (based on a smoothed mean
> latency of 8509 and 0 upstream overload responses)
>
> 07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:35 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Frank,
>
>
>
> Can you send me the Sprout debug logs for this call?
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 10:17
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hello Again,
>
>
>
> I think I am getting closer to my problem here.
>
>
>
> In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
> according to the P-Served-User Header sescase tag.
>
>
>
> So when the calls come-in to the AS with
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg
>
> The sescase tag is orig, so the AS threat the call as an originating leg
> and return the call to the S-CSCF as for any usual call.
>
>
>
> Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
> the header to
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg
>
> And to return the request to the AS, then the AS shall detect the
> terminating leg and forward handle the call as a conference call.
>
>
>
> My problem here is that the S-CSCF do not change the sescase tag to term,
> so the INVITE request is going back and forward between the S-CSCF and the
> AS and nobody handles it.
>
>
>
> So, the refined question would be: How do I configure the S-CSCF to change
> the leg type here?
>
>
>
> See attached pcap.
>
>
>
> -Franck.
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* Wednesday, January 6, 2016 3:51 PM
> *To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Ellie,
>
>
>
> Thanks for the comment.
>
> I think I originally misunderstood the problem I have.
>
> I do get originating and terminating triggers on the MMTEL AS.
>
> This works fine.
>
>
>
> The problem I face is with MMTEL Conference.
>
> In this specific scenario, the MMTEL AS sends the INVITE Request with the
> conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
> leg for it with the conference focus id.
>
>
>
> I thought we were missing the terminating trigger but It was a
> misinterpretation of the logs.
>
> We are missing the terminating leg for the conf-factory.
>
> I am not sure where and how shall we configure this specific trigger for
> the conferencing feature.
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Wednesday, January 6, 2016 3:44 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> Your trigger is using the Conjunctive Normal Form, so it matches a message
> if at least of one of each entry in your groups is true. Group 0 in your
> IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
> "MESSAGE" or session case 0 or session case 1), so this should match any
> INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
> originating registered or terminating registered.
>
>
>
> This IFC should be triggered for originating and terminating INVITEs
> therefore ? can you please send me the Sprout debug logs for a call? To
> turn on debug logging create/edit the file /etc/clearwater/user_settings,
> add log_level=5 and then restart Sprout (service sprout stop ? it?s
> automatically restarted by monit).
>
>
>
> Also, you don?t need this complicated a trigger if you just want to match
> all INVITEs ? you could just use:
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 05 January 2016 15:18
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Thanks Ellie,
>
>
>
> I reviewed the spec and the links provided.
>
> But I could not reach a situation where the application server gets
> notified of both originating and terminating SIP INVITEs?
>
> This is the trigger I used lastly.
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Is there a known issue getting the terminating party SIP INVITEs?
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, October 1, 2015 3:08 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> We?ve got some examples of iFC configuration in
> http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
> and
> https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.
>
>
>
>
> For a full description of how to configure iFCs, I recommend that you
> check out TS 29.228 (release 10, Annex C and F).
>
>
>
> Ellie
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
> <clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
> Malka
> *Sent:* 01 October 2015 12:31
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Configuration of iFCs rules
>
>
>
> Hi,
>
>
>
> I could not find in the doc pages a full guide for the configuration of
> iFC rules.
>
> I need to configure a rule for 3rd party registrar and for MMTel
> Conferencing.
>
> I there some information available around this topic somewhere?
>
>
>
> -Franck.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/6b873fe6/attachment.html>

From sainath.ellendula at wipro.com  Fri Jan  8 03:01:56 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Fri, 8 Jan 2016 08:01:56 +0000
Subject: [Clearwater] Ellis issue failed to update server
Message-ID: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


I was unable to point out where exactly issue occurs while creating new private identity and getting error as "failed to update server refresh the browser".


observed logs:


08-01-2016 07:53:55.125 UTC DEBUG homestead.py:275: Received response from http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids with code 404
08-01-2016 07:53:55.126 UTC WARNING utils.py:78: Non-OK HTTP response. HTTPResponse(code=404,request_time=0.1031348705291748,buffer=<_io.BytesIO object at 0x7f4a3dc90b30>,_body=None,time_info={},request=<tornado.httpclient.HTTPRequest object at 0x7f4a3e42d590>,effective_url='http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids',headers={'Content-Length': '95', 'Content-Encoding': 'gzip', 'Server': 'nginx/1.4.6 (Ubuntu)', 'Connection': 'close', 'Date': 'Fri, 08 Jan 2016 07:53:27 GMT', 'Content-Type': 'application/json'},error=HTTPError('HTTP 404: Not Found',))
08-01-2016 07:53:55.126 UTC WARNING numbers.py:114: Failed to fetch private identities from homestead
08-01-2016 07:53:55.126 UTC ERROR web.py:718: Cannot send error response after headers written


Please find the updated /var/log/ellis *.log attached.


Thanks in advance!!


Regards,

Sai

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/310fdbf7/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis-1_20160108T130000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/310fdbf7/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis_20160108T130000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/310fdbf7/attachment-0001.txt>

From Eleanor.Merry at metaswitch.com  Fri Jan  8 07:51:28 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Fri, 8 Jan 2016 12:51:28 +0000
Subject: [Clearwater] Ellis issue failed to update server
In-Reply-To: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Sai,

It looks like the Ellis database has some invalid entries (likely because of trying to use Ellis and an external HSS).

The easiest way to go from here is to wipe out all of your subscribers and then start again.

To do this:

Check that Homestead isn't using an external HSS. If you run ps  -eaf | grep homestead, you can see what options Homestead is running with.  Hss-peer should be empty, and dest-host should be set to 0.0.0.0

To delete all numbers on Ellis, run the following on Ellis:
sudo mysql
USE ellis
UPDATE numbers SET owner_id=NULL;

To delete all numbers on Homestead, run the following on Homestead:
cqlsh
USE homestead_provisioning;
TRUNCATE public;
TRUNCATE private;
TRUNCATE service_profiles;
TRUNCATE implicit_registration_sets;
USE homestead_cache;
TRUNCATE impi;
TRUNCATE impu;
TRUNCATE impi_mapping;

To delete all numbers on Homer, run the following on Homer:
cqlsh
USE homer;
TRUNCATE simservs;

Ellie

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 08 January 2016 08:02
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Ellis issue failed to update server


Hi Ellie,



I was unable to point out where exactly issue occurs while creating new private identity and getting error as "failed to update server refresh the browser".



observed logs:


08-01-2016 07:53:55.125 UTC DEBUG homestead.py:275: Received response from http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids with code 404
08-01-2016 07:53:55.126 UTC WARNING utils.py:78: Non-OK HTTP response. HTTPResponse(code=404,request_time=0.1031348705291748,buffer=<_io.BytesIO object at 0x7f4a3dc90b30>,_body=None,time_info={},request=<tornado.httpclient.HTTPRequest object at 0x7f4a3e42d590>,effective_url='http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids',headers={'Content-Length': '95', 'Content-Encoding': 'gzip', 'Server': 'nginx/1.4.6 (Ubuntu)', 'Connection': 'close', 'Date': 'Fri, 08 Jan 2016 07:53:27 GMT', 'Content-Type': 'application/json'},error=HTTPError('HTTP 404: Not Found',))
08-01-2016 07:53:55.126 UTC WARNING numbers.py:114: Failed to fetch private identities from homestead
08-01-2016 07:53:55.126 UTC ERROR web.py:718: Cannot send error response after headers written


Please find the updated /var/log/ellis *.log attached.



Thanks in advance!!



Regards,

Sai
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/6ab5228b/attachment.html>

From sainath.ellendula at wipro.com  Fri Jan  8 10:17:58 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Fri, 8 Jan 2016 15:17:58 +0000
Subject: [Clearwater] Ellis issue failed to update server
In-Reply-To: <BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Thanks.


Followed steps as suggested but still Ellis UI displays pop-up while creating a number with "failed to update server refresh the browser", Even password also did not displayed on browser. But logs looks good. Attaching the latest logs.

Can you please look at the logs and suggest me how to go ahead.

One more thing, to create a number in Ellis, only 3 VMs are running (Ellis, Homer & Homestead). Remaining VMs i have shut down due to RAM size of my PC. This could of any problem??

Thanks in advance!!

Regards,
Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 08 January 2016 18:21
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Ellis issue failed to update server


Hi Sai,



It looks like the Ellis database has some invalid entries (likely because of trying to use Ellis and an external HSS).



The easiest way to go from here is to wipe out all of your subscribers and then start again.



To do this:



Check that Homestead isn?t using an external HSS. If you run ps  -eaf | grep homestead, you can see what options Homestead is running with.  Hss-peer should be empty, and dest-host should be set to 0.0.0.0



To delete all numbers on Ellis, run the following on Ellis:

sudo mysql

USE ellis

UPDATE numbers SET owner_id=NULL;



To delete all numbers on Homestead, run the following on Homestead:

cqlsh

USE homestead_provisioning;

TRUNCATE public;

TRUNCATE private;

TRUNCATE service_profiles;

TRUNCATE implicit_registration_sets;

USE homestead_cache;

TRUNCATE impi;

TRUNCATE impu;

TRUNCATE impi_mapping;



To delete all numbers on Homer, run the following on Homer:

cqlsh

USE homer;

TRUNCATE simservs;



Ellie



From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 08 January 2016 08:02
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Ellis issue failed to update server



Hi Ellie,



I was unable to point out where exactly issue occurs while creating new private identity and getting error as "failed to update server refresh the browser".



observed logs:



08-01-2016 07:53:55.125 UTC DEBUG homestead.py:275: Received response from http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids with code 404

08-01-2016 07:53:55.126 UTC WARNING utils.py:78: Non-OK HTTP response. HTTPResponse(code=404,request_time=0.1031348705291748,buffer=<_io.BytesIO object at 0x7f4a3dc90b30>,_body=None,time_info={},request=<tornado.httpclient.HTTPRequest object at 0x7f4a3e42d590>,effective_url='http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids',headers={'Content-Length': '95', 'Content-Encoding': 'gzip', 'Server': 'nginx/1.4.6 (Ubuntu)', 'Connection': 'close', 'Date': 'Fri, 08 Jan 2016 07:53:27 GMT', 'Content-Type': 'application/json'},error=HTTPError('HTTP 404: Not Found',))

08-01-2016 07:53:55.126 UTC WARNING numbers.py:114: Failed to fetch private identities from homestead

08-01-2016 07:53:55.126 UTC ERROR web.py:718: Cannot send error response after headers written



Please find the updated /var/log/ellis *.log attached.



Thanks in advance!!



Regards,

Sai

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/a08f035f/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis_20160108T200000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/a08f035f/attachment.txt>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ellis-1_20160108T200000Z.txt
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160108/a08f035f/attachment-0001.txt>

From fmalka at modulo.co.il  Sun Jan 10 10:43:43 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Sun, 10 Jan 2016 17:43:43 +0200
Subject: [Clearwater] Can homer interface can be set to SSL or TLS?
Message-ID: <062d1d996c47b3973c95294ed593fc62@mail.gmail.com>

Can homer interface can be set to SSL or TLS?

Meaning for the Ut interface.



*Franck Malka*

[image: cid:image003.jpg at 01CFF8F3.C92A2EC0]
<http://www.facebook.com/modulocs>[image:
cid:image004.jpg at 01CFF8F3.C92A2EC0] <http://www.twitter.com/modulocs>[image:
cid:image005.jpg at 01CFF8F3.C92A2EC0]
<http://www.linkedin.com/company/modulo-communications-systems-ltd.>





Mobile   +972 54 488 9090

Tel        +972 72 274 4002
Fax       +972   3 774 1114

Skype   franck.malka





http://www.modulo.co.il/

14 Imber St. Kyriat Arie,

PO Box 4098,

Petah Tikva 49514

[image: cid:image002.jpg at 01CFF8F3.C92A2EC0]



[image: cid:image007.png at 01CFF8F3.C92A2EC0]

NOTE: The contents of this email and any attachments are confidential. They
are intended for the named recipient(s) only. If you have received this
email in error, please notify the system manager or the sender immediately
and do not disclose the contents to anyone or make copies thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 856 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 827 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 861 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.jpg
Type: image/jpeg
Size: 3786 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 877 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160110/25841e98/attachment.png>

From sainath.ellendula at wipro.com  Mon Jan 11 08:30:47 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Mon, 11 Jan 2016 13:30:47 +0000
Subject: [Clearwater] Issue in bono specific node
In-Reply-To: <KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>,
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,

I observed an error in bono log /var/log/bono *.log

But i can ping sprout machine from bono with name "sprout.pes.com".

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:86: SIPResolver::resolve for name sprout.pes.com, port 5052, transport 6, family 2
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:505: Attempt to parse sprout.pes.com as IP address
11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:128: Port is specified
11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:296: Perform A/AAAA record lookup only, name = sprout.pes.com
11-01-2016 13:20:04.702 UTC Verbose dnscachedresolver.cpp:237: Check cache for sprout.pes.com type 1
11-01-2016 13:20:04.702 UTC Debug dnscachedresolver.cpp:323: Pulling 0 records from cache for sprout.pes.com A
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:353: Found 0 A/AAAA records, randomizing
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:412: Adding 0 servers from blacklist
11-01-2016 13:20:04.702 UTC Error connection_pool.cpp:214: Failed to resolve sprout.pes.com to an IP address - Not found (PJ_ENOTFOUND)

Any suggestions would be helpful.

Thanks in advance!!

Regards,
Sai

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160111/09922527/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 12 12:51:39 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 12 Jan 2016 17:51:39 +0000
Subject: [Clearwater] Sprout WSS support
In-Reply-To: <CP1PR80MB1141E2EA7E996B78EA8F0C85D1F40@CP1PR80MB1141.lamprd80.prod.outlook.com>
References: <CP1PR80MB1678A7B07E0EC65F202307BD1910@CP1PR80MB167.lamprd80.prod.outlook.com>,
	<CO1PR02MB240701E37CD7EF4B2CD90649B900@CO1PR02MB240.namprd02.prod.outlook.com>
	<CP1PR80MB1141E2EA7E996B78EA8F0C85D1F40@CP1PR80MB1141.lamprd80.prod.outlook.com>
Message-ID: <BLUPR02MB12514FAF500FA08F3FA8C0F49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Felipe,

That's great to hear! We've not thought much about supporting WSS support - I'm happy to discuss (via email) your proposed changes though.

Also, we'll need you to execute a Clearwater contributor's agreement - I'll be in touch off list about that.

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Felipe Miney Gon?alves da Costa
Sent: 06 January 2016 10:29
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Sprout WSS support


Hi Ellie,



 I finally got to look into wss support, and will work on adding this to Sprout.



 Do you think wss support would be a global configuration parameter (deciding at launch time if websockets will be secure), or is there a way to make this "client based"?

 Also, please share with me whatever the team has already thought about this wss support, to ensure I take it into consideration.



 Thanks,



 Felipe

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: Thursday, July 9, 2015 1:42 PM
To: Felipe Miney Gon?alves da Costa; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Sprout WSS support


Hi Felipe,



Clearwater doesn't implement this, and we're not currently working on supporting secure websockets.



Do you have a particular need/timeframe for this function? Would you like to contribute to Clearwater by helping to add the support for this?



Ellie



From: clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org> [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Felipe Miney Gon?alves da Costa
Sent: 08 July 2015 20:52
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Sprout WSS support



 Hi,



 I found some threads in the mailing list regarding support for secure websockets, but in the end it was not clear if clearwater already implements this. If not, how far is this feature down the roadmap?



 Thanks



 Felipe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/9710e922/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 12 12:52:00 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 12 Jan 2016 17:52:00 +0000
Subject: [Clearwater] Ellis issue failed to update server
In-Reply-To: <KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BLUPR02MB1251FADD0F95F647249DDAF19BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Sai,

The Ellis logs show that Ellis is trying to get information about various subscribers, and Homestead is returning a 404 to all of them. Ellis shouldn't be asking about any subscribers yet though - can you confirm that you updated the numbers on Ellis as well as truncating the Homestead/Homer databases?

You *can* create a number in Ellis using only Ellis, Homer and Homestead - although you won't be able to do much with them. Alternatively, have you seen our all-in-one images (more details at http://clearwater.readthedocs.org/en/latest/All_in_one_Images/index.html)? These run all the Clearwater components on a single node, and are much simpler to set up than the full install.

Ellie

From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 08 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Ellis issue failed to update server


Hi Ellie,



Thanks.



Followed steps as suggested but still Ellis UI displays pop-up while creating a number with "failed to update server refresh the browser", Even password also did not displayed on browser. But logs looks good. Attaching the latest logs.

Can you please look at the logs and suggest me how to go ahead.
One more thing, to create a number in Ellis, only 3 VMs are running (Ellis, Homer & Homestead). Remaining VMs i have shut down due to RAM size of my PC. This could of any problem??

Thanks in advance!!

Regards,
Sai

________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 08 January 2016 18:21
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Ellis issue failed to update server


Hi Sai,



It looks like the Ellis database has some invalid entries (likely because of trying to use Ellis and an external HSS).



The easiest way to go from here is to wipe out all of your subscribers and then start again.



To do this:



Check that Homestead isn't using an external HSS. If you run ps  -eaf | grep homestead, you can see what options Homestead is running with.  Hss-peer should be empty, and dest-host should be set to 0.0.0.0



To delete all numbers on Ellis, run the following on Ellis:

sudo mysql

USE ellis

UPDATE numbers SET owner_id=NULL;



To delete all numbers on Homestead, run the following on Homestead:

cqlsh

USE homestead_provisioning;

TRUNCATE public;

TRUNCATE private;

TRUNCATE service_profiles;

TRUNCATE implicit_registration_sets;

USE homestead_cache;

TRUNCATE impi;

TRUNCATE impu;

TRUNCATE impi_mapping;



To delete all numbers on Homer, run the following on Homer:

cqlsh

USE homer;

TRUNCATE simservs;



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 08 January 2016 08:02
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Ellis issue failed to update server



Hi Ellie,



I was unable to point out where exactly issue occurs while creating new private identity and getting error as "failed to update server refresh the browser".



observed logs:



08-01-2016 07:53:55.125 UTC DEBUG homestead.py:275: Received response from http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids with code 404

08-01-2016 07:53:55.126 UTC WARNING utils.py:78: Non-OK HTTP response. HTTPResponse(code=404,request_time=0.1031348705291748,buffer=<_io.BytesIO object at 0x7f4a3dc90b30>,_body=None,time_info={},request=<tornado.httpclient.HTTPRequest object at 0x7f4a3e42d590>,effective_url='http://homestead.pes.com:8889/public/sip%3A6505550924%40cw-ngv.com/associated_private_ids',headers={'Content-Length': '95', 'Content-Encoding': 'gzip', 'Server': 'nginx/1.4.6 (Ubuntu)', 'Connection': 'close', 'Date': 'Fri, 08 Jan 2016 07:53:27 GMT', 'Content-Type': 'application/json'},error=HTTPError('HTTP 404: Not Found',))

08-01-2016 07:53:55.126 UTC WARNING numbers.py:114: Failed to fetch private identities from homestead

08-01-2016 07:53:55.126 UTC ERROR web.py:718: Cannot send error response after headers written



Please find the updated /var/log/ellis *.log attached.



Thanks in advance!!



Regards,

Sai

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/d5eb3191/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 12 12:52:08 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 12 Jan 2016 17:52:08 +0000
Subject: [Clearwater] Issue in bono specific node
In-Reply-To: <KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>,
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <BLUPR02MB12517C681921FCE01C1078C49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Sai,

What's the full output of running 'nslookup sprout.pes.com' on your Bono node?

Ellie

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 11 January 2016 13:31
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Issue in bono specific node

Hi Ellie,

I observed an error in bono log /var/log/bono *.log

But i can ping sprout machine from bono with name "sprout.pes.com".

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:86: SIPResolver::resolve for name sprout.pes.com, port 5052, transport 6, family 2
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:505: Attempt to parse sprout.pes.com as IP address
11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:128: Port is specified
11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:296: Perform A/AAAA record lookup only, name = sprout.pes.com
11-01-2016 13:20:04.702 UTC Verbose dnscachedresolver.cpp:237: Check cache for sprout.pes.com type 1
11-01-2016 13:20:04.702 UTC Debug dnscachedresolver.cpp:323: Pulling 0 records from cache for sprout.pes.com A
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:353: Found 0 A/AAAA records, randomizing
11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:412: Adding 0 servers from blacklist
11-01-2016 13:20:04.702 UTC Error connection_pool.cpp:214: Failed to resolve sprout.pes.com to an IP address - Not found (PJ_ENOTFOUND)

Any suggestions would be helpful.

Thanks in advance!!

Regards,
Sai

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/fa5e1f6b/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 12 13:01:41 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 12 Jan 2016 18:01:41 +0000
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
	<CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
Message-ID: <BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Franck,

Thanks for sending the logs across. On the terminating leg of the call, Sprout asks Homestead for the subscriber data of sip:conf-factory at example.com. It doesn?t look like Homestead knows anything about this PSI though, so it returns a 404, and Sprout then rejects the call.

You?ll need to make sure Clearwater knows about the PSI.

Are you using an external HSS? If so, then add the PSI to the HSS (the details for how to do so depend on your HSS). If you?re not using a HSS, then you can add the PSI using the Ellis API (see https://github.com/Metaswitch/ellis/blob/dev/docs/api.md#provisioning-specific-numbers for details). Then you can set up the PSI IFC in the same way that you?ve done for your other subscribers (but make sure that the IFC for the PSI doesn?t only trigger for *registered* subscribers).

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 08 January 2016 05:00
To: clearwater at lists.projectclearwater.org; Eleanor Merry
Subject: RE: [Clearwater] Configuration of iFCs rules


Hi

Further investigating this issue, i was told by the MMTEL AS guys that i need to configure an iFC for a Public Service Identity (PSI) with conf-factory URI.

any guidelines on how would look the syntax of such an iFC?

Franck
On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>> wrote:
Attached the requested logs:

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, January 7, 2016 1:46 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit). The logs are output in /var/log/sprout/.

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 11:42
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Can you tell me how to enable debug logs?
The only thing I see in the sprout log is

[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14390.840820 (based on a smoothed mean latency of 1301 and 0 upstream overload responses)
07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14400.557617 (based on a smoothed mean latency of 2830 and 0 upstream overload responses)
07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14410.234375 (based on a smoothed mean latency of 3231 and 0 upstream overload responses)
07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14419.383789 (based on a smoothed mean latency of 8509 and 0 upstream overload responses)
07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, January 7, 2016 1:35 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Frank,

Can you send me the Sprout debug logs for this call?

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 10:17
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hello Again,

I think I am getting closer to my problem here.

In fact, the UE dials to the conf-factory and the MMTEL AS routes the call according to the P-Served-User Header sescase tag.

So when the calls come-in to the AS with
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=orig;regstate=reg
The sescase tag is orig, so the AS threat the call as an originating leg and return the call to the S-CSCF as for any usual call.

Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change the header to
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=term;regstate=reg
And to return the request to the AS, then the AS shall detect the terminating leg and forward handle the call as a conference call.

My problem here is that the S-CSCF do not change the sescase tag to term, so the INVITE request is going back and forward between the S-CSCF and the AS and nobody handles it.

So, the refined question would be: How do I configure the S-CSCF to change the leg type here?

See attached pcap.

-Franck.

From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: Wednesday, January 6, 2016 3:51 PM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Ellie,

Thanks for the comment.
I think I originally misunderstood the problem I have.
I do get originating and terminating triggers on the MMTEL AS.
This works fine.

The problem I face is with MMTEL Conference.
In this specific scenario, the MMTEL AS sends the INVITE Request with the conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT leg for it with the conference focus id.

I thought we were missing the terminating trigger but It was a misinterpretation of the logs.
We are missing the terminating leg for the conf-factory.
I am not sure where and how shall we configure this specific trigger for the conferencing feature.

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Wednesday, January 6, 2016 3:44 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

Your trigger is using the Conjunctive Normal Form, so it matches a message if at least of one of each entry in your groups is true. Group 0 in your IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or "MESSAGE" or session case 0 or session case 1), so this should match any INVITE and any MESSAGE requests, and any SUSCRIBE requests that are originating registered or terminating registered.

This IFC should be triggered for originating and terminating INVITEs therefore ? can you please send me the Sprout debug logs for a call? To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit).

Also, you don?t need this complicated a trigger if you just want to match all INVITEs ? you could just use:

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 05 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Thanks Ellie,

I reviewed the spec and the links provided.
But I could not reach a situation where the application server gets notified of both originating and terminating SIP INVITEs?
This is the trigger I used lastly.

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Is there a known issue getting the terminating party SIP INVITEs?

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, October 1, 2015 3:08 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

We?ve got some examples of iFC configuration in http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl and https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.

For a full description of how to configure iFCs, I recommend that you check out TS 29.228 (release 10, Annex C and F).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 01 October 2015 12:31
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Configuration of iFCs rules

Hi,

I could not find in the doc pages a full guide for the configuration of iFC rules.
I need to configure a rule for 3rd party registrar and for MMTel Conferencing.
I there some information available around this topic somewhere?

-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/c8bef644/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 12 13:02:45 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 12 Jan 2016 18:02:45 +0000
Subject: [Clearwater] Can homer interface can be set to SSL or TLS?
In-Reply-To: <062d1d996c47b3973c95294ed593fc62@mail.gmail.com>
References: <062d1d996c47b3973c95294ed593fc62@mail.gmail.com>
Message-ID: <BLUPR02MB12519EFD103CBA8F792084559BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>

Hi Franck,

It can be ? although it?s worth noting that we don?t authenticate requests to Homer in Project Clearwater. Any client able to send traffic to port 7888 of a Homer node may perform any operation on any data stored in Homer, without providing any authentication; allowing external access therefore presents a significant security risk. Please see https://github.com/Metaswitch/crest/blob/dev/docs/homer_features.md for more details

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 10 January 2016 15:44
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Can homer interface can be set to SSL or TLS?

Can homer interface can be set to SSL or TLS?
Meaning for the Ut interface.

Franck Malka

[cid:image003.jpg at 01CFF8F3.C92A2EC0]<http://www.facebook.com/modulocs>[cid:image004.jpg at 01CFF8F3.C92A2EC0]<http://www.twitter.com/modulocs>[cid:image005.jpg at 01CFF8F3.C92A2EC0]<http://www.linkedin.com/company/modulo-communications-systems-ltd.>



Mobile   +972 54 488 9090<tel:%2B972%2054%20488%209090>
Tel        +972 72 274 4002<tel:%2B972%2072%20274%204002>
Fax       +972   3 774 1114<tel:%2B972%C2%A0%C2%A0%203%20774%201114>
Skype   franck.malka



http://www.modulo.co.il/
14 Imber St. Kyriat Arie,
PO Box 4098,
Petah Tikva 49514

[cid:image002.jpg at 01CFF8F3.C92A2EC0]



[cid:image007.png at 01CFF8F3.C92A2EC0]
NOTE: The contents of this email and any attachments are confidential. They are intended for the named recipient(s) only. If you have received this email in error, please notify the system manager or the sender immediately and do not disclose the contents to anyone or make copies thereof.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 856 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 827 bytes
Desc: image002.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment-0001.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.jpg
Type: image/jpeg
Size: 861 bytes
Desc: image003.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.jpg
Type: image/jpeg
Size: 3786 bytes
Desc: image004.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 877 bytes
Desc: image005.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/2afb91ff/attachment.png>

From fmalka at modulo.co.il  Tue Jan 12 13:19:13 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Tue, 12 Jan 2016 20:19:13 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
	<CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
	<BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
Message-ID: <CAKX=ev36d+fbBa48Zpd+c9FGpVY5iqAg17p3+CYGQO5eQjS0Nw@mail.gmail.com>

Thanks i just used a non registered private identity as a trigger and it
did the job for me.

Franck
On Jan 12, 2016 20:01, "Eleanor Merry" <Eleanor.Merry at metaswitch.com> wrote:

> Hi Franck,
>
>
>
> Thanks for sending the logs across. On the terminating leg of the call,
> Sprout asks Homestead for the subscriber data of
> sip:conf-factory at example.com. It doesn?t look like Homestead knows
> anything about this PSI though, so it returns a 404, and Sprout then
> rejects the call.
>
>
>
> You?ll need to make sure Clearwater knows about the PSI.
>
>
>
> Are you using an external HSS? If so, then add the PSI to the HSS (the
> details for how to do so depend on your HSS). If you?re not using a HSS,
> then you can add the PSI using the Ellis API (see
> https://github.com/Metaswitch/ellis/blob/dev/docs/api.md#provisioning-specific-numbers
> for details). Then you can set up the PSI IFC in the same way that you?ve
> done for your other subscribers (but make sure that the IFC for the PSI
> doesn?t only trigger for **registered** subscribers).
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* 08 January 2016 05:00
> *To:* clearwater at lists.projectclearwater.org; Eleanor Merry
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi
>
> Further investigating this issue, i was told by the MMTEL AS guys that i
> need to configure an iFC for a Public Service Identity (PSI) with
> conf-factory URI.
>
> any guidelines on how would look the syntax of such an iFC?
>
> Franck
>
> On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il> wrote:
>
> Attached the requested logs:
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:46 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> To turn on debug logging create/edit the file
> /etc/clearwater/user_settings, add log_level=5 and then restart Sprout
> (service sprout stop ? it?s automatically restarted by monit). The logs are
> output in /var/log/sprout/.
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 11:42
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Can you tell me how to enable debug logs?
>
> The only thing I see in the sprout log is
>
>
>
> [cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
>
> 07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14390.840820 (based on a smoothed mean
> latency of 1301 and 0 upstream overload responses)
>
> 07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14400.557617 (based on a smoothed mean
> latency of 2830 and 0 upstream overload responses)
>
> 07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14410.234375 (based on a smoothed mean
> latency of 3231 and 0 upstream overload responses)
>
> 07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14419.383789 (based on a smoothed mean
> latency of 8509 and 0 upstream overload responses)
>
> 07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:35 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Frank,
>
>
>
> Can you send me the Sprout debug logs for this call?
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 10:17
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hello Again,
>
>
>
> I think I am getting closer to my problem here.
>
>
>
> In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
> according to the P-Served-User Header sescase tag.
>
>
>
> So when the calls come-in to the AS with
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg
>
> The sescase tag is orig, so the AS threat the call as an originating leg
> and return the call to the S-CSCF as for any usual call.
>
>
>
> Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
> the header to
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg
>
> And to return the request to the AS, then the AS shall detect the
> terminating leg and forward handle the call as a conference call.
>
>
>
> My problem here is that the S-CSCF do not change the sescase tag to term,
> so the INVITE request is going back and forward between the S-CSCF and the
> AS and nobody handles it.
>
>
>
> So, the refined question would be: How do I configure the S-CSCF to change
> the leg type here?
>
>
>
> See attached pcap.
>
>
>
> -Franck.
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* Wednesday, January 6, 2016 3:51 PM
> *To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Ellie,
>
>
>
> Thanks for the comment.
>
> I think I originally misunderstood the problem I have.
>
> I do get originating and terminating triggers on the MMTEL AS.
>
> This works fine.
>
>
>
> The problem I face is with MMTEL Conference.
>
> In this specific scenario, the MMTEL AS sends the INVITE Request with the
> conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
> leg for it with the conference focus id.
>
>
>
> I thought we were missing the terminating trigger but It was a
> misinterpretation of the logs.
>
> We are missing the terminating leg for the conf-factory.
>
> I am not sure where and how shall we configure this specific trigger for
> the conferencing feature.
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Wednesday, January 6, 2016 3:44 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> Your trigger is using the Conjunctive Normal Form, so it matches a message
> if at least of one of each entry in your groups is true. Group 0 in your
> IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
> "MESSAGE" or session case 0 or session case 1), so this should match any
> INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
> originating registered or terminating registered.
>
>
>
> This IFC should be triggered for originating and terminating INVITEs
> therefore ? can you please send me the Sprout debug logs for a call? To
> turn on debug logging create/edit the file /etc/clearwater/user_settings,
> add log_level=5 and then restart Sprout (service sprout stop ? it?s
> automatically restarted by monit).
>
>
>
> Also, you don?t need this complicated a trigger if you just want to match
> all INVITEs ? you could just use:
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 05 January 2016 15:18
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Thanks Ellie,
>
>
>
> I reviewed the spec and the links provided.
>
> But I could not reach a situation where the application server gets
> notified of both originating and terminating SIP INVITEs?
>
> This is the trigger I used lastly.
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Is there a known issue getting the terminating party SIP INVITEs?
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, October 1, 2015 3:08 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> We?ve got some examples of iFC configuration in
> http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
> and
> https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.
>
>
>
>
> For a full description of how to configure iFCs, I recommend that you
> check out TS 29.228 (release 10, Annex C and F).
>
>
>
> Ellie
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
> <clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
> Malka
> *Sent:* 01 October 2015 12:31
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Configuration of iFCs rules
>
>
>
> Hi,
>
>
>
> I could not find in the doc pages a full guide for the configuration of
> iFC rules.
>
> I need to configure a rule for 3rd party registrar and for MMTel
> Conferencing.
>
> I there some information available around this topic somewhere?
>
>
>
> -Franck.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160112/116212dc/attachment.html>

From sainath.ellendula at wipro.com  Wed Jan 13 01:27:04 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Wed, 13 Jan 2016 06:27:04 +0000
Subject: [Clearwater] Issue in bono specific node
In-Reply-To: <BLUPR02MB12517C681921FCE01C1078C49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>,
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB12517C681921FCE01C1078C49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB14004AFE9784B7F773F2F1AFF2CB0@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Ellie,


Thanks for response.


After running 'nslookup sprout.pes.com' getting error as :


;; connection timed out; no servers could be reached


For this should i have to modify anything?


Reg, Another mail related to password display in Ellis UI is got resolved and now able to create number which displayed password at dashboard.


Thanks in advance!!


Regards,

Sai




________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Sent: 12 January 2016 23:22
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org
Subject: RE: Issue in bono specific node


Hi Sai,



What's the full output of running 'nslookup sprout.pes.com' on your Bono node?



Ellie



From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 11 January 2016 13:31
To: Eleanor Merry; clearwater at lists.projectclearwater.org
Subject: Issue in bono specific node



Hi Ellie,



I observed an error in bono log /var/log/bono *.log



But i can ping sprout machine from bono with name "sprout.pes.com".



11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:86: SIPResolver::resolve for name sprout.pes.com, port 5052, transport 6, family 2

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:505: Attempt to parse sprout.pes.com as IP address

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:128: Port is specified

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:296: Perform A/AAAA record lookup only, name = sprout.pes.com

11-01-2016 13:20:04.702 UTC Verbose dnscachedresolver.cpp:237: Check cache for sprout.pes.com type 1

11-01-2016 13:20:04.702 UTC Debug dnscachedresolver.cpp:323: Pulling 0 records from cache for sprout.pes.com A

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:353: Found 0 A/AAAA records, randomizing

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:412: Adding 0 servers from blacklist

11-01-2016 13:20:04.702 UTC Error connection_pool.cpp:214: Failed to resolve sprout.pes.com to an IP address - Not found (PJ_ENOTFOUND)



Any suggestions would be helpful.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160113/f38bd4b5/attachment.html>

From Chris.Elford at metaswitch.com  Wed Jan 13 06:10:26 2016
From: Chris.Elford at metaswitch.com (Chris Elford)
Date: Wed, 13 Jan 2016 11:10:26 +0000
Subject: [Clearwater] FW: Vicomte de Bragelonne Release Note
Message-ID: <BN1PR0201MB0801EE71A9AF2A6C43D2CD29E1CB0@BN1PR0201MB0801.namprd02.prod.outlook.com>

The release for Project Clearwater sprint "Vicomte de Bragelonne" has been cut. The code for this release is tagged as release-89 in github.

This release, we've greatly simplified our config sharing model. Now, all you need to do when changing /etc/clearwater/shared_config is run the upload_shared_config script on a single node, and any changes will automatically (and safely) be shared and picked up across your Clearwater deployment. We'll be putting out a blog post on this soon as well - check out http://www.projectclearwater.org/latest-news/ for more details.

We added the ability for Project Clearwater nodes to (optionally) use RADIUS authentication for SSH login. The installation and configuration process can be found in our documentation at https://clearwater.readthedocs.org/en/stable/Radius_Authentication/index.html<https://clearwater.readthedocs.org/en/latest/Radius_Authentication/index.html>. This feature requires a RADIUS server in your network to perform authentication; information on setting one up can be found at http://freeradius.org/.<http://freeradius.org/>

This release includes the following bug fixes:

*         Bono doesn't work in split networks (https://github.com/Metaswitch/sprout/issues/1291)

*         cassandra_plugin doesn't fix up /etc/cassandra/cassandra-env.sh for IPv6 (https://github.com/Metaswitch/clearwater-cassandra/issues/67)

*         cqlsh can't connect to cassandra on pure IPv6 network when rpc_address is defaulted (https://github.com/Metaswitch/clearwater-cassandra/issues/66)

*         IPv6 address in cluster_settings is missing square brackets (https://github.com/Metaswitch/clearwater-infrastructure/issues/278)

*         memcached infrastructure script doesn't enable memcached (https://github.com/Metaswitch/clearwater-infrastructure/issues/240)

*         Auto-generated code should be clearer about alarm numbers (https://github.com/Metaswitch/clearwater-etcd/issues/214)

*         check_cluster_state displays different info when sudo'd (https://github.com/Metaswitch/clearwater-etcd/issues/167)



To upgrade to this release, follow the instructions at http://clearwater.readthedocs.org/en/latest/Upgrading_a_Clearwater_deployment/index.html. If you are deploying an all-in-one node, the standard image (http://vm-images.cw-ngv.com/cw-aio.ova) has been updated for this release.



Thanks,

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160113/54d17bdc/attachment.html>

From shriman at verizon.net  Wed Jan 13 08:35:15 2016
From: shriman at verizon.net (shriman at verizon.net)
Date: Wed, 13 Jan 2016 07:35:15 -0600 (CST)
Subject: [Clearwater] Issue in bono specific node
Message-ID: <14942777.1399.1452692115083.JavaMail.root@vms182>

An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160113/0517d444/attachment.html>

From khigh at cisco.com  Sat Jan 16 19:11:32 2016
From: khigh at cisco.com (Kevin High (khigh))
Date: Sun, 17 Jan 2016 00:11:32 +0000
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of a
	Homestead
Message-ID: <2c0c33bd772c440e94641100761111c1@XCH-RTP-004.cisco.com>

Due to user error, I had to recreate the my Homestead and Homer instances.  I was hoping that they would automatically resync with Ellis, but that doesn't appear to be the case.  I see this script in Github https://github.com/Metaswitch/ellis/blob/dev/scripts/repop_hs.py, but I don't see the script on the Ellis instance.  I am not sure if this is even what I need.  I did copy the source to a file on Ellis and tried to run it similarly to how you would run the create_numbers.py, but just ran to into a bunch of errors.

Looking for some help to re-sync the Homer and Homestead databases from Ellis.

Thanks
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160117/5ac0e7f8/attachment.html>

From Eleanor.Merry at metaswitch.com  Tue Jan 19 13:09:35 2016
From: Eleanor.Merry at metaswitch.com (Eleanor Merry)
Date: Tue, 19 Jan 2016 18:09:35 +0000
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of
	a	Homestead
In-Reply-To: <2c0c33bd772c440e94641100761111c1@XCH-RTP-004.cisco.com>
References: <2c0c33bd772c440e94641100761111c1@XCH-RTP-004.cisco.com>
Message-ID: <BN3PR02MB12556E67C86755E030BADDB79BC10@BN3PR02MB1255.namprd02.prod.outlook.com>

Hi Kevin,

How did you lose the Homestead/Homer nodes? I ask because if you truncated the databases then Cassandra automatically takes a backup before it does the truncating, so you could restore from that.

We don't have a supported method in Project Clearwater for restoring Homer/Homestead data from Ellis. We recommend instead that users take periodic backups of the persistent data stores - please see http://clearwater.readthedocs.org/en/latest/Backups/index.html for more details.

That said, I've taken a look at the repop scripts, and fixed up initial runtime errors. If you take the latest scripts from the dev branch of Ellis then you should be able to use these to repopulate Homestead/Homer (they'll fill in default values for anything Ellis doesn't know, e.g. the IFCs, and they'll reset the subscriber passwords). Please note that this isn't our supported method though, and hasn't gone through a full QA.

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin High (khigh)
Sent: 17 January 2016 00:12
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Due to user error, I had to recreate the my Homestead and Homer instances.  I was hoping that they would automatically resync with Ellis, but that doesn't appear to be the case.  I see this script in Github https://github.com/Metaswitch/ellis/blob/dev/scripts/repop_hs.py, but I don't see the script on the Ellis instance.  I am not sure if this is even what I need.  I did copy the source to a file on Ellis and tried to run it similarly to how you would run the create_numbers.py, but just ran to into a bunch of errors.

Looking for some help to re-sync the Homer and Homestead databases from Ellis.

Thanks
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160119/bb21150d/attachment.html>

From khigh at cisco.com  Tue Jan 19 16:55:29 2016
From: khigh at cisco.com (Kevin High (khigh))
Date: Tue, 19 Jan 2016 21:55:29 +0000
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of
	a	Homestead
In-Reply-To: <BN3PR02MB12556E67C86755E030BADDB79BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <2c0c33bd772c440e94641100761111c1@XCH-RTP-004.cisco.com>
	<BN3PR02MB12556E67C86755E030BADDB79BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <bc373c9cf8a24391a9a49a5da22aca1d@XCH-RTP-004.cisco.com>

Hi Ellie,

I was having issues with Originating Triggers in the IFC for my App server, so I change the IFC (app-server.json) in Ellis  and that didn't fix the issue.  Looking at the logs I noticed that it was still my old IFC.  So I unchecked and re-checked the App server in the Ellis configuration as well as restarting Ellis.  I then noticed that I was getting looping, and again digging into the logs I saw that I had two triggers now.  I dug into Cassandra on Homestead and saw both the triggers in the database.  I deleted the entries in Cassandra (not using truncate) and Ellis stopped letting me see the numbers because of the

BAD GATEWAY - The server, while acting as a gateway or proxy, received an invalid response from the upstream server it accessed in attempting to fulfill the request.
(XHR): GET Error.

I figured that perhaps if I terminate my Homestead and Homer servers and rebuild them from scratch that it would rebuild the databases from Ellis.  But looking back I guess I didn't take into consideration that even though you populate the numbers in Ellis prior to installing Homer and Homestead, you don't create the users, which is what would be different right now.  So needless to say at this point, that didn't work.

I just ran your updated script and it populated the Cassandra databases on Homestead, but I am still getting the BAD GATEWAY error trying to look at my previous numbers.   So presuming something is still missing.  I have restarted all the services.

Just to note, this is a manual install with each components bono, sprout, homer, homestead and ellis running on individual servers.

Thanks
Kevin

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
Sent: Tuesday, January 19, 2016 10:10 AM
To: Kevin High (khigh) <khigh at cisco.com>; clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Hi Kevin,

How did you lose the Homestead/Homer nodes? I ask because if you truncated the databases then Cassandra automatically takes a backup before it does the truncating, so you could restore from that.

We don't have a supported method in Project Clearwater for restoring Homer/Homestead data from Ellis. We recommend instead that users take periodic backups of the persistent data stores - please see http://clearwater.readthedocs.org/en/latest/Backups/index.html for more details.

That said, I've taken a look at the repop scripts, and fixed up initial runtime errors. If you take the latest scripts from the dev branch of Ellis then you should be able to use these to repopulate Homestead/Homer (they'll fill in default values for anything Ellis doesn't know, e.g. the IFCs, and they'll reset the subscriber passwords). Please note that this isn't our supported method though, and hasn't gone through a full QA.

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin High (khigh)
Sent: 17 January 2016 00:12
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Due to user error, I had to recreate the my Homestead and Homer instances.  I was hoping that they would automatically resync with Ellis, but that doesn't appear to be the case.  I see this script in Github https://github.com/Metaswitch/ellis/blob/dev/scripts/repop_hs.py, but I don't see the script on the Ellis instance.  I am not sure if this is even what I need.  I did copy the source to a file on Ellis and tried to run it similarly to how you would run the create_numbers.py, but just ran to into a bunch of errors.

Looking for some help to re-sync the Homer and Homestead databases from Ellis.

Thanks
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160119/0477bdc9/attachment.html>

From peter.skrzynski at nec.co.nz  Tue Jan 19 17:04:27 2016
From: peter.skrzynski at nec.co.nz (Peter Skrzynski)
Date: Tue, 19 Jan 2016 22:04:27 +0000
Subject: [Clearwater] Bulk provisioning problem
Message-ID: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>

Hi,
I have a manual install using Release 76 ?In Dubious Battle?.
To bulk provision a specific range of numbers, I used a modified version of the bulk_create.py which does not use a csv file, and that worked fine.
I am now upgrading my IMS to the latest Release 89 ?Vicomte de Bragelonne?.
My modified bulk creation script no longer works.
There seems to be problems with the bulk_create.py file in Release 89.
The first line (of bulk_create.py) specifies the python file location as /usr/share/clearwater/crest/env/bin/python,
but actually it is in /usr/share/clearwater/clearwater-prov-tools/env/bin/python.
I fixed that and now it fails on the line ?from metaswitch.crest.tools.utils import create_imssubscription_xml?.
The error output is:
------------------------------------------------------------------------------------------
Traceback (most recent call last):
  File ?./my_bulk_create.py?, line 65, in <module>
    From metaswitch.crest.tools.utils import create_imssubscription_xml
ImportError: No module named crest.tools.utils
-------------------------------------------------------------------------------------------
Given that the python file is under ?/usr/share/clearwater/clearwater-prov-tools/?, but the metaswitch directory is under ?/usr/share/clearwater/crest/src/?,
does that mean there is a directory structure issue in homestead?
Or is it possible to fix my problem somehow?
I note that in Release 76 they were both under ?/usr/share/clearwater/homestead/?.
Regards
Peter.




Peter Skrzynski

Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image4de057.JPG at 052fbe88.4cb5803d]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160119/dadf98db/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image4de057.JPG
Type: image/jpeg
Size: 59501 bytes
Desc: image4de057.JPG
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160119/dadf98db/attachment.jpe>

From Matt.Williams at metaswitch.com  Wed Jan 20 04:24:27 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Wed, 20 Jan 2016 09:24:27 +0000
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild
	of	a	Homestead
In-Reply-To: <bc373c9cf8a24391a9a49a5da22aca1d@XCH-RTP-004.cisco.com>
References: <2c0c33bd772c440e94641100761111c1@XCH-RTP-004.cisco.com>
	<BN3PR02MB12556E67C86755E030BADDB79BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
	<bc373c9cf8a24391a9a49a5da22aca1d@XCH-RTP-004.cisco.com>
Message-ID: <CY1PR0201MB156308DD0CD61CF49C6A4C6A90C20@CY1PR0201MB1563.namprd02.prod.outlook.com>

Kevin,

Ellie's away for the next week or so, so I'm replying in her absence.

Please can you share the logs from Ellis (below /var/log/ellis) and Homestead-Prov (below /var/log/homestead-prov) that are generated when you see this failure?  This will tell us which URL on Homestead-Prov failed, and hopefully why - then we can figure out what configuration needs to be reinstated in Cassandra.

Regarding Ellis and app server provisioning, the way this works is that

*         when you tick an app server in the Ellis UI, Ellis reads the IFC from app-server.json and writes it to Homestead

*         when you reload the page, Ellis reads the IFCs from Homestead, sees if any match the app servers in app-server.json and marks the checkboxes as ticked/unticked accordingly

*         if you untick an app server in the Ellis UI, Ellis finds the IFC that corresponds to it and removes it

*         crucially, if an IFC doesn't match any app server, Ellis just ignores the IFC - it doesn't display it in the Ellis UI and it doesn't modify the IFC.

As a result, the best way to change an app server's IFC is either to

*         find all the subscribers with the old IFC, uncheck that app server in the Ellis UI, modiy the IFC in app-server.json and then recheck the app server or

*         not modify the IFC in app-server.json and instead just introduce a new app server (e.g. "app server v2") in app-server.json and then, on a per-subscriber basis, uncheck the old app server and check the new one.

I admit this is a bit clunky - unlike components like Sprout and Homestead, which are built to be carrier-grade, Ellis is a tool for easy provisioning for demos and testing, but does have a few rough edges!

Please let me know about the logs.

Thanks,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin High (khigh)
Sent: 19 January 2016 21:55
To: Eleanor Merry <Eleanor.Merry at metaswitch.com>; clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Hi Ellie,

I was having issues with Originating Triggers in the IFC for my App server, so I change the IFC (app-server.json) in Ellis  and that didn't fix the issue.  Looking at the logs I noticed that it was still my old IFC.  So I unchecked and re-checked the App server in the Ellis configuration as well as restarting Ellis.  I then noticed that I was getting looping, and again digging into the logs I saw that I had two triggers now.  I dug into Cassandra on Homestead and saw both the triggers in the database.  I deleted the entries in Cassandra (not using truncate) and Ellis stopped letting me see the numbers because of the

BAD GATEWAY - The server, while acting as a gateway or proxy, received an invalid response from the upstream server it accessed in attempting to fulfill the request.
(XHR): GET Error.

I figured that perhaps if I terminate my Homestead and Homer servers and rebuild them from scratch that it would rebuild the databases from Ellis.  But looking back I guess I didn't take into consideration that even though you populate the numbers in Ellis prior to installing Homer and Homestead, you don't create the users, which is what would be different right now.  So needless to say at this point, that didn't work.

I just ran your updated script and it populated the Cassandra databases on Homestead, but I am still getting the BAD GATEWAY error trying to look at my previous numbers.   So presuming something is still missing.  I have restarted all the services.

Just to note, this is a manual install with each components bono, sprout, homer, homestead and ellis running on individual servers.

Thanks
Kevin

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
Sent: Tuesday, January 19, 2016 10:10 AM
To: Kevin High (khigh) <khigh at cisco.com<mailto:khigh at cisco.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Hi Kevin,

How did you lose the Homestead/Homer nodes? I ask because if you truncated the databases then Cassandra automatically takes a backup before it does the truncating, so you could restore from that.

We don't have a supported method in Project Clearwater for restoring Homer/Homestead data from Ellis. We recommend instead that users take periodic backups of the persistent data stores - please see http://clearwater.readthedocs.org/en/latest/Backups/index.html for more details.

That said, I've taken a look at the repop scripts, and fixed up initial runtime errors. If you take the latest scripts from the dev branch of Ellis then you should be able to use these to repopulate Homestead/Homer (they'll fill in default values for anything Ellis doesn't know, e.g. the IFCs, and they'll reset the subscriber passwords). Please note that this isn't our supported method though, and hasn't gone through a full QA.

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin High (khigh)
Sent: 17 January 2016 00:12
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Syncing Ellis with Homestead have rebuild of a Homestead

Due to user error, I had to recreate the my Homestead and Homer instances.  I was hoping that they would automatically resync with Ellis, but that doesn't appear to be the case.  I see this script in Github https://github.com/Metaswitch/ellis/blob/dev/scripts/repop_hs.py, but I don't see the script on the Ellis instance.  I am not sure if this is even what I need.  I did copy the source to a file on Ellis and tried to run it similarly to how you would run the create_numbers.py, but just ran to into a bunch of errors.

Looking for some help to re-sync the Homer and Homestead databases from Ellis.

Thanks
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/e559f5cb/attachment.html>

From fmalka at modulo.co.il  Wed Jan 20 08:33:53 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Wed, 20 Jan 2016 15:33:53 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <CAKX=ev36d+fbBa48Zpd+c9FGpVY5iqAg17p3+CYGQO5eQjS0Nw@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>	<CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
	<BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
	<CAKX=ev36d+fbBa48Zpd+c9FGpVY5iqAg17p3+CYGQO5eQjS0Nw@mail.gmail.com>
Message-ID: <177e6cf9003bae8c0934ffcdb962b058@mail.gmail.com>

Hi Ellie,



I am not sure either or not I still have a problem with the iFCs triggers
or not.

I am still using the following trigger

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>

But I noticed that when I am transferring a call between parties, the
NOTIFY message is not reaching the REFERing client.

I would like to make a test where NOTIFY is excluded from the trigger and
is not forwarded to the MMTEL AS.

Can you help with the correct syntax of the iFC?



-Franck.





*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* Tuesday, January 12, 2016 8:19 PM
*To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>
*Cc:* clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks i just used a non registered private identity as a trigger and it
did the job for me.

Franck

On Jan 12, 2016 20:01, "Eleanor Merry" <Eleanor.Merry at metaswitch.com> wrote:

Hi Franck,



Thanks for sending the logs across. On the terminating leg of the call,
Sprout asks Homestead for the subscriber data of
sip:conf-factory at example.com. It doesn?t look like Homestead knows anything
about this PSI though, so it returns a 404, and Sprout then rejects the
call.



You?ll need to make sure Clearwater knows about the PSI.



Are you using an external HSS? If so, then add the PSI to the HSS (the
details for how to do so depend on your HSS). If you?re not using a HSS,
then you can add the PSI using the Ellis API (see
https://github.com/Metaswitch/ellis/blob/dev/docs/api.md#provisioning-specific-numbers
for details). Then you can set up the PSI IFC in the same way that you?ve
done for your other subscribers (but make sure that the IFC for the PSI
doesn?t only trigger for **registered** subscribers).



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* 08 January 2016 05:00
*To:* clearwater at lists.projectclearwater.org; Eleanor Merry
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi

Further investigating this issue, i was told by the MMTEL AS guys that i
need to configure an iFC for a Public Service Identity (PSI) with
conf-factory URI.

any guidelines on how would look the syntax of such an iFC?

Franck

On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il> wrote:

Attached the requested logs:



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, January 7, 2016 1:46 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



To turn on debug logging create/edit the file
/etc/clearwater/user_settings, add log_level=5 and then restart Sprout
(service sprout stop ? it?s automatically restarted by monit). The logs are
output in /var/log/sprout/.



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 07 January 2016 11:42
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Can you tell me how to enable debug logs?

The only thing I see in the sprout log is



[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt

07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14390.840820 (based on a smoothed mean
latency of 1301 and 0 upstream overload responses)

07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14400.557617 (based on a smoothed mean
latency of 2830 and 0 upstream overload responses)

07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14410.234375 (based on a smoothed mean
latency of 3231 and 0 upstream overload responses)

07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
request rate/second increased to 14419.383789 (based on a smoothed mean
latency of 8509 and 0 upstream overload responses)

07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS

07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with
cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404

07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
subscriber data from HSS



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, January 7, 2016 1:35 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Frank,



Can you send me the Sprout debug logs for this call?



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 07 January 2016 10:17
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hello Again,



I think I am getting closer to my problem here.



In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
according to the P-Served-User Header sescase tag.



So when the calls come-in to the AS with

P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg

The sescase tag is orig, so the AS threat the call as an originating leg
and return the call to the S-CSCF as for any usual call.



Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
the header to

P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg

And to return the request to the AS, then the AS shall detect the
terminating leg and forward handle the call as a conference call.



My problem here is that the S-CSCF do not change the sescase tag to term,
so the INVITE request is going back and forward between the S-CSCF and the
AS and nobody handles it.



So, the refined question would be: How do I configure the S-CSCF to change
the leg type here?



See attached pcap.



-Franck.



*From:* Franck Malka [mailto:fmalka at modulo.co.il]
*Sent:* Wednesday, January 6, 2016 3:51 PM
*To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Ellie,



Thanks for the comment.

I think I originally misunderstood the problem I have.

I do get originating and terminating triggers on the MMTEL AS.

This works fine.



The problem I face is with MMTEL Conference.

In this specific scenario, the MMTEL AS sends the INVITE Request with the
conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
leg for it with the conference focus id.



I thought we were missing the terminating trigger but It was a
misinterpretation of the logs.

We are missing the terminating leg for the conf-factory.

I am not sure where and how shall we configure this specific trigger for
the conferencing feature.



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Wednesday, January 6, 2016 3:44 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



Your trigger is using the Conjunctive Normal Form, so it matches a message
if at least of one of each entry in your groups is true. Group 0 in your
IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
"MESSAGE" or session case 0 or session case 1), so this should match any
INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
originating registered or terminating registered.



This IFC should be triggered for originating and terminating INVITEs
therefore ? can you please send me the Sprout debug logs for a call? To
turn on debug logging create/edit the file /etc/clearwater/user_settings,
add log_level=5 and then restart Sprout (service sprout stop ? it?s
automatically restarted by monit).



Also, you don?t need this complicated a trigger if you just want to match
all INVITEs ? you could just use:



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Ellie



*From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
*Sent:* 05 January 2016 15:18
*To:* Eleanor Merry; clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Thanks Ellie,



I reviewed the spec and the links provided.

But I could not reach a situation where the application server gets
notified of both originating and terminating SIP INVITEs?

This is the trigger I used lastly.



<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
>



Is there a known issue getting the terminating party SIP INVITEs?



-Franck.



*From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
*Sent:* Thursday, October 1, 2015 3:08 PM
*To:* Franck Malka <fmalka at modulo.co.il>;
clearwater at lists.projectclearwater.org
*Subject:* RE: [Clearwater] Configuration of iFCs rules



Hi Franck,



We?ve got some examples of iFC configuration in
http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
and
https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.




For a full description of how to configure iFCs, I recommend that you check
out TS 29.228 (release 10, Annex C and F).



Ellie



*From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
<clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
Malka
*Sent:* 01 October 2015 12:31
*To:* clearwater at lists.projectclearwater.org
*Subject:* [Clearwater] Configuration of iFCs rules



Hi,



I could not find in the doc pages a full guide for the configuration of iFC
rules.

I need to configure a rule for 3rd party registrar and for MMTel
Conferencing.

I there some information available around this topic somewhere?



-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/b90fddaa/attachment.html>

From Matt.Williams at metaswitch.com  Wed Jan 20 11:00:52 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Wed, 20 Jan 2016 16:00:52 +0000
Subject: [Clearwater] Bulk provisioning problem
In-Reply-To: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>
References: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>
Message-ID: <CY1PR0201MB156391704411139A63AEEBF590C20@CY1PR0201MB1563.namprd02.prod.outlook.com>

Peter,

Thanks for your email.

When you ran this before, did you run your my_bulk_create.py script on the Ellis node, or did you run it on the Homestead node?  I would expect you to run it on the Homestead node.

The issue you're hitting is that the "python" binary you've found below clearwater-prov-tools is in a special virtual environment ("virtualenv").  This virtual environment doesn't include the "crest" code on which bulk_create.py depends.  Crest is the Cassandra-backed RESTful HTTP server platform on which both Homestead-Prov and Homer are built.

There should be a python binary below /usr/share/clearwater/crest/env/bin/python - I've checked that it exists on both a freshly-installed Homestead node and a Homestead node that has been upgraded through many intermediate releases (although not necessarily 76 directly to 89, for which maybe there's an upgrade issue).

If you're trying to run this on a Homestead node and it's still failing, please can you check that homestead-prov is installed correctly?  To do this, run "dpkg-query -s homestead-prov" and check that it says "Status: install ok installed" (along with a load of other output!).

Please let me know how you get on.

Cheers,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Peter Skrzynski
Sent: 19 January 2016 22:04
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Bulk provisioning problem

Hi,
I have a manual install using Release 76 ?In Dubious Battle?.
To bulk provision a specific range of numbers, I used a modified version of the bulk_create.py which does not use a csv file, and that worked fine.
I am now upgrading my IMS to the latest Release 89 ?Vicomte de Bragelonne?.
My modified bulk creation script no longer works.
There seems to be problems with the bulk_create.py file in Release 89.
The first line (of bulk_create.py) specifies the python file location as /usr/share/clearwater/crest/env/bin/python,
but actually it is in /usr/share/clearwater/clearwater-prov-tools/env/bin/python.
I fixed that and now it fails on the line ?from metaswitch.crest.tools.utils import create_imssubscription_xml?.
The error output is:
------------------------------------------------------------------------------------------
Traceback (most recent call last):
  File ?./my_bulk_create.py?, line 65, in <module>
    From metaswitch.crest.tools.utils import create_imssubscription_xml
ImportError: No module named crest.tools.utils
-------------------------------------------------------------------------------------------
Given that the python file is under ?/usr/share/clearwater/clearwater-prov-tools/?, but the metaswitch directory is under ?/usr/share/clearwater/crest/src/?,
does that mean there is a directory structure issue in homestead?
Or is it possible to fix my problem somehow?
I note that in Release 76 they were both under ?/usr/share/clearwater/homestead/?.
Regards
Peter.




Peter Skrzynski
Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image002.jpg at 01D15399.72223080]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/50988067/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 8344 bytes
Desc: image002.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/50988067/attachment.jpg>

From Matt.Williams at metaswitch.com  Wed Jan 20 11:22:11 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Wed, 20 Jan 2016 16:22:11 +0000
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <177e6cf9003bae8c0934ffcdb962b058@mail.gmail.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
	<CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
	<BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
	<CAKX=ev36d+fbBa48Zpd+c9FGpVY5iqAg17p3+CYGQO5eQjS0Nw@mail.gmail.com>
	<177e6cf9003bae8c0934ffcdb962b058@mail.gmail.com>
Message-ID: <CY1PR0201MB15636D2907DB6C4BA55958FD90C20@CY1PR0201MB1563.namprd02.prod.outlook.com>

Franck,

Ellie is away for the next week or so, so I'm replying in her absence.

I think the IFC you've specified (formatted below) should only send INVITEs (not NOTIFYs) to the AS.

<InitialFilterCriteria>
  <TriggerPoint>
    <ConditionTypeCNF>1</ConditionTypeCNF>
    <SPT>
      <ConditionNegated>0</ConditionNegated>
      <Group>0</Group>
      <Method>INVITE</Method>
    </SPT>
  </TriggerPoint>
  <ApplicationServer>
    <ServerName>sip:10.0.20.215</ServerName>
    <DefaultHandling>0</DefaultHandling>
  </ApplicationServer>
</InitialFilterCriteria>

However, bear in mind that IFCs only apply for the first message of a dialog.  When the initial INVITE flows, we match these IFCs and decide to send the call to the AS.  At this point, the AS has a choice as to whether it adds a "Record-Route" header to the INVITE.

?         If the AS does add this header, all subsequent messages in the dialog will be sent via the AS, no matter what the SIP message is or what the IFCs are.

?         If the AS does not add this header, no further messages in the dialog will be sent via the AS - not even re-INVITEs.
The Record-Route headers contain the "route set" that describes the route that SIP messages follow.

Assuming that the REFER was sent in the same dialog as the INVITE, it would use the same route-set as the INVITE, and the NOTIFY would then inherit this route set too.  As a result, it would go via the AS.

In other words, I don't think there's a way for bypassing the AS on this in-dialog NOTIFY.  However, I would expect the AS to propagate the NOTIFY - do you know why that's not happening?

Incidentally, for more information on the Record-Route header, see RFC 3261, section 20.30.

Please let me know if I've misunderstood the scenario (e.g. if the REFER is out-of-dialog or if the AS did not Record-Route itself), or if you have any questions.

Thanks,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 20 January 2016 13:34
To: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Configuration of iFCs rules

Hi Ellie,

I am not sure either or not I still have a problem with the iFCs triggers or not.
I am still using the following trigger
<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>
But I noticed that when I am transferring a call between parties, the NOTIFY message is not reaching the REFERing client.
I would like to make a test where NOTIFY is excluded from the trigger and is not forwarded to the MMTEL AS.
Can you help with the correct syntax of the iFC?

-Franck.


From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: Tuesday, January 12, 2016 8:19 PM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules


Thanks i just used a non registered private identity as a trigger and it did the job for me.

Franck
On Jan 12, 2016 20:01, "Eleanor Merry" <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>> wrote:
Hi Franck,

Thanks for sending the logs across. On the terminating leg of the call, Sprout asks Homestead for the subscriber data of sip:conf-factory at example.com. It doesn?t look like Homestead knows anything about this PSI though, so it returns a 404, and Sprout then rejects the call.

You?ll need to make sure Clearwater knows about the PSI.

Are you using an external HSS? If so, then add the PSI to the HSS (the details for how to do so depend on your HSS). If you?re not using a HSS, then you can add the PSI using the Ellis API (see https://github.com/Metaswitch/ellis/blob/dev/docs/api.md#provisioning-specific-numbers for details). Then you can set up the PSI IFC in the same way that you?ve done for your other subscribers (but make sure that the IFC for the PSI doesn?t only trigger for *registered* subscribers).

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: 08 January 2016 05:00
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>; Eleanor Merry
Subject: RE: [Clearwater] Configuration of iFCs rules


Hi

Further investigating this issue, i was told by the MMTEL AS guys that i need to configure an iFC for a Public Service Identity (PSI) with conf-factory URI.

any guidelines on how would look the syntax of such an iFC?

Franck
On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>> wrote:
Attached the requested logs:

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, January 7, 2016 1:46 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit). The logs are output in /var/log/sprout/.

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 11:42
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Can you tell me how to enable debug logs?
The only thing I see in the sprout log is

[cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14390.840820 (based on a smoothed mean latency of 1301 and 0 upstream overload responses)
07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14400.557617 (based on a smoothed mean latency of 2830 and 0 upstream overload responses)
07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14410.234375 (based on a smoothed mean latency of 3231 and 0 upstream overload responses)
07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming request rate/second increased to 14419.383789 (based on a smoothed mean latency of 8509 and 0 upstream overload responses)
07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS
07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get subscriber data from HSS

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, January 7, 2016 1:35 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Frank,

Can you send me the Sprout debug logs for this call?

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 07 January 2016 10:17
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hello Again,

I think I am getting closer to my problem here.

In fact, the UE dials to the conf-factory and the MMTEL AS routes the call according to the P-Served-User Header sescase tag.

So when the calls come-in to the AS with
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=orig;regstate=reg
The sescase tag is orig, so the AS threat the call as an originating leg and return the call to the S-CSCF as for any usual call.

Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change the header to
P-Served-User: <sip:6505550955 at example.com<mailto:sip%3A6505550955 at example.com>>;sescase=term;regstate=reg
And to return the request to the AS, then the AS shall detect the terminating leg and forward handle the call as a conference call.

My problem here is that the S-CSCF do not change the sescase tag to term, so the INVITE request is going back and forward between the S-CSCF and the AS and nobody handles it.

So, the refined question would be: How do I configure the S-CSCF to change the leg type here?

See attached pcap.

-Franck.

From: Franck Malka [mailto:fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>]
Sent: Wednesday, January 6, 2016 3:51 PM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Ellie,

Thanks for the comment.
I think I originally misunderstood the problem I have.
I do get originating and terminating triggers on the MMTEL AS.
This works fine.

The problem I face is with MMTEL Conference.
In this specific scenario, the MMTEL AS sends the INVITE Request with the conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT leg for it with the conference focus id.

I thought we were missing the terminating trigger but It was a misinterpretation of the logs.
We are missing the terminating leg for the conf-factory.
I am not sure where and how shall we configure this specific trigger for the conferencing feature.

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Wednesday, January 6, 2016 3:44 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

Your trigger is using the Conjunctive Normal Form, so it matches a message if at least of one of each entry in your groups is true. Group 0 in your IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or "MESSAGE" or session case 0 or session case 1), so this should match any INVITE and any MESSAGE requests, and any SUSCRIBE requests that are originating registered or terminating registered.

This IFC should be triggered for originating and terminating INVITEs therefore ? can you please send me the Sprout debug logs for a call? To turn on debug logging create/edit the file /etc/clearwater/user_settings, add log_level=5 and then restart Sprout (service sprout stop ? it?s automatically restarted by monit).

Also, you don?t need this complicated a trigger if you just want to match all INVITEs ? you could just use:

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Ellie

From: Franck Malka [mailto:fmalka at modulo.co.il]
Sent: 05 January 2016 15:18
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Thanks Ellie,

I reviewed the spec and the links provided.
But I could not reach a situation where the application server gets notified of both originating and terminating SIP INVITEs?
This is the trigger I used lastly.

<InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria<sip:10.0.20.215%3c/ServerName%3e%3cDefaultHandling%3e0%3c/DefaultHandling%3e%3c/ApplicationServer%3e%3c/InitialFilterCriteria>>

Is there a known issue getting the terminating party SIP INVITEs?

-Franck.

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>]
Sent: Thursday, October 1, 2015 3:08 PM
To: Franck Malka <fmalka at modulo.co.il<mailto:fmalka at modulo.co.il>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] Configuration of iFCs rules

Hi Franck,

We?ve got some examples of iFC configuration in http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl and https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.

For a full description of how to configure iFCs, I recommend that you check out TS 29.228 (release 10, Annex C and F).

Ellie

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Franck Malka
Sent: 01 October 2015 12:31
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Configuration of iFCs rules

Hi,

I could not find in the doc pages a full guide for the configuration of iFC rules.
I need to configure a rule for 3rd party registrar and for MMTel Conferencing.
I there some information available around this topic somewhere?

-Franck.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/8b515dbf/attachment.html>

From fmalka at modulo.co.il  Wed Jan 20 11:30:50 2016
From: fmalka at modulo.co.il (Franck Malka)
Date: Wed, 20 Jan 2016 18:30:50 +0200
Subject: [Clearwater] Configuration of iFCs rules
In-Reply-To: <CY1PR0201MB15636D2907DB6C4BA55958FD90C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <8b677254bf5f329ee7f3c991ca911a7e@mail.gmail.com>
	<BN3PR02MB1255054A38E92AD1D0E6A74D9B4C0@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ccd5d9e38e10bde5da2914f095f3ec41@mail.gmail.com>
	<BN3PR02MB12556D140223D3A7ADBFC09F9BF40@BN3PR02MB1255.namprd02.prod.outlook.com>
	<ddc2f1061ec4424e1559abfe53212f69@mail.gmail.com>
	<5ec06403409a565c41ab12e68e60d33b@mail.gmail.com>
	<BLUPR02MB1251420BD68041832308CC1E9BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<cd2baf1f5be943b35e8351adad74fb3d@mail.gmail.com>
	<BLUPR02MB1251EE7789BAC92394149DB29BF50@BLUPR02MB1251.namprd02.prod.outlook.com>
	<811e4c2a7a6a4bb3c9c22530fe1be8e8@mail.gmail.com>
	<CAKX=ev3RL2Msg4BGdgHhMwOaY0AgkUgDJ5KpHkE947_MvYGZpA@mail.gmail.com>
	<BLUPR02MB12517B724287DB1404EE04279BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
	<CAKX=ev36d+fbBa48Zpd+c9FGpVY5iqAg17p3+CYGQO5eQjS0Nw@mail.gmail.com>
	<177e6cf9003bae8c0934ffcdb962b058@mail.gmail.com>
	<CY1PR0201MB15636D2907DB6C4BA55958FD90C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAKX=ev3CL8Cr+9mZMTuxMU5BsyZ6c2-Gyr+5qqQLsFycHB=+ag@mail.gmail.com>

thank you Matt

i found my problem and it was not related to tyw trigger.

Franck.
On Jan 20, 2016 6:22 PM, "Matt Williams" <Matt.Williams at metaswitch.com>
wrote:

> Franck,
>
>
>
> Ellie is away for the next week or so, so I'm replying in her absence.
>
>
>
> I think the IFC you've specified (formatted below) should only send
> INVITEs (not NOTIFYs) to the AS.
>
>
>
> <InitialFilterCriteria>
>
>   <TriggerPoint>
>
>     <ConditionTypeCNF>1</ConditionTypeCNF>
>
>     <SPT>
>
>       <ConditionNegated>0</ConditionNegated>
>
>       <Group>0</Group>
>
>       <Method>INVITE</Method>
>
>     </SPT>
>
>   </TriggerPoint>
>
>   <ApplicationServer>
>
>     <ServerName>sip:10.0.20.215</ServerName>
>
>     <DefaultHandling>0</DefaultHandling>
>
>   </ApplicationServer>
>
> </InitialFilterCriteria>
>
>
>
> However, bear in mind that IFCs only apply for the first message of a
> dialog.  When the initial INVITE flows, we match these IFCs and decide to
> send the call to the AS.  At this point, the AS has a choice as to whether
> it adds a "Record-Route" header to the INVITE.
>
> ?         If the AS does add this header, all subsequent messages in the
> dialog will be sent via the AS, no matter what the SIP message is or what
> the IFCs are.
>
> ?         If the AS does not add this header, no further messages in the
> dialog will be sent via the AS - not even re-INVITEs.
>
> The Record-Route headers contain the "route set" that describes the route
> that SIP messages follow.
>
>
>
> Assuming that the REFER was sent in the same dialog as the INVITE, it
> would use the same route-set as the INVITE, and the NOTIFY would then
> inherit this route set too.  As a result, it would go via the AS.
>
>
>
> In other words, I don't think there's a way for bypassing the AS on this
> in-dialog NOTIFY.  However, I would expect the AS to propagate the NOTIFY -
> do you know why that's not happening?
>
>
>
> Incidentally, for more information on the Record-Route header, see RFC
> 3261, section 20.30.
>
>
>
> Please let me know if I've misunderstood the scenario (e.g. if the REFER
> is out-of-dialog or if the AS did not Record-Route itself), or if you have
> any questions.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Franck Malka
> *Sent:* 20 January 2016 13:34
> *To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Ellie,
>
>
>
> I am not sure either or not I still have a problem with the iFCs triggers
> or not.
>
> I am still using the following trigger
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
> But I noticed that when I am transferring a call between parties, the
> NOTIFY message is not reaching the REFERing client.
>
> I would like to make a test where NOTIFY is excluded from the trigger and
> is not forwarded to the MMTEL AS.
>
> Can you help with the correct syntax of the iFC?
>
>
>
> -Franck.
>
>
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* Tuesday, January 12, 2016 8:19 PM
> *To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Thanks i just used a non registered private identity as a trigger and it
> did the job for me.
>
> Franck
>
> On Jan 12, 2016 20:01, "Eleanor Merry" <Eleanor.Merry at metaswitch.com>
> wrote:
>
> Hi Franck,
>
>
>
> Thanks for sending the logs across. On the terminating leg of the call,
> Sprout asks Homestead for the subscriber data of
> sip:conf-factory at example.com. It doesn?t look like Homestead knows
> anything about this PSI though, so it returns a 404, and Sprout then
> rejects the call.
>
>
>
> You?ll need to make sure Clearwater knows about the PSI.
>
>
>
> Are you using an external HSS? If so, then add the PSI to the HSS (the
> details for how to do so depend on your HSS). If you?re not using a HSS,
> then you can add the PSI using the Ellis API (see
> https://github.com/Metaswitch/ellis/blob/dev/docs/api.md#provisioning-specific-numbers
> for details). Then you can set up the PSI IFC in the same way that you?ve
> done for your other subscribers (but make sure that the IFC for the PSI
> doesn?t only trigger for **registered** subscribers).
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* 08 January 2016 05:00
> *To:* clearwater at lists.projectclearwater.org; Eleanor Merry
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi
>
> Further investigating this issue, i was told by the MMTEL AS guys that i
> need to configure an iFC for a Public Service Identity (PSI) with
> conf-factory URI.
>
> any guidelines on how would look the syntax of such an iFC?
>
> Franck
>
> On Jan 7, 2016 14:28, "Franck Malka" <fmalka at modulo.co.il> wrote:
>
> Attached the requested logs:
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:46 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> To turn on debug logging create/edit the file
> /etc/clearwater/user_settings, add log_level=5 and then restart Sprout
> (service sprout stop ? it?s automatically restarted by monit). The logs are
> output in /var/log/sprout/.
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 11:42
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Can you tell me how to enable debug logs?
>
> The only thing I see in the sprout log is
>
>
>
> [cw-aio]ubuntu at cw-aio:/var/log/sprout$ tail -f sprout_current.txt
>
> 07-01-2016 11:35:58.468 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14390.840820 (based on a smoothed mean
> latency of 1301 and 0 upstream overload responses)
>
> 07-01-2016 11:37:41.905 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14400.557617 (based on a smoothed mean
> latency of 2830 and 0 upstream overload responses)
>
> 07-01-2016 11:39:42.301 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14410.234375 (based on a smoothed mean
> latency of 3231 and 0 upstream overload responses)
>
> 07-01-2016 11:40:22.812 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:40:22.812 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.701 UTC Status load_monitor.cpp:237: Maximum incoming
> request rate/second increased to 14419.383789 (based on a smoothed mean
> latency of 8509 and 0 upstream overload responses)
>
> 07-01-2016 11:41:12.714 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.714 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
> 07-01-2016 11:41:12.944 UTC Error httpconnection.cpp:743: cURL failure
> with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
>
> 07-01-2016 11:41:12.945 UTC Error hssconnection.cpp:593: Could not get
> subscriber data from HSS
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, January 7, 2016 1:35 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Frank,
>
>
>
> Can you send me the Sprout debug logs for this call?
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 07 January 2016 10:17
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hello Again,
>
>
>
> I think I am getting closer to my problem here.
>
>
>
> In fact, the UE dials to the conf-factory and the MMTEL AS routes the call
> according to the P-Served-User Header sescase tag.
>
>
>
> So when the calls come-in to the AS with
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=orig;regstate=reg
>
> The sescase tag is orig, so the AS threat the call as an originating leg
> and return the call to the S-CSCF as for any usual call.
>
>
>
> Now the gets the S-CSCF the INVITE back the AS expect the S-CSCF to change
> the header to
>
> P-Served-User: <sip:6505550955 at example.com>;sescase=term;regstate=reg
>
> And to return the request to the AS, then the AS shall detect the
> terminating leg and forward handle the call as a conference call.
>
>
>
> My problem here is that the S-CSCF do not change the sescase tag to term,
> so the INVITE request is going back and forward between the S-CSCF and the
> AS and nobody handles it.
>
>
>
> So, the refined question would be: How do I configure the S-CSCF to change
> the leg type here?
>
>
>
> See attached pcap.
>
>
>
> -Franck.
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il]
> *Sent:* Wednesday, January 6, 2016 3:51 PM
> *To:* Eleanor Merry <Eleanor.Merry at metaswitch.com>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Ellie,
>
>
>
> Thanks for the comment.
>
> I think I originally misunderstood the problem I have.
>
> I do get originating and terminating triggers on the MMTEL AS.
>
> This works fine.
>
>
>
> The problem I face is with MMTEL Conference.
>
> In this specific scenario, the MMTEL AS sends the INVITE Request with the
> conf-factory URI to the S-CSCF and the MMTEL AS expects to get back an MT
> leg for it with the conference focus id.
>
>
>
> I thought we were missing the terminating trigger but It was a
> misinterpretation of the logs.
>
> We are missing the terminating leg for the conf-factory.
>
> I am not sure where and how shall we configure this specific trigger for
> the conferencing feature.
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Wednesday, January 6, 2016 3:44 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> Your trigger is using the Conjunctive Normal Form, so it matches a message
> if at least of one of each entry in your groups is true. Group 0 in your
> IFC is ("INVITE" OR "MESSAGE" OR "SUBSCRIBE") and Group 1 is ("INVITE" or
> "MESSAGE" or session case 0 or session case 1), so this should match any
> INVITE and any MESSAGE requests, and any SUSCRIBE requests that are
> originating registered or terminating registered.
>
>
>
> This IFC should be triggered for originating and terminating INVITEs
> therefore ? can you please send me the Sprout debug logs for a call? To
> turn on debug logging create/edit the file /etc/clearwater/user_settings,
> add log_level=5 and then restart Sprout (service sprout stop ? it?s
> automatically restarted by monit).
>
>
>
> Also, you don?t need this complicated a trigger if you just want to match
> all INVITEs ? you could just use:
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Ellie
>
>
>
> *From:* Franck Malka [mailto:fmalka at modulo.co.il <fmalka at modulo.co.il>]
> *Sent:* 05 January 2016 15:18
> *To:* Eleanor Merry; clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Thanks Ellie,
>
>
>
> I reviewed the spec and the links provided.
>
> But I could not reach a situation where the application server gets
> notified of both originating and terminating SIP INVITEs?
>
> This is the trigger I used lastly.
>
>
>
>
> <InitialFilterCriteria><TriggerPoint><ConditionTypeCNF>1</ConditionTypeCNF><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>0</Group><Method>SUBSCRIBE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>INVITE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><Method>MESSAGE</Method></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>0</SessionCase></SPT><SPT><ConditionNegated>0</ConditionNegated><Group>1</Group><SessionCase>1</SessionCase></SPT></TriggerPoint><ApplicationServer><ServerName>
> sip:10.0.20.215</ServerName><DefaultHandling>0</DefaultHandling></ApplicationServer></InitialFilterCriteria
> >
>
>
>
> Is there a known issue getting the terminating party SIP INVITEs?
>
>
>
> -Franck.
>
>
>
> *From:* Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
> *Sent:* Thursday, October 1, 2015 3:08 PM
> *To:* Franck Malka <fmalka at modulo.co.il>;
> clearwater at lists.projectclearwater.org
> *Subject:* RE: [Clearwater] Configuration of iFCs rules
>
>
>
> Hi Franck,
>
>
>
> We?ve got some examples of iFC configuration in
> http://clearwater.readthedocs.org/en/stable/Configuring_an_Application_Server/index.html#direct-configuration-via-curl
> and
> https://github.com/Metaswitch/memento/blob/dev/docs/memento_overview.md#configuration/.
>
>
>
>
> For a full description of how to configure iFCs, I recommend that you
> check out TS 29.228 (release 10, Annex C and F).
>
>
>
> Ellie
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org
> <clearwater-bounces at lists.projectclearwater.org>] *On Behalf Of *Franck
> Malka
> *Sent:* 01 October 2015 12:31
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Configuration of iFCs rules
>
>
>
> Hi,
>
>
>
> I could not find in the doc pages a full guide for the configuration of
> iFC rules.
>
> I need to configure a rule for 3rd party registrar and for MMTel
> Conferencing.
>
> I there some information available around this topic somewhere?
>
>
>
> -Franck.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160120/4c84ad6e/attachment.html>

From peter.skrzynski at nec.co.nz  Thu Jan 21 00:18:57 2016
From: peter.skrzynski at nec.co.nz (Peter Skrzynski)
Date: Thu, 21 Jan 2016 05:18:57 +0000
Subject: [Clearwater] Bulk provisioning problem
In-Reply-To: <CY1PR0201MB156391704411139A63AEEBF590C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>
	<CY1PR0201MB156391704411139A63AEEBF590C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <8b611056c40e478eabcc9a5c3617bf2e@ex15p.necnz.internal>

Hi Matt.
Thanks for the response.
Yes I am using the Homestead node, not Ellis. It is a manual install of bono/sprout/homestead/ibcf/dns.
Sorry I was misleading when I said ?upgrade? to 89.
Actually I am building a complete new IMS with version 89, and then I will just swing my users over to it.

My new Homestead node does NOT have the binary /usr/share/clearwater/crest/env/bin/python!
If fact, the env directory under /usr/share/clearwater/crest/ does not exist at all?
[homestead]user at homestead-1:/usr/share/clearwater/crest$ ls
src
[homestead]user at homestead-1:/usr/share/clearwater/crest$

The output from dpkg-query is?
[homestead]user at homestead-1:~$ dpkg-query ?s homestead-prov
Package: homestead-prov
Status: install ok unpacked
Priority: optional
Section: network
Installed-Size: 199
Maintainer: Project Clearwater Maintainers <maintainers at projectclearwater.org>
Architecture: amd64
Source: crest
Version: 1.0-160111.145732
Depends: crest
Conffiles:
/etc/cron.hourly/homestead-prov-log-cleanup newconffile
/etc/init.d/homestead-prov newconffile
/etc/clearwater/secure-connections/homestead.conf newconffile
Description: Provisioning backend for Homestead, the Cassandra powered HSS gateway
Homepage: http://projectclearwater.org/
[homestead]user at homestead-1:~$

So where to from here?
Does the above mean my homestead install did not work properly?
Should I just build another homestead node and see if the correct python binary file gets installed second time round?
Cheers,
Peter.

From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Thursday, 21 January 2016 5:01 a.m.
To: Peter Skrzynski
Cc: clearwater at lists.projectclearwater.org
Subject: RE: Bulk provisioning problem

Peter,

Thanks for your email.

When you ran this before, did you run your my_bulk_create.py script on the Ellis node, or did you run it on the Homestead node?  I would expect you to run it on the Homestead node.

The issue you're hitting is that the "python" binary you've found below clearwater-prov-tools is in a special virtual environment ("virtualenv").  This virtual environment doesn't include the "crest" code on which bulk_create.py depends.  Crest is the Cassandra-backed RESTful HTTP server platform on which both Homestead-Prov and Homer are built.

There should be a python binary below /usr/share/clearwater/crest/env/bin/python - I've checked that it exists on both a freshly-installed Homestead node and a Homestead node that has been upgraded through many intermediate releases (although not necessarily 76 directly to 89, for which maybe there's an upgrade issue).

If you're trying to run this on a Homestead node and it's still failing, please can you check that homestead-prov is installed correctly?  To do this, run "dpkg-query -s homestead-prov" and check that it says "Status: install ok installed" (along with a load of other output!).

Please let me know how you get on.

Cheers,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Peter Skrzynski
Sent: 19 January 2016 22:04
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Bulk provisioning problem

Hi,
I have a manual install using Release 76 ?In Dubious Battle?.
To bulk provision a specific range of numbers, I used a modified version of the bulk_create.py which does not use a csv file, and that worked fine.
I am now upgrading my IMS to the latest Release 89 ?Vicomte de Bragelonne?.
My modified bulk creation script no longer works.
There seems to be problems with the bulk_create.py file in Release 89.
The first line (of bulk_create.py) specifies the python file location as /usr/share/clearwater/crest/env/bin/python,
but actually it is in /usr/share/clearwater/clearwater-prov-tools/env/bin/python.
I fixed that and now it fails on the line ?from metaswitch.crest.tools.utils import create_imssubscription_xml?.
The error output is:
------------------------------------------------------------------------------------------
Traceback (most recent call last):
  File ?./my_bulk_create.py?, line 65, in <module>
    From metaswitch.crest.tools.utils import create_imssubscription_xml
ImportError: No module named crest.tools.utils
-------------------------------------------------------------------------------------------
Given that the python file is under ?/usr/share/clearwater/clearwater-prov-tools/?, but the metaswitch directory is under ?/usr/share/clearwater/crest/src/?,
does that mean there is a directory structure issue in homestead?
Or is it possible to fix my problem somehow?
I note that in Release 76 they were both under ?/usr/share/clearwater/homestead/?.
Regards
Peter.




Peter Skrzynski
Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image001.jpg at 01D15475.BA89B9B0]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/61673f8a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 8344 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/61673f8a/attachment.jpg>

From shivacharanms at gmail.com  Thu Jan 21 07:37:55 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Thu, 21 Jan 2016 18:07:55 +0530
Subject: [Clearwater] Homestead conf file missing.
Message-ID: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>

Hi,

I have a new clearwater manual install setup, homestead process has a
"Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how
do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
(usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size
         : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
 localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
 9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP
Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
configuration file for reading; tried the following locations:
/var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
'((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
store to stop

Thanks,
Shiva
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/8cc5a977/attachment.html>

From Matt.Williams at metaswitch.com  Thu Jan 21 08:29:36 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 21 Jan 2016 13:29:36 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
Message-ID: <CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/2e5ecd87/attachment.html>

From Matt.Williams at metaswitch.com  Thu Jan 21 08:43:50 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 21 Jan 2016 13:43:50 +0000
Subject: [Clearwater] Bulk provisioning problem
In-Reply-To: <8b611056c40e478eabcc9a5c3617bf2e@ex15p.necnz.internal>
References: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>
	<CY1PR0201MB156391704411139A63AEEBF590C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<8b611056c40e478eabcc9a5c3617bf2e@ex15p.necnz.internal>
Message-ID: <CY1PR0201MB156301B2EC28BB9DC34629B590C30@CY1PR0201MB1563.namprd02.prod.outlook.com>

Peter,

Thanks for your email.

Yes, it looks like your homestead-prov install has failed - note that it says "install ok unpacked" rather than "install ok installed".

My suspicion is that the crest package (on which homestead-prov depends) failed to install - this is the package that would create the env directory as part of installation.

Please can you try "sudo apt-get install -f" - this will try to fix any broken packages (such as crest), and let me know whether this succeeds or reports errors (and if it reports errors, what they are)?

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Peter Skrzynski [mailto:peter.skrzynski at nec.co.nz]
Sent: 21 January 2016 05:19
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: RE: Bulk provisioning problem

Hi Matt.
Thanks for the response.
Yes I am using the Homestead node, not Ellis. It is a manual install of bono/sprout/homestead/ibcf/dns.
Sorry I was misleading when I said ?upgrade? to 89.
Actually I am building a complete new IMS with version 89, and then I will just swing my users over to it.

My new Homestead node does NOT have the binary /usr/share/clearwater/crest/env/bin/python!
If fact, the env directory under /usr/share/clearwater/crest/ does not exist at all?
[homestead]user at homestead-1:/usr/share/clearwater/crest$ ls
src
[homestead]user at homestead-1:/usr/share/clearwater/crest$

The output from dpkg-query is?
[homestead]user at homestead-1:~$ dpkg-query ?s homestead-prov
Package: homestead-prov
Status: install ok unpacked
Priority: optional
Section: network
Installed-Size: 199
Maintainer: Project Clearwater Maintainers <maintainers at projectclearwater.org<mailto:maintainers at projectclearwater.org>>
Architecture: amd64
Source: crest
Version: 1.0-160111.145732
Depends: crest
Conffiles:
/etc/cron.hourly/homestead-prov-log-cleanup newconffile
/etc/init.d/homestead-prov newconffile
/etc/clearwater/secure-connections/homestead.conf newconffile
Description: Provisioning backend for Homestead, the Cassandra powered HSS gateway
Homepage: http://projectclearwater.org/
[homestead]user at homestead-1:~$

So where to from here?
Does the above mean my homestead install did not work properly?
Should I just build another homestead node and see if the correct python binary file gets installed second time round?
Cheers,
Peter.

From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Thursday, 21 January 2016 5:01 a.m.
To: Peter Skrzynski
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Bulk provisioning problem

Peter,

Thanks for your email.

When you ran this before, did you run your my_bulk_create.py script on the Ellis node, or did you run it on the Homestead node?  I would expect you to run it on the Homestead node.

The issue you're hitting is that the "python" binary you've found below clearwater-prov-tools is in a special virtual environment ("virtualenv").  This virtual environment doesn't include the "crest" code on which bulk_create.py depends.  Crest is the Cassandra-backed RESTful HTTP server platform on which both Homestead-Prov and Homer are built.

There should be a python binary below /usr/share/clearwater/crest/env/bin/python - I've checked that it exists on both a freshly-installed Homestead node and a Homestead node that has been upgraded through many intermediate releases (although not necessarily 76 directly to 89, for which maybe there's an upgrade issue).

If you're trying to run this on a Homestead node and it's still failing, please can you check that homestead-prov is installed correctly?  To do this, run "dpkg-query -s homestead-prov" and check that it says "Status: install ok installed" (along with a load of other output!).

Please let me know how you get on.

Cheers,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Peter Skrzynski
Sent: 19 January 2016 22:04
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Bulk provisioning problem

Hi,
I have a manual install using Release 76 ?In Dubious Battle?.
To bulk provision a specific range of numbers, I used a modified version of the bulk_create.py which does not use a csv file, and that worked fine.
I am now upgrading my IMS to the latest Release 89 ?Vicomte de Bragelonne?.
My modified bulk creation script no longer works.
There seems to be problems with the bulk_create.py file in Release 89.
The first line (of bulk_create.py) specifies the python file location as /usr/share/clearwater/crest/env/bin/python,
but actually it is in /usr/share/clearwater/clearwater-prov-tools/env/bin/python.
I fixed that and now it fails on the line ?from metaswitch.crest.tools.utils import create_imssubscription_xml?.
The error output is:
------------------------------------------------------------------------------------------
Traceback (most recent call last):
  File ?./my_bulk_create.py?, line 65, in <module>
    From metaswitch.crest.tools.utils import create_imssubscription_xml
ImportError: No module named crest.tools.utils
-------------------------------------------------------------------------------------------
Given that the python file is under ?/usr/share/clearwater/clearwater-prov-tools/?, but the metaswitch directory is under ?/usr/share/clearwater/crest/src/?,
does that mean there is a directory structure issue in homestead?
Or is it possible to fix my problem somehow?
I note that in Release 76 they were both under ?/usr/share/clearwater/homestead/?.
Regards
Peter.




Peter Skrzynski
Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image001.jpg at 01D15451.923D9A90]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/10697ae3/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 8344 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/10697ae3/attachment.jpg>

From shivacharanms at gmail.com  Thu Jan 21 12:44:13 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Thu, 21 Jan 2016 23:14:13 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service
clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service
clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts
after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at
http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com
> wrote:

> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/2a51c3f1/attachment.html>

From Matt.Williams at metaswitch.com  Thu Jan 21 14:15:14 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 21 Jan 2016 19:15:14 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
Message-ID: <CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160121/f10b1763/attachment.html>

From sainath.ellendula at wipro.com  Fri Jan 22 01:12:35 2016
From: sainath.ellendula at wipro.com (sainath.ellendula at wipro.com)
Date: Fri, 22 Jan 2016 06:12:35 +0000
Subject: [Clearwater] Issue in bono specific node
In-Reply-To: <BN3PR02MB12559CF3B74CAD50BEE8C4F49BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>,
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB12517C681921FCE01C1078C49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
	<KL1PR03MB14004AFE9784B7F773F2F1AFF2CB0@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB1400AA2D9732F45A1E9D9C8AF2C00@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<BN3PR02MB12559CF3B74CAD50BEE8C4F49BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
Message-ID: <KL1PR03MB1400521A1A7CFAA43F80EAD3F2C40@KL1PR03MB1400.apcprd03.prod.outlook.com>

Hi Matt,

I don't have much knowledge on creation of DNS records, I have gone through the DNS documentation which has provided below, But I am not sure in which VMs path to create a record.

In mentioned document ask to create DNS Records for each particular VMs(Bono, Sprout, Homer, Homestead, Ellis & Ralf).

Please can you share me the example file of any particular VM of whole DNS configuration, This would be very helpful for me.

Thanks in advance!!

Regards,
Sai

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
Sent: Tuesday, January 19, 2016 11:40 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com>
Cc: Matt Williams <Matt.Williams at metaswitch.com>
Subject: RE: Issue in bono specific node

Hi Sai,

You can find our DNS documentation at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html#configuration - this covers what DNS records are needed, and how to set up BIND to provide DNS. Note, if you use an all-in-one install (see http://clearwater.readthedocs.org/en/latest/All_in_one_Images/index.html) then you don't need to set up DNS.

Also, please can you email the Project Clearwater Mailing list rather than me directly - this helps our other users as they get to see the questions/answers, and you'll also likely get a quicker response (and I won't be available for the next week or so).

Ellie

From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 18 January 2016 06:39
To: Eleanor Merry
Subject: RE: Issue in bono specific node

Hi Ellie,

As of now all VMs are running and UP. I have configured Xlite phone to register a user.

Getting error with DNS(Failed to resolve sprout.pes.com).

Could you please help me here what all file changes required for DNS configuration?

Thanks in advance!!

Regards,
Sai

From: Sainath Ellendula (WT01 - Product Engineering Service)
Sent: Wednesday, January 13, 2016 11:57 AM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Issue in bono specific node


Hi Ellie,



Thanks for response.



After running 'nslookup sprout.pes.com' getting error as :



;; connection timed out; no servers could be reached



For this should i have to modify anything?



Reg, Another mail related to password display in Ellis UI is got resolved and now able to create number which displayed password at dashboard.



Thanks in advance!!



Regards,

Sai





________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 12 January 2016 23:22
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Issue in bono specific node


Hi Sai,



What's the full output of running 'nslookup sprout.pes.com' on your Bono node?



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 11 January 2016 13:31
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Issue in bono specific node



Hi Ellie,



I observed an error in bono log /var/log/bono *.log



But i can ping sprout machine from bono with name "sprout.pes.com".



11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:86: SIPResolver::resolve for name sprout.pes.com, port 5052, transport 6, family 2

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:505: Attempt to parse sprout.pes.com as IP address

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:128: Port is specified

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:296: Perform A/AAAA record lookup only, name = sprout.pes.com

11-01-2016 13:20:04.702 UTC Verbose dnscachedresolver.cpp:237: Check cache for sprout.pes.com type 1

11-01-2016 13:20:04.702 UTC Debug dnscachedresolver.cpp:323: Pulling 0 records from cache for sprout.pes.com A

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:353: Found 0 A/AAAA records, randomizing

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:412: Adding 0 servers from blacklist

11-01-2016 13:20:04.702 UTC Error connection_pool.cpp:214: Failed to resolve sprout.pes.com to an IP address - Not found (PJ_ENOTFOUND)



Any suggestions would be helpful.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/b75d3140/attachment.html>

From shivacharanms at gmail.com  Thu Jan 21 22:25:37 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Fri, 22 Jan 2016 08:55:37 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>

Hi Matt,

Seems the shared config file wasn't applied properly to the home stead
node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the
services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
Matt.Williams at metaswitch.com> wrote:

> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/c2fb376c/attachment.html>

From shivacharanms at gmail.com  Fri Jan 22 01:01:50 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Fri, 22 Jan 2016 11:31:50 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
Message-ID: <CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>

Hi Matt,

An update, ive changed the share_config file as follows and also I dont
have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

*shared_config *
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888
hs_provisioning_hostname=10.222.5.173:8889
ralf_hostname=10.222.5.163:10888
xdms_hostname=0.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

*ellis error log*
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
to the agentx master agent ([NIL]):


*homer log:*
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
UNIX socket /tmp/.homer-sock-0

*sprout log:*
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
request rate/second unchanged - only handled 20 requests in last 142284ms,
minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with
cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with
cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with
cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with
cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
wrote:

> Hi Matt,
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
> Program 'poll_bono'  Status failed
> Program 'poll_memento_https'        Status failed
>
> And Ellis UI still show the nginx welcome page.
>
> Please find the shared_config file below.
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
> # Deployment definitions
> home_domain=10.222.5.159
> sprout_hostname=sprout.10.222.5.172
> hs_hostname=hs.10.222.5.173:8888
> hs_provisioning_hostname=hs.10.222.5.173:8889
> ralf_hostname=ralf.10.222.5.163:10888
> xdms_hostname=homer.10.222.5.179:7888
>
> # Email server configuration
> smtp_smarthost=example.com
> smtp_username=username
> smtp_password=password
> email_recovery_sender=clearwater at example.org
>
> # Keys
> signup_key=secret
> turn_workaround=secret
> ellis_api_key=secret
> ellis_cookie_key=secret
>
> Shiva
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
>> Shiva,
>>
>>
>>
>> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
>> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
>> /etc/clearwater/shared_config file?
>>
>>
>>
>> Matt
>>
>>
>>
>> --
>>
>>
>>
>> Matt Williams
>> Lead Architect, Project Clearwater
>>
>> +44 (0) 20 8366 1177
>>
>>
>>
>> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
>> *Sent:* 21 January 2016 17:44
>> *To:* Matt Williams <Matt.Williams at metaswitch.com>
>> *Cc:* clearwater at lists.projectclearwater.org
>> *Subject:* Re: [Clearwater] Homestead conf file missing.
>>
>>
>>
>> Hi Matt,
>>
>>
>>
>> Thank you for the reply.
>>
>>
>>
>> About homestead, yes I tried running "sudo service
>> clearwater-infrastructure restart" did not return any error
>>
>>
>>
>> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
>> clearwater-infrastructure restart
>>
>>  * Restarting clearwater-infrastructure clearwater-infrastructure
>>
>> Configuring monit for only localhost access
>>
>>  [ OK ]
>>
>> [homestead]ubuntu at homestead:/var/log/homestead$
>>
>>
>>
>> On Ellis node the process seems to run, but its not stable process
>> restarts after a while.
>>
>>
>>
>> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>>
>> The Monit daemon 5.8.1 uptime: 9h 50m
>>
>>
>>
>> Process 'ntp_process'               Running
>>
>> System 'node-ellis'                 Running
>>
>> Process 'nginx_process'             Running
>>
>> Process 'mysql_process'             Running
>>
>> Process 'ellis_process'             Running
>>
>> Program 'poll_ellis'                Status ok
>>
>> Program 'poll_ellis_https'          Status ok
>>
>> Process 'clearwater_queue_manager'  Running
>>
>> Process 'etcd_process'              Running
>>
>> Program 'poll_etcd_cluster'         Waiting
>>
>> Program 'poll_etcd'                 Status ok
>>
>> Process 'clearwater_diags_monitor_process' Running
>>
>> Process 'clearwater_config_manager' Running
>>
>> Process 'clearwater_cluster_manager' Running
>>
>>
>>
>> And the ellis error log file says it failed to ping homestead.
>>
>> "UTC ERROR homestead.py:68: Failed to ping Homestead at
>> http://hs.10.222.5.173:8889/ping. Have you configured your
>> HOMESTEAD_URL?"
>>
>> netstat on homestead shows no processon 8889 port.
>>
>>
>>
>>
>>
>> Shiva
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
>> Matt.Williams at metaswitch.com> wrote:
>>
>> Shiva,
>>
>>
>>
>> It's good to hear from you.
>>
>>
>>
>> /var/lib/homestead/homestead.conf should be built by the
>> clearwater-infrastructure script that is run on package installation and
>> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
>> restart".  Do you get any errors out when you do so?
>>
>>
>>
>> You mention that ellis is displaying the nginx page.  Is the ellis
>> process running?  Run "sudo monit summary" on the ellis node to find out.
>> If it isn't running, please check /var/log/ellis/ for details and, if that
>> doesn't help, let me know what you see.
>>
>>
>>
>> Incidentally, please can you subscribe to the clearwater mailing list, so
>> that your posts are automatically approved and you can see other people's
>> questions and comments - see
>> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
>> for details.
>>
>>
>>
>> Thanks,
>>
>>
>>
>> Matt
>>
>>
>>
>> --
>>
>>
>>
>> Matt Williams
>> Lead Architect, Project Clearwater
>>
>> +44 (0) 20 8366 1177
>>
>>
>>
>> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
>> *On Behalf Of *Shiva Charan
>> *Sent:* 21 January 2016 12:38
>> *To:* clearwater at lists.projectclearwater.org
>> *Subject:* [Clearwater] Homestead conf file missing.
>>
>>
>>
>> Hi,
>>
>>
>>
>> I have a new clearwater manual install setup, homestead process has a
>> "Execution failed" status.
>>
>>
>>
>> Also when i open the ellis UI with the ellis IP it goes to nginx page,
>> how do i get the clearwater UI?
>>
>>
>>
>> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
>> file is missing. How do I get this file?
>>
>>
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
>> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>>
>> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to
>> connect to the agentx master agent ([NIL]):
>>
>> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
>> LoadMonitor
>>
>> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target
>> latency (usecs)   : 100000
>>
>> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
>> size          : 20
>>
>> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
>> fill rate/s: 100.000000
>>
>> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token
>> fill rate/s    : 10.000000
>>
>> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
>> Cached Resolver using servers:
>>
>> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:
>> 127.0.0.1
>>
>> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
>> resolver
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
>> store connection
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>>  localhost
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>>  9160
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
>> store worker pool
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:
>> 10
>>
>> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>>
>> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>>
>> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
>> HTTP Connection
>>
>> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
>> created for server :9888
>>
>> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
>> will use a response timeout of 500ms
>>
>> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
>> Diameter stack
>>
>> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
>> Diameter stack from file /var/lib/homestead/homestead.conf
>>
>> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
>> configuration file for reading; tried the following locations:
>> /var/lib/homestead/homestead.conf; Error: No such file or directory
>>
>> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
>> '((fd_conf_parse()))' :       No such file or directory
>>
>> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
>> Diameter stack - function fd_core_parseconf, rc 2
>>
>> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting
>> down
>>
>> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>>
>> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
>> store to stop
>>
>>
>>
>> Thanks,
>>
>> Shiva
>>
>>
>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/2fe878e0/attachment.html>
-------------- next part --------------
gdb failed with return code 32512
22-01-2016 05:52:56.688 UTC Status main.cpp:1443: Access logging enabled to /var/log/bono
22-01-2016 05:52:56.688 UTC Status main.cpp:1447: Log level set to 2
22-01-2016 05:52:56.688 UTC Warning main.cpp:1571: A registration expiry period should not be specified for P-CSCF
22-01-2016 05:52:56.689 UTC Status snmp_agent.cpp:111: AgentX agent initialised
22-01-2016 05:52:56.689 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
22-01-2016 05:52:56.689 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
22-01-2016 05:52:56.689 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
22-01-2016 05:52:56.689 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
22-01-2016 05:52:56.689 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
22-01-2016 05:52:56.689 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
22-01-2016 05:52:56.689 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
22-01-2016 05:52:56.689 UTC Status sipresolver.cpp:60: Created SIP resolver
22-01-2016 05:52:56.717 UTC Status stack.cpp:375: Listening on port 5058
22-01-2016 05:52:56.718 UTC Status stack.cpp:375: Listening on port 5060
22-01-2016 05:52:56.718 UTC Status stack.cpp:830: Local host aliases:
22-01-2016 05:52:56.718 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 05:52:56.718 UTC Status stack.cpp:835:  bono
22-01-2016 05:52:56.718 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 05:52:56.718 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 05:52:56.719 UTC Status httpresolver.cpp:51: Created HTTP resolver
22-01-2016 05:52:56.722 UTC Status httpconnection.cpp:114: Configuring HTTP Connection
22-01-2016 05:52:56.722 UTC Status httpconnection.cpp:115:   Connection created for server 10.222.5.163:10888
22-01-2016 05:52:56.722 UTC Status httpconnection.cpp:116:   Connection will use a response timeout of 500ms
22-01-2016 05:52:56.723 UTC Status main.cpp:1871: Creating connection to Chronos localhost:7253 using 127.0.0.1:9888 as the callback URI
22-01-2016 05:52:56.723 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
22-01-2016 05:52:56.723 UTC Status httpconnection.cpp:147:   Connection created for server localhost:7253
22-01-2016 05:52:56.723 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
22-01-2016 05:52:56.723 UTC Status connection_pool.cpp:72: Creating connection pool to 10.222.5.172:5054
22-01-2016 05:52:56.723 UTC Status connection_pool.cpp:73:   connections = 50, recycle time = 600 +/- 120 seconds
22-01-2016 05:52:56.727 UTC Status bono.cpp:3316: Create list of PBXes
22-01-2016 05:52:56.727 UTC Status pluginloader.cpp:63: Loading plug-ins from /usr/share/clearwater/sprout/plugins
22-01-2016 05:52:56.727 UTC Status pluginloader.cpp:148: Finished loading plug-ins
22-01-2016 05:52:56.729 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:53:11.742 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
-------------- next part --------------
22-01-2016 05:15:14.438 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for 10.222.5.159: Could not contact DNS servers
22-01-2016 05:15:14.439 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._tcp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:15:14.439 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._sctp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:15:14.439 UTC Error diameterstack.cpp:858: No Diameter peers have been found
22-01-2016 05:20:12.756 UTC Status freeDiameter: [dbg_monitor] Dumping queues statistics
22-01-2016 05:20:12.756 UTC Status freeDiameter: Global 'Local delivery': cur:0/25, h:0, T:0 in 0.000000s (-NANitems/s), blocked:0.000000s, last processing:0.000000s
22-01-2016 05:20:12.756 UTC Status freeDiameter: Global 'Total received': cur:0/20, h:0, T:0 in 0.000000s (-NANitems/s), blocked:0.000000s, last processing:0.000000s
22-01-2016 05:20:12.756 UTC Status freeDiameter: Global 'Total sending': cur:0/30, h:0, T:0 in 0.000000s (-NANitems/s), blocked:0.000000s, last processing:0.000000s
22-01-2016 05:20:12.756 UTC Status freeDiameter: [dbg_monitor] Dumping servers information
22-01-2016 05:20:12.756 UTC Status freeDiameter: {server}(@0x193a900)'{----} SCTP srv :3869 (13)': SCTP, NotSecur(0), Thread running'pending connections'(@0x193a960): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
{server}(@0x193b380)'{----} SCTP srv :5659 (15)': SCTP, Secur(2), Thread running'pending connections'(@0x193b3e0): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
{server}(@0x193be00)'{----} TCP srv [0.0.0.0]:3869 (17)': TCP, NotSecur(0), Thread running'pending connections'(@0x193be60): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
{server}(@0x193c880)'{----} TCP srv [0.0.0.0]:5659 (19)': TCP, Secur(1), Thread running'pending connections'(@0x193c8e0): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
{server}(@0x193d300)'{----} TCP srv [::]:3869 (21)': TCP, NotSecur(0), Thread running'pending connections'(@0x193d360): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
{server}(@0x193dd80)'{----} TCP srv [::]:5659 (22)': TCP, Secur(1), Thread running'pending connections'(@0x193dde0): items:0,0,5 threads:5,0 stats:0/0.000000,0.000000,0.000000 thresholds:0,0,0,(nil),(nil),(nil)
22-01-2016 05:20:14.440 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for 10.222.5.159: Could not contact DNS servers
22-01-2016 05:20:14.441 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._tcp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:20:14.441 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._sctp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:20:14.441 UTC Error diameterstack.cpp:858: No Diameter peers have been found
22-01-2016 05:25:14.443 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for 10.222.5.159: Could not contact DNS servers
22-01-2016 05:25:14.444 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._tcp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:25:14.444 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._sctp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:25:14.444 UTC Error diameterstack.cpp:858: No Diameter peers have been found
22-01-2016 05:30:14.445 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for 10.222.5.159: Could not contact DNS servers
22-01-2016 05:30:14.446 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._tcp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:30:14.447 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for _diameter._sctp.10.222.5.159: Could not contact DNS servers
22-01-2016 05:30:14.447 UTC Error diameterstack.cpp:858: No Diameter peers have been found
22-01-2016 05:32:08.750 UTC Error diameterstack.cpp:293: Routing error: 'No remaining suitable candidate to route the message to' for message with Command-Code 271, Destination-Host  and Destination-Realm 10.222.5.159
22-01-2016 05:32:08.750 UTC Status communicationmonitor.cpp:91: Setting alarm 2003
22-01-2016 05:32:08.750 UTC Warning peer_message_sender.cpp:125: Failed to send ACR to  (number 0)
22-01-2016 05:32:08.750 UTC Error peer_message_sender.cpp:145: Failed to connect to all CCFs, message not sent
22-01-2016 05:32:08.750 UTC Warning session_manager.cpp:319: Session for poll-sip-151273 received error from CDF

From Matt.Williams at metaswitch.com  Fri Jan 22 04:26:17 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 22 Jan 2016 09:26:17 +0000
Subject: [Clearwater] Issue in bono specific node
In-Reply-To: <KL1PR03MB1400521A1A7CFAA43F80EAD3F2C40@KL1PR03MB1400.apcprd03.prod.outlook.com>
References: <KL1PR03MB1400E0DB13535CE7C3B186FEF2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB1251177E99DE79D07B90CF209BF60@BLUPR02MB1251.namprd02.prod.outlook.com>,
	<KL1PR03MB1400475264FC7CA03FBC9366F2F60@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB14004D5266611CE1792DF345F2C90@KL1PR03MB1400.apcprd03.prod.outlook.com>,
	<BLUPR02MB12517C681921FCE01C1078C49BCA0@BLUPR02MB1251.namprd02.prod.outlook.com>
	<KL1PR03MB14004AFE9784B7F773F2F1AFF2CB0@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<KL1PR03MB1400AA2D9732F45A1E9D9C8AF2C00@KL1PR03MB1400.apcprd03.prod.outlook.com>
	<BN3PR02MB12559CF3B74CAD50BEE8C4F49BC10@BN3PR02MB1255.namprd02.prod.outlook.com>
	<KL1PR03MB1400521A1A7CFAA43F80EAD3F2C40@KL1PR03MB1400.apcprd03.prod.outlook.com>
Message-ID: <CY1PR0201MB1563C6F529AFDCDB5BD80B4290C40@CY1PR0201MB1563.namprd02.prod.outlook.com>

Sai,

The DNS configuration lives on a separate DNS server.  We have experience of using BIND for this, and the process is described in http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html#bind.  Have you tried this?

You asked for an example DNS configuration file - this is contained in the "Configuring Zone" subscriber (http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html#configuring-zone).

Once you have a DNS server, you need to point your hosts at it - either via DHCP or (more likely in your scenario) by following http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html#client-configuration.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: sainath.ellendula at wipro.com [mailto:sainath.ellendula at wipro.com]
Sent: 22 January 2016 06:13
To: clearwater at lists.projectclearwater.org; Matt Williams <Matt.Williams at metaswitch.com>
Cc: Eleanor Merry <Eleanor.Merry at metaswitch.com>
Subject: RE: Issue in bono specific node

Hi Matt,

I don't have much knowledge on creation of DNS records, I have gone through the DNS documentation which has provided below, But I am not sure in which VMs path to create a record.

In mentioned document ask to create DNS Records for each particular VMs(Bono, Sprout, Homer, Homestead, Ellis & Ralf).

Please can you share me the example file of any particular VM of whole DNS configuration, This would be very helpful for me.

Thanks in advance!!

Regards,
Sai

From: Eleanor Merry [mailto:Eleanor.Merry at metaswitch.com]
Sent: Tuesday, January 19, 2016 11:40 PM
To: Sainath Ellendula (WT01 - Product Engineering Service) <sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com>>
Cc: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Subject: RE: Issue in bono specific node

Hi Sai,

You can find our DNS documentation at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html#configuration - this covers what DNS records are needed, and how to set up BIND to provide DNS. Note, if you use an all-in-one install (see http://clearwater.readthedocs.org/en/latest/All_in_one_Images/index.html) then you don't need to set up DNS.

Also, please can you email the Project Clearwater Mailing list rather than me directly - this helps our other users as they get to see the questions/answers, and you'll also likely get a quicker response (and I won't be available for the next week or so).

Ellie

From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 18 January 2016 06:39
To: Eleanor Merry
Subject: RE: Issue in bono specific node

Hi Ellie,

As of now all VMs are running and UP. I have configured Xlite phone to register a user.

Getting error with DNS(Failed to resolve sprout.pes.com).

Could you please help me here what all file changes required for DNS configuration?

Thanks in advance!!

Regards,
Sai

From: Sainath Ellendula (WT01 - Product Engineering Service)
Sent: Wednesday, January 13, 2016 11:57 AM
To: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: Issue in bono specific node


Hi Ellie,



Thanks for response.



After running 'nslookup sprout.pes.com' getting error as :



;; connection timed out; no servers could be reached



For this should i have to modify anything?



Reg, Another mail related to password display in Ellis UI is got resolved and now able to create number which displayed password at dashboard.



Thanks in advance!!



Regards,

Sai





________________________________
From: Eleanor Merry <Eleanor.Merry at metaswitch.com<mailto:Eleanor.Merry at metaswitch.com>>
Sent: 12 January 2016 23:22
To: Sainath Ellendula (WT01 - Product Engineering Service); clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Issue in bono specific node


Hi Sai,



What's the full output of running 'nslookup sprout.pes.com' on your Bono node?



Ellie



From: sainath.ellendula at wipro.com<mailto:sainath.ellendula at wipro.com> [mailto:sainath.ellendula at wipro.com]
Sent: 11 January 2016 13:31
To: Eleanor Merry; clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Issue in bono specific node



Hi Ellie,



I observed an error in bono log /var/log/bono *.log



But i can ping sprout machine from bono with name "sprout.pes.com".



11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:86: SIPResolver::resolve for name sprout.pes.com, port 5052, transport 6, family 2

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:505: Attempt to parse sprout.pes.com as IP address

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:128: Port is specified

11-01-2016 13:20:04.702 UTC Debug sipresolver.cpp:296: Perform A/AAAA record lookup only, name = sprout.pes.com

11-01-2016 13:20:04.702 UTC Verbose dnscachedresolver.cpp:237: Check cache for sprout.pes.com type 1

11-01-2016 13:20:04.702 UTC Debug dnscachedresolver.cpp:323: Pulling 0 records from cache for sprout.pes.com A

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:353: Found 0 A/AAAA records, randomizing

11-01-2016 13:20:04.702 UTC Debug baseresolver.cpp:412: Adding 0 servers from blacklist

11-01-2016 13:20:04.702 UTC Error connection_pool.cpp:214: Failed to resolve sprout.pes.com to an IP address - Not found (PJ_ENOTFOUND)



Any suggestions would be helpful.



Thanks in advance!!



Regards,

Sai



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com<http://www.wipro.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/34dbc43a/attachment.html>

From Matt.Williams at metaswitch.com  Fri Jan 22 05:43:17 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 22 Jan 2016 10:43:17 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
Message-ID: <CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 22 January 2016 06:02
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/21d25992/attachment.html>

From shivacharanms at gmail.com  Fri Jan 22 08:15:42 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Fri, 22 Jan 2016 18:45:42 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now
fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the
registration is not success full.
The screen and log file is as below.

[image: Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com
> wrote:

> Shiva,
>
>
>
> Clearwater is very oriented around DNS.
>
> ?         DNS is used for load-balancing when you have more than 1 node
> in a cluster - in particular, following RFC 3263 for SIP.
>
> ?         DNS is used (following the rules in RFC 6733) for resolving
> Diameter realms to IP addresses.
>
>
>
> It is possible to get Clearwater running without a DNS server, but I would
> strongly recommend that you deploy a DNS server - in particular, if you
> event intend to scale up to a fault-tolerant or higher-capacity deployment,
> it is mandatory.
>
>
>
> The instructions for configuring DNS (and installing a DNS server if you
> don't already have one) are at
> http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html
> .
>
>
>
> Please let me know if you do definitely need to run without DNS, and we
> can look at how to set this up - but note the restrictions above on
> scalability and fault-tolerance.
>
>
>
> On the issues you're seeing below, I think the problem is that there is
> still configuration entries such as "sprout_hostname" below that contain
> both a hostname prefix and then an IP address - moving to DNS is one way to
> resolve all this.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 06:02
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> An update, ive changed the share_config file as follows and also I dont
> have a dns server in my environment( I assume its not mandatory).
>
> Also find the logs below.
>
>
>
> *shared_config *
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=10.222.5.173:8888
>
> hs_provisioning_hostname=10.222.5.173:8889
>
> ralf_hostname=10.222.5.163:10888
>
> xdms_hostname=0.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> *ellis error log*
>
> 22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK
>
>
>
> *homestead log:*
>
> 22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
>
>
>
>
> *homer log:*
>
> 2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
> UNIX socket /tmp/.homer-sock-0
>
>
>
> *sprout log:*
>
> 22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
> request rate/second unchanged - only handled 20 requests in last 142284ms,
> minimum threshold for a change is 35571.000000
>
> 22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
>
>
>
>
> bono and ralf log files are attached to the mail
>
>
>
>
>
>
>
> On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Matt,
>
>
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
>
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
>
> Program 'poll_bono'  Status failed
>
> Program 'poll_memento_https'        Status failed
>
>
>
> And Ellis UI still show the nginx welcome page.
>
>
>
> Please find the shared_config file below.
>
>
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=hs.10.222.5.173:8888
>
> hs_provisioning_hostname=hs.10.222.5.173:8889
>
> ralf_hostname=ralf.10.222.5.163:10888
>
> xdms_hostname=homer.10.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> Shiva
>
>
>
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/eaf3be23/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 42965 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/eaf3be23/attachment.png>
-------------- next part --------------
Advanced stack dump (requires gdb):
sh: 1: /usr/bin/gdb: not found

gdb failed with return code 32512
22-01-2016 13:06:56.426 UTC Status main.cpp:1443: Access logging enabled to /var/log/bono
22-01-2016 13:06:56.426 UTC Status main.cpp:1447: Log level set to 2
22-01-2016 13:06:56.426 UTC Warning main.cpp:1571: A registration expiry period should not be specified for P-CSCF
22-01-2016 13:06:56.427 UTC Status snmp_agent.cpp:111: AgentX agent initialised
22-01-2016 13:06:56.427 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
22-01-2016 13:06:56.427 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
22-01-2016 13:06:56.427 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
22-01-2016 13:06:56.427 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
22-01-2016 13:06:56.427 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
22-01-2016 13:06:56.427 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
22-01-2016 13:06:56.427 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
22-01-2016 13:06:56.427 UTC Status sipresolver.cpp:60: Created SIP resolver
22-01-2016 13:06:56.457 UTC Status stack.cpp:375: Listening on port 5058
22-01-2016 13:06:56.458 UTC Status stack.cpp:375: Listening on port 5060
22-01-2016 13:06:56.458 UTC Status stack.cpp:830: Local host aliases:
22-01-2016 13:06:56.458 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 13:06:56.458 UTC Status stack.cpp:835:  bono
22-01-2016 13:06:56.458 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 13:06:56.458 UTC Status stack.cpp:835:  10.222.5.159
22-01-2016 13:06:56.459 UTC Status httpresolver.cpp:51: Created HTTP resolver
22-01-2016 13:06:56.462 UTC Status httpconnection.cpp:114: Configuring HTTP Connection
22-01-2016 13:06:56.462 UTC Status httpconnection.cpp:115:   Connection created for server 10.222.5.163:10888
22-01-2016 13:06:56.462 UTC Status httpconnection.cpp:116:   Connection will use a response timeout of 500ms
22-01-2016 13:06:56.463 UTC Status main.cpp:1871: Creating connection to Chronos localhost:7253 using 127.0.0.1:9888 as the callback URI
22-01-2016 13:06:56.463 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
22-01-2016 13:06:56.463 UTC Status httpconnection.cpp:147:   Connection created for server localhost:7253
22-01-2016 13:06:56.463 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
22-01-2016 13:06:56.463 UTC Status connection_pool.cpp:72: Creating connection pool to 10.222.5.172:5054
22-01-2016 13:06:56.463 UTC Status connection_pool.cpp:73:   connections = 50, recycle time = 600 +/- 120 seconds
22-01-2016 13:06:56.467 UTC Status bono.cpp:3316: Create list of PBXes
22-01-2016 13:06:56.467 UTC Status pluginloader.cpp:63: Loading plug-ins from /usr/share/clearwater/sprout/plugins
22-01-2016 13:06:56.467 UTC Status pluginloader.cpp:148: Finished loading plug-ins
22-01-2016 13:06:56.469 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 13:07:11.471 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
-------------- next part --------------
22-01-2016 13:03:34.931 UTC Call-Disconnected: CALL_ID=poll-sip-24405 REASON=404
22-01-2016 13:04:05.132 UTC Call-Disconnected: CALL_ID=poll-sip-24435 REASON=404
22-01-2016 13:04:25.649 UTC Call-Disconnected: CALL_ID=Vj-H9znhDRz7PTuOE2xH9A.. REASON=401
22-01-2016 13:04:35.318 UTC Call-Disconnected: CALL_ID=poll-sip-24465 REASON=404
22-01-2016 13:04:45.336 UTC Call-Disconnected: CALL_ID=poll-sip-24475 REASON=404
22-01-2016 13:04:56.691 UTC Call-Disconnected: CALL_ID=Vj-H9znhDRz7PTuOE2xH9A.. REASON=401
22-01-2016 13:04:59.131 UTC Call-Disconnected: CALL_ID=Vj-H9znhDRz7PTuOE2xH9A.. REASON=401
22-01-2016 13:05:05.701 UTC Call-Disconnected: CALL_ID=poll-sip-24495 REASON=404
22-01-2016 13:05:26.069 UTC Call-Disconnected: CALL_ID=UZts_JotWFHMIIpPzItIyA.. REASON=401
22-01-2016 13:05:26.690 UTC Call-Disconnected: CALL_ID=Vj-H9znhDRz7PTuOE2xH9A.. REASON=401
22-01-2016 13:05:35.899 UTC Call-Disconnected: CALL_ID=poll-sip-24526 REASON=404
22-01-2016 13:05:45.918 UTC Call-Disconnected: CALL_ID=poll-sip-24536 REASON=404
22-01-2016 13:05:57.566 UTC Call-Disconnected: CALL_ID=UZts_JotWFHMIIpPzItIyA.. REASON=401
22-01-2016 13:06:00.067 UTC Call-Disconnected: CALL_ID=UZts_JotWFHMIIpPzItIyA.. REASON=401
22-01-2016 13:06:06.092 UTC Call-Disconnected: CALL_ID=poll-sip-24556 REASON=404
22-01-2016 13:06:27.586 UTC Call-Disconnected: CALL_ID=UZts_JotWFHMIIpPzItIyA.. REASON=401
-------------- next part --------------
2-01-2016 13:09:01.579 UTC 200 POST /authentication-timeout 0.005865 seconds
22-01-2016 13:09:09.094 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:09:19.126 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:09:29.136 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:09:38.083 UTC 200 POST /authentication-timeout 0.006025 seconds
22-01-2016 13:09:39.172 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:09:49.195 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:09:59.222 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:10:01.578 UTC 200 POST /authentication-timeout 0.006185 seconds
22-01-2016 13:10:09.246 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:10:19.280 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:10:29.298 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:10:39.321 UTC 200 GET /ping 0.000000 seconds
22-01-2016 13:10:42.081 UTC 200 POST /authentication-timeout 0.006049 seconds
-------------- next part --------------
22-01-2016 13:07:06.518 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:07:06.518 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:07:16.545 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:07:16.545 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:07:39.128 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:07:39.128 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:08:09.325 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:08:09.325 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:08:18.978 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 102652ms, minimum threshold for a change is 25663.000000
22-01-2016 13:08:20.355 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:08:20.355 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:08:40.545 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:08:40.545 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 13:09:10.737 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 13:09:10.737 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS

From Matt.Williams at metaswitch.com  Fri Jan 22 09:22:38 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 22 Jan 2016 14:22:38 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
Message-ID: <CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

If you're intending to implement DNS, I'd suggest doing it now rather than later - you're going down paths that are not well-trodden, and I'm sure we're going to hit lots of configuration issues.  It will be much quicker to deploy DNS now.

My guess in this case is that, because the subscriber's "domain" parameter is an IP address, Bono is just routing the INVITE to that IP address (which is itself, so it fails).  Even when we deploy without DNS, we still configure the domain to be a real domain name (even though it won't resolve in DNS).

If this doesn't resolve the problem, I'd suggest turning debug logging on in Bono and Sprout (as described at http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono and http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout) - this will give you more detailed diagnostics about what's going on in Bono and Sprout.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 22 January 2016 13:16
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the registration is not success full.
The screen and log file is as below.

[Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 06:02

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/ce63c138/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 86154 bytes
Desc: image002.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/ce63c138/attachment.png>

From shivacharanms at gmail.com  Fri Jan 22 14:05:46 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Sat, 23 Jan 2016 00:35:46 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>

Hi Matt,

Yes I understand your recommendation, but for now there is no dns server in
my design.
Will have a segregated setup for that.

For now please find the bono and sproute logs attached to the mail.

how do i make this work without the dns?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <Matt.Williams at metaswitch.com
> wrote:

> Shiva,
>
>
>
> If you're intending to implement DNS, I'd suggest doing it now rather than
> later - you're going down paths that are not well-trodden, and I'm sure
> we're going to hit lots of configuration issues.  It will be *much*
> quicker to deploy DNS now.
>
>
>
> My guess in this case is that, because the subscriber's "domain" parameter
> is an IP address, Bono is just routing the INVITE to that IP address (which
> is itself, so it fails).  Even when we deploy without DNS, we still
> configure the domain to be a real domain name (even though it won't resolve
> in DNS).
>
>
>
> If this doesn't resolve the problem, I'd suggest turning debug logging on
> in Bono and Sprout (as described at
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono
> and
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout)
> - this will give you more detailed diagnostics about what's going on in
> Bono and Sprout.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 13:16
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thanks for the recommendation, will implement DNS later on :) .
>
>
>
> And you were rite I had missed to remove a dns name for sprout, its now
> fixed i am able to open the UI and create numbers.
>
>
>
> But when trying to make a sip call via zoiper client application, the
> registration is not success full.
>
> The screen and log file is as below.
>
>
>
> [image: Inline image 2]
>
>
>
> Any idea?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Clearwater is very oriented around DNS.
>
> ?         DNS is used for load-balancing when you have more than 1 node
> in a cluster - in particular, following RFC 3263 for SIP.
>
> ?         DNS is used (following the rules in RFC 6733) for resolving
> Diameter realms to IP addresses.
>
>
>
> It is possible to get Clearwater running without a DNS server, but I would
> strongly recommend that you deploy a DNS server - in particular, if you
> event intend to scale up to a fault-tolerant or higher-capacity deployment,
> it is mandatory.
>
>
>
> The instructions for configuring DNS (and installing a DNS server if you
> don't already have one) are at
> http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html
> .
>
>
>
> Please let me know if you do definitely need to run without DNS, and we
> can look at how to set this up - but note the restrictions above on
> scalability and fault-tolerance.
>
>
>
> On the issues you're seeing below, I think the problem is that there is
> still configuration entries such as "sprout_hostname" below that contain
> both a hostname prefix and then an IP address - moving to DNS is one way to
> resolve all this.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 06:02
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> An update, ive changed the share_config file as follows and also I dont
> have a dns server in my environment( I assume its not mandatory).
>
> Also find the logs below.
>
>
>
> *shared_config *
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=10.222.5.173:8888
>
> hs_provisioning_hostname=10.222.5.173:8889
>
> ralf_hostname=10.222.5.163:10888
>
> xdms_hostname=0.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> *ellis error log*
>
> 22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK
>
>
>
> *homestead log:*
>
> 22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
>
>
>
>
> *homer log:*
>
> 2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
> UNIX socket /tmp/.homer-sock-0
>
>
>
> *sprout log:*
>
> 22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
> request rate/second unchanged - only handled 20 requests in last 142284ms,
> minimum threshold for a change is 35571.000000
>
> 22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
>
>
>
>
> bono and ralf log files are attached to the mail
>
>
>
>
>
>
>
> On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Matt,
>
>
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
>
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
>
> Program 'poll_bono'  Status failed
>
> Program 'poll_memento_https'        Status failed
>
>
>
> And Ellis UI still show the nginx welcome page.
>
>
>
> Please find the shared_config file below.
>
>
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=hs.10.222.5.173:8888
>
> hs_provisioning_hostname=hs.10.222.5.173:8889
>
> ralf_hostname=ralf.10.222.5.163:10888
>
> xdms_hostname=homer.10.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> Shiva
>
>
>
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160123/46fde323/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 86154 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160123/46fde323/attachment.png>
-------------- next part --------------
01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12e89a8 in slot 18 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12ea848 TCP transport 10.222.5.159:42222 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12ea848 in slot 19 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12ec6e8 TCP transport 10.222.5.159:52423 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12ec6e8 in slot 20 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12ee588 TCP transport 10.222.5.159:53200 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12ee588 in slot 21 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f0428 TCP transport 10.222.5.159:58143 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f0428 in slot 22 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f22c8 TCP transport 10.222.5.159:54063 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f22c8 in slot 23 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f4168 TCP transport 10.222.5.159:50150 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f4168 in slot 24 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f6008 TCP transport 10.222.5.159:33560 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f6008 in slot 25 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f7ea8 TCP transport 10.222.5.159:53341 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f7ea8 in slot 26 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12f9d48 TCP transport 10.222.5.159:52442 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12f9d48 in slot 27 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12fbbe8 TCP transport 10.222.5.159:51674 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12fbbe8 in slot 28 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12fda88 TCP transport 10.222.5.159:42810 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12fda88 in slot 29 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x12ff928 TCP transport 10.222.5.159:56001 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x12ff928 in slot 30 has connected
22-01-2016 18:13:25.050 UTC Verbose pjsip:  tcpc0x13017c8 TCP transport 10.222.5.159:39774 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.050 UTC Debug connection_pool.cpp:336: Transport tcpc0x13017c8 in slot 31 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1303668 TCP transport 10.222.5.159:53951 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1303668 in slot 32 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1305508 TCP transport 10.222.5.159:57779 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1305508 in slot 33 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x13073a8 TCP transport 10.222.5.159:59369 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x13073a8 in slot 34 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1309248 TCP transport 10.222.5.159:48572 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1309248 in slot 35 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x130b0e8 TCP transport 10.222.5.159:52819 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x130b0e8 in slot 36 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x130cf88 TCP transport 10.222.5.159:41554 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x130cf88 in slot 37 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x130ee28 TCP transport 10.222.5.159:39772 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x130ee28 in slot 38 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1310cc8 TCP transport 10.222.5.159:50878 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1310cc8 in slot 39 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1312b68 TCP transport 10.222.5.159:48173 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1312b68 in slot 40 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1314a08 TCP transport 10.222.5.159:33339 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1314a08 in slot 41 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x13168a8 TCP transport 10.222.5.159:42174 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x13168a8 in slot 42 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1318748 TCP transport 10.222.5.159:39146 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1318748 in slot 43 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x131a5e8 TCP transport 10.222.5.159:45395 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x131a5e8 in slot 44 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x131c488 TCP transport 10.222.5.159:44057 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x131c488 in slot 45 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x131e328 TCP transport 10.222.5.159:44708 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x131e328 in slot 46 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x13201c8 TCP transport 10.222.5.159:34571 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x13201c8 in slot 47 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1322068 TCP transport 10.222.5.159:52143 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1322068 in slot 48 has connected
22-01-2016 18:13:25.051 UTC Verbose pjsip:  tcpc0x1323f08 TCP transport 10.222.5.159:38406 is connected to 10.222.5.172:5054
22-01-2016 18:13:25.051 UTC Debug connection_pool.cpp:336: Transport tcpc0x1323f08 in slot 49 has connected
22-01-2016 18:13:26.320 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg REGISTER/cseq=270 (rdata0xf100c8)
22-01-2016 18:13:26.320 UTC Verbose common_sip_processing.cpp:120: RX 701 bytes Request msg REGISTER/cseq=270 (rdata0xf100c8) from UDP 10.222.5.162:32930:
--start msg--

REGISTER sip:10.222.5.159;transport=UDP SIP/2.0
Via: SIP/2.0/UDP 204.57.98.108:61897;branch=z9hG4bK-524287-1---59975f6b33c92da4
Max-Forwards: 70
Contact: <sip:6505550008 at 204.57.98.108:62113;rinstance=633a7d3b4158b33a;transport=UDP>
To: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>
From: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>;tag=c4043803
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
CSeq: 270 REGISTER
Expires: 3600
Allow: INVITE, ACK, CANCEL, BYE, NOTIFY, REFER, MESSAGE, OPTIONS, INFO, SUBSCRIBE
Supported: replaces, norefersub, extended-refer, timer, outbound, path, X-cisco-serviceuri
User-Agent: Z 3.9.32144 r32121
Allow-Events: presence, kpml
Content-Length: 0


--end msg--
22-01-2016 18:13:26.320 UTC Debug pjutils.cpp:1648: Logging SAS Call-ID marker, Call-ID nCXQL8rriVqoKjhPaMdSaQ..
22-01-2016 18:13:26.320 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7f92a4039ce8 for worker threads
22-01-2016 18:13:26.320 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7f92a4039ce8
22-01-2016 18:13:26.320 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=270 (rdata0x7f92a4039ce8)
22-01-2016 18:13:26.320 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:13:26.320 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:13:26.320 UTC Debug bono.cpp:279: Proxy RX request
22-01-2016 18:13:26.321 UTC Debug pjutils.cpp:674: Cloned Request msg REGISTER/cseq=270 (rdata0x7f92a4039ce8) to tdta0x7f929c0008e0
22-01-2016 18:13:26.321 UTC Debug bono.cpp:803: Request received on non-trusted port 5060
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1043: Perform access proxy routing for REGISTER request
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1080: Message requires outbound support
22-01-2016 18:13:26.321 UTC Debug flowtable.cpp:90: Find or create flow for transport udp0xf0f9f0 (1), remote address 10.222.5.162:32930
22-01-2016 18:13:26.321 UTC Debug flowtable.cpp:105: Added flow record 0x7f929c0028a0
22-01-2016 18:13:26.321 UTC Debug flowtable.cpp:232: Reporting current flow count: 1
22-01-2016 18:13:26.321 UTC Debug flowtable.cpp:599: Dialog count now 2 for flow
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1092: Found or created flow data record, token = HTsFfdAHmK
22-01-2016 18:13:26.321 UTC Debug flowtable.cpp:616: Dialog count now 1 for flow
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1001: Mark originating
22-01-2016 18:13:26.321 UTC Info bono.cpp:1022: Route request to upstream proxy sip:10.222.5.172:5054;transport=TCP;lr;orig
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:13:26.321 UTC Debug acr.cpp:1763: Create RalfACR for node type P-CSCF with role Originating
22-01-2016 18:13:26.321 UTC Debug acr.cpp:49: Created ACR (0x7f929c002c30)
22-01-2016 18:13:26.321 UTC Debug acr.cpp:175: Created P-CSCF Ralf ACR
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:13:26.321 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:13:26.321 UTC Debug acr.cpp:214: Set record type for P/S-CSCF
22-01-2016 18:13:26.321 UTC Debug acr.cpp:222: Non-dialog message => EVENT_RECORD
22-01-2016 18:13:26.321 UTC Debug acr.cpp:1491: Stored 0 subscription identifiers
22-01-2016 18:13:26.321 UTC Debug bono.cpp:479: Trust mode INBOUND_EDGE_CLIENT(,-rsp,-pch), serving state None
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c003 Transaction created for Request msg REGISTER/cseq=270 (rdata0x7f92a4039ce8)
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1771: UASTransaction constructor (0x7f929c003bb0)
22-01-2016 18:13:26.321 UTC Debug bono.cpp:1772: ACR (0x7f929c002c30)
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c003 Incoming Request msg REGISTER/cseq=270 (rdata0x7f92a4039ce8) in state Null
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c003 State changed from Null to Trying, event=RX_MSG
22-01-2016 18:13:26.321 UTC Debug bono.cpp:383: tsx0x7f929c003448 - tu_on_tsx_state UAS, TSX_STATE RX_MSG state=Trying
22-01-2016 18:13:26.321 UTC Debug pjsip:       endpoint Response msg 408/REGISTER/cseq=270 (tdta0x7f929c003d40) created
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2403: Report SAS start marker - trail (1)
22-01-2016 18:13:26.321 UTC Debug trustboundary.cpp:69: Add P-Charging headers
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2477: Allocating transaction and data for target 0
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2734: Stripping loose routes from proxied message
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2761: Adding a Route header to sip:10.222.5.172:5054;transport=TCP
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c007 Transaction created for Request msg REGISTER/cseq=270 (tdta0x7f929c004fd0)
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2504: Adding trail identifier 1 to UAC transaction
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2523: Updating request URI and route for target 0
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2829: Transport tcpc0x12d38c8 (TCP to 10.222.5.172:5054) pre-selected for transaction
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2847: Sending request for sip:10.222.5.159;transport=UDP
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c007 Sending Request msg REGISTER/cseq=270 (tdta0x7f929c004fd0) in state Null
22-01-2016 18:13:26.321 UTC Debug pjsip:       endpoint Request msg REGISTER/cseq=270 (tdta0x7f929c004fd0): skipping target resolution because address is already set
22-01-2016 18:13:26.321 UTC Verbose common_sip_processing.cpp:136: TX 942 bytes Request msg REGISTER/cseq=270 (tdta0x7f929c004fd0) to TCP 10.222.5.172:5054:
--start msg--

REGISTER sip:10.222.5.159;transport=UDP SIP/2.0
Via: SIP/2.0/TCP 10.222.5.159:41684;rport;branch=z9hG4bKPjMK-Bde7s2zJ70n7QByrCrbVPC--Lzq8x
Path: <sip:HTsFfdAHmK at 10.222.5.159:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 204.57.98.108:61897;received=10.222.5.162;branch=z9hG4bK-524287-1---59975f6b33c92da4
Max-Forwards: 70
Contact: <sip:6505550008 at 204.57.98.108:62113;transport=UDP;rinstance=633a7d3b4158b33a>
To: "6505550008" <sip:6505550008 at 10.222.5.159>
From: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=c4043803
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
CSeq: 270 REGISTER
Expires: 3600
Allow: INVITE, ACK, CANCEL, BYE, NOTIFY, REFER, MESSAGE, OPTIONS, INFO, SUBSCRIBE
Supported: replaces, norefersub, extended-refer, timer, outbound, path, X-cisco-serviceuri
User-Agent: Z 3.9.32144 r32121
Allow-Events: presence, kpml
P-Visited-Network-ID: 10.222.5.159
Route: <sip:10.222.5.172:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
22-01-2016 18:13:26.321 UTC Debug pjsip: tsx0x7f929c007 State changed from Null to Calling, event=TX_MSG
22-01-2016 18:13:26.321 UTC Debug bono.cpp:383: tsx0x7f929c007038 - tu_on_tsx_state UAC, TSX_STATE TX_MSG state=Calling
22-01-2016 18:13:26.321 UTC Debug bono.cpp:2947: tsx0x7f929c007038 - uac_data = 0x7f929c0077a0, uas_data = 0x7f929c003bb0
22-01-2016 18:13:26.321 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7f92a4039ce8
22-01-2016 18:13:26.321 UTC Debug thread_dispatcher.cpp:199: Request latency = 728us
22-01-2016 18:13:26.329 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Response msg 401/REGISTER/cseq=270 (rdata0x12d3c00)
22-01-2016 18:13:26.329 UTC Verbose common_sip_processing.cpp:120: RX 607 bytes Response msg 401/REGISTER/cseq=270 (rdata0x12d3c00) from TCP 10.222.5.172:5054:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/TCP 10.222.5.159:41684;rport=41684;received=10.222.5.159;branch=z9hG4bKPjMK-Bde7s2zJ70n7QByrCrbVPC--Lzq8x
Via: SIP/2.0/UDP 204.57.98.108:61897;received=10.222.5.162;branch=z9hG4bK-524287-1---59975f6b33c92da4
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
From: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=c4043803
To: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=z9hG4bKPjMK-Bde7s2zJ70n7QByrCrbVPC--Lzq8x
CSeq: 270 REGISTER
WWW-Authenticate: Digest  realm="10.222.5.159",nonce="6d8bfcb964e206f9",opaque="610313b46a96ced6",algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
22-01-2016 18:13:26.329 UTC Debug pjutils.cpp:1648: Logging SAS Call-ID marker, Call-ID nCXQL8rriVqoKjhPaMdSaQ..
22-01-2016 18:13:26.329 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7f92a404a698 for worker threads
22-01-2016 18:13:26.329 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7f92a404a698
22-01-2016 18:13:26.329 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Response msg 401/REGISTER/cseq=270 (rdata0x7f92a404a698)
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 Incoming Response msg 401/REGISTER/cseq=270 (rdata0x7f92a404a698) in state Calling
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 State changed from Calling to Completed, event=RX_MSG
22-01-2016 18:13:26.329 UTC Debug bono.cpp:383: tsx0x7f929c007038 - tu_on_tsx_state UAC, TSX_STATE RX_MSG state=Completed
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2947: tsx0x7f929c007038 - uac_data = 0x7f929c0077a0, uas_data = 0x7f929c003bb0
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2986: tsx0x7f929c007038 - RX_MSG on active UAC transaction
22-01-2016 18:13:26.329 UTC Debug trustboundary.cpp:57: Strip trusted headers
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2179: tsx0x7f929c007038 - Final response, so disconnect UAS and UAC transactions
22-01-2016 18:13:26.329 UTC Debug pjsip: tdta0x7f929c00 Destroying txdata Response msg 408/REGISTER/cseq=270 (tdta0x7f929c003d40)
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2614: Dissociate UAC transaction 0x7f929c0077a0 (0)
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c003 Sending Response msg 401/REGISTER/cseq=270 (tdta0x7f92a0001890) in state Trying
22-01-2016 18:13:26.329 UTC Debug pjsip:  sip_resolve.c Target '10.222.5.162:61897' type=UDP resolved to '10.222.5.162:61897' type=UDP (UDP transport)
22-01-2016 18:13:26.329 UTC Verbose common_sip_processing.cpp:136: TX 487 bytes Response msg 401/REGISTER/cseq=270 (tdta0x7f92a0001890) to UDP 10.222.5.162:61897:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/UDP 204.57.98.108:61897;received=10.222.5.162;branch=z9hG4bK-524287-1---59975f6b33c92da4
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
From: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=c4043803
To: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=z9hG4bKPjMK-Bde7s2zJ70n7QByrCrbVPC--Lzq8x
CSeq: 270 REGISTER
WWW-Authenticate: Digest  realm="10.222.5.159",nonce="6d8bfcb964e206f9",opaque="610313b46a96ced6",algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c003 State changed from Trying to Completed, event=TX_MSG
22-01-2016 18:13:26.329 UTC Debug bono.cpp:383: tsx0x7f929c003448 - tu_on_tsx_state UAS, TSX_STATE TX_MSG state=Completed
22-01-2016 18:13:26.329 UTC Debug bono.cpp:803: Request received on non-trusted port 5060
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2412: Report SAS end marker - trail (1)
22-01-2016 18:13:26.329 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7f92a404a698
22-01-2016 18:13:26.329 UTC Debug thread_dispatcher.cpp:199: Request latency = 442us
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 Timeout timer event
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 State changed from Completed to Terminated, event=TIMER
22-01-2016 18:13:26.329 UTC Debug bono.cpp:383: tsx0x7f929c007038 - tu_on_tsx_state UAC, TSX_STATE TIMER state=Terminated
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2947: tsx0x7f929c007038 - uac_data = 0x7f929c0077a0, uas_data = (nil)
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 Timeout timer event
22-01-2016 18:13:26.329 UTC Debug pjsip: tsx0x7f929c007 State changed from Terminated to Destroyed, event=TIMER
22-01-2016 18:13:26.329 UTC Debug bono.cpp:383: tsx0x7f929c007038 - tu_on_tsx_state UAC, TSX_STATE TIMER state=Destroyed
22-01-2016 18:13:26.329 UTC Debug bono.cpp:2947: tsx0x7f929c007038 - uac_data = 0x7f929c0077a0, uas_data = (nil)
22-01-2016 18:13:26.329 UTC Debug bono.cpp:3034: tsx0x7f929c007038 - UAC tsx destroyed
22-01-2016 18:13:26.329 UTC Debug pjsip: tdta0x7f929c00 Destroying txdata Request msg REGISTER/cseq=270 (tdta0x7f929c004fd0)
22-01-2016 18:13:30.320 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg REGISTER/cseq=270 (rdata0xf21a88)
22-01-2016 18:13:30.320 UTC Verbose common_sip_processing.cpp:120: RX 701 bytes Request msg REGISTER/cseq=270 (rdata0xf21a88) from UDP 10.222.5.162:32930:
--start msg--

REGISTER sip:10.222.5.159;transport=UDP SIP/2.0
Via: SIP/2.0/UDP 204.57.98.108:61897;branch=z9hG4bK-524287-1---59975f6b33c92da4
Max-Forwards: 70
Contact: <sip:6505550008 at 204.57.98.108:62113;rinstance=633a7d3b4158b33a;transport=UDP>
To: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>
From: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>;tag=c4043803
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
CSeq: 270 REGISTER
Expires: 3600
Allow: INVITE, ACK, CANCEL, BYE, NOTIFY, REFER, MESSAGE, OPTIONS, INFO, SUBSCRIBE
Supported: replaces, norefersub, extended-refer, timer, outbound, path, X-cisco-serviceuri
User-Agent: Z 3.9.32144 r32121
Allow-Events: presence, kpml
Content-Length: 0


--end msg--
22-01-2016 18:13:30.320 UTC Debug pjutils.cpp:1648: Logging SAS Call-ID marker, Call-ID nCXQL8rriVqoKjhPaMdSaQ..
22-01-2016 18:13:30.320 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7f92a404a698 for worker threads
22-01-2016 18:13:30.320 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7f92a404a698
22-01-2016 18:13:30.320 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=270 (rdata0x7f92a404a698)
22-01-2016 18:13:30.320 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:13:30.320 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:13:30.320 UTC Debug pjsip: tsx0x7f929c003 Incoming Request msg REGISTER/cseq=270 (rdata0x7f92a404a698) in state Completed
22-01-2016 18:13:30.320 UTC Debug pjsip: tsx0x7f929c003 Retransmiting Response msg 401/REGISTER/cseq=270 (tdta0x7f92a0001890), count=0, restart?=0
22-01-2016 18:13:30.320 UTC Verbose common_sip_processing.cpp:136: TX 487 bytes Response msg 401/REGISTER/cseq=270 (tdta0x7f92a0001890) to UDP 10.222.5.162:61897:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/UDP 204.57.98.108:61897;received=10.222.5.162;branch=z9hG4bK-524287-1---59975f6b33c92da4
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
From: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=c4043803
To: "6505550008" <sip:6505550008 at 10.222.5.159>;tag=z9hG4bKPjMK-Bde7s2zJ70n7QByrCrbVPC--Lzq8x
CSeq: 270 REGISTER
WWW-Authenticate: Digest  realm="10.222.5.159",nonce="6d8bfcb964e206f9",opaque="610313b46a96ced6",algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
22-01-2016 18:13:30.320 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7f92a404a698
22-01-2016 18:13:30.320 UTC Debug thread_dispatcher.cpp:199: Request latency = 193us
22-01-2016 18:13:34.320 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg REGISTER/cseq=270 (rdata0xf33448)
22-01-2016 18:13:34.320 UTC Verbose common_sip_processing.cpp:120: RX 701 bytes Request msg REGISTER/cseq=270 (rdata0xf33448) from UDP 10.222.5.162:32930:
--start msg--

REGISTER sip:10.222.5.159;transport=UDP SIP/2.0
Via: SIP/2.0/UDP 204.57.98.108:61897;branch=z9hG4bK-524287-1---59975f6b33c92da4
Max-Forwards: 70
Contact: <sip:6505550008 at 204.57.98.108:62113;rinstance=633a7d3b4158b33a;transport=UDP>
To: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>
From: "6505550008"<sip:6505550008 at 10.222.5.159;transport=UDP>;tag=c4043803
Call-ID: nCXQL8rriVqoKjhPaMdSaQ..
CSeq: 270 REGISTER
Expires: 3600
Allow: INVITE, ACK, CANCEL, BYE, NOTIFY, REFER, MESSAGE, OPTIONS, INFO, SUBSCRIBE
Supported: replaces, norefersub, extended-refer, timer, outbound, path, X-cisco-serviceuri
User-Agent: Z 3.9.32144 r32121
Allow-Events: presence, kpml
Content-Length: 0


--end msg--
-------------- next part --------------
--start msg--

SIP/2.0 200 OK
Via: SIP/2.0/TCP 10.222.5.172;rport=55801;received=10.222.5.172;branch=z9hG4bK-45325
Call-ID: poll-sip-45325
From: "poll-sip" <sip:poll-sip at 10.222.5.172>;tag=45325
To: <sip:poll-sip at 10.222.5.172>;tag=z9hG4bK-45325
CSeq: 45325 OPTIONS
Content-Length:  0


--end msg--
22-01-2016 18:52:58.203 UTC Debug common_sip_processing.cpp:254: Skipping SAS logging for OPTIONS response
22-01-2016 18:52:58.203 UTC Debug pjsip: tdta0x7f592c2a Destroying txdata Response msg 200/OPTIONS/cseq=45325 (tdta0x7f592c2a82e0)
22-01-2016 18:52:58.203 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7f5934034ef8
22-01-2016 18:52:58.203 UTC Debug thread_dispatcher.cpp:199: Request latency = 192us
22-01-2016 18:52:59.203 UTC Verbose pjsip: tcps0x7f593403 TCP connection closed
22-01-2016 18:52:59.203 UTC Debug connection_tracker.cpp:91: Connection 0x7f5934032658 has been destroyed
22-01-2016 18:52:59.203 UTC Verbose pjsip: tcps0x7f593403 TCP transport destroyed with reason 70016: End of file (PJ_EEOF)
22-01-2016 18:53:00.846 UTC Verbose httpstack.cpp:286: Process request for URL /authentication-timeout, args (null)
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:195: Key av\\6505550008 at 10.222.5.159\470506104a0198bd hashes to vbucket 118 via hash 0x8f1a51f6
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:367: 1 read replicas for key av\\6505550008 at 10.222.5.159\470506104a0198bd
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:402: Attempt to read from replica 0 (connection 0x7f599c084d40)
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:780: Fetch result
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:788: Found record on replica
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:410: Read for av\\6505550008 at 10.222.5.159\470506104a0198bd on replica 0 returned SUCCESS
22-01-2016 18:53:00.846 UTC Debug memcachedstore.cpp:453: Read 142 bytes from table av key 6505550008 at 10.222.5.159\470506104a0198bd, CAS = 578
22-01-2016 18:53:00.846 UTC Debug avstore.cpp:106: Retrieved AV for 6505550008 at 10.222.5.159\470506104a0198bd
{"digest":{"ha1":"1d3766c8dce441db5cb8af71865800bc","realm":"10.222.5.159","qop":"auth"},"branch":"z9hG4bKPj.s33yohye9VF.Q.eF0ZGmbk7TOSt32Kr"}
22-01-2016 18:53:00.846 UTC Debug handlers.cpp:630: AV for 6505550008 at 10.222.5.159:470506104a0198bd has timed out
22-01-2016 18:53:00.846 UTC Debug hssconnection.cpp:585: Making Homestead request for /impu/sip%3A6505550008%4010.222.5.159/reg-data?private_id=6505550008%4010.222.5.159
22-01-2016 18:53:00.847 UTC Debug httpresolver.cpp:71: HttpResolver::resolve for host 10.222.5.173, port 8888, family 2
22-01-2016 18:53:00.847 UTC Debug baseresolver.cpp:505: Attempt to parse 10.222.5.173 as IP address
22-01-2016 18:53:00.847 UTC Debug httpresolver.cpp:79: Target is an IP address
22-01-2016 18:53:00.847 UTC Debug httpconnection.cpp:623: Sending HTTP request : http://10.222.5.173:8888/impu/sip%3A6505550008%4010.222.5.159/reg-data?private_id=6505550008%4010.222.5.159 (trying 10.222.5.173) on new connection
22-01-2016 18:53:00.850 UTC Debug httpconnection.cpp:924: Received header http/1.1200ok with value
22-01-2016 18:53:00.850 UTC Debug httpconnection.cpp:924: Received header content-length with value 817
22-01-2016 18:53:00.850 UTC Debug httpconnection.cpp:924: Received header content-type with value text/plain
22-01-2016 18:53:00.850 UTC Debug httpconnection.cpp:924: Received header  with value
22-01-2016 18:53:00.850 UTC Debug httpconnection.cpp:638: Received HTTP response: status=200, doc=<ClearwaterRegData>
        <RegistrationState>UNREGISTERED</RegistrationState>
        <IMSSubscription xsi="http://www.w3.org/2001/XMLSchema-instance" noNamespaceSchemaLocation="CxDataType.xsd">
                <PrivateID>Unspecified</PrivateID>
                <ServiceProfile>
                        <InitialFilterCriteria>
                                <TriggerPoint>
                                        <ConditionTypeCNF>0</ConditionTypeCNF>
                                        <SPT>
                                                <ConditionNegated>0</ConditionNegated>
                                                <Group>0</Group>
                                                <Method>INVITE</Method>
                                                <Extension/>
                                        </SPT>
                                </TriggerPoint>
                                <ApplicationServer>
                                        <ServerName>sip:mmtel.10.222.5.159</ServerName>
                                        <DefaultHandling>0</DefaultHandling>
                                </ApplicationServer>
                        </InitialFilterCriteria>
                        <PublicIdentity>
                                <Identity>sip:6505550008 at 10.222.5.159</Identity>
                        </PublicIdentity>
                </ServiceProfile>
        </IMSSubscription>
</ClearwaterRegData>


22-01-2016 18:53:00.850 UTC Debug hssconnection.cpp:366: Processing Identity node from HSS XML - sip:6505550008 at 10.222.5.159

22-01-2016 18:53:00.850 UTC Verbose httpstack.cpp:69: Sending response 200 to request for URL /authentication-timeout, args (null)
22-01-2016 18:53:02.243 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg OPTIONS/cseq=45372 (rdata0x7f593401a090)
22-01-2016 18:53:02.243 UTC Verbose common_sip_processing.cpp:120: RX 525 bytes Request msg OPTIONS/cseq=45372 (rdata0x7f593401a090) from TCP 10.222.5.159:55924:
--start msg--

OPTIONS sip:poll-sip at 10.222.5.159:5058 SIP/2.0
Via: SIP/2.0/TCP 10.222.5.159:55924;rport;branch=z9hG4bKPjbEPbXRLkFK2RIGAGkALecZ97N90H8pa8
Via: SIP/2.0/TCP 10.222.5.159;rport=55100;received=10.222.5.159;branch=z9hG4bK-45372
Max-Forwards: 2
To: <sip:poll-sip at 10.222.5.159>
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=45372
Call-ID: poll-sip-45372
CSeq: 45372 OPTIONS
Contact: <sip:10.222.5.159>
Accept: application/sdp
User-Agent: poll-sip
Route: <sip:10.222.5.172:5054;transport=TCP;lr>
Content-Length:  0


--end msg--
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:53:02.243 UTC Debug pjutils.cpp:1648: Logging SAS Call-ID marker, Call-ID poll-sip-45372
22-01-2016 18:53:02.243 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7f59340326d8 for worker threads
22-01-2016 18:53:02.243 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7f59340326d8
22-01-2016 18:53:02.243 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg OPTIONS/cseq=45372 (rdata0x7f59340326d8)
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:53:02.243 UTC Debug authentication.cpp:666: Authentication module invoked
22-01-2016 18:53:02.243 UTC Debug authentication.cpp:676: Request does not need authentication
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:53:02.243 UTC Debug basicproxy.cpp:92: Process OPTIONS request
22-01-2016 18:53:02.243 UTC Verbose sproutletproxy.cpp:436: Sproutlet Proxy transaction (0x7f59380761e0) created
22-01-2016 18:53:02.243 UTC Debug basicproxy.cpp:1247: Report SAS start marker - trail (396)
22-01-2016 18:53:02.243 UTC Debug pjutils.cpp:674: Cloned Request msg OPTIONS/cseq=45372 (rdata0x7f59340326d8) to tdta0x7f5938316890
22-01-2016 18:53:02.243 UTC Debug pjsip: tsx0x7f5938004 Transaction created for Request msg OPTIONS/cseq=45372 (rdata0x7f59340326d8)
22-01-2016 18:53:02.243 UTC Debug pjsip: tsx0x7f5938004 Incoming Request msg OPTIONS/cseq=45372 (rdata0x7f59340326d8) in state Null
22-01-2016 18:53:02.243 UTC Debug pjsip: tsx0x7f5938004 State changed from Null to Trying, event=RX_MSG
22-01-2016 18:53:02.243 UTC Debug basicproxy.cpp:213: tsx0x7f5938004468 - tu_on_tsx_state UAS, TSX_STATE RX_MSG state=Trying
22-01-2016 18:53:02.243 UTC Debug pjsip:       endpoint Response msg 408/OPTIONS/cseq=45372 (tdta0x7f5938318850) created
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:102: Find target Sproutlet for request
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:136: Found next routable URI: sip:10.222.5.172:5054;transport=TCP;lr
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:175: No Sproutlet found using service name or host
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:180: Find default service for port 5054
22-01-2016 18:53:02.243 UTC Debug scscfsproutlet.cpp:339: S-CSCF Transaction (0x7f5938260c50) created
22-01-2016 18:53:02.243 UTC Verbose sproutletproxy.cpp:1062: Created Sproutlet scscf-0x7f5938260c50 for Request msg OPTIONS/cseq=45372 (tdta0x7f5938316890)
22-01-2016 18:53:02.243 UTC Verbose sproutletproxy.cpp:1967: Routing Request msg OPTIONS/cseq=45372 (tdta0x7f5938316890) (553 bytes) to downstream sproutlet scscf:
--start msg--

OPTIONS sip:poll-sip at 10.222.5.159:5058 SIP/2.0
Via: SIP/2.0/TCP 10.222.5.159:55924;rport=55924;received=10.222.5.159;branch=z9hG4bKPjbEPbXRLkFK2RIGAGkALecZ97N90H8pa8
Via: SIP/2.0/TCP 10.222.5.159;rport=55100;received=10.222.5.159;branch=z9hG4bK-45372
Max-Forwards: 2
To: <sip:poll-sip at 10.222.5.159>
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=45372
Call-ID: poll-sip-45372
CSeq: 45372 OPTIONS
Contact: <sip:10.222.5.159>
Accept: application/sdp
User-Agent: poll-sip
Route: <sip:10.222.5.172:5054;transport=TCP;lr>
Content-Length:  0


--end msg--
22-01-2016 18:53:02.243 UTC Debug pjutils.cpp:691: Cloned tdta0x7f5938316890 to tdta0x7f5938319860
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:1123: Remove top Route header Route: <sip:10.222.5.172:5054;transport=TCP;lr>
22-01-2016 18:53:02.243 UTC Debug sproutletproxy.cpp:1640: Adding message 0x7f5938319e70 => txdata 0x7f5938319908 mapping
22-01-2016 18:53:02.243 UTC Verbose sproutletproxy.cpp:1492: scscf-0x7f5938260c50 pass initial request Request msg OPTIONS/cseq=45372 (tdta0x7f5938319860) to Sproutlet
22-01-2016 18:53:02.243 UTC Info scscfsproutlet.cpp:381: S-CSCF received initial request
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:167: home domain: false, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:197: Classified URI as 3
22-01-2016 18:53:02.243 UTC Debug scscfsproutlet.cpp:677: Route header references this system
22-01-2016 18:53:02.243 UTC Debug scscfsproutlet.cpp:730: No ODI token, or invalid ODI token, on request, and no P-Charging-Vector header (so can't log ICID for correlation)
22-01-2016 18:53:02.243 UTC Debug scscfsproutlet.cpp:736: Got our Route header, session case term, OD=None
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:02.243 UTC Debug uri_classifier.cpp:197: Classified URI as 4
22-01-2016 18:53:02.243 UTC Debug acr.cpp:1763: Create RalfACR for node type S-CSCF with role Terminating
22-01-2016 18:53:02.243 UTC Debug acr.cpp:49: Created ACR (0x7f5938261230)
22-01-2016 18:53:02.243 UTC Debug acr.cpp:175: Created S-CSCF Ralf ACR
22-01-2016 18:53:02.243 UTC Debug scscfsproutlet.cpp:925: Looking up iFCs for sip:poll-sip at 10.222.5.159 for new AS chain
22-01-2016 18:53:02.244 UTC Debug hssconnection.cpp:585: Making Homestead request for /impu/sip%3Apoll-sip%4010.222.5.159/reg-data
22-01-2016 18:53:02.244 UTC Debug httpresolver.cpp:71: HttpResolver::resolve for host 10.222.5.173, port 8888, family 2
22-01-2016 18:53:02.244 UTC Debug baseresolver.cpp:505: Attempt to parse 10.222.5.173 as IP address
22-01-2016 18:53:02.244 UTC Debug httpresolver.cpp:79: Target is an IP address
22-01-2016 18:53:02.244 UTC Debug httpconnection.cpp:623: Sending HTTP request : http://10.222.5.173:8888/impu/sip%3Apoll-sip%4010.222.5.159/reg-data (trying 10.222.5.173) on new connection
22-01-2016 18:53:02.247 UTC Debug httpconnection.cpp:924: Received header http/1.1404notfound with value
22-01-2016 18:53:02.247 UTC Debug httpconnection.cpp:924: Received header content-length with value 0
22-01-2016 18:53:02.247 UTC Debug httpconnection.cpp:924: Received header  with value
22-01-2016 18:53:02.247 UTC Debug httpconnection.cpp:638: Received HTTP response: status=404, doc=
22-01-2016 18:53:02.247 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 0 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 18:53:02.247 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 18:53:02.247 UTC Debug scscfsproutlet.cpp:935: Failed to retrieve ServiceProfile for sip:poll-sip at 10.222.5.159
22-01-2016 18:53:02.247 UTC Debug acr.cpp:214: Set record type for P/S-CSCF
22-01-2016 18:53:02.247 UTC Debug acr.cpp:247: EVENT_RECORD
22-01-2016 18:53:02.247 UTC Info scscfsproutlet.cpp:426: Failed to determine served user for request, reject with 404 status code
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1640: Adding message 0x7f593831cea0 => txdata 0x7f593831c938 mapping
22-01-2016 18:53:02.247 UTC Verbose sproutletproxy.cpp:1321: scscf-0x7f5938260c50 sending Response msg 404/OPTIONS/cseq=45372 (tdta0x7f593831c890)
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1647: Removing message 0x7f5938319e70 => txdata 0x7f5938319908 mapping
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1398: Free message tdta0x7f5938319860
22-01-2016 18:53:02.247 UTC Debug pjsip: tdta0x7f593831 Destroying txdata Request msg OPTIONS/cseq=45372 (tdta0x7f5938319860)
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1655: Processing actions from sproutlet - 1 responses, 0 requests, 0 timers
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1741: Aggregating response with status code 404
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1791: 3xx/4xx/5xx/6xx response
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1795: Best 3xx/4xx/5xx/6xx response so far
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1682: All UAC responded
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1647: Removing message 0x7f593831cea0 => txdata 0x7f593831c938 mapping
22-01-2016 18:53:02.247 UTC Debug pjsip: tsx0x7f5938004 Sending Response msg 404/OPTIONS/cseq=45372 (tdta0x7f593831c890) in state Trying
22-01-2016 18:53:02.247 UTC Verbose common_sip_processing.cpp:136: TX 432 bytes Response msg 404/OPTIONS/cseq=45372 (tdta0x7f593831c890) to TCP 10.222.5.159:55924:
--start msg--

SIP/2.0 404 Not Found
Via: SIP/2.0/TCP 10.222.5.159:55924;rport=55924;received=10.222.5.159;branch=z9hG4bKPjbEPbXRLkFK2RIGAGkALecZ97N90H8pa8
Via: SIP/2.0/TCP 10.222.5.159;rport=55100;received=10.222.5.159;branch=z9hG4bK-45372
Call-ID: poll-sip-45372
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=45372
To: <sip:poll-sip at 10.222.5.159>;tag=z9hG4bKPjbEPbXRLkFK2RIGAGkALecZ97N90H8pa8
CSeq: 45372 OPTIONS
Content-Length:  0


--end msg--
22-01-2016 18:53:02.247 UTC Debug pjsip: tsx0x7f5938004 State changed from Trying to Completed, event=TX_MSG
22-01-2016 18:53:02.247 UTC Debug basicproxy.cpp:213: tsx0x7f5938004468 - tu_on_tsx_state UAS, TSX_STATE TX_MSG state=Completed
22-01-2016 18:53:02.247 UTC Verbose sproutletproxy.cpp:1733: scscf-0x7f5938260c50 suiciding
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1068: Destroying SproutletWrapper 0x7f5938263690
22-01-2016 18:53:02.247 UTC Debug scscfsproutlet.cpp:345: S-CSCF Transaction (0x7f5938260c50) destroyed
22-01-2016 18:53:02.247 UTC Info acr.cpp:658: No CCF or ECF to send ACR for session poll-sip-45372 to - dropping!
22-01-2016 18:53:02.247 UTC Debug acr.cpp:54: Destroyed ACR (0x7f5938261230)
22-01-2016 18:53:02.247 UTC Debug sproutletproxy.cpp:1077: Free original request Request msg OPTIONS/cseq=45372 (tdta0x7f5938316890) (tdta0x7f5938316890)
22-01-2016 18:53:02.247 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7f59340326d8
22-01-2016 18:53:02.247 UTC Debug thread_dispatcher.cpp:199: Request latency = 3910us
22-01-2016 18:53:02.254 UTC Debug pjsip: tsx0x7f5938004 Timeout timer event
22-01-2016 18:53:02.254 UTC Debug pjsip: tsx0x7f5938004 State changed from Completed to Terminated, event=TIMER
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:213: tsx0x7f5938004468 - tu_on_tsx_state UAS, TSX_STATE TIMER state=Terminated
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:1257: Report SAS end marker - trail (396)
22-01-2016 18:53:02.254 UTC Debug pjsip: tsx0x7f5938004 Timeout timer event
22-01-2016 18:53:02.254 UTC Debug pjsip: tsx0x7f5938004 State changed from Terminated to Destroyed, event=TIMER
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:213: tsx0x7f5938004468 - tu_on_tsx_state UAS, TSX_STATE TIMER state=Destroyed
22-01-2016 18:53:02.254 UTC Debug sproutletproxy.cpp:670: tsx0x7f5938004468 - UAS tsx destroyed
22-01-2016 18:53:02.254 UTC Debug sproutletproxy.cpp:989: Safe for UASTsx to suicide
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:1432: Transaction ((nil)) suiciding
22-01-2016 18:53:02.254 UTC Verbose sproutletproxy.cpp:467: Sproutlet Proxy transaction (0x7f59380761e0) destroyed
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:443: BasicProxy::UASTsx destructor (0x7f59380761e0)
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:458: Disconnect UAC transactions from UAS transaction
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:472: Free original request
22-01-2016 18:53:02.254 UTC Debug pjsip: tdta0x7f593831 Destroying txdata Request msg OPTIONS/cseq=45372 (tdta0x7f5938316890)
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:481: Free un-used best response
22-01-2016 18:53:02.254 UTC Debug pjsip: tdta0x7f593831 Destroying txdata Response msg 408/OPTIONS/cseq=45372 (tdta0x7f5938318850)
22-01-2016 18:53:02.254 UTC Debug basicproxy.cpp:502: BasicProxy::UASTsx destructor completed
22-01-2016 18:53:02.254 UTC Debug pjsip: tdta0x7f593831 Destroying txdata Response msg 404/OPTIONS/cseq=45372 (tdta0x7f593831c890)
22-01-2016 18:53:02.254 UTC Debug pjsip: tsx0x7f5938004 Transaction destroyed!
22-01-2016 18:53:08.230 UTC Verbose pjsip:    tcplis:5054 TCP listener 10.222.5.172:5054: got incoming TCP connection from 10.222.5.172:56233, sock=1118
22-01-2016 18:53:08.230 UTC Verbose pjsip: tcps0x7f593403 TCP server transport created
22-01-2016 18:53:08.230 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Request msg OPTIONS/cseq=45335 (rdata0x7f5934032990)
22-01-2016 18:53:08.230 UTC Verbose common_sip_processing.cpp:120: RX 347 bytes Request msg OPTIONS/cseq=45335 (rdata0x7f5934032990) from TCP 10.222.5.172:56233:
--start msg--

OPTIONS sip:poll-sip at 10.222.5.172:5054 SIP/2.0
Via: SIP/2.0/TCP 10.222.5.172;rport;branch=z9hG4bK-45335
Max-Forwards: 2
To: <sip:poll-sip at 10.222.5.172:5054>
From: poll-sip <sip:poll-sip at 10.222.5.172>;tag=45335
Call-ID: poll-sip-45335
CSeq: 45335 OPTIONS
Contact: <sip:10.222.5.172>
Accept: application/sdp
Content-Length: 0
User-Agent: poll-sip


--end msg--
22-01-2016 18:53:08.230 UTC Debug uri_classifier.cpp:167: home domain: false, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:08.230 UTC Debug uri_classifier.cpp:197: Classified URI as 3
22-01-2016 18:53:08.230 UTC Debug common_sip_processing.cpp:212: Skipping SAS logging for OPTIONS request
22-01-2016 18:53:08.230 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7f5934034ef8 for worker threads
22-01-2016 18:53:08.230 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7f5934034ef8
22-01-2016 18:53:08.230 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg OPTIONS/cseq=45335 (rdata0x7f5934034ef8)
22-01-2016 18:53:08.230 UTC Debug uri_classifier.cpp:167: home domain: false, local_to_node: true, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
22-01-2016 18:53:08.230 UTC Debug uri_classifier.cpp:197: Classified URI as 3
22-01-2016 18:53:08.230 UTC Debug pjsip:       endpoint Response msg 200/OPTIONS/cseq=45335 (tdta0x7f5934036e10) created
22-01-2016 18:53:08.231 UTC Verbose common_sip_processing.cpp:136: TX 277 bytes Response msg 200/OPTIONS/cseq=45335 (tdta0x7f5934036e10) to TCP 10.222.5.172:56233:
--start msg--

SIP/2.0 200 OK
Via: SIP/2.0/TCP 10.222.5.172;rport=56233;received=10.222.5.172;branch=z9hG4bK-45335
Call-ID: poll-sip-45335
From: "poll-sip" <sip:poll-sip at 10.222.5.172>;tag=45335
To: <sip:poll-sip at 10.222.5.172>;tag=z9hG4bK-45335
CSeq: 45335 OPTIONS
Content-Length:  0


--end msg--

From Matt.Williams at metaswitch.com  Fri Jan 22 14:26:32 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 22 Jan 2016 19:26:32 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
Message-ID: <CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

The Bono and Sprout traces seem to be from different times - the Bono traces are from 18:13 and the Sprout traces are from 18:52.  Do you have NTP configured?

The Bono trace seems to show

?         a Zoiper softphone sending a REGISTER for sip:6505550008 at 10.222.5.159

?         Bono forwarding this on to Sprout

?         Sprout replying with a 401 authentication challenge

?         Bono forwarding this back to the Zoiper

?         a retry from the Zoiper, but no indication of it attempting to respond to the authentication challenge.
(The Sprout trace doesn't show anything as it's from a different time.)

When the Zoiper receives the 401 challenge, it should respond with a new REGISTER that responds to this challenge.  It's possible that the trace file you've shared is truncated before this happens, or maybe the Zoiper is not responding to the challenge for some reason.

Please can you check your complete Bono logs?

?         If you see a REGISTER request containing an Authorization header, please can you share those logs and we can investigate if/why that's failing.

?         If you don't see any Authorization headers in your REGISTER requests, this sounds like a problem with your Zoiper configuration - it should be responding to the challenge.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 22 January 2016 19:06
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Yes I understand your recommendation, but for now there is no dns server in my design.
Will have a segregated setup for that.

For now please find the bono and sproute logs attached to the mail.

how do i make this work without the dns?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

If you're intending to implement DNS, I'd suggest doing it now rather than later - you're going down paths that are not well-trodden, and I'm sure we're going to hit lots of configuration issues.  It will be much quicker to deploy DNS now.

My guess in this case is that, because the subscriber's "domain" parameter is an IP address, Bono is just routing the INVITE to that IP address (which is itself, so it fails).  Even when we deploy without DNS, we still configure the domain to be a real domain name (even though it won't resolve in DNS).

If this doesn't resolve the problem, I'd suggest turning debug logging on in Bono and Sprout (as described at http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono and http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout) - this will give you more detailed diagnostics about what's going on in Bono and Sprout.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 13:16

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the registration is not success full.
The screen and log file is as below.

[Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 06:02

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/2ee91054/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: image001.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160122/2ee91054/attachment.png>

From shivacharanms at gmail.com  Sun Jan 24 06:51:37 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Sun, 24 Jan 2016 17:21:37 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>

Hi Matt,

The registrations were successful but when it try to make the call, i get a
408 request time out from zoiper client.

Thanks,
Shiva

On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <
Matt.Williams at metaswitch.com> wrote:

> Shiva,
>
>
>
> The Bono and Sprout traces seem to be from different times - the Bono
> traces are from 18:13 and the Sprout traces are from 18:52.  Do you have
> NTP configured?
>
>
>
> The Bono trace seems to show
>
> ?         a Zoiper softphone sending a REGISTER for
> sip:6505550008 at 10.222.5.159
>
> ?         Bono forwarding this on to Sprout
>
> ?         Sprout replying with a 401 authentication challenge
>
> ?         Bono forwarding this back to the Zoiper
>
> ?         a retry from the Zoiper, but no indication of it attempting to
> respond to the authentication challenge.
>
> (The Sprout trace doesn't show anything as it's from a different time.)
>
>
>
> When the Zoiper receives the 401 challenge, it should respond with a new
> REGISTER that responds to this challenge.  It's possible that the trace
> file you've shared is truncated before this happens, or maybe the Zoiper is
> not responding to the challenge for some reason.
>
>
>
> Please can you check your complete Bono logs?
>
> ?         If you see a REGISTER request containing an Authorization
> header, please can you share those logs and we can investigate if/why
> that's failing.
>
> ?         If you don't see any Authorization headers in your REGISTER
> requests, this sounds like a problem with your Zoiper configuration - it
> should be responding to the challenge.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 19:06
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Yes I understand your recommendation, but for now there is no dns server
> in my design.
>
> Will have a segregated setup for that.
>
>
>
> For now please find the bono and sproute logs attached to the mail.
>
>
>
> how do i make this work without the dns?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> If you're intending to implement DNS, I'd suggest doing it now rather than
> later - you're going down paths that are not well-trodden, and I'm sure
> we're going to hit lots of configuration issues.  It will be *much*
> quicker to deploy DNS now.
>
>
>
> My guess in this case is that, because the subscriber's "domain" parameter
> is an IP address, Bono is just routing the INVITE to that IP address (which
> is itself, so it fails).  Even when we deploy without DNS, we still
> configure the domain to be a real domain name (even though it won't resolve
> in DNS).
>
>
>
> If this doesn't resolve the problem, I'd suggest turning debug logging on
> in Bono and Sprout (as described at
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono
> and
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout)
> - this will give you more detailed diagnostics about what's going on in
> Bono and Sprout.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 13:16
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thanks for the recommendation, will implement DNS later on :) .
>
>
>
> And you were rite I had missed to remove a dns name for sprout, its now
> fixed i am able to open the UI and create numbers.
>
>
>
> But when trying to make a sip call via zoiper client application, the
> registration is not success full.
>
> The screen and log file is as below.
>
>
>
> [image: Inline image 2]
>
>
>
> Any idea?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Clearwater is very oriented around DNS.
>
> ?         DNS is used for load-balancing when you have more than 1 node
> in a cluster - in particular, following RFC 3263 for SIP.
>
> ?         DNS is used (following the rules in RFC 6733) for resolving
> Diameter realms to IP addresses.
>
>
>
> It is possible to get Clearwater running without a DNS server, but I would
> strongly recommend that you deploy a DNS server - in particular, if you
> event intend to scale up to a fault-tolerant or higher-capacity deployment,
> it is mandatory.
>
>
>
> The instructions for configuring DNS (and installing a DNS server if you
> don't already have one) are at
> http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html
> .
>
>
>
> Please let me know if you do definitely need to run without DNS, and we
> can look at how to set this up - but note the restrictions above on
> scalability and fault-tolerance.
>
>
>
> On the issues you're seeing below, I think the problem is that there is
> still configuration entries such as "sprout_hostname" below that contain
> both a hostname prefix and then an IP address - moving to DNS is one way to
> resolve all this.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 06:02
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> An update, ive changed the share_config file as follows and also I dont
> have a dns server in my environment( I assume its not mandatory).
>
> Also find the logs below.
>
>
>
> *shared_config *
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=10.222.5.173:8888
>
> hs_provisioning_hostname=10.222.5.173:8889
>
> ralf_hostname=10.222.5.163:10888
>
> xdms_hostname=0.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> *ellis error log*
>
> 22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK
>
>
>
> *homestead log:*
>
> 22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
>
>
>
>
> *homer log:*
>
> 2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
> UNIX socket /tmp/.homer-sock-0
>
>
>
> *sprout log:*
>
> 22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
> request rate/second unchanged - only handled 20 requests in last 142284ms,
> minimum threshold for a change is 35571.000000
>
> 22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
>
>
>
>
> bono and ralf log files are attached to the mail
>
>
>
>
>
>
>
> On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Matt,
>
>
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
>
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
>
> Program 'poll_bono'  Status failed
>
> Program 'poll_memento_https'        Status failed
>
>
>
> And Ellis UI still show the nginx welcome page.
>
>
>
> Please find the shared_config file below.
>
>
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=hs.10.222.5.173:8888
>
> hs_provisioning_hostname=hs.10.222.5.173:8889
>
> ralf_hostname=ralf.10.222.5.163:10888
>
> xdms_hostname=homer.10.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> Shiva
>
>
>
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160124/cf8deee6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160124/cf8deee6/attachment.png>
-------------- next part --------------
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff034003 Transaction created for Request msg OPTIONS/cseq=191829 (rdata0x7ff03005dfd8)
24-01-2016 11:33:59.598 UTC Debug bono.cpp:1771: UASTransaction constructor (0x7ff034003990)
24-01-2016 11:33:59.598 UTC Debug bono.cpp:1772: ACR (0x7ff0340029e0)
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff034003 Incoming Request msg OPTIONS/cseq=191829 (rdata0x7ff03005dfd8) in state Null
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff034003 State changed from Null to Trying, event=RX_MSG
24-01-2016 11:33:59.598 UTC Debug bono.cpp:383: tsx0x7ff034003228 - tu_on_tsx_state UAS, TSX_STATE RX_MSG state=Trying
24-01-2016 11:33:59.598 UTC Debug pjsip:       endpoint Response msg 408/OPTIONS/cseq=191829 (tdta0x7ff034003b20) created
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2403: Report SAS start marker - trail (3)
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2477: Allocating transaction and data for target 0
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2734: Stripping loose routes from proxied message
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2761: Adding a Route header to sip:10.222.5.172:5054;transport=TCP
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff03400b Transaction created for Request msg OPTIONS/cseq=191829 (tdta0x7ff034004dd0)
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2504: Adding trail identifier 3 to UAC transaction
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2523: Updating request URI and route for target 0
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2829: Transport tcpc0x1a85d48 (TCP to 10.222.5.172:5054) pre-selected for transaction
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2847: Sending request for sip:poll-sip at 10.222.5.159:5058
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff03400b Sending Request msg OPTIONS/cseq=191829 (tdta0x7ff034004dd0) in state Null
24-01-2016 11:33:59.598 UTC Debug pjsip:       endpoint Request msg OPTIONS/cseq=191829 (tdta0x7ff034004dd0): skipping target resolution because address is already set
24-01-2016 11:33:59.598 UTC Verbose common_sip_processing.cpp:136: TX 529 bytes Request msg OPTIONS/cseq=191829 (tdta0x7ff034004dd0) to TCP 10.222.5.172:5054:
--start msg--

OPTIONS sip:poll-sip at 10.222.5.159:5058 SIP/2.0^M
Via: SIP/2.0/TCP 10.222.5.159:33695;rport;branch=z9hG4bKPjP6TB36k3pBZkk4UK9zfLNgID-uPnypcw^M
Via: SIP/2.0/TCP 10.222.5.159;rport=50477;received=10.222.5.159;branch=z9hG4bK-191829^M
Max-Forwards: 2^M
To: <sip:poll-sip at 10.222.5.159>^M
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=191829^M
Call-ID: poll-sip-191829^M
CSeq: 191829 OPTIONS^M
Contact: <sip:10.222.5.159>^M
Accept: application/sdp^M
User-Agent: poll-sip^M
Route: <sip:10.222.5.172:5054;transport=TCP;lr>^M
Content-Length:  0^M
^M

--end msg--
24-01-2016 11:33:59.598 UTC Debug pjsip: tsx0x7ff03400b State changed from Null to Calling, event=TX_MSG
24-01-2016 11:33:59.598 UTC Debug bono.cpp:383: tsx0x7ff03400bec8 - tu_on_tsx_state UAC, TSX_STATE TX_MSG state=Calling
24-01-2016 11:33:59.598 UTC Debug bono.cpp:2947: tsx0x7ff03400bec8 - uac_data = 0x7ff03400c630, uas_data = 0x7ff034003990
24-01-2016 11:33:59.598 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7ff03005dfd8
24-01-2016 11:33:59.598 UTC Debug thread_dispatcher.cpp:199: Request latency = 644us
24-01-2016 11:33:59.602 UTC Debug pjsip: sip_endpoint.c Processing incoming message: Response msg 404/OPTIONS/cseq=191829 (rdata0x1a86080)
24-01-2016 11:33:59.602 UTC Verbose common_sip_processing.cpp:120: RX 436 bytes Response msg 404/OPTIONS/cseq=191829 (rdata0x1a86080) from TCP 10.222.5.172:5054:
--start msg--

SIP/2.0 404 Not Found^M
Via: SIP/2.0/TCP 10.222.5.159:33695;rport=33695;received=10.222.5.159;branch=z9hG4bKPjP6TB36k3pBZkk4UK9zfLNgID-uPnypcw^M
Via: SIP/2.0/TCP 10.222.5.159;rport=50477;received=10.222.5.159;branch=z9hG4bK-191829^M
Call-ID: poll-sip-191829^M
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=191829^M
To: <sip:poll-sip at 10.222.5.159>;tag=z9hG4bKPjP6TB36k3pBZkk4UK9zfLNgID-uPnypcw^M
CSeq: 191829 OPTIONS^M
Content-Length:  0^M
^M

--end msg--
24-01-2016 11:33:59.602 UTC Debug pjutils.cpp:1648: Logging SAS Call-ID marker, Call-ID poll-sip-191829
24-01-2016 11:33:59.602 UTC Debug thread_dispatcher.cpp:253: Queuing cloned received message 0x7ff03005dfd8 for worker threads
24-01-2016 11:33:59.602 UTC Debug thread_dispatcher.cpp:149: Worker thread dequeue message 0x7ff03005dfd8
24-01-2016 11:33:59.602 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Response msg 404/OPTIONS/cseq=191829 (rdata0x7ff03005dfd8)
24-01-2016 11:33:59.602 UTC Debug pjsip: tsx0x7ff03400b Incoming Response msg 404/OPTIONS/cseq=191829 (rdata0x7ff03005dfd8) in state Calling
24-01-2016 11:33:59.602 UTC Debug pjsip: tsx0x7ff03400b State changed from Calling to Completed, event=RX_MSG
24-01-2016 11:33:59.602 UTC Debug bono.cpp:383: tsx0x7ff03400bec8 - tu_on_tsx_state UAC, TSX_STATE RX_MSG state=Completed
24-01-2016 11:33:59.602 UTC Debug bono.cpp:2947: tsx0x7ff03400bec8 - uac_data = 0x7ff03400c630, uas_data = 0x7ff034003990
24-01-2016 11:33:59.602 UTC Debug bono.cpp:2986: tsx0x7ff03400bec8 - RX_MSG on active UAC transaction
24-01-2016 11:33:59.602 UTC Debug acr.cpp:1491: Stored 0 subscription identifiers
24-01-2016 11:33:59.602 UTC Debug bono.cpp:2179: tsx0x7ff03400bec8 - Final response, so disconnect UAS and UAC transactions
24-01-2016 11:33:59.602 UTC Debug pjsip: tdta0x7ff03400 Destroying txdata Response msg 408/OPTIONS/cseq=191829 (tdta0x7ff034003b20)
24-01-2016 11:33:59.602 UTC Debug bono.cpp:2614: Dissociate UAC transaction 0x7ff03400c630 (0)
24-01-2016 11:33:59.602 UTC Debug pjsip: tsx0x7ff034003 Sending Response msg 404/OPTIONS/cseq=191829 (tdta0x7ff02c0008e0) in state Trying
24-01-2016 11:33:59.602 UTC Verbose common_sip_processing.cpp:136: TX 316 bytes Response msg 404/OPTIONS/cseq=191829 (tdta0x7ff02c0008e0) to TCP 10.222.5.159:50477:
--start msg--

SIP/2.0 404 Not Found^M
Via: SIP/2.0/TCP 10.222.5.159;rport=50477;received=10.222.5.159;branch=z9hG4bK-191829^M
Call-ID: poll-sip-191829^M
From: "poll-sip" <sip:poll-sip at 10.222.5.159>;tag=191829^M
To: <sip:poll-sip at 10.222.5.159>;tag=z9hG4bKPjP6TB36k3pBZkk4UK9zfLNgID-uPnypcw^M
CSeq: 191829 OPTIONS^M
Content-Length:  0^M
^M

--end msg--
24-01-2016 11:33:59.602 UTC Debug pjsip: tsx0x7ff034003 State changed from Trying to Completed, event=TX_MSG
24-01-2016 11:33:59.602 UTC Debug bono.cpp:383: tsx0x7ff034003228 - tu_on_tsx_state UAS, TSX_STATE TX_MSG state=Completed
24-01-2016 11:33:59.602 UTC Debug bono.cpp:799: Request received on trusted port 5058
24-01-2016 11:33:59.602 UTC Debug bono.cpp:2412: Report SAS end marker - trail (3)
24-01-2016 11:33:59.602 UTC Debug thread_dispatcher.cpp:193: Worker thread completed processing message 0x7ff03005dfd8
24-01-2016 11:33:59.602 UTC Debug thread_dispatcher.cpp:199: Request latency = 302us
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff034003 Timeout timer event
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff034003 State changed from Completed to Terminated, event=TIMER
24-01-2016 11:33:59.612 UTC Debug bono.cpp:383: tsx0x7ff034003228 - tu_on_tsx_state UAS, TSX_STATE TIMER state=Terminated
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff03400b Timeout timer event
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff03400b State changed from Completed to Terminated, event=TIMER
24-01-2016 11:33:59.612 UTC Debug bono.cpp:383: tsx0x7ff03400bec8 - tu_on_tsx_state UAC, TSX_STATE TIMER state=Terminated
24-01-2016 11:33:59.612 UTC Debug bono.cpp:2947: tsx0x7ff03400bec8 - uac_data = 0x7ff03400c630, uas_data = (nil)
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff034003 Timeout timer event
24-01-2016 11:33:59.612 UTC Debug pjsip: tsx0x7ff034003 State changed from Terminated to Destroyed, event=TIMER
24-01-2016 11:33:59.612 UTC Debug bono.cpp:383: tsx0x7ff034003228 - tu_on_tsx_state UAS, TSX_STATE TIMER state=Destroyed
24-01-2016 11:33:59.612 UTC Debug bono.cpp:2261: tsx0x7ff034003228 - UAS tsx destroyed
24-01-2016 11:33:59.612 UTC Debug bono.cpp:1816: UASTransaction destructor (0x7ff034003990)
24-01-2016 11:33:59.612 UTC Debug bono.cpp:1836: Disconnect UAC transactions from UAS transaction
24-01-2016 11:33:59.612 UTC Debug bono.cpp:1882: Upstream ACR = 0x7ff0340029e0, Downstream ACR = 0x7ff0340029e0
24-01-2016 11:33:59.612 UTC Verbose acr.cpp:641: Sending P-CSCF Ralf ACR (0x7ff0340029e0)
24-01-2016 11:33:59.612 UTC Debug acr.cpp:671: Building message
24-01-2016 11:33:59.612 UTC Debug acr.cpp:688: Adding peers meta-data, 1 ccfs, 0 ecfs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:727: Building event
24-01-2016 11:33:59.612 UTC Debug acr.cpp:732: Adding Account-Record-Type AVP 1
24-01-2016 11:33:59.612 UTC Debug acr.cpp:752: Adding Service-Information AVP group
24-01-2016 11:33:59.612 UTC Debug acr.cpp:762: Adding 0 Subscription-Id AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:788: Adding IMS-Information AVP group
24-01-2016 11:33:59.612 UTC Debug acr.cpp:793: Adding Event-Type AVP group
24-01-2016 11:33:59.612 UTC Debug acr.cpp:822: Adding 0 Calling-Party-Address AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:842: Adding Called-Party-Address AVP
24-01-2016 11:33:59.612 UTC Debug acr.cpp:863: Adding 0 Called-Asserted-Identity AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:884: Adding 0 Associated-URI AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:903: Adding Time-Stamps AVP group
24-01-2016 11:33:59.612 UTC Debug acr.cpp:993: Adding 0 Transit-IOI-List AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1069: Adding 0 Early-Media-Description AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1097: Adding 0 Message-Body AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1181: Adding Cause-Code(404) AVP to ACR[Interim]
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1187: Adding 0 Reason-Header AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1205: Adding 0 Access-Network-Information AVPs
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1223: Adding From-Address AVP
24-01-2016 11:33:59.612 UTC Debug acr.cpp:1245: Adding Route-Header-Transmitted AVP
24-01-2016 11:33:59.613 UTC Debug httpconnection.cpp:183: Allocated CURL handle 0x7ff0240008c0
24-01-2016 11:33:59.613 UTC Debug acr.cpp:54: Destroyed ACR (0x7ff0340029e0)
24-01-2016 11:33:59.613 UTC Debug bono.cpp:1907: Free original request (0x7ff034000988)
24-01-2016 11:33:59.613 UTC Debug pjsip: tdta0x7ff03400 Destroying txdata Request msg OPTIONS/cseq=191829 (tdta0x7ff0340008e0)
24-01-2016 11:33:59.613 UTC Debug bono.cpp:1923: UASTransaction destructor completed
24-01-2016 11:33:59.613 UTC Debug pjsip: tdta0x7ff02c00 Destroying txdata Response msg 404/OPTIONS/cseq=191829 (tdta0x7ff02c0008e0)
24-01-2016 11:33:59.613 UTC Debug pjsip: tsx0x7ff03400b Timeout timer event
24-01-2016 11:33:59.613 UTC Debug pjsip: tsx0x7ff03400b State changed from Terminated to Destroyed, event=TIMER
24-01-2016 11:33:59.613 UTC Debug bono.cpp:383: tsx0x7ff03400bec8 - tu_on_tsx_state UAC, TSX_STATE TIMER state=Destroyed
24-01-2016 11:33:59.613 UTC Debug bono.cpp:2947: tsx0x7ff03400bec8 - uac_data = 0x7ff03400c630, uas_data = (nil)
24-01-2016 11:33:59.613 UTC Debug bono.cpp:3034: tsx0x7ff03400bec8 - UAC tsx destroyed
24-01-2016 11:33:59.613 UTC Debug pjsip: tdta0x7ff03400 Destroying txdata Request msg OPTIONS/cseq=191829 (tdta0x7ff034004dd0)
24-01-2016 11:33:59.613 UTC Debug pjsip: tsx0x7ff034003 Transaction destroyed!
24-01-2016 11:33:59.613 UTC Debug pjsip: tsx0x7ff03400b Transaction destroyed!
24-01-2016 11:33:59.614 UTC Debug httpresolver.cpp:71: HttpResolver::resolve for host 10.222.5.163, port 10888, family 2
24-01-2016 11:33:59.614 UTC Debug baseresolver.cpp:505: Attempt to parse 10.222.5.163 as IP address
24-01-2016 11:33:59.614 UTC Debug httpresolver.cpp:79: Target is an IP address
24-01-2016 11:33:59.614 UTC Debug httpconnection.cpp:623: Sending HTTP request : http://10.222.5.163:10888/call-id/poll-sip-191829 (trying 10.222.5.163) on new connection
24-01-2016 11:33:59.616 UTC Debug httpconnection.cpp:924: Received header http/1.1200ok with value
24-01-2016 11:33:59.616 UTC Debug httpconnection.cpp:924: Received header content-length with value 0
24-01-2016 11:33:59.616 UTC Debug httpconnection.cpp:924: Received header  with value
24-01-2016 11:33:59.616 UTC Debug httpconnection.cpp:638: Received HTTP response: status=200, doc=
24-01-2016 11:34:00.597 UTC Verbose pjsip: tcps0x7ff03003 TCP connection closed
24-01-2016 11:34:00.597 UTC Debug connection_tracker.cpp:91: Connection 0x7ff030039c28 has been destroyed
24-01-2016 11:34:00.597 UTC Verbose pjsip: tcps0x7ff03003 TCP transport destroyed with reason 70016: End of file (PJ_EEOF)
24-01-2016 11:34:04.568 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):

From Matt.Williams at metaswitch.com  Mon Jan 25 03:06:14 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Mon, 25 Jan 2016 08:06:14 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
Message-ID: <CY1PR0201MB156383DDAD803FBCEA57D64790C70@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

The bono_current.txt file you sent contains no record of an INVITE request (or a 408 response).  Please can you check that the INVITE is actually being sent to Bono and, if it is, gather a log from Bono from this period?

Also, it may well be a configuration issue on Sprout, so please gather Sprout's logs at the same time.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 24 January 2016 11:52
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

The registrations were successful but when it try to make the call, i get a 408 request time out from zoiper client.

Thanks,
Shiva

On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

The Bono and Sprout traces seem to be from different times - the Bono traces are from 18:13 and the Sprout traces are from 18:52.  Do you have NTP configured?

The Bono trace seems to show

?         a Zoiper softphone sending a REGISTER for sip:6505550008 at 10.222.5.159<mailto:sip%3A6505550008 at 10.222.5.159>

?         Bono forwarding this on to Sprout

?         Sprout replying with a 401 authentication challenge

?         Bono forwarding this back to the Zoiper

?         a retry from the Zoiper, but no indication of it attempting to respond to the authentication challenge.
(The Sprout trace doesn't show anything as it's from a different time.)

When the Zoiper receives the 401 challenge, it should respond with a new REGISTER that responds to this challenge.  It's possible that the trace file you've shared is truncated before this happens, or maybe the Zoiper is not responding to the challenge for some reason.

Please can you check your complete Bono logs?

?         If you see a REGISTER request containing an Authorization header, please can you share those logs and we can investigate if/why that's failing.

?         If you don't see any Authorization headers in your REGISTER requests, this sounds like a problem with your Zoiper configuration - it should be responding to the challenge.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 19:06

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Yes I understand your recommendation, but for now there is no dns server in my design.
Will have a segregated setup for that.

For now please find the bono and sproute logs attached to the mail.

how do i make this work without the dns?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

If you're intending to implement DNS, I'd suggest doing it now rather than later - you're going down paths that are not well-trodden, and I'm sure we're going to hit lots of configuration issues.  It will be much quicker to deploy DNS now.

My guess in this case is that, because the subscriber's "domain" parameter is an IP address, Bono is just routing the INVITE to that IP address (which is itself, so it fails).  Even when we deploy without DNS, we still configure the domain to be a real domain name (even though it won't resolve in DNS).

If this doesn't resolve the problem, I'd suggest turning debug logging on in Bono and Sprout (as described at http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono and http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout) - this will give you more detailed diagnostics about what's going on in Bono and Sprout.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 13:16

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the registration is not success full.
The screen and log file is as below.

[Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 06:02

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160125/0e999974/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: image001.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160125/0e999974/attachment.png>

From Matt.Williams at metaswitch.com  Mon Jan 25 06:05:32 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Mon, 25 Jan 2016 11:05:32 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NwnR1tUCrgh-q0zv__d6Pk0f8UD8MbB6xcopoN3bSVEhw@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
	<CY1PR0201MB156383DDAD803FBCEA57D64790C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NwnR1tUCrgh-q0zv__d6Pk0f8UD8MbB6xcopoN3bSVEhw@mail.gmail.com>
Message-ID: <CY1PR0201MB1563BFDDD833EF2E99C12D6E90C70@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

Yes, in this trace, we do see the INVITE being sent to Bono.  In future, you can check this in the bono*.txt logs (as with debug logging enabled, all SIP messages are traced there), or with network capture.

The trace shows that the bono process is being restarted regularly.  I suspect this is because the monit process (which monitors and restarts processes if they fail) is automatically polling bono with SIP OPTIONS messages and these requests are failing.  We see these OPTIONS messages in the bono logs, along with the INVITE.  The reason the OPTIONS messages are failing is that Bono's local_ip matches home_domain (both in /etc/clearwater/local_config), so the bono process doesn't know whether to forward these requests on to Sprout (where they fail, as expected) or to reply to them itself.

This is a configuration error.  As I asked you below:
Even when we deploy without DNS, we still configure the home domain to be a real domain name (even though it won't resolve in DNS).
Please can you fix this configuration, and confirm that you've done so?  When you've done this, you'll also need to recreate your subscribers on Ellis, as the old ones will have the wrong home domain.

As below, I'd strongly recommend deploying DNS - while we may be able to make a non-DNS deployment work, it's going to take a lot longer, and require you to understand a lot more about the solution and do a lot more troubleshooting.

The remote_cluster_settings file is used for geographic redundant deployments.  See http://clearwater.readthedocs.org/en/latest/Geographic_redundancy/ for more details.  You won't need this because you're not running a geographic redundant deployment.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 25 January 2016 10:01
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

yes i've given bono node details ( registration is successful ) please find the latest logs attached after I tried a call request from zoiper client.
Is it still not connecting to bono? what should be the contents of "remote_cluster_settings" file in sprout?

Thanks,
Shiva


On Mon, Jan 25, 2016 at 12:06 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

The bono_current.txt file you sent contains no record of an INVITE request (or a 408 response).  Please can you check that the INVITE is actually being sent to Bono and, if it is, gather a log from Bono from this period?

Also, it may well be a configuration issue on Sprout, so please gather Sprout's logs at the same time.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 24 January 2016 11:52

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

The registrations were successful but when it try to make the call, i get a 408 request time out from zoiper client.

Thanks,
Shiva

On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

The Bono and Sprout traces seem to be from different times - the Bono traces are from 18:13 and the Sprout traces are from 18:52.  Do you have NTP configured?

The Bono trace seems to show

?         a Zoiper softphone sending a REGISTER for sip:6505550008 at 10.222.5.159<mailto:sip%3A6505550008 at 10.222.5.159>

?         Bono forwarding this on to Sprout

?         Sprout replying with a 401 authentication challenge

?         Bono forwarding this back to the Zoiper

?         a retry from the Zoiper, but no indication of it attempting to respond to the authentication challenge.
(The Sprout trace doesn't show anything as it's from a different time.)

When the Zoiper receives the 401 challenge, it should respond with a new REGISTER that responds to this challenge.  It's possible that the trace file you've shared is truncated before this happens, or maybe the Zoiper is not responding to the challenge for some reason.

Please can you check your complete Bono logs?

?         If you see a REGISTER request containing an Authorization header, please can you share those logs and we can investigate if/why that's failing.

?         If you don't see any Authorization headers in your REGISTER requests, this sounds like a problem with your Zoiper configuration - it should be responding to the challenge.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 19:06

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Yes I understand your recommendation, but for now there is no dns server in my design.
Will have a segregated setup for that.

For now please find the bono and sproute logs attached to the mail.

how do i make this work without the dns?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

If you're intending to implement DNS, I'd suggest doing it now rather than later - you're going down paths that are not well-trodden, and I'm sure we're going to hit lots of configuration issues.  It will be much quicker to deploy DNS now.

My guess in this case is that, because the subscriber's "domain" parameter is an IP address, Bono is just routing the INVITE to that IP address (which is itself, so it fails).  Even when we deploy without DNS, we still configure the domain to be a real domain name (even though it won't resolve in DNS).

If this doesn't resolve the problem, I'd suggest turning debug logging on in Bono and Sprout (as described at http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono and http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout) - this will give you more detailed diagnostics about what's going on in Bono and Sprout.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 13:16

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the registration is not success full.
The screen and log file is as below.

[Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 06:02

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva








-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160125/a401b9e4/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: image001.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160125/a401b9e4/attachment.png>

From peter.skrzynski at nec.co.nz  Mon Jan 25 23:22:31 2016
From: peter.skrzynski at nec.co.nz (Peter Skrzynski)
Date: Tue, 26 Jan 2016 04:22:31 +0000
Subject: [Clearwater] Bulk provisioning problem
In-Reply-To: <CY1PR0201MB156301B2EC28BB9DC34629B590C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <8482fee1ad284e8e985a8d705c3e38ee@ex15p.necnz.internal>
	<CY1PR0201MB156391704411139A63AEEBF590C20@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<8b611056c40e478eabcc9a5c3617bf2e@ex15p.necnz.internal>
	<CY1PR0201MB156301B2EC28BB9DC34629B590C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <7cf93750ca69416ea4082e72b749fade@ex15w.necnz.internal>

HI Matt,
Thanks, yes the ?sudo apt-get install -f? did work, and after setting the ?/usr/share/clearwater/crest/env/bin/python? path, and the ?import from metaswitch? entries, it is now all working OK?
[homestead]user at homestead-1:~$ dpkg-query -s homestead-prov
Package: homestead-prov
Status: install ok installed
Priority: optional
Section: network
Installed-Size: 199
Maintainer: Project Clearwater Maintainers <maintainers at projectclearwater.org<mailto:maintainers at projectclearwater.org>>
Architecture: amd64
Source: crest
Version: 1.0-160111.145732
Depends: crest
Conffiles:
/etc/cron.hourly/homestead-prov-log-cleanup e43ebf9d66c26ea9a1748ef6e765343c
/etc/init.d/homestead-prov 448b84f2fec0eae50bb8e1022edb920e
/etc/clearwater/secure-connections/homestead.conf 8ee85b3d9b0f652e1b4727a6655f2b67
Description: Provisioning backend for Homestead, the Cassandra powered HSS gateway
Homepage: http://projectclearwater.org/
[homestead]user at homestead-1:~$
Many thanks,
Regards
Peter.

From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Friday, 22 January 2016 2:44 a.m.
To: Peter Skrzynski
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Bulk provisioning problem

Peter,

Thanks for your email.

Yes, it looks like your homestead-prov install has failed - note that it says "install ok unpacked" rather than "install ok installed".

My suspicion is that the crest package (on which homestead-prov depends) failed to install - this is the package that would create the env directory as part of installation.

Please can you try "sudo apt-get install -f" - this will try to fix any broken packages (such as crest), and let me know whether this succeeds or reports errors (and if it reports errors, what they are)?

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Peter Skrzynski [mailto:peter.skrzynski at nec.co.nz]
Sent: 21 January 2016 05:19
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Bulk provisioning problem

Hi Matt.
Thanks for the response.
Yes I am using the Homestead node, not Ellis. It is a manual install of bono/sprout/homestead/ibcf/dns.
Sorry I was misleading when I said ?upgrade? to 89.
Actually I am building a complete new IMS with version 89, and then I will just swing my users over to it.

My new Homestead node does NOT have the binary /usr/share/clearwater/crest/env/bin/python!
If fact, the env directory under /usr/share/clearwater/crest/ does not exist at all?
[homestead]user at homestead-1:/usr/share/clearwater/crest$ ls
src
[homestead]user at homestead-1:/usr/share/clearwater/crest$

The output from dpkg-query is?
[homestead]user at homestead-1:~$ dpkg-query ?s homestead-prov
Package: homestead-prov
Status: install ok unpacked
Priority: optional
Section: network
Installed-Size: 199
Maintainer: Project Clearwater Maintainers <maintainers at projectclearwater.org<mailto:maintainers at projectclearwater.org>>
Architecture: amd64
Source: crest
Version: 1.0-160111.145732
Depends: crest
Conffiles:
/etc/cron.hourly/homestead-prov-log-cleanup newconffile
/etc/init.d/homestead-prov newconffile
/etc/clearwater/secure-connections/homestead.conf newconffile
Description: Provisioning backend for Homestead, the Cassandra powered HSS gateway
Homepage: http://projectclearwater.org/
[homestead]user at homestead-1:~$

So where to from here?
Does the above mean my homestead install did not work properly?
Should I just build another homestead node and see if the correct python binary file gets installed second time round?
Cheers,
Peter.

From: Matt Williams [mailto:Matt.Williams at metaswitch.com]
Sent: Thursday, 21 January 2016 5:01 a.m.
To: Peter Skrzynski
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: RE: Bulk provisioning problem

Peter,

Thanks for your email.

When you ran this before, did you run your my_bulk_create.py script on the Ellis node, or did you run it on the Homestead node?  I would expect you to run it on the Homestead node.

The issue you're hitting is that the "python" binary you've found below clearwater-prov-tools is in a special virtual environment ("virtualenv").  This virtual environment doesn't include the "crest" code on which bulk_create.py depends.  Crest is the Cassandra-backed RESTful HTTP server platform on which both Homestead-Prov and Homer are built.

There should be a python binary below /usr/share/clearwater/crest/env/bin/python - I've checked that it exists on both a freshly-installed Homestead node and a Homestead node that has been upgraded through many intermediate releases (although not necessarily 76 directly to 89, for which maybe there's an upgrade issue).

If you're trying to run this on a Homestead node and it's still failing, please can you check that homestead-prov is installed correctly?  To do this, run "dpkg-query -s homestead-prov" and check that it says "Status: install ok installed" (along with a load of other output!).

Please let me know how you get on.

Cheers,

Matt

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Peter Skrzynski
Sent: 19 January 2016 22:04
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Bulk provisioning problem

Hi,
I have a manual install using Release 76 ?In Dubious Battle?.
To bulk provision a specific range of numbers, I used a modified version of the bulk_create.py which does not use a csv file, and that worked fine.
I am now upgrading my IMS to the latest Release 89 ?Vicomte de Bragelonne?.
My modified bulk creation script no longer works.
There seems to be problems with the bulk_create.py file in Release 89.
The first line (of bulk_create.py) specifies the python file location as /usr/share/clearwater/crest/env/bin/python,
but actually it is in /usr/share/clearwater/clearwater-prov-tools/env/bin/python.
I fixed that and now it fails on the line ?from metaswitch.crest.tools.utils import create_imssubscription_xml?.
The error output is:
------------------------------------------------------------------------------------------
Traceback (most recent call last):
  File ?./my_bulk_create.py?, line 65, in <module>
    From metaswitch.crest.tools.utils import create_imssubscription_xml
ImportError: No module named crest.tools.utils
-------------------------------------------------------------------------------------------
Given that the python file is under ?/usr/share/clearwater/clearwater-prov-tools/?, but the metaswitch directory is under ?/usr/share/clearwater/crest/src/?,
does that mean there is a directory structure issue in homestead?
Or is it possible to fix my problem somehow?
I note that in Release 76 they were both under ?/usr/share/clearwater/homestead/?.
Regards
Peter.




Peter Skrzynski
Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image001.jpg at 01D157A9.22CB8DB0]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160126/bce2f4a4/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 8344 bytes
Desc: image001.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160126/bce2f4a4/attachment.jpg>

From Graeme.Robertson at metaswitch.com  Tue Jan 26 07:01:38 2016
From: Graeme.Robertson at metaswitch.com (Graeme Robertson)
Date: Tue, 26 Jan 2016 12:01:38 +0000
Subject: [Clearwater] Wuthering Heights release note
In-Reply-To: <BLUPR0201MB1763F668C9B2543E7B0B87EBE3D80@BLUPR0201MB1763.namprd02.prod.outlook.com>
References: <BLUPR0201MB1763F668C9B2543E7B0B87EBE3D80@BLUPR0201MB1763.namprd02.prod.outlook.com>
Message-ID: <BLUPR0201MB1763B0BF91B4200C1A76CAA8E3D80@BLUPR0201MB1763.namprd02.prod.outlook.com>

The release for Project Clearwater sprint "Wuthering Heights" has been cut. The code for this release is tagged as release-90 in github.

This release includes the following bug fixes:

*         Bad ENT log for calls to unknown user (https://github.com/Metaswitch/sprout/issues/1300)

*         SQN resync in AKA doesn't work (https://github.com/Metaswitch/sprout/issues/1299)

*         Adding a second P-Asserted-Identity isn't quite right (https://github.com/Metaswitch/sprout/issues/1267)

*         Unit test time - a test that controls current time doesn't clean up (https://github.com/Metaswitch/sprout/issues/1185)

*         Sprout adds wrong header field parameter for orig-cdiv (https://github.com/Metaswitch/sprout/issues/1140)

*         Missing ENT log for memcached read alarm (https://github.com/Metaswitch/sprout/issues/902)

*         `make full_test` fails on a clean Chronos checkout (https://github.com/Metaswitch/chronos/issues/208)

*         ENT logs often spam (https://github.com/Metaswitch/cpp-common/issues/317)

*         Java bulk provisioning should be included in homestead-prov package (https://github.com/Metaswitch/crest/issues/267)

*         Chef spun up a broken deployment.  (https://github.com/Metaswitch/chef/issues/254)

*         Uninstalling clearwater-nginx leaves monit configuration file (https://github.com/Metaswitch/clearwater-nginx/issues/23)

*         Astaire no longer builds (https://github.com/Metaswitch/astaire/issues/42)


For upgrading to this release, follow the instructions at http://clearwater.readthedocs.org/en/latest/Upgrading_a_Clearwater_deployment/index.html. If you are deploying an all-in-one node, the standard image (http://vm-images.cw-ngv.com/cw-aio.ova) has been updated for this release.



Thanks,
Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160126/b89a1172/attachment.html>

From shivacharanms at gmail.com  Thu Jan 28 02:43:57 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Thu, 28 Jan 2016 13:13:57 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB1563BFDDD833EF2E99C12D6E90C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
	<CY1PR0201MB156383DDAD803FBCEA57D64790C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NwnR1tUCrgh-q0zv__d6Pk0f8UD8MbB6xcopoN3bSVEhw@mail.gmail.com>
	<CY1PR0201MB1563BFDDD833EF2E99C12D6E90C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NzuqFqyABitYffzTSqy+BPV0P=WBDbtEfs44Et4M7+zqw@mail.gmail.com>

HI Matt,

Ive installed a DNS server in my environment, what all changes do i need to
do?

Thanks,
Shiva

On Mon, Jan 25, 2016 at 4:35 PM, Matt Williams <Matt.Williams at metaswitch.com
> wrote:

> Shiva,
>
>
>
> Yes, in this trace, we do see the INVITE being sent to Bono.  In future,
> you can check this in the bono*.txt logs (as with debug logging enabled,
> all SIP messages are traced there), or with network capture.
>
>
>
> The trace shows that the bono process is being restarted regularly.  I
> suspect this is because the monit process (which monitors and restarts
> processes if they fail) is automatically polling bono with SIP OPTIONS
> messages and these requests are failing.  We see these OPTIONS messages in
> the bono logs, along with the INVITE.  The reason the OPTIONS messages are
> failing is that Bono's local_ip matches home_domain (both in
> /etc/clearwater/local_config), so the bono process doesn't know whether to
> forward these requests on to Sprout (where they fail, as expected) or to
> reply to them itself.
>
>
>
> This is a configuration error.  As I asked you below:
>
> Even when we deploy without DNS, we still configure the home domain to be
> a real domain name (even though it won't resolve in DNS).
>
> Please can you fix this configuration, and confirm that you've done so?
> When you've done this, you'll also need to recreate your subscribers on
> Ellis, as the old ones will have the wrong home domain.
>
>
>
> As below, I'd strongly recommend deploying DNS - while we may be able to
> make a non-DNS deployment work, it's going to take a lot longer, and
> require you to understand a lot more about the solution and do a lot more
> troubleshooting.
>
>
>
> The remote_cluster_settings file is used for geographic redundant
> deployments.  See
> http://clearwater.readthedocs.org/en/latest/Geographic_redundancy/ for
> more details.  You won't need this because you're not running a geographic
> redundant deployment.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 25 January 2016 10:01
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> yes i've given bono node details ( registration is successful ) please
> find the latest logs attached after I tried a call request from zoiper
> client.
>
> Is it still not connecting to bono? what should be the contents of
> "remote_cluster_settings" file in sprout?
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
> On Mon, Jan 25, 2016 at 12:06 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> The bono_current.txt file you sent contains no record of an INVITE request
> (or a 408 response).  Please can you check that the INVITE is actually
> being sent to Bono and, if it is, gather a log from Bono from this period?
>
>
>
> Also, it may well be a configuration issue on Sprout, so please gather
> Sprout's logs at the same time.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 24 January 2016 11:52
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> The registrations were successful but when it try to make the call, i get
> a 408 request time out from zoiper client.
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> The Bono and Sprout traces seem to be from different times - the Bono
> traces are from 18:13 and the Sprout traces are from 18:52.  Do you have
> NTP configured?
>
>
>
> The Bono trace seems to show
>
> ?         a Zoiper softphone sending a REGISTER for
> sip:6505550008 at 10.222.5.159
>
> ?         Bono forwarding this on to Sprout
>
> ?         Sprout replying with a 401 authentication challenge
>
> ?         Bono forwarding this back to the Zoiper
>
> ?         a retry from the Zoiper, but no indication of it attempting to
> respond to the authentication challenge.
>
> (The Sprout trace doesn't show anything as it's from a different time.)
>
>
>
> When the Zoiper receives the 401 challenge, it should respond with a new
> REGISTER that responds to this challenge.  It's possible that the trace
> file you've shared is truncated before this happens, or maybe the Zoiper is
> not responding to the challenge for some reason.
>
>
>
> Please can you check your complete Bono logs?
>
> ?         If you see a REGISTER request containing an Authorization
> header, please can you share those logs and we can investigate if/why
> that's failing.
>
> ?         If you don't see any Authorization headers in your REGISTER
> requests, this sounds like a problem with your Zoiper configuration - it
> should be responding to the challenge.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 19:06
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Yes I understand your recommendation, but for now there is no dns server
> in my design.
>
> Will have a segregated setup for that.
>
>
>
> For now please find the bono and sproute logs attached to the mail.
>
>
>
> how do i make this work without the dns?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> If you're intending to implement DNS, I'd suggest doing it now rather than
> later - you're going down paths that are not well-trodden, and I'm sure
> we're going to hit lots of configuration issues.  It will be *much*
> quicker to deploy DNS now.
>
>
>
> My guess in this case is that, because the subscriber's "domain" parameter
> is an IP address, Bono is just routing the INVITE to that IP address (which
> is itself, so it fails).  Even when we deploy without DNS, we still
> configure the domain to be a real domain name (even though it won't resolve
> in DNS).
>
>
>
> If this doesn't resolve the problem, I'd suggest turning debug logging on
> in Bono and Sprout (as described at
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono
> and
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout)
> - this will give you more detailed diagnostics about what's going on in
> Bono and Sprout.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 13:16
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thanks for the recommendation, will implement DNS later on :) .
>
>
>
> And you were rite I had missed to remove a dns name for sprout, its now
> fixed i am able to open the UI and create numbers.
>
>
>
> But when trying to make a sip call via zoiper client application, the
> registration is not success full.
>
> The screen and log file is as below.
>
>
>
> [image: Inline image 2]
>
>
>
> Any idea?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Clearwater is very oriented around DNS.
>
> ?         DNS is used for load-balancing when you have more than 1 node
> in a cluster - in particular, following RFC 3263 for SIP.
>
> ?         DNS is used (following the rules in RFC 6733) for resolving
> Diameter realms to IP addresses.
>
>
>
> It is possible to get Clearwater running without a DNS server, but I would
> strongly recommend that you deploy a DNS server - in particular, if you
> event intend to scale up to a fault-tolerant or higher-capacity deployment,
> it is mandatory.
>
>
>
> The instructions for configuring DNS (and installing a DNS server if you
> don't already have one) are at
> http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html
> .
>
>
>
> Please let me know if you do definitely need to run without DNS, and we
> can look at how to set this up - but note the restrictions above on
> scalability and fault-tolerance.
>
>
>
> On the issues you're seeing below, I think the problem is that there is
> still configuration entries such as "sprout_hostname" below that contain
> both a hostname prefix and then an IP address - moving to DNS is one way to
> resolve all this.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 06:02
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> An update, ive changed the share_config file as follows and also I dont
> have a dns server in my environment( I assume its not mandatory).
>
> Also find the logs below.
>
>
>
> *shared_config *
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=10.222.5.173:8888
>
> hs_provisioning_hostname=10.222.5.173:8889
>
> ralf_hostname=10.222.5.163:10888
>
> xdms_hostname=0.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> *ellis error log*
>
> 22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK
>
>
>
> *homestead log:*
>
> 22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
>
>
>
>
> *homer log:*
>
> 2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
> UNIX socket /tmp/.homer-sock-0
>
>
>
> *sprout log:*
>
> 22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
> request rate/second unchanged - only handled 20 requests in last 142284ms,
> minimum threshold for a change is 35571.000000
>
> 22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
>
>
>
>
> bono and ralf log files are attached to the mail
>
>
>
>
>
>
>
> On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Matt,
>
>
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
>
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
>
> Program 'poll_bono'  Status failed
>
> Program 'poll_memento_https'        Status failed
>
>
>
> And Ellis UI still show the nginx welcome page.
>
>
>
> Please find the shared_config file below.
>
>
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=hs.10.222.5.173:8888
>
> hs_provisioning_hostname=hs.10.222.5.173:8889
>
> ralf_hostname=ralf.10.222.5.163:10888
>
> xdms_hostname=homer.10.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> Shiva
>
>
>
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/920c4789/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/920c4789/attachment.png>

From Matt.Williams at metaswitch.com  Thu Jan 28 07:14:33 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 28 Jan 2016 12:14:33 +0000
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CAJAf6NzuqFqyABitYffzTSqy+BPV0P=WBDbtEfs44Et4M7+zqw@mail.gmail.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
	<CY1PR0201MB156383DDAD803FBCEA57D64790C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NwnR1tUCrgh-q0zv__d6Pk0f8UD8MbB6xcopoN3bSVEhw@mail.gmail.com>
	<CY1PR0201MB1563BFDDD833EF2E99C12D6E90C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzuqFqyABitYffzTSqy+BPV0P=WBDbtEfs44Et4M7+zqw@mail.gmail.com>
Message-ID: <CY1PR0201MB1563A302E15F42A9E4BBD46390DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Shiva,

Thanks!  You need to

?         delete any subscribers you've created already (as they have the wrong home domain)

?         configure your DNS server to have the DNS records described in http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#dns-records - you may be able to adapt the example zone file at http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#configuring-zone to do this

?         make sure that your Clearwater VMs are configured to use the DNS server - if you haven't done this through DHCP, you can see http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#client-configuration for more details on how to do this

?         configure your Clearwater VMs with domain names rather than IP addresses - see http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#create-the-per-node-configuration for per-node configuration and http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provide-shared-configuration for information that is shared across the cluster

?         delete and recreate the list of available numbers in Ellis (as these have the wrong home domain)

o   to delete them, on the Ellis node, run 'echo "DELETE FROM ellis.numbers WHERE owner_id IS NULL ;" | sudo mysql'

o   to create them, follow http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provision-telephone-numbers-in-ellis again

?         create new subscribers.

Does that make sense?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com]
Sent: 28 January 2016 07:44
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] Homestead conf file missing.

HI Matt,

Ive installed a DNS server in my environment, what all changes do i need to do?

Thanks,
Shiva

On Mon, Jan 25, 2016 at 4:35 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Yes, in this trace, we do see the INVITE being sent to Bono.  In future, you can check this in the bono*.txt logs (as with debug logging enabled, all SIP messages are traced there), or with network capture.

The trace shows that the bono process is being restarted regularly.  I suspect this is because the monit process (which monitors and restarts processes if they fail) is automatically polling bono with SIP OPTIONS messages and these requests are failing.  We see these OPTIONS messages in the bono logs, along with the INVITE.  The reason the OPTIONS messages are failing is that Bono's local_ip matches home_domain (both in /etc/clearwater/local_config), so the bono process doesn't know whether to forward these requests on to Sprout (where they fail, as expected) or to reply to them itself.

This is a configuration error.  As I asked you below:
Even when we deploy without DNS, we still configure the home domain to be a real domain name (even though it won't resolve in DNS).
Please can you fix this configuration, and confirm that you've done so?  When you've done this, you'll also need to recreate your subscribers on Ellis, as the old ones will have the wrong home domain.

As below, I'd strongly recommend deploying DNS - while we may be able to make a non-DNS deployment work, it's going to take a lot longer, and require you to understand a lot more about the solution and do a lot more troubleshooting.

The remote_cluster_settings file is used for geographic redundant deployments.  See http://clearwater.readthedocs.org/en/latest/Geographic_redundancy/ for more details.  You won't need this because you're not running a geographic redundant deployment.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 25 January 2016 10:01

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

yes i've given bono node details ( registration is successful ) please find the latest logs attached after I tried a call request from zoiper client.
Is it still not connecting to bono? what should be the contents of "remote_cluster_settings" file in sprout?

Thanks,
Shiva


On Mon, Jan 25, 2016 at 12:06 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

The bono_current.txt file you sent contains no record of an INVITE request (or a 408 response).  Please can you check that the INVITE is actually being sent to Bono and, if it is, gather a log from Bono from this period?

Also, it may well be a configuration issue on Sprout, so please gather Sprout's logs at the same time.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 24 January 2016 11:52

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

The registrations were successful but when it try to make the call, i get a 408 request time out from zoiper client.

Thanks,
Shiva

On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

The Bono and Sprout traces seem to be from different times - the Bono traces are from 18:13 and the Sprout traces are from 18:52.  Do you have NTP configured?

The Bono trace seems to show

?         a Zoiper softphone sending a REGISTER for sip:6505550008 at 10.222.5.159<mailto:sip%3A6505550008 at 10.222.5.159>

?         Bono forwarding this on to Sprout

?         Sprout replying with a 401 authentication challenge

?         Bono forwarding this back to the Zoiper

?         a retry from the Zoiper, but no indication of it attempting to respond to the authentication challenge.
(The Sprout trace doesn't show anything as it's from a different time.)

When the Zoiper receives the 401 challenge, it should respond with a new REGISTER that responds to this challenge.  It's possible that the trace file you've shared is truncated before this happens, or maybe the Zoiper is not responding to the challenge for some reason.

Please can you check your complete Bono logs?

?         If you see a REGISTER request containing an Authorization header, please can you share those logs and we can investigate if/why that's failing.

?         If you don't see any Authorization headers in your REGISTER requests, this sounds like a problem with your Zoiper configuration - it should be responding to the challenge.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 19:06

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Yes I understand your recommendation, but for now there is no dns server in my design.
Will have a segregated setup for that.

For now please find the bono and sproute logs attached to the mail.

how do i make this work without the dns?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

If you're intending to implement DNS, I'd suggest doing it now rather than later - you're going down paths that are not well-trodden, and I'm sure we're going to hit lots of configuration issues.  It will be much quicker to deploy DNS now.

My guess in this case is that, because the subscriber's "domain" parameter is an IP address, Bono is just routing the INVITE to that IP address (which is itself, so it fails).  Even when we deploy without DNS, we still configure the domain to be a real domain name (even though it won't resolve in DNS).

If this doesn't resolve the problem, I'd suggest turning debug logging on in Bono and Sprout (as described at http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono and http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout) - this will give you more detailed diagnostics about what's going on in Bono and Sprout.

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 13:16

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thanks for the recommendation, will implement DNS later on :) .

And you were rite I had missed to remove a dns name for sprout, its now fixed i am able to open the UI and create numbers.

But when trying to make a sip call via zoiper client application, the registration is not success full.
The screen and log file is as below.

[Inline image 2]

Any idea?

Thanks,
Shiva

On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Clearwater is very oriented around DNS.

?         DNS is used for load-balancing when you have more than 1 node in a cluster - in particular, following RFC 3263 for SIP.

?         DNS is used (following the rules in RFC 6733) for resolving Diameter realms to IP addresses.

It is possible to get Clearwater running without a DNS server, but I would strongly recommend that you deploy a DNS server - in particular, if you event intend to scale up to a fault-tolerant or higher-capacity deployment, it is mandatory.

The instructions for configuring DNS (and installing a DNS server if you don't already have one) are at http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html.

Please let me know if you do definitely need to run without DNS, and we can look at how to set this up - but note the restrictions above on scalability and fault-tolerance.

On the issues you're seeing below, I think the problem is that there is still configuration entries such as "sprout_hostname" below that contain both a hostname prefix and then an IP address - moving to DNS is one way to resolve all this.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 22 January 2016 06:02

To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

An update, ive changed the share_config file as follows and also I dont have a dns server in my environment( I assume its not mandatory).
Also find the logs below.

shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=10.222.5.173:8888<http://10.222.5.173:8888>
hs_provisioning_hostname=10.222.5.173:8889<http://10.222.5.173:8889>
ralf_hostname=10.222.5.163:10888<http://10.222.5.163:10888>
xdms_hostname=0.222.5.179:7888<http://0.222.5.179:7888>

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

ellis error log
22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password in the clear over http
22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK

homestead log:
22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):


homer log:
2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on UNIX socket /tmp/.homer-sock-0

sprout log:
22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming request rate/second unchanged - only handled 20 requests in last 142284ms, minimum threshold for a change is 35571.000000
22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to retrieve record for hs.10.222.5.173: Could not contact DNS servers
22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS
22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get subscriber data from HSS


bono and ralf log files are attached to the mail



On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>> wrote:
Hi Matt,

Seems the shared config file wasn't applied properly to the home stead node, i copied the config file to /etc/clearwater/ and ran
"sudo service clearwater-infrastructure restart"  now almost all the services are running on all nodes are running, except for
Program 'poll_bono'  Status failed
Program 'poll_memento_https'        Status failed

And Ellis UI still show the nginx welcome page.

Please find the shared_config file below.

[homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
# Deployment definitions
home_domain=10.222.5.159
sprout_hostname=sprout.10.222.5.172
hs_hostname=hs.10.222.5.173:8888
hs_provisioning_hostname=hs.10.222.5.173:8889
ralf_hostname=ralf.10.222.5.163:10888
xdms_hostname=homer.10.222.5.179:7888

# Email server configuration
smtp_smarthost=example.com<http://example.com>
smtp_username=username
smtp_password=password
email_recovery_sender=clearwater at example.org<mailto:clearwater at example.org>

# Keys
signup_key=secret
turn_workaround=secret
ellis_api_key=secret
ellis_cookie_key=secret

Shiva


On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

Thanks for this.  I notice that the URL that Ellis is trying to ping is "http://hs.10.222.5.173:8889/ping".  Please can you check/share your /etc/clearwater/shared_config file?

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Shiva Charan [mailto:shivacharanms at gmail.com<mailto:shivacharanms at gmail.com>]
Sent: 21 January 2016 17:44
To: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Cc: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: Re: [Clearwater] Homestead conf file missing.

Hi Matt,

Thank you for the reply.

About homestead, yes I tried running "sudo service clearwater-infrastructure restart" did not return any error

[homestead]ubuntu at homestead:/var/log/homestead$ sudo service clearwater-infrastructure restart
 * Restarting clearwater-infrastructure clearwater-infrastructure
Configuring monit for only localhost access
 [ OK ]
[homestead]ubuntu at homestead:/var/log/homestead$

On Ellis node the process seems to run, but its not stable process restarts after a while.

[ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
The Monit daemon 5.8.1 uptime: 9h 50m

Process 'ntp_process'               Running
System 'node-ellis'                 Running
Process 'nginx_process'             Running
Process 'mysql_process'             Running
Process 'ellis_process'             Running
Program 'poll_ellis'                Status ok
Program 'poll_ellis_https'          Status ok
Process 'clearwater_queue_manager'  Running
Process 'etcd_process'              Running
Program 'poll_etcd_cluster'         Waiting
Program 'poll_etcd'                 Status ok
Process 'clearwater_diags_monitor_process' Running
Process 'clearwater_config_manager' Running
Process 'clearwater_cluster_manager' Running

And the ellis error log file says it failed to ping homestead.
"UTC ERROR homestead.py:68: Failed to ping Homestead at http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
netstat on homestead shows no processon 8889 port.


Shiva





On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>> wrote:
Shiva,

It's good to hear from you.

/var/lib/homestead/homestead.conf should be built by the clearwater-infrastructure script that is run on package installation and boot.  You can rerun it by typing "sudo service clearwater-infrastructure restart".  Do you get any errors out when you do so?

You mention that ellis is displaying the nginx page.  Is the ellis process running?  Run "sudo monit summary" on the ellis node to find out.  If it isn't running, please check /var/log/ellis/ for details and, if that doesn't help, let me know what you see.

Incidentally, please can you subscribe to the clearwater mailing list, so that your posts are automatically approved and you can see other people's questions and comments - see http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org for details.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177<tel:%2B44%20%280%29%2020%208366%201177>

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org<mailto:clearwater-bounces at lists.projectclearwater.org>] On Behalf Of Shiva Charan
Sent: 21 January 2016 12:38
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] Homestead conf file missing.

Hi,

I have a new clearwater manual install setup, homestead process has a "Execution failed" status.

Also when i open the ellis UI with the ellis IP it goes to nginx page, how do i get the clearwater UI?

/etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf file is missing. How do I get this file?

21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laNames ::= { laEntry 2 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing LoadMonitor
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency (usecs)   : 100000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket size          : 20
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token fill rate/s: 100.000000
21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill rate/s    : 10.000000
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating Cached Resolver using servers:
21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP resolver
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring store connection
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:  localhost
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:      9160
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring store worker pool
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring HTTP Connection
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection created for server :9888
21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection will use a response timeout of 500ms
21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing Diameter stack
21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring Diameter stack from file /var/lib/homestead/homestead.conf
21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open configuration file for reading; tried the following locations: /var/lib/homestead/homestead.conf; Error: No such file or directory
21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in '((fd_conf_parse()))' :       No such file or directory
21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize Diameter stack - function fd_core_parseconf, rc 2
21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for store to stop

Thanks,
Shiva









-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/f752294c/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: image001.png
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/f752294c/attachment.png>

From le.l.wang at ericsson.com  Thu Jan 28 11:12:23 2016
From: le.l.wang at ericsson.com (Le Wang L)
Date: Thu, 28 Jan 2016 16:12:23 +0000
Subject: [Clearwater]  [Homestead]No cached av found in impi
Message-ID: <D2D009E0.13238%le.l.wang@ericsson.com>

 
 

Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that
> 
> 28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to
> the agentx master agent ([NIL]):
> 28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL
> /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request:
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com,
> scheme Unknown, authorization
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for
> authentication vector for 6505550009 at example.com/sip:6505550009 at example.com
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting
> thread-local Client
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local
> Client - creating one
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication
> vector for 6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID
> sip:6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
> 28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for
> get_columns. Try ONE
> 28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking
> communication changes - successful attempts 2, failures 0
> 28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request
> failed: rc=2, Row 6505550009 at example.com not present in
>  column_family impi
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed -
> reject request
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com -
> reject
> 28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to
> request for URL /impi/6505550009%40example.com/av, args
> impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com**
entry but only ** 6505550674 at cw-ngv.com** entry there. This basically causes
the authentication failed and returns me 403 Forbidden when my SIP client
tries to register. 

`cqlsh:homestead_cache> select * from impi;

private_id             | digest_ha1                       | digest_qop |
digest_realm | known_preferred
------------------------+----------------------------------+------------+---
-----------+-----------------
 6505550674 at cw-ngv.com | 94f3913dcd98b380d3eed0e684a6b070 |       auth |
cw-ngv.com |            True

Could someone help to point out where I did wrong or there is an issue? Is
there any solution/work-around, e.g adding entries into database manually?
Which table I need to update besides impi?

Thanks.
BR,
Le

 
 
 
 
 
 
 
 
 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/6133064f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5102 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/6133064f/attachment.p7s>

From Matt.Williams at metaswitch.com  Thu Jan 28 11:49:23 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 28 Jan 2016 16:49:23 +0000
Subject: [Clearwater] [Homestead]No cached av found in impi
In-Reply-To: <D2D009E0.13238%le.l.wang@ericsson.com>
References: <D2D009E0.13238%le.l.wang@ericsson.com>
Message-ID: <CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Le,

Thanks for your email.

What do you have home_domain set to in /etc/clearwater/shared_config?  This determines the domain name of the SIP URIs (IMPUs) and authentication usernames (IMPIs) that we'd expect to see.

(If you installed from an all-in-one image, this defaults to example.com.  If you created your own deployment, you'd have set it during install.)

Please let me know.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Le Wang L
Sent: 28 January 2016 16:12
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Homestead]No cached av found in impi


Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that

28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request: private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>, scheme Unknown, authorization
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>/sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting thread-local Client
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local Client - creating one
28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for get_columns. Try ONE
28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking communication changes - successful attempts 2, failures 0
28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request failed: rc=2, Row 6505550009 at example.com<mailto:6505550009 at example.com> not present in
column_family impi
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed - reject request
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com> - reject
28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com<mailto:6505550674 at example.com>** entry but only ** 6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com>** entry there. This basically causes the authentication failed and returns me 403 Forbidden when my SIP client tries to register.

`cqlsh:homestead_cache> select * from impi;

private_id | digest_ha1 | digest_qop | digest_realm | known_preferred
------------------------+----------------------------------+------------+--------------+-----------------
6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com> | 94f3913dcd98b380d3eed0e684a6b070 | auth | cw-ngv.com | True

Could someone help to point out where I did wrong or there is an issue? Is there any solution/work-around, e.g adding entries into database manually? Which table I need to update besides impi?

Thanks.
BR,
Le
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/04ed317b/attachment.html>

From le.l.wang at ericsson.com  Thu Jan 28 12:48:25 2016
From: le.l.wang at ericsson.com (Le Wang L)
Date: Thu, 28 Jan 2016 17:48:25 +0000
Subject: [Clearwater] [Homestead]No cached av found in impi
In-Reply-To: <CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <D2D009E0.13238%le.l.wang@ericsson.com>
	<CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <D2D01F50.13258%le.l.wang@ericsson.com>

Hi Matt,

I have Clearwater installed on different nodes, not All-In-One.

The home_domain name is set to ?example.com? in
/etc/clearwater/share_config.
?
# Deployment definitions
home_domain=example.com

sprout_hostname=sprout.example.com

hs_hostname=hs.example.com:8888

hs_provisioning_hostname=hs.example.com:8889

ralf_hostname=ralf.example.com:10888

xdms_hostname=homer.example.com:7888

                   

# Email server configuration

smtp_smarthost=localhost

smtp_username=username

smtp_password=password

email_recovery_sender=clearwater at example.org

                   

# Keys

signup_key=secret

turn_workaround=secret

ellis_api_key=secret

ellis_cookie_key=secret
?

I also run  the ?sudo service clearwater-infrastructure restart? then ?sudo
service ellis stop? commands. However, Ellis is still using ?cw-ngv.com? as
the default value for the domain.

But, somehow, Ellis still sends cw-ngv.com to Homestead, as you can see in
this log. And Ellis GUI generates Private Identity like
?6505550717 at cw-ngv.com? not ?6505550717 at example.com?. It feels the setting
does not apply to Ellis for some reasons.

28-01-2016 17:13:47.230 UTC INFO base.py:269: Sending 200 response to
localhost for PUT 
http://http_homestead_prov/irs/b736051d-b518-4f5b-8875-28aa6037d2a0/service_
profiles/3a82d92e-3fab-44de-ab32-14a29896b22b/public_ids/sip%3A6505550111%40
cw-ngv.com



BR,
Le

From:  Matt Williams <Matt.Williams at metaswitch.com>
Date:  Thursday 28 January 2016 at 18:49
To:  Le Wang <le.l.wang at ericsson.com>
Cc:  "clearwater at lists.projectclearwater.org"
<clearwater at lists.projectclearwater.org>
Subject:  RE: [Clearwater]  [Homestead]No cached av found in impi

Le,
 
Thanks for your email.
 
What do you have home_domain set to in /etc/clearwater/shared_config?  This
determines the domain name of the SIP URIs (IMPUs) and authentication
usernames (IMPIs) that we'd expect to see.
 
(If you installed from an all-in-one image, this defaults to example.com.
If you created your own deployment, you'd have set it during install.)
 
Please let me know.

Thanks,
 
Matt
 

--
 
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177
 

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On
Behalf Of Le Wang L
Sent: 28 January 2016 16:12
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Homestead]No cached av found in impi
 

Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that
> 
> 28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to
> the agentx master agent ([NIL]):
> 28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL
> /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request:
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com,
> scheme Unknown, authorization
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for
> authentication vector for 6505550009 at example.com/sip:6505550009 at example.com
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting
> thread-local Client
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local
> Client - creating one
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication
> vector for 6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID
> sip:6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
> 28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for
> get_columns. Try ONE
> 28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking
> communication changes - successful attempts 2, failures 0
> 28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request
> failed: rc=2, Row 6505550009 at example.com not present in
> column_family impi
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed -
> reject request
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com -
> reject
> 28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to
> request for URL /impi/6505550009%40example.com/av, args
> impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com**
entry but only ** 6505550674 at cw-ngv.com** entry there. This basically causes
the authentication failed and returns me 403 Forbidden when my SIP client
tries to register. 

`cqlsh:homestead_cache> select * from impi;

private_id | digest_ha1 | digest_qop | digest_realm | known_preferred
------------------------+----------------------------------+------------+---
-----------+-----------------
6505550674 at cw-ngv.com | 94f3913dcd98b380d3eed0e684a6b070 | auth | cw-ngv.com
| True

Could someone help to point out where I did wrong or there is an issue? Is
there any solution/work-around, e.g adding entries into database manually?
Which table I need to update besides impi?

Thanks.
BR,
Le


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/29bc0b44/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5102 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/29bc0b44/attachment.p7s>

From Matt.Williams at metaswitch.com  Thu Jan 28 12:57:41 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 28 Jan 2016 17:57:41 +0000
Subject: [Clearwater] [Homestead]No cached av found in impi
In-Reply-To: <D2D01F50.13258%le.l.wang@ericsson.com>
References: <D2D009E0.13238%le.l.wang@ericsson.com>
	<CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<D2D01F50.13258%le.l.wang@ericsson.com>
Message-ID: <CY1PR0201MB15632C59C679382BAB51A32890DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Le,

Is there a chance you'd previously configured Clearwater with a home_domain of cw-ngv.com?

As part of installing Ellis, you create a pool of SIP URIs for it to allocate.  These SIP URIs include the home_domain that was configured at the time.  To change this,

*         using the Ellis UI, delete any subscribers you've already created

*         on the Ellis command line, run 'echo "DELETE FROM ellis.numbers WHERE owner_id IS NULL ;" | sudo mysql' to delete all numbers from the pool

*         follow http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provision-telephone-numbers-in-ellis to provision a new pool.
You can run 'echo "SELECT number FROM ellis.numbers ; " | sudo mysql' on the Ellis command line to list all the SIP URIs in the pool, and check that they are in the correct home domain.

I hope that helps - please let me know.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Le Wang L [mailto:le.l.wang at ericsson.com]
Sent: 28 January 2016 17:48
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Homestead]No cached av found in impi

Hi Matt,

I have Clearwater installed on different nodes, not All-In-One.

The home_domain name is set to "example.com" in /etc/clearwater/share_config.
"
# Deployment definitions

home_domain=example.com

sprout_hostname=sprout.example.com

hs_hostname=hs.example.com:8888

hs_provisioning_hostname=hs.example.com:8889

ralf_hostname=ralf.example.com:10888

xdms_hostname=homer.example.com:7888



# Email server configuration

smtp_smarthost=localhost

smtp_username=username

smtp_password=password

email_recovery_sender=clearwater at example.org<mailto:email_recovery_sender=clearwater at example.org>



# Keys

signup_key=secret

turn_workaround=secret

ellis_api_key=secret
ellis_cookie_key=secret
"

I also run  the 'sudo service clearwater-infrastructure restart' then 'sudo service ellis stop' commands. However, Ellis is still using 'cw-ngv.com' as the default value for the domain.

But, somehow, Ellis still sends cw-ngv.com to Homestead, as you can see in this log. And Ellis GUI generates Private Identity like "6505550717 at cw-ngv.com<mailto:6505550717 at cw-ngv.com>" not "6505550717 at example.com<mailto:6505550717 at example.com>". It feels the setting does not apply to Ellis for some reasons.


28-01-2016 17:13:47.230 UTC INFO base.py:269: Sending 200 response to localhost for PUT http://http_homestead_prov/irs/b736051d-b518-4f5b-8875-28aa6037d2a0/service_profiles/3a82d92e-3fab-44de-ab32-14a29896b22b/public_ids/sip%3A6505550111%40cw-ngv.com


BR,
Le

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Date: Thursday 28 January 2016 at 18:49
To: Le Wang <le.l.wang at ericsson.com<mailto:le.l.wang at ericsson.com>>
Cc: "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Clearwater] [Homestead]No cached av found in impi

Le,

Thanks for your email.

What do you have home_domain set to in /etc/clearwater/shared_config?  This determines the domain name of the SIP URIs (IMPUs) and authentication usernames (IMPIs) that we'd expect to see.

(If you installed from an all-in-one image, this defaults to example.com.  If you created your own deployment, you'd have set it during install.)

Please let me know.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Le Wang L
Sent: 28 January 2016 16:12
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] [Homestead]No cached av found in impi


Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that

28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request: private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>, scheme Unknown, authorization
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>/sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting thread-local Client
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local Client - creating one
28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for get_columns. Try ONE
28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking communication changes - successful attempts 2, failures 0
28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request failed: rc=2, Row 6505550009 at example.com<mailto:6505550009 at example.com> not present in
column_family impi
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed - reject request
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com> - reject
28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com<mailto:6505550674 at example.com>** entry but only ** 6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com>** entry there. This basically causes the authentication failed and returns me 403 Forbidden when my SIP client tries to register.

`cqlsh:homestead_cache> select * from impi;

private_id | digest_ha1 | digest_qop | digest_realm | known_preferred
------------------------+----------------------------------+------------+--------------+-----------------
6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com> | 94f3913dcd98b380d3eed0e684a6b070 | auth | cw-ngv.com | True

Could someone help to point out where I did wrong or there is an issue? Is there any solution/work-around, e.g adding entries into database manually? Which table I need to update besides impi?

Thanks.
BR,
Le
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/6ad2161c/attachment.html>

From Matt.Williams at metaswitch.com  Thu Jan 28 15:01:38 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Thu, 28 Jan 2016 20:01:38 +0000
Subject: [Clearwater] [Homestead]No cached av found in impi
References: <D2D009E0.13238%le.l.wang@ericsson.com>
	<CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<D2D01F50.13258%le.l.wang@ericsson.com> 
Message-ID: <CY1PR0201MB156360270C0DB5A8D48AE45590DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Le,

A colleague has just pointed out that you might have hit this scenario without ever having configured cw-ngv.com - https://github.com/Metaswitch/ellis/issues/155 covers a bug where you could create numbers before the correct configuration has been applied.

Either way, following the process below should resolve the problem - please let me know how you get on!

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Matt Williams
Sent: 28 January 2016 17:56
To: 'Le Wang L' <le.l.wang at ericsson.com>
Cc: clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] [Homestead]No cached av found in impi

Le,

Is there a chance you'd previously configured Clearwater with a home_domain of cw-ngv.com?

As part of installing Ellis, you create a pool of SIP URIs for it to allocate.  These SIP URIs include the home_domain that was configured at the time.  To change this,

*         using the Ellis UI, delete any subscribers you've already created

*         on the Ellis command line, run 'echo "DELETE FROM ellis.numbers WHERE owner_id IS NULL ;" | sudo mysql' to delete all numbers from the pool

*         follow http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provision-telephone-numbers-in-ellis to provision a new pool.
You can run 'echo "SELECT number FROM ellis.numbers ; " | sudo mysql' on the Ellis command line to list all the SIP URIs in the pool, and check that they are in the correct home domain.

I hope that helps - please let me know.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Le Wang L [mailto:le.l.wang at ericsson.com]
Sent: 28 January 2016 17:48
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Homestead]No cached av found in impi

Hi Matt,

I have Clearwater installed on different nodes, not All-In-One.

The home_domain name is set to "example.com" in /etc/clearwater/share_config.
"
# Deployment definitions

home_domain=example.com

sprout_hostname=sprout.example.com

hs_hostname=hs.example.com:8888

hs_provisioning_hostname=hs.example.com:8889

ralf_hostname=ralf.example.com:10888

xdms_hostname=homer.example.com:7888



# Email server configuration

smtp_smarthost=localhost

smtp_username=username

smtp_password=password

email_recovery_sender=clearwater at example.org<mailto:email_recovery_sender=clearwater at example.org>



# Keys

signup_key=secret

turn_workaround=secret

ellis_api_key=secret
ellis_cookie_key=secret
"

I also run  the 'sudo service clearwater-infrastructure restart' then 'sudo service ellis stop' commands. However, Ellis is still using 'cw-ngv.com' as the default value for the domain.

But, somehow, Ellis still sends cw-ngv.com to Homestead, as you can see in this log. And Ellis GUI generates Private Identity like "6505550717 at cw-ngv.com<mailto:6505550717 at cw-ngv.com>" not "6505550717 at example.com<mailto:6505550717 at example.com>". It feels the setting does not apply to Ellis for some reasons.


28-01-2016 17:13:47.230 UTC INFO base.py:269: Sending 200 response to localhost for PUT http://http_homestead_prov/irs/b736051d-b518-4f5b-8875-28aa6037d2a0/service_profiles/3a82d92e-3fab-44de-ab32-14a29896b22b/public_ids/sip%3A6505550111%40cw-ngv.com


BR,
Le

From: Matt Williams <Matt.Williams at metaswitch.com<mailto:Matt.Williams at metaswitch.com>>
Date: Thursday 28 January 2016 at 18:49
To: Le Wang <le.l.wang at ericsson.com<mailto:le.l.wang at ericsson.com>>
Cc: "clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>" <clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>>
Subject: RE: [Clearwater] [Homestead]No cached av found in impi

Le,

Thanks for your email.

What do you have home_domain set to in /etc/clearwater/shared_config?  This determines the domain name of the SIP URIs (IMPUs) and authentication usernames (IMPIs) that we'd expect to see.

(If you installed from an all-in-one image, this defaults to example.com.  If you created your own deployment, you'd have set it during install.)

Please let me know.

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Le Wang L
Sent: 28 January 2016 16:12
To: clearwater at lists.projectclearwater.org<mailto:clearwater at lists.projectclearwater.org>
Subject: [Clearwater] [Homestead]No cached av found in impi


Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that

28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):
28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request: private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>, scheme Unknown, authorization
28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>/sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting thread-local Client
28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local Client - creating one
28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication vector for 6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID sip:6505550009 at example.com<mailto:6505550009 at example.com>
28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for get_columns. Try ONE
28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking communication changes - successful attempts 2, failures 0
28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request failed: rc=2, Row 6505550009 at example.com<mailto:6505550009 at example.com> not present in
column_family impi
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed - reject request
28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for private ID 6505550009 at example.com<mailto:6505550009 at example.com>, public ID sip:6505550009 at example.com<mailto:6505550009 at example.com> - reject
28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to request for URL /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com<mailto:6505550674 at example.com>** entry but only ** 6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com>** entry there. This basically causes the authentication failed and returns me 403 Forbidden when my SIP client tries to register.

`cqlsh:homestead_cache> select * from impi;

private_id | digest_ha1 | digest_qop | digest_realm | known_preferred
------------------------+----------------------------------+------------+--------------+-----------------
6505550674 at cw-ngv.com<mailto:6505550674 at cw-ngv.com> | 94f3913dcd98b380d3eed0e684a6b070 | auth | cw-ngv.com | True

Could someone help to point out where I did wrong or there is an issue? Is there any solution/work-around, e.g adding entries into database manually? Which table I need to update besides impi?

Thanks.
BR,
Le
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160128/71d3560c/attachment.html>

From khigh at tropo.com  Thu Jan 28 15:02:06 2016
From: khigh at tropo.com (Kevin Heath High)
Date: Thu, 28 Jan 2016 12:02:06 -0800
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write
In-Reply-To: <71ED8D8361F0EF45BB6B949BFDCD46710107D37A6D@ENFICSMBX1.datcon.co.uk>
References: <CAN2RUgodSqC8phJrqYEbF8x+d6VCVBLt+13cCqHTC9+Cy-6MHg@mail.gmail.com>
	<71ED8D8361F0EF45BB6B949BFDCD46710107D37A6D@ENFICSMBX1.datcon.co.uk>
Message-ID: <007301d15a06$c3fce710$4bf6b530$@tropo.com>

I have run into this issue recently in two different installed (one I did,
one somebody else did).  I both situations these were single sprout manual
installs and both were resolved by modifying the cluster_settings file to
point back to sprout.  According to the cluster_settings file it is getting
created by clearwater_etcd.  Would be curious how this file is getting
generated and if there is something I am doing wrong in the installation
that is generating this issue.

Thanks
Kevin

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Eleanor
Merry
Sent: Tuesday, January 27, 2015 10:30 AM
To: Sushant Hiray <hiraysushant at gmail.com>;
clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hi Sushant, 

Do you see this error on every register attempt, or is it intermittent? How
many Sprouts do you have in your deployment?

Also, can you check that the /etc/clearwater/cluster_settings file on each
Sprout has the correct values - this should be a single line of the form
'memcached_servers=<sprout 1 IP address>:11211,<sprout 2 IP
address>:11211,...', and the order of the IP addresses must be identical on
each node. 

Ellie

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Sushant
Hiray
Sent: 27 January 2015 09:35
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hello,

We recently shifted our clearwater infrastructure to Open Stack.

We are facing an issue with the registration of a user.
The following is the log at Sprout with log_level=5

I've highlighted the relevant error zones:

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>
Call-ID: 1374014318
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060
;line=9002fc03804a36b>;+sip.instance="<urn:uuid:43be9c7e-a58e-11e4-955c-6ddd
4f8d4915>"
Authorization: Digest username="user10 at ims.hom", realm="ims.hom", nonce="
", uri="sip:ims.hom", response=" ",integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
Supported: path, gruu
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.589 UTC Debug stack.cpp:470: Queuing cloned received
message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.589 UTC Debug stack.cpp:206: Worker thread dequeue
message 0x7f8734097078
26-01-2015 19:05:38.589 UTC Debug pjsip: sip_endpoint.c Distributing rdata
to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:486: Authorization
header in request
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\  hashes to vbucket 41 via hash 0xbdd4da29
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:373: 1 read replicas
for key av\\user10 at ims.hom\



*26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:406: Attempt to read
from replica 0 (connection 0x7f870c056860)26-01-2015 19:05:38.589 UTC Debug
memcachedstore.cpp:449: Read for av\\user10 at ims.hom\  on replica 0 returned
error 47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015
19:05:38.589 UTC Error memcachedstore.cpp:519: Failed to read data for
av\\user10 at ims.hom\  from 1 replicas*26-01-2015 19:05:38.589 UTC Debug
authentication.cpp:539: Verify authentication information in request
26-01-2015 19:05:38.589 UTC Warning authentication.cpp:204: Received an
authentication request for user10 at ims.hom with nonce  , but no matching AV
found
26-01-2015 19:05:38.589 UTC Debug acr.cpp:48: Created ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:644: No authentication
information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.589 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f870c1b6510) created
26-01-2015 19:05:38.589 UTC Debug pjutils.cpp:461: Private identity from
authorization header = user10 at ims.hom
26-01-2015 19:05:38.589 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse
hs.ims.hom as IP address
26-01-2015 19:05:38.589 UTC Debug dnscachedresolver.cpp:179: Pulling 1
records from cache for hs.ims.hom A
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA
records, randomizing
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888
transport 6 is not blacklisted
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:370: Added a server, now
have 1 of 5
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:408: Adding 0 servers
from blacklist
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.589 UTC Debug httpconnection.cpp:553: Sending HTTP
request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.591 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:309: Valid AV -
generate challenge
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:315: Create
WWW-Authenticate header
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:359: Add Digest
information
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.591 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom
\2ebbd3a10aba9cfa
{"branch":"z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:540: Writing 138 bytes
to table av key user10 at ims.hom\2ebbd3a10aba9cfa, CAS = 0, expiry = 40
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:560: 1 write replicas
for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:609: Attempt
conditional write to replica 0 (connection 0x7f870c056860), CAS = 0




*26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:652: memcached_add
command for av\\user10 at ims.hom\2ebbd3a10aba9cfa failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140217998993504) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.591 UTC Error
memcachedstore.cpp:713: Failed to write data for
av\\user10 at ims.hom\2ebbd3a10aba9cfa to 1 replicas26-01-2015 19:05:38.591 UTC
Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom*26-01-2015 19:05:38.591 UTC Verbose
stack.cpp:259: TX 545 bytes Response msg 401/REGISTER/cseq=1
(tdta0x7f870c1b6510) to TCP 192.168.1.41:54658:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport=54658;received=192.168.1.41;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZ
Zo-H3kw
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
Call-ID: 1374014318
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>;tag=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
CSeq: 1 REGISTER
WWW-Authenticate: Digest
realm="ims.hom",nonce="2ebbd3a10aba9cfa",opaque="1fafe52f54443250",stale=tru
e,algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
26-01-2015 19:05:38.591 UTC Debug pjsip: tdta0x7f870c1b Destroying txdata
Response msg 401/REGISTER/cseq=1 (tdta0x7f870c1b6510)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:82: Sending Null ACR
(0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:53: Destroyed ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug stack.cpp:208: Worker thread completed
processing message 0x7f8734097078
26-01-2015 19:05:38.591 UTC Debug stack.cpp:214: Request latency = 1927us
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Processing incoming
message: Request msg REGISTER/cseq=1 (rdata0x7f873400d328)
26-01-2015 19:05:38.593 UTC Verbose stack.cpp:243: RX 848 bytes Request msg
REGISTER/cseq=1 (rdata0x7f873400d328) from TCP 192.168.1.41:42193:
--start msg--

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:42193
;rport;branch=z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK1731639894
From: <sip:user10 at ims.hom>;tag=1334365898
To: <sip:user10 at ims.hom>
Call-ID: 1090655798
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060;line=9002fc03804a36b>
Authorization: Digest username="user10 at ims.hom", realm="ims.hom",
nonce="2ebbd3a10aba9cfa", uri="sip:ims.hom",
response="6da3503d6706fab2f9250a96ef9136b8",
algorithm=MD5,integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.593 UTC Debug stack.cpp:470: Queuing cloned received
message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.593 UTC Debug stack.cpp:206: Worker thread dequeue
message 0x7f8734097078
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Distributing rdata
to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:486: Authorization
header in request
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:373: 1 read replicas
for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:406: Attempt to read
from replica 0 (connection 0x7f87800cea30)


*26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:449: Read for
av\\user10 at ims.hom\2ebbd3a10aba9cfa on replica 0 returned error 47 (SERVER
HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015 19:05:38.593 UTC
Error memcachedstore.cpp:519: Failed to read data for
av\\user10 at ims.hom\2ebbd3a10aba9cfa from 1 replicas*26-01-2015 19:05:38.593
UTC Debug authentication.cpp:539: Verify authentication information in
request
26-01-2015 19:05:38.593 UTC Warning authentication.cpp:204: Received an
authentication request for user10 at ims.hom with nonce 2ebbd3a10aba9cfa, but
no matching AV found
26-01-2015 19:05:38.593 UTC Debug acr.cpp:48: Created ACR (0x7f878014fea0)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:644: No authentication
information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.593 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f87801a2070) created
26-01-2015 19:05:38.593 UTC Debug pjutils.cpp:461: Private identity from
authorization header = user10 at ims.hom
26-01-2015 19:05:38.593 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse
hs.ims.hom as IP address
26-01-2015 19:05:38.593 UTC Debug dnscachedresolver.cpp:179: Pulling 1
records from cache for hs.ims.hom A
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA
records, randomizing
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888
transport 6 is not blacklisted
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:370: Added a server, now
have 1 of 5
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:408: Adding 0 servers
from blacklist
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.593 UTC Debug httpconnection.cpp:553: Sending HTTP
request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.594 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:309: Valid AV -
generate challenge
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:315: Create
WWW-Authenticate header
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:359: Add Digest
information
26-01-2015 19:05:38.595 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.595 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom
\256f5de87094a4d0
{"branch":"z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:540: Writing 138 bytes
to table av key user10 at ims.hom\256f5de87094a4d0, CAS = 0, expiry = 40
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\256f5de87094a4d0 hashes to vbucket 127 via hash
0x8c22357f
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:560: 1 write replicas
for key av\\user10 at ims.hom\256f5de87094a4d0
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:609: Attempt
conditional write to replica 0 (connection 0x7f87800cea30), CAS = 0





*26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:652: memcached_add
command for av\\user10 at ims.hom\256f5de87094a4d0 failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140219945642544) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.595 UTC Error
memcachedstore.cpp:713: Failed to write data for
av\\user10 at ims.hom\256f5de87094a4d0 to 1 replicas26-01-2015 19:05:38.595 UTC
Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom26-01-2015 19:05:38.595 UTC Verbose stack.cpp:259:
TX 546 bytes Response msg 401/REGISTER/cseq=1 (tdta0x7f87801a2070) to TCP
192.168.1.41:42193 <http://192.168.1.41:42193>:*

The Memcached server is unable to read/write the data and hence we are
facing the problem.
Can you please suggest some steps so that we can curb this issue.

Thanks,
Sushant Hiray,
Senior Undergrad CSE,
IIT Bombay
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater




From peter.skrzynski at nec.co.nz  Thu Jan 28 21:02:22 2016
From: peter.skrzynski at nec.co.nz (Peter Skrzynski)
Date: Fri, 29 Jan 2016 02:02:22 +0000
Subject: [Clearwater] Clarification of SNMP statistics
Message-ID: <663823bd3b394bb6ab98ab04c2659fb9@ex15w.necnz.internal>

Hi,
I wanted to clarify the requirements for obtaining SNMP statistics from IMS nodes.
I am running a manual install of bono/sprout/homestead/ibcf/dns with release 89 ?Vicomte de Bragelonne?.
As per the instructions in ?http://clearwater.readthedocs.org/en/latest/Clearwater_SNMP_Statistics/index.html?, I have run ?sudo apt-get install clearwater-snmp-handler-astaire? on the Sprout node only.

Specifically, the instructions state ?These SNMP statistics require: the clearwater-snmp-handler-astaire packages to be installed for Sprout and Ralf nodes?.

But what about the other IMS nodes?

Is there no other action required to activate snmp statistics for bono and homestead nodes?

Surely they require a snmp daemon to be running?

There is no snmpd entry in ?ps ?ef?, and no /etc/snmp directory, on my bono or homestead nodes, but there is on the sprout node.

Also, the log files for bono and homestead show continuous entries of?

UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):

Does that mean that snmp is not set up correctly in those nodes?

Is the documentation incorrect when it says to install the packages only on the sprout node?

Or, in my case, do I need to do ?sudo apt-get install snmpd? on my bono and homestead nodes?

Should the documentation state that?

Any guidance would be most appreciated.

Regards,

Peter.





Peter Skrzynski

Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:imagee7da7e.JPG at 8690cb26.438f3040]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/96625c36/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: imagee7da7e.JPG
Type: image/jpeg
Size: 59501 bytes
Desc: imagee7da7e.JPG
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/96625c36/attachment.jpe>

From le.l.wang at ericsson.com  Fri Jan 29 04:57:23 2016
From: le.l.wang at ericsson.com (Le Wang L)
Date: Fri, 29 Jan 2016 09:57:23 +0000
Subject: [Clearwater] [Homestead]No cached av found in impi
In-Reply-To: <CY1PR0201MB156360270C0DB5A8D48AE45590DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <D2D009E0.13238%le.l.wang@ericsson.com>
	<CY1PR0201MB15633E9482F687ED832F425690DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<D2D01F50.13258%le.l.wang@ericsson.com>
	<CY1PR0201MB156360270C0DB5A8D48AE45590DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <D2D0FC7E.132CD%le.l.wang@ericsson.com>

Hi Matt,

The solution to re-provision a pool works and I get correct domain name in
SIP URIs. Thanks a lot.

BR,
Le

From:  Matt Williams <Matt.Williams at metaswitch.com>
Date:  Thursday 28 January 2016 at 22:01
To:  Le Wang <le.l.wang at ericsson.com>
Cc:  "clearwater at lists.projectclearwater.org"
<clearwater at lists.projectclearwater.org>
Subject:  RE: [Clearwater]  [Homestead]No cached av found in impi

Le,
 
A colleague has just pointed out that you might have hit this scenario
without ever having configured cw-ngv.com -
https://github.com/Metaswitch/ellis/issues/155 covers a bug where you could
create numbers before the correct configuration has been applied.
 
Either way, following the process below should resolve the problem - please
let me know how you get on!
 
Thanks,
 
Matt
 

--
 
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177
 

From: Matt Williams
Sent: 28 January 2016 17:56
To: 'Le Wang L' <le.l.wang at ericsson.com>
Cc: clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] [Homestead]No cached av found in impi
 
Le,
 
Is there a chance you'd previously configured Clearwater with a home_domain
of cw-ngv.com?
 
As part of installing Ellis, you create a pool of SIP URIs for it to
allocate.  These SIP URIs include the home_domain that was configured at the
time.  To change this,
?        using the Ellis UI, delete any subscribers you've already created

?        on the Ellis command line, run 'echo "DELETE FROM ellis.numbers
WHERE owner_id IS NULL ;" | sudo mysql' to delete all numbers from the pool

?        follow 
http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provis
ion-telephone-numbers-in-ellis to provision a new pool.

You can run 'echo "SELECT number FROM ellis.numbers ; " | sudo mysql' on the
Ellis command line to list all the SIP URIs in the pool, and check that they
are in the correct home domain.
 
I hope that helps - please let me know.
 
Thanks,
 
Matt
 

--
 
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177
 

From: Le Wang L [mailto:le.l.wang at ericsson.com]
Sent: 28 January 2016 17:48
To: Matt Williams <Matt.Williams at metaswitch.com>
Cc: clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Homestead]No cached av found in impi
 

Hi Matt,

 

I have Clearwater installed on different nodes, not All-In-One.

 

The home_domain name is set to ?example.com? in
/etc/clearwater/share_config.

?

# Deployment definitions
home_domain=example.com

sprout_hostname=sprout.example.com

hs_hostname=hs.example.com:8888

hs_provisioning_hostname=hs.example.com:8889

ralf_hostname=ralf.example.com:10888

xdms_hostname=homer.example.com:7888

                   

# Email server configuration

smtp_smarthost=localhost

smtp_username=username

smtp_password=password

email_recovery_sender=clearwater at example.org

                   

# Keys

signup_key=secret

turn_workaround=secret

ellis_api_key=secret

ellis_cookie_key=secret

?

 

I also run  the ?sudo service clearwater-infrastructure restart? then ?sudo
service ellis stop? commands. However, Ellis is still using ?cw-ngv.com? as
the default value for the domain.

 

But, somehow, Ellis still sends cw-ngv.com to Homestead, as you can see in
this log. And Ellis GUI generates Private Identity like
?6505550717 at cw-ngv.com? not ?6505550717 at example.com?. It feels the setting
does not apply to Ellis for some reasons.

 

28-01-2016 17:13:47.230 UTC INFO base.py:269: Sending 200 response to
localhost for PUT 
http://http_homestead_prov/irs/b736051d-b518-4f5b-8875-28aa6037d2a0/service_
profiles/3a82d92e-3fab-44de-ab32-14a29896b22b/public_ids/sip%3A6505550111%40
cw-ngv.com

 

 

BR,

Le

 

From: Matt Williams <Matt.Williams at metaswitch.com>
Date: Thursday 28 January 2016 at 18:49
To: Le Wang <le.l.wang at ericsson.com>
Cc: "clearwater at lists.projectclearwater.org"
<clearwater at lists.projectclearwater.org>
Subject: RE: [Clearwater] [Homestead]No cached av found in impi

 

Le,
 
Thanks for your email.
 
What do you have home_domain set to in /etc/clearwater/shared_config?  This
determines the domain name of the SIP URIs (IMPUs) and authentication
usernames (IMPIs) that we'd expect to see.
 
(If you installed from an all-in-one image, this defaults to example.com.
If you created your own deployment, you'd have set it during install.)
 
Please let me know.

Thanks,
 
Matt
 

--
 
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177
 

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On
Behalf Of Le Wang L
Sent: 28 January 2016 16:12
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Homestead]No cached av found in impi
 

Hi,

I am having issues with manual Clearwater installation.

The log on Homestead node shows that
> 
> 28-01-2016 14:00:05.612 UTC Warning (Net-SNMP): Warning: Failed to connect to
> the agentx master agent ([NIL]):
> 28-01-2016 14:00:12.138 UTC Verbose httpstack.cpp:286: Process request for URL
> /impi/6505550009%40example.com/av, args impu=sip%3A6505550009%40example.com
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:148: Parsed HTTP request:
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com,
> scheme Unknown, authorization
> 28-01-2016 14:00:12.138 UTC Debug handlers.cpp:174: Querying cache for
> authentication vector for 6505550009 at example.com/sip:6505550009 at example.com
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:284: Getting
> thread-local Client
> 28-01-2016 14:00:12.138 UTC Debug cassandra_store.cpp:289: No thread-local
> Client - creating one
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:673: Looking for authentication
> vector for 6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:686: Checking public ID
> sip:6505550009 at example.com
> 28-01-2016 14:00:12.139 UTC Debug cache.cpp:696: Issuing cache query
> 28-01-2016 14:00:12.140 UTC Debug cassandra_store.cpp:724: Failed TWO read for
> get_columns. Try ONE
> 28-01-2016 14:00:12.142 UTC Debug communicationmonitor.cpp:82: Checking
> communication changes - successful attempts 2, failures 0
> 28-01-2016 14:00:12.142 UTC Debug cassandra_store.cpp:437: Cassandra request
> failed: rc=2, Row 6505550009 at example.com not present in
> column_family impi
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:203: Cache query failed -
> reject request
> 28-01-2016 14:00:12.142 UTC Debug handlers.cpp:208: No cached av found for
> private ID 6505550009 at example.com, public ID sip:6505550009 at example.com -
> reject
> 28-01-2016 14:00:12.142 UTC Verbose httpstack.cpp:69: Sending response 404 to
> request for URL /impi/6505550009%40example.com/av, args
> impu=sip%3A6505550009%40example.com

>From the database, I can see that there is no ** 6505550674 at example.com**
entry but only ** 6505550674 at cw-ngv.com** entry there. This basically causes
the authentication failed and returns me 403 Forbidden when my SIP client
tries to register. 

`cqlsh:homestead_cache> select * from impi;

private_id | digest_ha1 | digest_qop | digest_realm | known_preferred
------------------------+----------------------------------+------------+---
-----------+-----------------
6505550674 at cw-ngv.com | 94f3913dcd98b380d3eed0e684a6b070 | auth | cw-ngv.com
| True

Could someone help to point out where I did wrong or there is an issue? Is
there any solution/work-around, e.g adding entries into database manually?
Which table I need to update besides impi?

Thanks.
BR,
Le


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/9132813a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5102 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/9132813a/attachment.p7s>

From Matt.Williams at metaswitch.com  Fri Jan 29 05:07:15 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 29 Jan 2016 10:07:15 +0000
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write
In-Reply-To: <007301d15a06$c3fce710$4bf6b530$@tropo.com>
References: <CAN2RUgodSqC8phJrqYEbF8x+d6VCVBLt+13cCqHTC9+Cy-6MHg@mail.gmail.com>
	<71ED8D8361F0EF45BB6B949BFDCD46710107D37A6D@ENFICSMBX1.datcon.co.uk>
	<007301d15a06$c3fce710$4bf6b530$@tropo.com>
Message-ID: <BLUPR0201MB1556280FDDBD23DFF1D32A5A90DB0@BLUPR0201MB1556.namprd02.prod.outlook.com>

Kevin,

Yes, assuming you're using clearwater_cluster_manager (and we recommend that you do), it manages /etc/clearwater/cluster_settings - it uses etcd to synchronize its configuration.

What do you see in /etc/clearwater/cluster_settings that is wrong?  It's possible there's a bug in clearwater_cluster_manager that is generating the wrong configuration.

Please let me know.

Thanks,

Matt

--
?
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177


-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin Heath High
Sent: 28 January 2016 20:02
To: Eleanor Merry <Eleanor.Merry at metaswitch.com>; clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Sprout] Memcache Error : Fail to read/write

I have run into this issue recently in two different installed (one I did, one somebody else did).  I both situations these were single sprout manual installs and both were resolved by modifying the cluster_settings file to point back to sprout.  According to the cluster_settings file it is getting created by clearwater_etcd.  Would be curious how this file is getting generated and if there is something I am doing wrong in the installation that is generating this issue.

Thanks
Kevin

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Eleanor Merry
Sent: Tuesday, January 27, 2015 10:30 AM
To: Sushant Hiray <hiraysushant at gmail.com>; clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hi Sushant, 

Do you see this error on every register attempt, or is it intermittent? How many Sprouts do you have in your deployment?

Also, can you check that the /etc/clearwater/cluster_settings file on each Sprout has the correct values - this should be a single line of the form 'memcached_servers=<sprout 1 IP address>:11211,<sprout 2 IP
address>:11211,...', and the order of the IP addresses must be identical 
address>on
each node. 

Ellie

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Sushant Hiray
Sent: 27 January 2015 09:35
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hello,

We recently shifted our clearwater infrastructure to Open Stack.

We are facing an issue with the registration of a user.
The following is the log at Sprout with log_level=5

I've highlighted the relevant error zones:

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>
Call-ID: 1374014318
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060
;line=9002fc03804a36b>;+sip.instance="<urn:uuid:43be9c7e-a58e-11e4-955c-6ddd
4f8d4915>"
Authorization: Digest username="user10 at ims.hom", realm="ims.hom", nonce="
", uri="sip:ims.hom", response=" ",integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
Supported: path, gruu
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.589 UTC Debug stack.cpp:470: Queuing cloned received message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.589 UTC Debug stack.cpp:206: Worker thread dequeue message 0x7f8734097078
26-01-2015 19:05:38.589 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:486: Authorization header in request
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\  hashes to vbucket 41 via hash 0xbdd4da29
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:373: 1 read replicas for key av\\user10 at ims.hom\



*26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:406: Attempt to read from replica 0 (connection 0x7f870c056860)26-01-2015 19:05:38.589 UTC Debug
memcachedstore.cpp:449: Read for av\\user10 at ims.hom\  on replica 0 returned error 47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015
19:05:38.589 UTC Error memcachedstore.cpp:519: Failed to read data for av\\user10 at ims.hom\  from 1 replicas*26-01-2015 19:05:38.589 UTC Debug
authentication.cpp:539: Verify authentication information in request
26-01-2015 19:05:38.589 UTC Warning authentication.cpp:204: Received an authentication request for user10 at ims.hom with nonce  , but no matching AV found
26-01-2015 19:05:38.589 UTC Debug acr.cpp:48: Created ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:644: No authentication information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.589 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f870c1b6510) created
26-01-2015 19:05:38.589 UTC Debug pjutils.cpp:461: Private identity from authorization header = user10 at ims.hom
26-01-2015 19:05:38.589 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse hs.ims.hom as IP address
26-01-2015 19:05:38.589 UTC Debug dnscachedresolver.cpp:179: Pulling 1 records from cache for hs.ims.hom A
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA records, randomizing
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888 transport 6 is not blacklisted
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:370: Added a server, now have 1 of 5
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:408: Adding 0 servers from blacklist
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.589 UTC Debug httpconnection.cpp:553: Sending HTTP request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.591 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:309: Valid AV - generate challenge
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:315: Create WWW-Authenticate header
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:359: Add Digest information
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.591 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom \2ebbd3a10aba9cfa
{"branch":"z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:540: Writing 138 bytes to table av key user10 at ims.hom\2ebbd3a10aba9cfa, CAS = 0, expiry = 40
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:560: 1 write replicas for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:609: Attempt conditional write to replica 0 (connection 0x7f870c056860), CAS = 0




*26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:652: memcached_add command for av\\user10 at ims.hom\2ebbd3a10aba9cfa failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140217998993504) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.591 UTC Error
memcachedstore.cpp:713: Failed to write data for av\\user10 at ims.hom\2ebbd3a10aba9cfa to 1 replicas26-01-2015 19:05:38.591 UTC Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom*26-01-2015 19:05:38.591 UTC Verbose
stack.cpp:259: TX 545 bytes Response msg 401/REGISTER/cseq=1
(tdta0x7f870c1b6510) to TCP 192.168.1.41:54658:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport=54658;received=192.168.1.41;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZ
Zo-H3kw
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
Call-ID: 1374014318
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>;tag=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
CSeq: 1 REGISTER
WWW-Authenticate: Digest
realm="ims.hom",nonce="2ebbd3a10aba9cfa",opaque="1fafe52f54443250",stale=tru
e,algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
26-01-2015 19:05:38.591 UTC Debug pjsip: tdta0x7f870c1b Destroying txdata Response msg 401/REGISTER/cseq=1 (tdta0x7f870c1b6510)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:82: Sending Null ACR
(0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:53: Destroyed ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug stack.cpp:208: Worker thread completed processing message 0x7f8734097078
26-01-2015 19:05:38.591 UTC Debug stack.cpp:214: Request latency = 1927us
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Processing incoming
message: Request msg REGISTER/cseq=1 (rdata0x7f873400d328)
26-01-2015 19:05:38.593 UTC Verbose stack.cpp:243: RX 848 bytes Request msg
REGISTER/cseq=1 (rdata0x7f873400d328) from TCP 192.168.1.41:42193:
--start msg--

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:42193
;rport;branch=z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK1731639894
From: <sip:user10 at ims.hom>;tag=1334365898
To: <sip:user10 at ims.hom>
Call-ID: 1090655798
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060;line=9002fc03804a36b>
Authorization: Digest username="user10 at ims.hom", realm="ims.hom", nonce="2ebbd3a10aba9cfa", uri="sip:ims.hom", response="6da3503d6706fab2f9250a96ef9136b8",
algorithm=MD5,integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.593 UTC Debug stack.cpp:470: Queuing cloned received message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.593 UTC Debug stack.cpp:206: Worker thread dequeue message 0x7f8734097078
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:486: Authorization header in request
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:373: 1 read replicas for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:406: Attempt to read from replica 0 (connection 0x7f87800cea30)


*26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:449: Read for av\\user10 at ims.hom\2ebbd3a10aba9cfa on replica 0 returned error 47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015 19:05:38.593 UTC Error memcachedstore.cpp:519: Failed to read data for av\\user10 at ims.hom\2ebbd3a10aba9cfa from 1 replicas*26-01-2015 19:05:38.593 UTC Debug authentication.cpp:539: Verify authentication information in request
26-01-2015 19:05:38.593 UTC Warning authentication.cpp:204: Received an authentication request for user10 at ims.hom with nonce 2ebbd3a10aba9cfa, but no matching AV found
26-01-2015 19:05:38.593 UTC Debug acr.cpp:48: Created ACR (0x7f878014fea0)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:644: No authentication information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.593 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f87801a2070) created
26-01-2015 19:05:38.593 UTC Debug pjutils.cpp:461: Private identity from authorization header = user10 at ims.hom
26-01-2015 19:05:38.593 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse hs.ims.hom as IP address
26-01-2015 19:05:38.593 UTC Debug dnscachedresolver.cpp:179: Pulling 1 records from cache for hs.ims.hom A
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA records, randomizing
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888 transport 6 is not blacklisted
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:370: Added a server, now have 1 of 5
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:408: Adding 0 servers from blacklist
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.593 UTC Debug httpconnection.cpp:553: Sending HTTP request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.594 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:309: Valid AV - generate challenge
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:315: Create WWW-Authenticate header
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:359: Add Digest information
26-01-2015 19:05:38.595 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.595 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom
\256f5de87094a4d0
{"branch":"z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:540: Writing 138 bytes to table av key user10 at ims.hom\256f5de87094a4d0, CAS = 0, expiry = 40
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\256f5de87094a4d0 hashes to vbucket 127 via hash 0x8c22357f
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:560: 1 write replicas for key av\\user10 at ims.hom\256f5de87094a4d0
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:609: Attempt conditional write to replica 0 (connection 0x7f87800cea30), CAS = 0





*26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:652: memcached_add command for av\\user10 at ims.hom\256f5de87094a4d0 failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140219945642544) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.595 UTC Error
memcachedstore.cpp:713: Failed to write data for
av\\user10 at ims.hom\256f5de87094a4d0 to 1 replicas26-01-2015 19:05:38.595 UTC Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom26-01-2015 19:05:38.595 UTC Verbose stack.cpp:259:
TX 546 bytes Response msg 401/REGISTER/cseq=1 (tdta0x7f87801a2070) to TCP
192.168.1.41:42193 <http://192.168.1.41:42193>:*

The Memcached server is unable to read/write the data and hence we are facing the problem.
Can you please suggest some steps so that we can curb this issue.

Thanks,
Sushant Hiray,
Senior Undergrad CSE,
IIT Bombay
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater


_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org



From shivacharanms at gmail.com  Fri Jan 29 05:42:23 2016
From: shivacharanms at gmail.com (Shiva Charan)
Date: Fri, 29 Jan 2016 16:12:23 +0530
Subject: [Clearwater] Homestead conf file missing.
In-Reply-To: <CY1PR0201MB1563A302E15F42A9E4BBD46390DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
References: <CAJAf6NxiL_60RjM+wLk-=60POy2SiksPsLghC+eJGYFUyM1faA@mail.gmail.com>
	<CY1PR0201MB15630224570CE51F4910B26C90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyULNUReE8G5-j-7km3X1NdKgRXOybLwriQQfb0S7-udA@mail.gmail.com>
	<CY1PR0201MB1563197232A39DB6717EEFBB90C30@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzjOrU9_Vf46EWWs0J--gYjK5AOZuKor6wLJM2J4F4=LA@mail.gmail.com>
	<CAJAf6NzoonOmEby4quYJtRsT3Lk6BCkXzQjhr8_wEEkpLGgB9g@mail.gmail.com>
	<CY1PR0201MB15637946ED02908A3D179E0990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzV08Bc8WhCYG72hM92FUg5cVECA_1x_M=PCJqOHJaM1g@mail.gmail.com>
	<CY1PR0201MB1563FE76A8C424670D6DC39B90C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6Nzcf6vLNNGrKVEQ6TpoWpQ=HBz85xZ+kmk4UCZ0YsMA_w@mail.gmail.com>
	<CY1PR0201MB1563975B1F6F0CA0C91DC8E990C40@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NyKLNKs3mNb5wHtVmQMwsWiA9mfjMjTJ-+gRLW=8ff6JQ@mail.gmail.com>
	<CY1PR0201MB156383DDAD803FBCEA57D64790C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NwnR1tUCrgh-q0zv__d6Pk0f8UD8MbB6xcopoN3bSVEhw@mail.gmail.com>
	<CY1PR0201MB1563BFDDD833EF2E99C12D6E90C70@CY1PR0201MB1563.namprd02.prod.outlook.com>
	<CAJAf6NzuqFqyABitYffzTSqy+BPV0P=WBDbtEfs44Et4M7+zqw@mail.gmail.com>
	<CY1PR0201MB1563A302E15F42A9E4BBD46390DA0@CY1PR0201MB1563.namprd02.prod.outlook.com>
Message-ID: <CAJAf6NyfQ6nkPVdH0eHDQwfsWx1Eo55e1sPrg6LQkUaUU1cP1A@mail.gmail.com>

Hi Matt,

I followed your steps, the calls are going thourgh now.
Thanks a ton for your help.

Thanks,
Shiva

On Thu, Jan 28, 2016 at 5:44 PM, Matt Williams <Matt.Williams at metaswitch.com
> wrote:

> Shiva,
>
>
>
> Thanks!  You need to
>
> ?         delete any subscribers you've created already (as they have the
> wrong home domain)
>
> ?         configure your DNS server to have the DNS records described in
> http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#dns-records
> - you may be able to adapt the example zone file at
> http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#configuring-zone
> to do this
>
> ?         make sure that your Clearwater VMs are configured to use the
> DNS server - if you haven't done this through DHCP, you can see
> http://clearwater.readthedocs.org/en/stable/Clearwater_DNS_Usage/index.html#client-configuration
> for more details on how to do this
>
> ?         configure your Clearwater VMs with domain names rather than IP
> addresses - see
> http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#create-the-per-node-configuration
> for per-node configuration and
> http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provide-shared-configuration
> for information that is shared across the cluster
>
> ?         delete and recreate the list of available numbers in Ellis (as
> these have the wrong home domain)
>
> o   to delete them, on the Ellis node, run 'echo "DELETE FROM
> ellis.numbers WHERE owner_id IS NULL ;" | sudo mysql'
>
> o   to create them, follow
> http://clearwater.readthedocs.org/en/stable/Manual_Install/index.html#provision-telephone-numbers-in-ellis
> again
>
> ?         create new subscribers.
>
>
>
> Does that make sense?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 28 January 2016 07:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> HI Matt,
>
>
>
> Ive installed a DNS server in my environment, what all changes do i need
> to do?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Mon, Jan 25, 2016 at 4:35 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Yes, in this trace, we do see the INVITE being sent to Bono.  In future,
> you can check this in the bono*.txt logs (as with debug logging enabled,
> all SIP messages are traced there), or with network capture.
>
>
>
> The trace shows that the bono process is being restarted regularly.  I
> suspect this is because the monit process (which monitors and restarts
> processes if they fail) is automatically polling bono with SIP OPTIONS
> messages and these requests are failing.  We see these OPTIONS messages in
> the bono logs, along with the INVITE.  The reason the OPTIONS messages are
> failing is that Bono's local_ip matches home_domain (both in
> /etc/clearwater/local_config), so the bono process doesn't know whether to
> forward these requests on to Sprout (where they fail, as expected) or to
> reply to them itself.
>
>
>
> This is a configuration error.  As I asked you below:
>
> Even when we deploy without DNS, we still configure the home domain to be
> a real domain name (even though it won't resolve in DNS).
>
> Please can you fix this configuration, and confirm that you've done so?
> When you've done this, you'll also need to recreate your subscribers on
> Ellis, as the old ones will have the wrong home domain.
>
>
>
> As below, I'd strongly recommend deploying DNS - while we may be able to
> make a non-DNS deployment work, it's going to take a lot longer, and
> require you to understand a lot more about the solution and do a lot more
> troubleshooting.
>
>
>
> The remote_cluster_settings file is used for geographic redundant
> deployments.  See
> http://clearwater.readthedocs.org/en/latest/Geographic_redundancy/ for
> more details.  You won't need this because you're not running a geographic
> redundant deployment.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 25 January 2016 10:01
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> yes i've given bono node details ( registration is successful ) please
> find the latest logs attached after I tried a call request from zoiper
> client.
>
> Is it still not connecting to bono? what should be the contents of
> "remote_cluster_settings" file in sprout?
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
> On Mon, Jan 25, 2016 at 12:06 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> The bono_current.txt file you sent contains no record of an INVITE request
> (or a 408 response).  Please can you check that the INVITE is actually
> being sent to Bono and, if it is, gather a log from Bono from this period?
>
>
>
> Also, it may well be a configuration issue on Sprout, so please gather
> Sprout's logs at the same time.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 24 January 2016 11:52
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> The registrations were successful but when it try to make the call, i get
> a 408 request time out from zoiper client.
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Sat, Jan 23, 2016 at 12:56 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> The Bono and Sprout traces seem to be from different times - the Bono
> traces are from 18:13 and the Sprout traces are from 18:52.  Do you have
> NTP configured?
>
>
>
> The Bono trace seems to show
>
> ?         a Zoiper softphone sending a REGISTER for
> sip:6505550008 at 10.222.5.159
>
> ?         Bono forwarding this on to Sprout
>
> ?         Sprout replying with a 401 authentication challenge
>
> ?         Bono forwarding this back to the Zoiper
>
> ?         a retry from the Zoiper, but no indication of it attempting to
> respond to the authentication challenge.
>
> (The Sprout trace doesn't show anything as it's from a different time.)
>
>
>
> When the Zoiper receives the 401 challenge, it should respond with a new
> REGISTER that responds to this challenge.  It's possible that the trace
> file you've shared is truncated before this happens, or maybe the Zoiper is
> not responding to the challenge for some reason.
>
>
>
> Please can you check your complete Bono logs?
>
> ?         If you see a REGISTER request containing an Authorization
> header, please can you share those logs and we can investigate if/why
> that's failing.
>
> ?         If you don't see any Authorization headers in your REGISTER
> requests, this sounds like a problem with your Zoiper configuration - it
> should be responding to the challenge.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 19:06
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Yes I understand your recommendation, but for now there is no dns server
> in my design.
>
> Will have a segregated setup for that.
>
>
>
> For now please find the bono and sproute logs attached to the mail.
>
>
>
> how do i make this work without the dns?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 7:52 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> If you're intending to implement DNS, I'd suggest doing it now rather than
> later - you're going down paths that are not well-trodden, and I'm sure
> we're going to hit lots of configuration issues.  It will be *much*
> quicker to deploy DNS now.
>
>
>
> My guess in this case is that, because the subscriber's "domain" parameter
> is an IP address, Bono is just routing the INVITE to that IP address (which
> is itself, so it fails).  Even when we deploy without DNS, we still
> configure the domain to be a real domain name (even though it won't resolve
> in DNS).
>
>
>
> If this doesn't resolve the problem, I'd suggest turning debug logging on
> in Bono and Sprout (as described at
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#bono
> and
> http://clearwater.readthedocs.org/en/latest/Troubleshooting_and_Recovery/index.html#sprout)
> - this will give you more detailed diagnostics about what's going on in
> Bono and Sprout.
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 13:16
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thanks for the recommendation, will implement DNS later on :) .
>
>
>
> And you were rite I had missed to remove a dns name for sprout, its now
> fixed i am able to open the UI and create numbers.
>
>
>
> But when trying to make a sip call via zoiper client application, the
> registration is not success full.
>
> The screen and log file is as below.
>
>
>
> [image: Inline image 2]
>
>
>
> Any idea?
>
>
>
> Thanks,
>
> Shiva
>
>
>
> On Fri, Jan 22, 2016 at 4:13 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Clearwater is very oriented around DNS.
>
> ?         DNS is used for load-balancing when you have more than 1 node
> in a cluster - in particular, following RFC 3263 for SIP.
>
> ?         DNS is used (following the rules in RFC 6733) for resolving
> Diameter realms to IP addresses.
>
>
>
> It is possible to get Clearwater running without a DNS server, but I would
> strongly recommend that you deploy a DNS server - in particular, if you
> event intend to scale up to a fault-tolerant or higher-capacity deployment,
> it is mandatory.
>
>
>
> The instructions for configuring DNS (and installing a DNS server if you
> don't already have one) are at
> http://clearwater.readthedocs.org/en/latest/Clearwater_DNS_Usage/index.html
> .
>
>
>
> Please let me know if you do definitely need to run without DNS, and we
> can look at how to set this up - but note the restrictions above on
> scalability and fault-tolerance.
>
>
>
> On the issues you're seeing below, I think the problem is that there is
> still configuration entries such as "sprout_hostname" below that contain
> both a hostname prefix and then an IP address - moving to DNS is one way to
> resolve all this.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 22 January 2016 06:02
>
>
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> An update, ive changed the share_config file as follows and also I dont
> have a dns server in my environment( I assume its not mandatory).
>
> Also find the logs below.
>
>
>
> *shared_config *
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=10.222.5.173:8888
>
> hs_provisioning_hostname=10.222.5.173:8889
>
> ralf_hostname=10.222.5.163:10888
>
> xdms_hostname=0.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> *ellis error log*
>
> 22-01-2016 05:51:32.515 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:03.235 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:03.278 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:03.295 UTC INFO homestead.py:62: Pinged Homestead OK
>
> 22-01-2016 05:52:34.010 UTC INFO main.py:115: Process 3 starting up
>
> 22-01-2016 05:52:34.055 UTC WARNING homestead.py:309: Passing SIP password
> in the clear over http
>
> 22-01-2016 05:52:34.064 UTC INFO homestead.py:62: Pinged Homestead OK
>
>
>
> *homestead log:*
>
> 22-01-2016 05:53:45.109 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:00.121 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:15.128 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:30.134 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:54:45.147 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:00.161 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:15.176 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:30.190 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 22-01-2016 05:55:45.204 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
>
>
>
>
> *homer log:*
>
> 2-01-2016 03:18:56.908 UTC INFO main.py:74: Going to listen for HTTP on
> UNIX socket /tmp/.homer-sock-0
>
>
>
> *sprout log:*
>
> 22-01-2016 05:57:49.979 UTC Status load_monitor.cpp:260: Maximum incoming
> request rate/second unchanged - only handled 20 requests in last 142284ms,
> minimum threshold for a change is 35571.000000
>
> 22-01-2016 05:58:08.533 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:08.533 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:08.533 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:38.720 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:38.720 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:58:48.752 UTC Error dnscachedresolver.cpp:567: Failed to
> retrieve record for hs.10.222.5.173: Could not contact DNS servers
>
> 22-01-2016 05:58:48.752 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:58:48.752 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
> 22-01-2016 05:59:08.926 UTC Error httpconnection.cpp:771: cURL failure
> with cURL error code 6 (see man 3 libcurl-errors) and HTTP error code 404
>
> 22-01-2016 05:59:08.926 UTC Error hssconnection.cpp:615: Could not get
> subscriber data from HSS
>
>
>
>
>
> bono and ralf log files are attached to the mail
>
>
>
>
>
>
>
> On Fri, Jan 22, 2016 at 8:55 AM, Shiva Charan <shivacharanms at gmail.com>
> wrote:
>
> Hi Matt,
>
>
>
> Seems the shared config file wasn't applied properly to the home stead
> node, i copied the config file to /etc/clearwater/ and ran
>
> "sudo service clearwater-infrastructure restart"  now almost all the
> services are running on all nodes are running, except for
>
> Program 'poll_bono'  Status failed
>
> Program 'poll_memento_https'        Status failed
>
>
>
> And Ellis UI still show the nginx welcome page.
>
>
>
> Please find the shared_config file below.
>
>
>
> [homestead]ubuntu at homestead:/etc/clearwater$ cat shared_config
>
> # Deployment definitions
>
> home_domain=10.222.5.159
>
> sprout_hostname=sprout.10.222.5.172
>
> hs_hostname=hs.10.222.5.173:8888
>
> hs_provisioning_hostname=hs.10.222.5.173:8889
>
> ralf_hostname=ralf.10.222.5.163:10888
>
> xdms_hostname=homer.10.222.5.179:7888
>
>
>
> # Email server configuration
>
> smtp_smarthost=example.com
>
> smtp_username=username
>
> smtp_password=password
>
> email_recovery_sender=clearwater at example.org
>
>
>
> # Keys
>
> signup_key=secret
>
> turn_workaround=secret
>
> ellis_api_key=secret
>
> ellis_cookie_key=secret
>
>
>
> Shiva
>
>
>
>
>
> On Fri, Jan 22, 2016 at 12:45 AM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> Thanks for this.  I notice that the URL that Ellis is trying to ping is "
> http://hs.10.222.5.173:8889/ping".  Please can you check/share your
> /etc/clearwater/shared_config file?
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Shiva Charan [mailto:shivacharanms at gmail.com]
> *Sent:* 21 January 2016 17:44
> *To:* Matt Williams <Matt.Williams at metaswitch.com>
> *Cc:* clearwater at lists.projectclearwater.org
> *Subject:* Re: [Clearwater] Homestead conf file missing.
>
>
>
> Hi Matt,
>
>
>
> Thank you for the reply.
>
>
>
> About homestead, yes I tried running "sudo service
> clearwater-infrastructure restart" did not return any error
>
>
>
> [homestead]ubuntu at homestead:/var/log/homestead$ sudo service
> clearwater-infrastructure restart
>
>  * Restarting clearwater-infrastructure clearwater-infrastructure
>
> Configuring monit for only localhost access
>
>  [ OK ]
>
> [homestead]ubuntu at homestead:/var/log/homestead$
>
>
>
> On Ellis node the process seems to run, but its not stable process
> restarts after a while.
>
>
>
> [ellis]ubuntu at ellis:/etc/clearwater$ sudo monit summary
>
> The Monit daemon 5.8.1 uptime: 9h 50m
>
>
>
> Process 'ntp_process'               Running
>
> System 'node-ellis'                 Running
>
> Process 'nginx_process'             Running
>
> Process 'mysql_process'             Running
>
> Process 'ellis_process'             Running
>
> Program 'poll_ellis'                Status ok
>
> Program 'poll_ellis_https'          Status ok
>
> Process 'clearwater_queue_manager'  Running
>
> Process 'etcd_process'              Running
>
> Program 'poll_etcd_cluster'         Waiting
>
> Program 'poll_etcd'                 Status ok
>
> Process 'clearwater_diags_monitor_process' Running
>
> Process 'clearwater_config_manager' Running
>
> Process 'clearwater_cluster_manager' Running
>
>
>
> And the ellis error log file says it failed to ping homestead.
>
> "UTC ERROR homestead.py:68: Failed to ping Homestead at
> http://hs.10.222.5.173:8889/ping. Have you configured your HOMESTEAD_URL?"
>
> netstat on homestead shows no processon 8889 port.
>
>
>
>
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
> On Thu, Jan 21, 2016 at 6:59 PM, Matt Williams <
> Matt.Williams at metaswitch.com> wrote:
>
> Shiva,
>
>
>
> It's good to hear from you.
>
>
>
> /var/lib/homestead/homestead.conf should be built by the
> clearwater-infrastructure script that is run on package installation and
> boot.  You can rerun it by typing "sudo service clearwater-infrastructure
> restart".  Do you get any errors out when you do so?
>
>
>
> You mention that ellis is displaying the nginx page.  Is the ellis process
> running?  Run "sudo monit summary" on the ellis node to find out.  If it
> isn't running, please check /var/log/ellis/ for details and, if that
> doesn't help, let me know what you see.
>
>
>
> Incidentally, please can you subscribe to the clearwater mailing list, so
> that your posts are automatically approved and you can see other people's
> questions and comments - see
> http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org
> for details.
>
>
>
> Thanks,
>
>
>
> Matt
>
>
>
> --
>
>
>
> Matt Williams
> Lead Architect, Project Clearwater
>
> +44 (0) 20 8366 1177
>
>
>
> *From:* Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org]
> *On Behalf Of *Shiva Charan
> *Sent:* 21 January 2016 12:38
> *To:* clearwater at lists.projectclearwater.org
> *Subject:* [Clearwater] Homestead conf file missing.
>
>
>
> Hi,
>
>
>
> I have a new clearwater manual install setup, homestead process has a
> "Execution failed" status.
>
>
>
> Also when i open the ellis UI with the ellis IP it goes to nginx page, how
> do i get the clearwater UI?
>
>
>
> /etc/log/homestead/homestead_current.txt says the /var/lib/homestead.conf
> file is missing. How do I get this file?
>
>
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendResult ::= { nsExtendOutput1Entry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutNumLines ::= { nsExtendOutput1Entry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutputFull ::= { nsExtendOutput1Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutput1Line ::= { nsExtendOutput1Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendOutLine ::= { nsExtendOutput2Entry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-EXTEND-MIB: nsExtendLineIndex ::= { nsExtendOutput2Entry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyStart ::= { netSnmpNotifications 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyShutdown ::= { netSnmpNotifications 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> NET-SNMP-AGENT-MIB: nsNotifyRestart ::= { netSnmpNotifications 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrMessage ::= { laEntry 101 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laErrorFlag ::= { laEntry 100 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadFloat ::= { laEntry 6 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoadInt ::= { laEntry 5 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laConfig ::= { laEntry 4 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laLoad ::= { laEntry 3 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laNames ::= { laEntry 2 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Cannot adopt OID in
> UCD-SNMP-MIB: laIndex ::= { laEntry 1 }
>
> 21-01-2016 12:33:09.196 UTC Warning (Net-SNMP): Warning: Failed to connect
> to the agentx master agent ([NIL]):
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:105: Constructing
> LoadMonitor
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:106:    Target latency
> (usecs)   : 100000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:107:    Max bucket
> size          : 20
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:108:    Initial token
> fill rate/s: 100.000000
>
> 21-01-2016 12:33:09.197 UTC Status load_monitor.cpp:109:    Min token fill
> rate/s    : 10.000000
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:142: Creating
> Cached Resolver using servers:
>
> 21-01-2016 12:33:09.197 UTC Status dnscachedresolver.cpp:152:     127.0.0.1
>
> 21-01-2016 12:33:09.197 UTC Status httpresolver.cpp:51: Created HTTP
> resolver
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:154: Configuring
> store connection
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:155:   Hostname:
>  localhost
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:156:   Port:
>  9160
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:206: Configuring
> store worker pool
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:207:   Threads:   10
>
> 21-01-2016 12:33:09.197 UTC Status cassandra_store.cpp:208:   Max Queue: 0
>
> 21-01-2016 12:33:09.198 UTC Status cassandra_store.cpp:223: Starting store
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:146: Configuring
> HTTP Connection
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:147:   Connection
> created for server :9888
>
> 21-01-2016 12:33:09.200 UTC Status httpconnection.cpp:148:   Connection
> will use a response timeout of 500ms
>
> 21-01-2016 12:33:09.200 UTC Status diameterstack.cpp:78: Initializing
> Diameter stack
>
> 21-01-2016 12:33:09.202 UTC Status diameterstack.cpp:415: Configuring
> Diameter stack from file /var/lib/homestead/homestead.conf
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: Unable to open
> configuration file for reading; tried the following locations:
> /var/lib/homestead/homestead.conf; Error: No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error freeDiameter: ERROR: in
> '((fd_conf_parse()))' :       No such file or directory
>
> 21-01-2016 12:33:09.202 UTC Error main.cpp:756: Failed to initialize
> Diameter stack - function fd_core_parseconf, rc 2
>
> 21-01-2016 12:33:09.202 UTC Status main.cpp:757: Homestead is shutting down
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:245: Stopping store
>
> 21-01-2016 12:33:09.202 UTC Status cassandra_store.cpp:255: Waiting for
> store to stop
>
>
>
> Thanks,
>
> Shiva
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/04882f1f/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 86154 bytes
Desc: not available
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/04882f1f/attachment.png>

From Matt.Williams at metaswitch.com  Fri Jan 29 07:42:29 2016
From: Matt.Williams at metaswitch.com (Matt Williams)
Date: Fri, 29 Jan 2016 12:42:29 +0000
Subject: [Clearwater] Clarification of SNMP statistics
In-Reply-To: <663823bd3b394bb6ab98ab04c2659fb9@ex15w.necnz.internal>
References: <663823bd3b394bb6ab98ab04c2659fb9@ex15w.necnz.internal>
Message-ID: <CY1PR0201MB15635B6D0709290D4D7499C490DB0@CY1PR0201MB1563.namprd02.prod.outlook.com>

Peter,

Thanks for raising this.

I think the documentation has an omission - you must install clearwater-snmpd on all nodes.  (I suspect Sprout is working because Chronos, on which it depends, in turn depends on clearwater-snmpd, but Homestead and Bono do not depend on Chronos.)

Note that we use clearwater-snmpd (a Clearwater fork of snmpd) rather than vanilla snmpd because this includes a fix that has yet to be accepted upstream.

Installing clearwater-snmpd should resolve the logs you're seeing - Bono and Homestead are trying to connect to snmpd, but it's not installed.

Incidentally, you shouldn't need any "clearwater-snmp-handler-*" packages apart from for Astaire - we've switched most components to use a different infrastructure that doesn't require these handlers, but Astaire is still pending this change.

Please let me know if installing clearwater-snmpd resolves your problems and we'll get the docs updated (or investigate more if not).

Thanks,

Matt

--

Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177

From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Peter Skrzynski
Sent: 29 January 2016 02:02
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] Clarification of SNMP statistics

Hi,
I wanted to clarify the requirements for obtaining SNMP statistics from IMS nodes.
I am running a manual install of bono/sprout/homestead/ibcf/dns with release 89 ?Vicomte de Bragelonne?.
As per the instructions in ?http://clearwater.readthedocs.org/en/latest/Clearwater_SNMP_Statistics/index.html?, I have run ?sudo apt-get install clearwater-snmp-handler-astaire? on the Sprout node only.

Specifically, the instructions state ?These SNMP statistics require: the clearwater-snmp-handler-astaire packages to be installed for Sprout and Ralf nodes?.

But what about the other IMS nodes?

Is there no other action required to activate snmp statistics for bono and homestead nodes?

Surely they require a snmp daemon to be running?

There is no snmpd entry in ?ps ?ef?, and no /etc/snmp directory, on my bono or homestead nodes, but there is on the sprout node.

Also, the log files for bono and homestead show continuous entries of?

UTC Warning (Net-SNMP): Warning: Failed to connect to the agentx master agent ([NIL]):

Does that mean that snmp is not set up correctly in those nodes?

Is the documentation incorrect when it says to install the packages only on the sprout node?

Or, in my case, do I need to do ?sudo apt-get install snmpd? on my bono and homestead nodes?

Should the documentation state that?

Any guidance would be most appreciated.

Regards,

Peter.





Peter Skrzynski
Technical Lead
NEC New Zealand Limited
NEC House, Level 6, 40 Taranaki Street, PO Box 1936, Wellington 6011, New Zealand
T: 043816257, M: 0274849530, F: +6443811110
peter.skrzynski at nec.co.nz<mailto:peter.skrzynski at nec.co.nz>
nz.nec.com<http://nz.nec.com>

[cid:image002.jpg at 01D15A91.D93FCD50]

Please consider the environment before printing this email

Attention:
The information contained in this message and or attachments is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  Any review, retransmission, dissemination, copying or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any system and destroy any copies. NEC has no liability for any act or omission in reliance on the email or any attachment.  Before opening this email or any attachment(s), please check them for viruses. NEC is not responsible for any viruses in this email or any attachment(s); any changes made to this  email or any attachment(s) after they are sent; or any effects this email or any attachment(s) have on your network or computer system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/58e68927/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 8340 bytes
Desc: image002.jpg
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160129/58e68927/attachment.jpg>

From khigh at cisco.com  Fri Jan 29 12:32:23 2016
From: khigh at cisco.com (Kevin High (khigh))
Date: Fri, 29 Jan 2016 17:32:23 +0000
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write
In-Reply-To: <BLUPR0201MB1556280FDDBD23DFF1D32A5A90DB0@BLUPR0201MB1556.namprd02.prod.outlook.com>
References: <CAN2RUgodSqC8phJrqYEbF8x+d6VCVBLt+13cCqHTC9+Cy-6MHg@mail.gmail.com>
	<71ED8D8361F0EF45BB6B949BFDCD46710107D37A6D@ENFICSMBX1.datcon.co.uk>
	<007301d15a06$c3fce710$4bf6b530$@tropo.com>
	<BLUPR0201MB1556280FDDBD23DFF1D32A5A90DB0@BLUPR0201MB1556.namprd02.prod.outlook.com>
Message-ID: <672cbbc5c38c422f99e31691f5bce7c1@XCH-RTP-004.cisco.com>

The IP address in the cluster_settings file that was created during install is the IP address of the Homer node and not the Sprout node.  I had to manually change the IP address in that file in both installations in spite of the comments at the top of the file saying not to modify manually.

Thanks
Kevin


 

-----Original Message-----
From: Matt Williams [mailto:Matt.Williams at metaswitch.com] 
Sent: Friday, January 29, 2016 2:07 AM
To: Tropo - Kevin High <khigh at tropo.com>
Cc: clearwater at lists.projectclearwater.org
Subject: RE: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Kevin,

Yes, assuming you're using clearwater_cluster_manager (and we recommend that you do), it manages /etc/clearwater/cluster_settings - it uses etcd to synchronize its configuration.

What do you see in /etc/clearwater/cluster_settings that is wrong?  It's possible there's a bug in clearwater_cluster_manager that is generating the wrong configuration.

Please let me know.

Thanks,

Matt

--
?
Matt Williams
Lead Architect, Project Clearwater
+44 (0) 20 8366 1177


-----Original Message-----
From: Clearwater [mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Kevin Heath High
Sent: 28 January 2016 20:02
To: Eleanor Merry <Eleanor.Merry at metaswitch.com>; clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Sprout] Memcache Error : Fail to read/write

I have run into this issue recently in two different installed (one I did, one somebody else did).  I both situations these were single sprout manual installs and both were resolved by modifying the cluster_settings file to point back to sprout.  According to the cluster_settings file it is getting created by clearwater_etcd.  Would be curious how this file is getting generated and if there is something I am doing wrong in the installation that is generating this issue.

Thanks
Kevin

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Eleanor Merry
Sent: Tuesday, January 27, 2015 10:30 AM
To: Sushant Hiray <hiraysushant at gmail.com>; clearwater at lists.projectclearwater.org
Subject: Re: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hi Sushant, 

Do you see this error on every register attempt, or is it intermittent? How many Sprouts do you have in your deployment?

Also, can you check that the /etc/clearwater/cluster_settings file on each Sprout has the correct values - this should be a single line of the form 'memcached_servers=<sprout 1 IP address>:11211,<sprout 2 IP
address>:11211,...', and the order of the IP addresses must be identical 
address>on
each node. 

Ellie

-----Original Message-----
From: clearwater-bounces at lists.projectclearwater.org
[mailto:clearwater-bounces at lists.projectclearwater.org] On Behalf Of Sushant Hiray
Sent: 27 January 2015 09:35
To: clearwater at lists.projectclearwater.org
Subject: [Clearwater] [Sprout] Memcache Error : Fail to read/write

Hello,

We recently shifted our clearwater infrastructure to Open Stack.

We are facing an issue with the registration of a user.
The following is the log at Sprout with log_level=5

I've highlighted the relevant error zones:

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>
Call-ID: 1374014318
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060
;line=9002fc03804a36b>;+sip.instance="<urn:uuid:43be9c7e-a58e-11e4-955c-6ddd
4f8d4915>"
Authorization: Digest username="user10 at ims.hom", realm="ims.hom", nonce="
", uri="sip:ims.hom", response=" ",integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
Supported: path, gruu
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.589 UTC Debug stack.cpp:470: Queuing cloned received message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.589 UTC Debug stack.cpp:206: Worker thread dequeue message 0x7f8734097078
26-01-2015 19:05:38.589 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:486: Authorization header in request
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\  hashes to vbucket 41 via hash 0xbdd4da29
26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:373: 1 read replicas for key av\\user10 at ims.hom\



*26-01-2015 19:05:38.589 UTC Debug memcachedstore.cpp:406: Attempt to read from replica 0 (connection 0x7f870c056860)26-01-2015 19:05:38.589 UTC Debug
memcachedstore.cpp:449: Read for av\\user10 at ims.hom\  on replica 0 returned error 47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015
19:05:38.589 UTC Error memcachedstore.cpp:519: Failed to read data for av\\user10 at ims.hom\  from 1 replicas*26-01-2015 19:05:38.589 UTC Debug
authentication.cpp:539: Verify authentication information in request
26-01-2015 19:05:38.589 UTC Warning authentication.cpp:204: Received an authentication request for user10 at ims.hom with nonce  , but no matching AV found
26-01-2015 19:05:38.589 UTC Debug acr.cpp:48: Created ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.589 UTC Debug authentication.cpp:644: No authentication information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.589 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f870c1b6510) created
26-01-2015 19:05:38.589 UTC Debug pjutils.cpp:461: Private identity from authorization header = user10 at ims.hom
26-01-2015 19:05:38.589 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse hs.ims.hom as IP address
26-01-2015 19:05:38.589 UTC Debug dnscachedresolver.cpp:179: Pulling 1 records from cache for hs.ims.hom A
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA records, randomizing
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888 transport 6 is not blacklisted
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:370: Added a server, now have 1 of 5
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:408: Adding 0 servers from blacklist
26-01-2015 19:05:38.589 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.589 UTC Debug httpconnection.cpp:553: Sending HTTP request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.591 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:309: Valid AV - generate challenge
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:315: Create WWW-Authenticate header
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:359: Add Digest information
26-01-2015 19:05:38.591 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.591 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom \2ebbd3a10aba9cfa
{"branch":"z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:540: Writing 138 bytes to table av key user10 at ims.hom\2ebbd3a10aba9cfa, CAS = 0, expiry = 40
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:560: 1 write replicas for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:609: Attempt conditional write to replica 0 (connection 0x7f870c056860), CAS = 0




*26-01-2015 19:05:38.591 UTC Debug memcachedstore.cpp:652: memcached_add command for av\\user10 at ims.hom\2ebbd3a10aba9cfa failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140217998993504) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.591 UTC Error
memcachedstore.cpp:713: Failed to write data for av\\user10 at ims.hom\2ebbd3a10aba9cfa to 1 replicas26-01-2015 19:05:38.591 UTC Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom*26-01-2015 19:05:38.591 UTC Verbose
stack.cpp:259: TX 545 bytes Response msg 401/REGISTER/cseq=1
(tdta0x7f870c1b6510) to TCP 192.168.1.41:54658:
--start msg--

SIP/2.0 401 Unauthorized
Via: SIP/2.0/TCP 192.168.1.41:54658
;rport=54658;received=192.168.1.41;branch=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZ
Zo-H3kw
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK107315516
Call-ID: 1374014318
From: <sip:user10 at ims.hom>;tag=1642292484
To: <sip:user10 at ims.hom>;tag=z9hG4bKPjQhihJs.dF7ZqIk473L9ayKtDZZo-H3kw
CSeq: 1 REGISTER
WWW-Authenticate: Digest
realm="ims.hom",nonce="2ebbd3a10aba9cfa",opaque="1fafe52f54443250",stale=tru
e,algorithm=MD5,qop="auth"
Content-Length:  0


--end msg--
26-01-2015 19:05:38.591 UTC Debug pjsip: tdta0x7f870c1b Destroying txdata Response msg 401/REGISTER/cseq=1 (tdta0x7f870c1b6510)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:82: Sending Null ACR
(0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug acr.cpp:53: Destroyed ACR (0x7f870c1aa2b0)
26-01-2015 19:05:38.591 UTC Debug stack.cpp:208: Worker thread completed processing message 0x7f8734097078
26-01-2015 19:05:38.591 UTC Debug stack.cpp:214: Request latency = 1927us
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Processing incoming
message: Request msg REGISTER/cseq=1 (rdata0x7f873400d328)
26-01-2015 19:05:38.593 UTC Verbose stack.cpp:243: RX 848 bytes Request msg
REGISTER/cseq=1 (rdata0x7f873400d328) from TCP 192.168.1.41:42193:
--start msg--

REGISTER sip:ims.hom SIP/2.0
Via: SIP/2.0/TCP 192.168.1.41:42193
;rport;branch=z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6
Path: <sip:Y77aQms8YX at 192.168.1.41:5058;transport=TCP;lr;ob>
Via: SIP/2.0/UDP 192.168.1.39:5060
;rport=5060;received=192.168.1.39;branch=z9hG4bK1731639894
From: <sip:user10 at ims.hom>;tag=1334365898
To: <sip:user10 at ims.hom>
Call-ID: 1090655798
CSeq: 1 REGISTER
Contact: <sip:user10 at 192.168.1.39:5060;line=9002fc03804a36b>
Authorization: Digest username="user10 at ims.hom", realm="ims.hom", nonce="2ebbd3a10aba9cfa", uri="sip:ims.hom", response="6da3503d6706fab2f9250a96ef9136b8",
algorithm=MD5,integrity-protected=ip-assoc-pending
Max-Forwards: 70
User-Agent: eXosip/3.1.0
Expires: 600000
P-Visited-Network-ID: ims.hom
Session-Expires: 600
Route: <sip:sprout.ims.hom:5054;transport=TCP;lr;orig>
Content-Length:  0


--end msg--
26-01-2015 19:05:38.593 UTC Debug stack.cpp:470: Queuing cloned received message 0x7f8734097078 for worker threads
26-01-2015 19:05:38.593 UTC Debug stack.cpp:206: Worker thread dequeue message 0x7f8734097078
26-01-2015 19:05:38.593 UTC Debug pjsip: sip_endpoint.c Distributing rdata to modules: Request msg REGISTER/cseq=1 (rdata0x7f8734097078)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:486: Authorization header in request
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:174: Key av\\user10 at ims.hom\2ebbd3a10aba9cfa hashes to vbucket 34 via hash 0x325860a2
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:373: 1 read replicas for key av\\user10 at ims.hom\2ebbd3a10aba9cfa
26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:406: Attempt to read from replica 0 (connection 0x7f87800cea30)


*26-01-2015 19:05:38.593 UTC Debug memcachedstore.cpp:449: Read for av\\user10 at ims.hom\2ebbd3a10aba9cfa on replica 0 returned error 47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY)26-01-2015 19:05:38.593 UTC Error memcachedstore.cpp:519: Failed to read data for av\\user10 at ims.hom\2ebbd3a10aba9cfa from 1 replicas*26-01-2015 19:05:38.593 UTC Debug authentication.cpp:539: Verify authentication information in request
26-01-2015 19:05:38.593 UTC Warning authentication.cpp:204: Received an authentication request for user10 at ims.hom with nonce 2ebbd3a10aba9cfa, but no matching AV found
26-01-2015 19:05:38.593 UTC Debug acr.cpp:48: Created ACR (0x7f878014fea0)
26-01-2015 19:05:38.593 UTC Debug authentication.cpp:644: No authentication information in request or stale nonce, so reject with challenge
26-01-2015 19:05:38.593 UTC Debug pjsip:       endpoint Response msg
401/REGISTER/cseq=1 (tdta0x7f87801a2070) created
26-01-2015 19:05:38.593 UTC Debug pjutils.cpp:461: Private identity from authorization header = user10 at ims.hom
26-01-2015 19:05:38.593 UTC Debug httpresolver.cpp:70:
HttpResolver::resolve for host hs.ims.hom, port 8888, family 2
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse hs.ims.hom as IP address
26-01-2015 19:05:38.593 UTC Debug dnscachedresolver.cpp:179: Pulling 1 records from cache for hs.ims.hom A
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:349: Found 1 A/AAAA records, randomizing
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:491: 192.168.1.43:8888 transport 6 is not blacklisted
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:370: Added a server, now have 1 of 5
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:408: Adding 0 servers from blacklist
26-01-2015 19:05:38.593 UTC Debug baseresolver.cpp:501: Attempt to parse
192.168.1.43 as IP address
26-01-2015 19:05:38.593 UTC Debug httpconnection.cpp:553: Sending HTTP request :
http://hs.ims.hom:8888/impi/user10%40ims.hom/av?impu=sip%3Auser10%40ims.hom
(trying 192.168.1.43)
26-01-2015 19:05:38.594 UTC Debug httpconnection.cpp:568: Received HTTP
response: status=200,
doc={"digest":{"ha1":"4a4a6a1e2aad77dcb54cb43acd17c59d","realm":"ims.hom","q
op":"auth"}}
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:146: Digest specified
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:309: Valid AV - generate challenge
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:315: Create WWW-Authenticate header
26-01-2015 19:05:38.594 UTC Debug authentication.cpp:359: Add Digest information
26-01-2015 19:05:38.595 UTC Debug authentication.cpp:386: Write AV to store
26-01-2015 19:05:38.595 UTC Debug avstore.cpp:66: Set AV for user10 at ims.hom
\256f5de87094a4d0
{"branch":"z9hG4bKPjqvLAEWzN3k7PI663pnNLz6zgU9Sk5XJ6","digest":{"ha1":"4a4a6
a1e2aad77dcb54cb43acd17c59d","qop":"auth","realm":"ims.hom"}}

26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:540: Writing 138 bytes to table av key user10 at ims.hom\256f5de87094a4d0, CAS = 0, expiry = 40
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:174: Key
av\\user10 at ims.hom\256f5de87094a4d0 hashes to vbucket 127 via hash 0x8c22357f
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:560: 1 write replicas for key av\\user10 at ims.hom\256f5de87094a4d0
26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:609: Attempt conditional write to replica 0 (connection 0x7f87800cea30), CAS = 0





*26-01-2015 19:05:38.595 UTC Debug memcachedstore.cpp:652: memcached_add command for av\\user10 at ims.hom\256f5de87094a4d0 failed on replica 0, rc =
47 (SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY), expiry =
40(140219945642544) SERVER HAS FAILED AND IS DISABLED UNTIL TIMED RETRY,
host: 10.129.2.112:11211 <http://10.129.2.112:11211> ->
libmemcached/connect.cc:63326-01-2015 19:05:38.595 UTC Error
memcachedstore.cpp:713: Failed to write data for
av\\user10 at ims.hom\256f5de87094a4d0 to 1 replicas26-01-2015 19:05:38.595 UTC Error avstore.cpp:71: Failed to write Authentication Vector for private_id
user10 at ims.hom26-01-2015 19:05:38.595 UTC Verbose stack.cpp:259:
TX 546 bytes Response msg 401/REGISTER/cseq=1 (tdta0x7f87801a2070) to TCP
192.168.1.41:42193 <http://192.168.1.41:42193>:*

The Memcached server is unable to read/write the data and hence we are facing the problem.
Can you please suggest some steps so that we can curb this issue.

Thanks,
Sushant Hiray,
Senior Undergrad CSE,
IIT Bombay
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater
_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/listinfo/clearwater


_______________________________________________
Clearwater mailing list
Clearwater at lists.projectclearwater.org
http://lists.projectclearwater.org/mailman/listinfo/clearwater_lists.projectclearwater.org



From khigh at cisco.com  Sun Jan 31 23:38:17 2016
From: khigh at cisco.com (Kevin High (khigh))
Date: Mon, 1 Feb 2016 04:38:17 +0000
Subject: [Clearwater] Bono issues with proxy in front
Message-ID: <739e03abe5e447b2b13f68f332884b57@XCH-RTP-004.cisco.com>

I have a SIP Proxy in front of Bono for various reasons.  This doesn't appear to be an issue when just making calls, but this becomes a big issue when using an AS since Bono always uses the there first number to that  traversed it from this IP/Port as the PAI. ( have masked confidential public addresses)

30-01-2016 19:21:10.224 UTC Debug bono.cpp:1180: Message received on non-trusted port 5060
30-01-2016 19:21:10.224 UTC Debug flowtable.cpp:136: Find flow for transport tcps0x7f5b500338e8 (2), remote address 172.20.73.137:55065
30-01-2016 19:21:10.224 UTC Debug flowtable.cpp:599: Dialog count now 2 for flow sip:4215550067 at xxx.yyy.zzz.com
30-01-2016 19:21:10.224 UTC Debug flowtable.cpp:150: Found flow record 0x7f5b440028a0
30-01-2016 19:21:10.224 UTC Debug bono.cpp:1232: Message received on known client flow
30-01-2016 19:21:10.224 UTC Debug bono.cpp:1250: Request has no P-Preferred-Identity headers, so check for default identity on flow
30-01-2016 19:21:10.224 UTC Debug pjutils.cpp:461: Adding P-Asserted-Identity header: sip:4215550067 at xxx.yyy.zzz.com

Even though this address was not in the INVITE

INVITE sip:4215550042 at xxx.yyy.zzz.com SIP/2.0
To: <sip:4215550042 at xxx.yyy.zzz.com>
Content-Type: application/sdp
CSeq: 9132 INVITE
Call-ID: 4a5cc5f406ab7658086689e8458a5f96 at 192.168.28.128
x-original-connection: 192.168.28.128
Contact: "Bob Blue" <sip:4215550091 at 162.198.77.173:6811;transport=tcp>
Via: SIP/2.0/TCP 172.20.73.137:5060;branch=z9hG4bKpkvwcnmhb0gn;x-session-id=ss_qhk6f3y4rsbo
Via: SIP/2.0/TCP 192.168.28.128:57655;branch=z9hG4bKed0e8335e680b972c76c97d5c0c37858393030;rport=6811;received=162.198.77.173;x-horizon-id=ss_qhk6f3y4rsbo;x-horizon-sign=194bd002-8332-4c36-a28a-11bb579660a8
Record-Route: <sip:172.20.73.137:5060;transport=tcp;lr>;x-session-id=ss_qhk6f3y4rsbo
Content-Length: 446
Route: <sip:bono-01.xxx.yyy.zzz.com;lr;transport=tcp;x-hor=tr>
Max-Forwards: 69
From: "Bob Blue" <sip:4215550091 at xxx.yyy.zzz.com>;tag=2352624865

But the 4215550067 was the first number I dialed from after I restart Bono.

Where this becomes a problem is that Sprout uses the PAI to determin the PSU

30-01-2016 19:34:43.173 UTC Debug pjutils.cpp:304: Served user from P-Asserted-Identity header
30-01-2016 19:34:43.173 UTC Debug uri_classifier.cpp:167: home domain: true, local_to_node: false, is_gruu: false, enforce_user_phone: false, prefer_sip: true, treat_number_as_phone: false
30-01-2016 19:34:43.173 UTC Debug uri_classifier.cpp:197: Classified URI as 4
30-01-2016 19:34:43.173 UTC Debug acr.cpp:49: Created ACR (0x7f85944e0ea0)
30-01-2016 19:34:43.173 UTC Debug scscfsproutlet.cpp:919: Single Record-Route - initiation of originating handling
30-01-2016 19:34:43.173 UTC Debug sproutletproxy.cpp:325: Creating URI for scscf
30-01-2016 19:34:43.173 UTC Debug sproutletproxy.cpp:329: Add services parameter
30-01-2016 19:34:43.174 UTC Debug sproutletproxy.cpp:337: sip:sprout.xxx.yyy.zzz.com:5054;transport=TCP;lr;service=scscf
30-01-2016 19:34:43.174 UTC Debug scscfsproutlet.cpp:925: Looking up iFCs for sip:4215550067 at xxx.yyy.zzz.com for new AS chain
30-01-2016 19:34:43.174 UTC Debug hssconnection.cpp:585: Making Homestead request for /impu/sip%3A4215550067%40xxx.yyy.zzz.com/reg-data

Which again is not a number associated with the actual call flow.

Is there any way to turn the client flow cach'ng off, or make it also look at the addresses as well as the ip/port.  I presum this is also why UDP doesn't work properly either when the phones are behind the same NAT.

Any thoughts would be appreciated.  I am also looking into being able to have the proxy server create a new TCP connections accordingly.

Thanks
Kevin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.projectclearwater.org/pipermail/clearwater_lists.projectclearwater.org/attachments/20160201/903ae00a/attachment.html>

